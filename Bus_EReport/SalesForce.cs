using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;
using DBase_EReport;
using System.Configuration;

namespace Bus_EReport
{
    public class SalesForce
    {
        private string strQry = string.Empty;
        DataTable dt = new DataTable();
        DataTable dt_recursive_Aud = new DataTable();

        DataRow dr = null;
        string Audit_mgr = string.Empty; // Added by Sri - 29Aug15
        string Audit_mgr_All = string.Empty; // Added by Sri - 29Aug15
        int iReturn_Backup = -1;
        public DataSet getSalesForce_BulkEdit(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            //strQry = " SELECT Sf_Code,Sf_Name,Sf_UserName,Sf_HQ,State_Code,Sf_Password,sf_emp_id,Designation_Code,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date FROM  Mas_Salesforce " +
            //         " WHERE Division_Code= '" + divcode + "' " +
            //         " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " ORDER BY 2";

            strQry = " SELECT Sf_Code,Sf_Name,Sf_UserName,Sf_HQ,State_Code,Sf_Password,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.Designation_Short_Name as Designation_Name,a.Designation_Code " +
                     " FROM  Mas_Salesforce a join Mas_SF_Designation b on a.Designation_Code=b.Designation_Code WHERE " +
                     " (a.Division_Code like '" + divcode + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 AND lower(sf_code) != 'admin'" +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int pcaadd(string sf_code, string div_code, string sfName, DateTime visitDate)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                string strQry = "INSERT INTO Option_Audit_PCA(Sf_Code, Sf_Name, Visit_Date,Division_Code) " +
                                "VALUES ('" + sf_code + "', '" + sfName + "', '" + visitDate.ToString("yyyy-MM-dd HH:mm") + "','" + div_code + "')";

                if (!string.IsNullOrEmpty(strQry))
                    iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        public int rcpaadd(string sf_code, string div_code, string divName, string sfName, DateTime visitDate)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                string strQry = "INSERT INTO Option_Audit_RCPA(Sf_Code, Sf_Name, Visit_Date, Division_Name, Division_Code) " +
                                "VALUES ('" + sf_code + "', '" + sfName + "', '" + visitDate.ToString("yyyy-MM-dd") + "', '" + divName + "', '" + div_code + "')";

                if (!string.IsNullOrEmpty(strQry))
                    iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }
        public DataSet getUnChmgeoMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            if (ddlmode == "5")
            {


                strQry = " select count(distinct Chemists_Code)cnt from Mas_Chemists where division_code='" + div_code + "' and sf_code='" + sf_code + "' and Chemists_Active_Flag=0 and Chemists_Code not in(select Cust_Code from map_GEO_ChemiCustomers where division_code='" + div_code + "' and statflag=0)";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getStkgeoMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            if (ddlmode == "5")
            {


                strQry = " select count(distinct D.cust_code)cnt from Mas_Stockist M inner join map_GEO_StockCustomers D on D.cust_code=cast(M.Stockist_Code as varchar) and M.division_code=D.division_code where D.division_code='" + div_code + "' and Stockist_Active_Flag=0 and statflag=0 and sf_code like '%" + sf_code + "%'";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getUnStkgeoMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            if (ddlmode == "5")
            {


                strQry = " select count(distinct Stockist_Code)cnt from Mas_Stockist where division_code='" + div_code + "' and sf_code like '%" + sf_code + "%' and Stockist_Active_Flag=0 and Stockist_Code not in(select Cust_Code from map_GEO_StockCustomers where division_code='" + div_code + "' and statflag=0)";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getChmgeoMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            if (ddlmode == "5")
            {


                strQry = " select count(distinct D.cust_code)cnt from Mas_Chemists M inner join map_GEO_ChemiCustomers D on D.cust_code=cast(M.Chemists_Code as varchar) and M.division_code=D.division_code where D.division_code='" + div_code + "' and Chemists_Active_Flag=0 and statflag=0 and sf_code='" + sf_code + "'";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet Mgrcount(string div_code, string mgr_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsTP = null;

            //strQry = "select count(DR_code)cnt from Core_Doctor_Map where Mgr_Code = '" + mgr_code + "'and division_code ='" + div_code + "' group by Mgr_code";
            strQry = "select isnull((select count(DR_code)cnt from Core_Doctor_Map where Mgr_Code = '" + mgr_code + "'and division_code ='" + div_code + "' group by Mgr_code),'0')cnt";
            try
            {
                dsTP = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsTP;
        }
        public DataSet ReleaseSession(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC ReleaseSession '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet ReleaseSssionTime(string Sfcode, string Mn, String YR)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select * from Startworks_Permission where sf_code='" + Sfcode + "' and Month(date)='" + Mn + "' and Year(date)='" + YR + "' and flag='1'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet untagGeochemist(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select distinct Cust_Code ,Chemists_Code,Chemists_Name,sf_name+'-'+sf_Designation_Short_Name+'-'+sf_hq sf_name,lat,long,MapId from map_GEO_ChemiCustomers M inner join Mas_Chemists CH on M.Cust_Code=CH.Chemists_Code inner join mas_salesforce SF on SF.sf_code=CH.sf_code where Chemists_Active_Flag=0  and M.division_code='" + divcode + "' and CH.sf_code='" + sf_code + "' order by Chemists_Name,Chemists_Code";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sp_UserList_Hierarchy_Upload(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy_ImgUpload '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        } //Added By Gowri
        public DataSet untagGeoStockist(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "select distinct M.Cust_Code ,ST.Stockist_Code,ST.Stockist_Name,M.lat,M.long,M.MapId from map_GEO_StockCustomers M inner join mas_stockist ST on M.Cust_Code=ST.Stockist_Code where M.Division_code='" + divcode + "' and ST.Stockist_Active_Flag=0 and  (ST.SF_Code like '" + sf_code + ',' + "%'  or ST.SF_Code like '%" + ',' + sf_code + ',' + "%') order by Stockist_Name,Stockist_Code";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSalesForce_BulkEditFind(string sFindQry)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT Sf_Code,Sf_Name,Sf_UserName,UsrDfd_UserName,Sf_HQ,State_Code,Sf_Password,sf_emp_id,sf_desgn,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.Designation_Short_Name as Designation_Name,b.Designation_Short_Name,a.Designation_Code FROM Mas_Salesforce a,Mas_SF_Designation b " +

                     " WHERE SF_Status = 0 AND sf_Tp_Active_flag = 0 " +
                      " and a.Designation_Code=b.Designation_Code" +
                     " AND lower(sf_code) != 'admin' " +
                     sFindQry +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSalesForce_BulkEdit_Rpt(string divcode, string sReport, string RptMgr)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT Sf_Code,Sf_Name,Sf_UserName,UsrDfd_UserName,Sf_HQ,State_Code,Sf_Password,sf_emp_id,a.Designation_Code,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date, b.Designation_Short_Name as Designation_Name " +
                     " FROM  Mas_Salesforce a join Mas_SF_Designation b on a.Designation_Code=b.Designation_Code " +
                     " WHERE (a.Division_Code like '" + divcode + ',' + "%'  or " +
                      " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 " +
                     " AND (TP_Reporting_SF = '" + sReport + "'" +
                     " OR sf_Code = '" + sReport + "' " +
                     " OR sf_Code = '" + RptMgr + "' )" +
                     " AND lower(sf_code) != 'admin' " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSfName(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Name,sf_code,sf_Designation_Short_Name, Sf_HQ FROM  Mas_Salesforce " +
                     " WHERE sf_code= '" + sfcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int BulkEdit(string str, string SF_Code)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + SF_Code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "UPDATE Mas_Salesforce SET " + str + "  Where SF_Code='" + SF_Code + "'";
                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + SF_Code + "'";
                iReturn_Backup = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }


        public DataSet getState()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsState = null;

            strQry = " SELECT '' as State_Code, '---Select---' as StateName " +
                     " UNION " +
                     " select State_Code,StateName  from Mas_State " +
                     " ORDER BY 2";

            try
            {
                dsState = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsState;
        }

        public DataSet getState_BulkEdit(string SF_Code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT State_Code FROM  Mas_Salesforce " +
                     " WHERE SF_Code='" + SF_Code + "' AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSFType(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            //strQry = "SELECT '' as Sf_Code, '---Select---' as sf_name " +
            //       " UNION " +
            //       "SELECT 'admin' as Sf_Code, 'admin' as sf_name " +
            //       " UNION " +
            //       "select Sf_Code,sf_name + ' - ' + sf_Designation_Short_Name + ' - ' + Sf_HQ from Mas_Salesforce where  (Division_Code like '" + div_code + ',' + "%'  or " +
            //       " Division_Code like '%" + ',' + div_code + ',' + "%')  AND sf_type = 2 and sf_TP_Active_Flag !=1 and SF_Status !=2";


            strQry = "SELECT '' as Sf_Code, '---Select---' as sf_name,'' as SF_VacantBlock " +
                              " UNION " +
                              "SELECT 'admin' as Sf_Code, 'admin' as sf_name,'' as SF_VacantBlock " +
                              " UNION " +
                              "select Sf_Code,sf_name + ' - ' + sf_Designation_Short_Name + ' - ' + Sf_HQ,SF_VacantBlock from Mas_Salesforce where  (Division_Code like '" + div_code + ',' + "%'  or " +
                              " Division_Code like '%" + ',' + div_code + ',' + "%')  AND sf_type = 2 and  ( sf_tp_active_flag=0 or sf_tp_active_flag=1 and SF_VacantBlock='H') and SF_Status !=2 and sf_code not in (select sf_code from Mas_Sf_Audit_Team where division_code='" + div_code + "')";



            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSFType()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "SELECT '' as Sf_Code, '---Select Manager---' as sf_name " +
                    " UNION " +
                    "SELECT 'admin' as Sf_Code, 'admin' as sf_name " +
                    " UNION " +
                    " select Sf_Code,sf_name from Mas_Salesforce where sf_type = 2"
                    ;

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getUserList_Reporting(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " SELECT '' as sf_code, '---Select---' as Sf_Name " +
                      " UNION " +
                      " SELECT 'admin' as sf_code, 'admin' as Sf_Name " +
                      " UNION " +
                      " select Sf_Code,Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name  from mas_salesforce " +
                         " where sf_status !=2 and sf_code != 'admin'  and Sf_Code in " +
                         " (select TP_Reporting_SF from mas_salesforce where sf_code != 'admin' and " +
                         " Division_Code = '" + div_code + ",') ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getUserList_Reporting()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select a.Sf_Code,a.Sf_Name  from mas_salesforce a, Mas_Division b " +
                      " where a.sf_TP_Active_Flag = 0 and" +
                       "(a.Division_Code like b.Division_Code +','+'%' or a.Division_Code like '%'+','+b.Division_Code+','+'%')  " +
                        "and b.Division_Active_Flag = 0 " +
                        " and  a.Sf_Code in (select TP_Reporting_SF from Mas_Salesforce where sf_code != 'admin' ) " +
                        " order by 2 ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // Re_P_To
        public DataSet getU_L_R(string div_code, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select Sf_Code,Sf_Name  from mas_salesforce " +
                        " where sf_TP_Active_Flag in (0,2)  and Sf_Code in " +
                        " (select TP_Reporting_SF from Mas_Salesforce where sf_code != 'admin' and TP_Reporting_SF = '" + sf_code + "' " +
                       " and (Division_Code like '" + div_code + ',' + "%'  or " +
                       " Division_Code like '%" + ',' + div_code + ',' + "%') ) ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // Approval Screen Alphabatical Search Option 
        public DataSet getUserList_Reporting(string div_code, string sAlpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " SELECT '' as sf_code, '---Select the Manager---' as Sf_Name " +
                     " UNION " +
                     " select Sf_Code,Sf_Name  from mas_salesforce " +
                        " where sf_TP_Active_Flag in (0,2) AND LEFT(Sf_Name,1) = '" + sAlpha + "'  and Sf_Code in " +
                        " (select TP_Reporting_SF from Mas_Salesforce where sf_code != 'admin' and " +
                        " (Division_Code like '" + div_code + ',' + "%'  or " +
                         " Division_Code like '%" + ',' + div_code + ',' + "%')) ";
            //" (select TP_Reporting_SF from Mas_Salesforce where sf_code != 'admin' and Division_Code = '" + div_code + "' ) " +
            //" order by Sf_Name ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet SF_Hierarchy(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, sf_Type,Reporting_To_SF,sf_hq,sf_password " +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status != 2 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND Reporting_To_SF =  '" + sf_code + "' " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet SalesForceList(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceGet '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserList(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet UserList(string divcode, string sf_code, string level)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Mail '" + divcode + "', '" + sf_code + "', '" + level + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet getSalesForcelist_Alphabet(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=0 and sf_type = 2 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_Tp_Active_flag = 0 " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForcelist_Reporting(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            if (sf_code != "admin")
            {
                strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code " +
                         " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                         " WHERE SF_Status=0 " +
                         " AND lower(sf_code) != 'admin' " +
                         " AND a.TP_Reporting_SF != '" + sf_code + "' " +
                         " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                         " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                         " ORDER BY 2";
            }
            else
            {
                strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code " +
                        " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                        " WHERE SF_Status=0 " +
                        " AND lower(sf_code) != 'admin' " +
                        " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                        " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                        " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                        " ORDER BY 2";
            }
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        // Reporting_To ( Values in Grid)
        public DataSet getSalesForcelist_Reporting_Approval(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ,a.sf_Designation_Short_Name as Designation_Name," +
                     "(select s.Sf_Name + ' - ' + s.sf_Designation_Short_Name + ' - ' + s.Sf_HQ from mas_salesforce s where sf_code=a.TP_Reporting_SF) as Reporting_To" +
                    " FROM mas_salesforce a" +
                    " WHERE lower(sf_code) != 'admin' " +
                    " AND a.TP_Reporting_SF = '" + sf_code + "' " +
                    " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                        " a.Division_Code like '%" + ',' + divcode + ',' + "%') and SF_Status !=2 " +
                    " ORDER BY 2";

            //SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ,(select sfc.Sf_Name from mas_salesforce_AM sfc where   sf_code=a.Reporting_To) as Reporting_To,(select c.Sf_Name from Mas_Salesforce_AM c where Sf_Code=a.DCR_AM) as DCR_AM  FROM mas_salesforce_AM a WHERE lower(sf_code) != 'admin'  AND a.Reporting_To = 'MGR0003'  AND a.Division_Code = '9'  ORDER BY 2
            //strQry = " SELECT SF_Code,Sf_Name,Sf_HQ,Reporting_To FROM  Mas_Salesforce_AM " +
            //" WHERE Reporting_To ='" + sf_code + "' AND Division_Code= '" + divcode + "' ";



            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        // Dropdown Reporting 
        public DataSet getView_AM(string div_code, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ," +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Reporting_To) as Reporting_To, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.DCR_AM) as DCR_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.TP_AM) as TP_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.LstDr_AM) as LstDr_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Leave_AM) as Leave_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.SS_AM) as SS_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Expense_AM) as Expense_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Otr_AM) as Otr_AM " +
            //         " FROM mas_salesforce_AM a" +
            //         " WHERE lower(sf_code) != 'admin' " +
            //         " AND a.Reporting_To = '" + sf_code + "' " +
            //         " and a.Division_Code = '" + div_code + "' " +
            //         " ORDER BY 2";

            strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ,c.sf_Designation_Short_Name as Designation_Name," +
                    "(select Sf_Name  from mas_salesforce where sf_code=a.Reporting_To)+'-'+ " +
                    "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=a.Reporting_To)+'-'+ " +
                    "(select Sf_HQ from Mas_Salesforce where sf_code=a.Reporting_To) Reporting_To, " +
                    "(select Sf_Code from Mas_Salesforce where sf_code=a.Reporting_To) Reporting, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                    " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                    " WHERE c.sf_TP_Active_Flag=0 and c.SF_Status=0 " +
                    " AND a.Reporting_To = '" + sf_code + "' " +
                    " and a.Division_Code = '" + div_code + "' " +
                    " ORDER BY 2";


            //strQry = " SELECT SF_Code,Sf_Name, Reporting_To_SF FROM  Mas_Salesforce " +
            //" WHERE Reporting_To_SF ='" + sf_code + "' AND Division_Code= '" + div_code + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getView_AM_New(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ," +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Reporting_To) as Reporting_To, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.DCR_AM) as DCR_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.TP_AM) as TP_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.LstDr_AM) as LstDr_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Leave_AM) as Leave_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.SS_AM) as SS_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Expense_AM) as Expense_AM, " +
            //         "(select Sf_Name from mas_salesforce_AM where sf_code=a.Otr_AM) as Otr_AM " +
            //         " FROM mas_salesforce_AM a" +
            //         " WHERE lower(sf_code) != 'admin' " +
            //    //  " AND a.Reporting_To = '" + sf_code + "' " +
            //         " and a.Division_Code = '" + div_code + "' " +
            //         " ORDER BY 2";

            //strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ ,c.sf_Designation_Short_Name as Designation_Name," +
            //          "(select Sf_Name  from mas_salesforce_AM where sf_code=a.Reporting_To)+'-'+ " +
            //          "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=a.Reporting_To)+'-'+ " +
            //          "(select Sf_HQ from Mas_Salesforce where sf_code=a.Reporting_To) Reporting_To, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.DCR_AM) as DCR_AM, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.TP_AM) as TP_AM, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.LstDr_AM) as LstDr_AM, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.Leave_AM) as Leave_AM, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.SS_AM) as SS_AM, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.Expense_AM) as Expense_AM, " +
            //          "(select Sf_Name from mas_salesforce_AM where sf_code=a.Otr_AM) as Otr_AM " +
            //          " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
            //          " WHERE lower(a.sf_code) != 'admin' and c.sf_TP_Active_Flag=0 and c.SF_Status=0" +
            //    //  " AND a.Reporting_To = '" + sf_code + "' " +
            //          " and a.Division_Code = '" + div_code + "' " +
            //          " ORDER BY 2";

            strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ ,c.sf_Designation_Short_Name as Designation_Name," +
                      "(select Sf_Name  from mas_salesforce where sf_code=a.Reporting_To)+'-'+ " +
                      "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=a.Reporting_To)+'-'+ " +
                      "(select Sf_HQ from Mas_Salesforce where sf_code=a.Reporting_To) Reporting_To, " +
                      "(select Sf_Code from Mas_Salesforce where sf_code=a.Reporting_To) Reporting, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                      "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                      " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                      " WHERE c.sf_TP_Active_Flag=0 and c.SF_Status=0" +
                      //  " AND a.Reporting_To = '" + sf_code + "' " +
                      " and a.Division_Code = '" + div_code + "' " +
                      " ORDER BY 2";

            //strQry = " SELECT SF_Code,Sf_Name, Reporting_To_SF FROM  Mas_Salesforce " +
            //" WHERE Reporting_To_SF ='" + sf_code + "' AND Division_Code= '" + div_code + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForcelist(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Name,a.State_Code as state_code " +
            //         " FROM mas_salesforce a, mas_state b, Mas_SF_Designation c" +
            //         " WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " AND a.State_Code=b.State_Code " +
            //         " And a.Designation_Code = c.Designation_Code" +
            //         " AND a.Division_Code like '" + divcode + ',' + "%'  or " +
            //         " a.Division_Code like '%" + ',' + divcode + "' or" +
            //         " a.Division_Code like '%" + ',' + divcode + ',' + "%' "+
            //         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
            //         " ORDER BY Sf_Name";

            strQry = "  SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, " +
                     "  (select UsrDfd_UserName from Mas_Salesforce where sf_code=a.sf_code) +'- '+ " +
                     "  (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     "  a.sf_type as Type, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
                      " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                      " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and  " +
                      " SF_Status=0  AND lower(sf_code) != 'admin' AND a.sf_Tp_Active_flag = 0 " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForcelist()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT a.SF_Code, a.Sf_Name, a.Division_Code,  a.Reporting_To_SF" +
                     " FROM mas_salesforce a, mas_state b" +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.State_Code=b.State_Code " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getDoctorCount_SFWise(string div_code, string mgr_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = " select distinct b.state_code, b.statename, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where sf_type=1 and Division_Code = a.Division_Code and " +
            //" State_Code = a.State_Code) as MR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where sf_type=2  and Division_Code = a.Division_Code and " +
            //" State_Code = a.State_Code) as MGR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where sf_type=1 and sf_Tp_Active_flag = 0 and Division_Code = a.Division_Code " +
            //" and State_Code = a.State_Code) as Active_MR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where sf_type=2  and sf_Tp_Active_flag = 0 and Division_Code = a.Division_Code " +
            //" and State_Code = a.State_Code) as Active_MGR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where sf_type=1 and sf_Tp_Active_flag = 1 and Division_Code = a.Division_Code " +
            //" and State_Code = a.State_Code) as DeActive_MR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where sf_type=2  and sf_Tp_Active_flag = 1 and Division_Code = a.Division_Code " +
            //" and State_Code = a.State_Code) as DeActive_MGR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where SF_Status=1 and sf_type=1  and Division_Code = a.Division_Code and " +
            //" State_Code = a.State_Code) as Block_MR_Count, " +
            //" (select COUNT(sf_code) from Mas_Salesforce where SF_Status=1  and sf_type=2 and Division_Code = a.Division_Code and " +
            //" State_Code = a.State_Code) as Block_MGR_Count " +
            //" from Mas_Salesforce a, Mas_State b " +
            //" where a.State_Code = b.State_Code and a.Sf_Code != 'admin' and a.Division_Code = '" + divcode + "' " +
            //" ORDER BY 2";

            strQry = "select sf_code, sf_name " +
                        " from Mas_Salesforce " +
                        " where (Division_Code like '" + div_code + ',' + "%' or Division_Code like '%" + ',' + div_code + ',' + "%')  and " +
                        " TP_Reporting_SF = '" + mgr_code + "' " +
                        " order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getDoctorCount_statewise(string div_code, string state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "select sf_code, sf_name, sf_username, sf_HQ, sf_Designation_Short_Name, sf_Designation_Short_Name as Designation_Short_Name " +
                     " from Mas_Salesforce " +
                     " where Sf_Code !='admin' and (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " and State_Code = '" + state_code + "' and " +
                     " sf_type = 1 order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSF_Status(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = " select distinct b.state_code, b.statename, " +
            " (select COUNT(sf_code) from Mas_Salesforce where sf_type=1 and Division_Code = a.Division_Code and SF_Status !=2 and  " +
            " State_Code = a.State_Code) as MR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where sf_type=2  and Division_Code = a.Division_Code and SF_Status !=2 and " +
            " State_Code = a.State_Code) as MGR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where sf_type=1 and sf_Tp_Active_flag = 0 and Division_Code = a.Division_Code and SF_Status !=2 " +
            " and State_Code = a.State_Code) as Active_MR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where sf_type=2  and sf_Tp_Active_flag = 0 and Division_Code = a.Division_Code and SF_Status !=2 " +
            " and State_Code = a.State_Code) as Active_MGR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where sf_type=1 and sf_Tp_Active_flag = 1 and Division_Code = a.Division_Code and SF_Status !=2 " +
            " and State_Code = a.State_Code) as DeActive_MR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where sf_type=2  and sf_Tp_Active_flag = 1 and Division_Code = a.Division_Code and SF_Status !=2" +
            " and State_Code = a.State_Code) as DeActive_MGR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where SF_Status=1 and sf_type=1  and Division_Code = a.Division_Code and SF_Status !=2 and " +
            " State_Code = a.State_Code) as Block_MR_Count, " +
            " (select COUNT(sf_code) from Mas_Salesforce where SF_Status=1  and sf_type=2 and Division_Code = a.Division_Code and SF_Status !=2 and " +
            " State_Code = a.State_Code) as Block_MGR_Count " +
            " from Mas_Salesforce a, Mas_State b " +
            " where a.State_Code = b.State_Code and a.Sf_Code != 'admin' and (a.Division_Code like '" + divcode + ',' + "%'  or " +
            " a.Division_Code like '%" + ',' + divcode + ',' + "%') ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        // Approval Managers
        public DataSet getApproval_Managers(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = " SELECT sf_code,sf_name,sf_hq,TP_Reporting_SF " +
                     " FROM Mas_Salesforce " +
                     " where (Division_Code like '" + divcode + ',' + "%' or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') AND sf_type = 1 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND TP_Reporting_SF = '" + sf_code + "' " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForcelist(string divcode, string sAlpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
            //         " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //         " WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
            //         " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
            //         " AND LEFT(a.sf_name,1) = '" + sAlpha + "' " +
            //         " ORDER BY Sf_Name";

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, " +
                      " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     "  (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     "  Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                     " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.Division_Code = '" + divcode + ",' " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " AND LEFT(a.sf_name,1) = '" + sAlpha + "' " +
                     " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForceBlklist(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code," +
                     "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_BlkReason,sf_Designation_Short_Name " +
                     " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code" +
                     " WHERE SF_Status=1 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (a.Division_Code like '" + divcode + ',' + "%' or " +
                     " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND a.SF_Status = 1 AND a.sf_Tp_Active_flag = 0 " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForceVaclist(string divcode, string sf_vacantblock)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, b.StateName,a.State_Code as state_code ,sf_Designation_Short_Name ," +
                    "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, " +
                    " (select count(ListedDrCode) from mas_listeddr where ListedDr_Active_Flag=0 and sf_code=a.sf_code) Dr_Count  " +
                    " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                    " WHERE SF_Status=0 " +
                    " AND lower(sf_code) != 'admin' " +
                    " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                    " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                   " AND a.sf_vacantblock = '" + sf_vacantblock + "' " +
                    " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 " +
                    " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForceVaclist(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, b.StateName,a.State_Code as state_code,sf_Designation_Short_Name ," +
                    "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF " +
                    " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                    " WHERE a.SF_Status=0 " +
                    " AND lower(a.sf_code) != 'admin' " +
                    " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                    " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                    " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 " +
                    " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet FindSalesForcelist(string sFindQry)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
            //         " FROM mas_salesforce a, mas_state b,Mas_SF_Designation c " +
            //         " WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " AND a.State_Code=b.State_Code " +
            //         " AND a.Designation_Code = c.Designation_Code" +
            //         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
            //         sFindQry +
            //         " ORDER BY Sf_Name";
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     "sf_type as Type , case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                     " FROM mas_salesforce a, mas_state b,Mas_SF_Designation c " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.State_Code=b.State_Code " +
                     " AND a.Designation_Code = c.Designation_Code" +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     sFindQry +
                     " ORDER BY Sf_Name";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForce_ReportingTo_TourPlan(string div_code, string reporting_to)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = " SELECT '' as sf_code, '---Select---' as Sf_Name " +
                     " UNION " +
                     "SELECT sf_code, Sf_Name " +
                     " FROM mas_salesforce " +
                     " WHERE Reporting_To_SF= '" + reporting_to + "' " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet SF_ReportingTo_TourPlan(string div_code, string reporting_to)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = " SELECT a.sf_code, a.Sf_Name, a.Sf_HQ,a.sf_type,b.Designation_Short_Name" +
                     " FROM mas_salesforce a, Mas_SF_Designation b" +
                     " WHERE a.Reporting_To_SF= '" + reporting_to + "' " +
                     " AND lower(a.sf_code) != 'admin' " +
                     "and a.Designation_Code=b.Designation_Code " +
                     " AND (a.Division_Code like '" + div_code + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_ReportingTo(string div_code, string reporting_to)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT a.sf_code, a.Sf_Name ,a.Sf_UserName,c.Designation_Name,a.Sf_HQ" +
                     " FROM mas_salesforce a,Mas_SF_Designation c" +
                     " WHERE a.Reporting_To_SF= '" + reporting_to + "' " +
                     " AND lower(a.sf_code) != 'admin' " +
                     " AND a.Designation_Code = c.Designation_Code" +
                     " AND (a.Division_Code like '" + div_code + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + div_code + ',' + "%') and SF_Status !=2 " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_ReportingTo_MGR(string div_code, string reporting_to, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code, Sf_Name " +
                     " FROM mas_salesforce " +
                     " WHERE Reporting_To_SF= '" + reporting_to + "' " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND sf_code != '" + sf_code + "' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSFCode_Manager(string div_code, string reporting_to, string emp_id, string sf_name, string user_name, string password)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code" +
                     " FROM mas_salesforce " +
                     " WHERE sf_type=2 and Reporting_To_SF= '" + reporting_to + "' " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " and sf_emp_id = '" + emp_id + "' and Sf_Name ='" + sf_name + "' " +
                     " and Sf_UserName = '" + user_name + "' and Sf_Password = '" + password + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        // New Change Reporting
        public DataSet Change_Rep(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Reporting_To  '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSalesForce_ReMap_ReportingTo(string div_code, string sf_code, string reporting_sf)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = "SELECT a.sf_code, a.Sf_Name ,a.Sf_UserName,c.Designation_Name,a.Sf_HQ" +
            //         " FROM mas_salesforce a,Mas_SF_Designation c" +
            //         " WHERE a.sf_code IN " +
            //         " (SELECT sf_team FROM Mas_Salesforce_Vac_RepTeam WHERE Sf_Code = '" + sf_code + "' and Reporting_To_SF='" + reporting_sf + "' and division_code like '" + div_code + "' )  and SF_Status !=2  " +
            //         " AND a.Designation_Code = c.Designation_Code" +
            //         " ORDER BY 2";

            strQry = "SELECT a.sf_code, a.Sf_Name ,a.Sf_UserName,c.Designation_Name,a.Sf_HQ" +
                   " FROM mas_salesforce a,Mas_SF_Designation c" +
                   " WHERE a.sf_code IN " +
                   " (SELECT sf_team FROM Mas_Salesforce_Vac_RepTeam WHERE Sf_Code = '" + sf_code + "'  and division_code like '" + div_code + "' )  and SF_Status !=2 and " +
                   " (select Reporting_To_SF from mas_salesforce WHERE Sf_Code = '" + sf_code + "')='" + reporting_sf + "' " +
                   " AND a.Designation_Code = c.Designation_Code" +
                   " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getsf(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code, Sf_Name,convert(varchar,Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt,convert(varchar,Last_DCR_Date,103) Last_DCR_Date" +
                     " FROM mas_salesforce " +
                     " WHERE lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getsf(string div_code, string sReport, string ReportingMGR)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code, Sf_Name,convert(varchar,Sf_TP_DCR_Active_Dt,101) Sf_TP_DCR_Active_Dt,convert(varchar,Last_DCR_Date,101) Last_DCR_Date" +
                     " FROM mas_salesforce " +
                     " WHERE lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 " +
                     " AND (TP_Reporting_SF = '" + sReport + "'" +
                     " OR sf_Code = '" + sReport + "' " +
                     " OR sf_Code = '" + ReportingMGR + "' )" +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getsf_tp(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code, Sf_Name,convert(varchar,sf_TP_Active_Dt,103) sf_TP_Active_Dt,convert(varchar,Last_TP_Date,103) Last_TP_Date" +
                     " FROM mas_salesforce " +
                     " WHERE lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                      " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 " +

                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public DataSet getReportingTo(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT Reporting_To_SF" +
                     " FROM mas_salesforce " +
                      " WHERE sf_code = '" + sf_code + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        // Datasource Reporting
        public DataSet getR_To(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code,sf_name,Reporting_To_SF " +
                     " FROM Mas_salesforce " +
                     " where Reporting_To_SF = '" + sf_code + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getActiveReportingTo(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code" +
                     " FROM mas_salesforce " +
                      " WHERE Reporting_To_SF = '" + sf_code + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public DataSet getSalesForce_ReportingTo(string div_code, string reporting_to, int sf_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT 'admin' as Sf_Code, 'admin' as sf_name " +
                    " UNION " +
                    "SELECT sf_code, Sf_Name " +
                     " FROM mas_salesforce " +
                     " WHERE sf_code != '" + reporting_to + "' " +
                     " AND sf_type = '" + sf_type + "' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') and sf_TP_Active_Flag !=1 and SF_Status !=2" +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_ReportingTo_MGR(string div_code, string reporting_to, int sf_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = " SELECT 'admin' as Sf_Code, 'admin' as sf_name " +
                     " UNION " +
                     " SELECT sf_code, Sf_Name " +
                     " FROM mas_salesforce " +
                     " WHERE sf_type = '" + sf_type + "' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     //" AND sf_tp_active_flag = 0 " +
                     " and sf_TP_Active_Flag !=1 and SF_Status !=2" +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_Active_ReportingTo(string div_code, string reporting_to, int sf_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = " SELECT sf_code, Sf_Name FROM mas_salesforce " +
                     " WHERE lower(sf_code) = 'admin' " +
                     " UNION " +
                     " SELECT sf_code, Sf_Name " +
                     " FROM mas_salesforce " +
                     " WHERE sf_type != '" + sf_type + "' " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%') and sf_TP_Active_Flag !=1 and SF_Status !=2" +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT Sf_Name,Sf_UserName,Sf_Password,convert(varchar,Sf_Joining_Date,103) Sf_Joining_Date, " +
                     " Reporting_To_SF,TP_Reporting_SF,State_Code,convert(varchar,sf_Tp_Active_Dt,103) sf_Tp_Active_Dt, " +
                     " SF_ContactAdd_One,SF_ContactAdd_Two,SF_City_Pincode,SF_Email,SF_Mobile, " +
                     " case when SF_DOB='1900-01-01' then '' else convert(varchar,sf_Dob,103) end as SF_DOB, " +
                     " SF_Per_ContactAdd_One, SF_Per_ContactAdd_Two,SF_Per_City_Pincode,SF_Per_Contact_No,SF_Cat_Code,Sf_HQ, " +
                     " Division_Code,Sf_Code,sf_Tp_Active_flag, " +
                     " (select isnull(convert(varchar,Max(Entry_Date),101),'') from Trans_DCR_Entry_HEad where sf_Code='" + sf_code + "') " +
                     "  as DCr_Last_dt,sf_Tp_Deactive_Dt,sf_emp_id,sf_short_name,Designation_Code,sf_type,subdivision_code,SF_VacantBlock,sf_BlkReason," +
                      " case when SF_DOW='1900-01-01' then '' else convert(varchar,sf_Dow,103) end as SF_DOW,UsrDfd_UserName,Fieldforce_Type,sf_desgn,Bank_Name,Bank_AcNo,IFS_Code " +
                     " FROM mas_salesforce " +
                     " WHERE Sf_Code= '" + sf_code + "' ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public int RecordUpdate(string sf_code, string sf_name, int state, string hq, string sf_design, string desig_short_name)
        {
            int iReturn = -1;
            //if (!RecordExist(div_code, div_sname))
            //{
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "UPDATE Mas_Salesforce " +
                         " SET sf_name = '" + sf_name + "', " +
                         //" sf_username = '" + usr_name + "', " +
                         " state_code = " + state + ", " +
                         " sf_hq = '" + hq + "'," +
                         " Designation_Code = '" + sf_design + "'," +
                          " sf_Designation_Short_Name = '" + desig_short_name + "'," +
                         " LastUpdt_Date = getdate() " +
                         " WHERE sf_code = '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "UPDATE Mas_Salesforce_AM " +
                        " SET Sf_Name = '" + sf_name + "' , " +
                        "Sf_HQ = '" + hq + "'  where Sf_Code = '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            //}
            //else
            //{
            //    iReturn = -3;
            //}
            return iReturn;

        }

        public int DeActivate(string sf_code, string type)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "EXEC Sp_DeactSf '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);
                if (type == "H")
                {

                    strQry = "Update Mas_SF_Block set sf_Block_Flag = 1," +
                           " sf_Block_End_Date = getdate() " +
                           //" sf_blkreason='' " +
                           " WHERE Sf_Code= '" + sf_code + "' and sf_Block_Flag=0 ";

                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int Block(string sf_code, string blkreason, string div_code, string sf_name, string sf_joining_date, string Reporting_ManagerCode, string Reporting_ManagerName, string Sf_HQ, string sf_emp_id, string sf_Designation_Short_Name, string Status)
        {
            int iReturn = -1;
            DateTime joining;
            joining = Convert.ToDateTime(sf_joining_date);

            string joining2 = joining.Month + "-" + joining.Day + "-" + joining.Year;

            try
            {

                DB_EReporting db = new DB_EReporting();




                if (Status == "B")
                {

                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);

                    strQry = "Update Mas_Salesforce set sf_status = 1 ," +
                            "  sf_blkreason = '" + blkreason + "'," +
                               "LastUpdt_Date = getdate() " +
                            " WHERE Sf_Code= '" + sf_code + "' and Division_Code='" + div_code + ",' ";

                    iReturn = db.ExecQry(strQry);


                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);
                }


                //strQry = " INSERT INTO Mas_SF_Block (sf_code,sf_Block_Reason, sf_Block_Flag, sf_Block_Start_Date, sf_Block_End_Date,   " +
                //              " Division_Code) " +
                //              " VALUES ('" + sf_code + "','" + blkreason + "' , '0', " +
                //              " getdate(), getdate(), '" + div_code + "' ) ";

                //iReturn = db.ExecQry(strQry);

                strQry = " INSERT INTO Mas_SF_Block (sf_code,sf_Block_Reason, sf_Block_Flag, sf_Block_Start_Date,   " +
                           " Division_Code,sf_name,Sf_Joining_Date,Reporting_ManagerCode,Reporting_ManagerName,Sf_HQ,sf_emp_id,sf_Designation_Short_Name,Status) " +
                           " VALUES ('" + sf_code + "','" + blkreason + "' , '0', " +
                           " getdate(),'" + div_code + "','" + sf_name + "','" + joining2 + "','" + Reporting_ManagerCode + "','" + Reporting_ManagerName + "','" + Sf_HQ + "','" + sf_emp_id + "','" + sf_Designation_Short_Name + "','" + Status + "') ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        public int Activate(string sf_code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce set sf_status = 0," +
                        " LastUpdt_Date = getdate() ," +
                        " sf_blkreason='' " +
                        " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_SF_Block set sf_Block_Flag = 1," +
                       " sf_Block_End_Date = getdate() " +
                       //" sf_blkreason='' " +
                       " WHERE Sf_Code= '" + sf_code + "' and sf_Block_Flag=0 ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int VacActivate(string sf_code, string state_code)
        {
            int iReturn = -1;
            DataSet dsVacant;
            DataSet dsVacant2;

            string empl_id = string.Empty;
            int sl_num = -1;
            int Slno = -1;
            DateTime DCR_Start_Date;
            DateTime Joining_Date;
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce set sf_Tp_Active_flag = 0," +
                         " SF_VacantBlock ='', " +
                         " LastUpdt_Date = getdate() " +
                         " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);


                if ((state_code == "") || (state_code == null))
                {
                    // Populate the new table "salesforce_vacant" before making the fieldforce as VACANT by Sridevi on 04/21/2015

                    //strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM salesforce_vacant ";
                    strQry = "SELECT isnull(max(Cast(SubString(Employee_Id,2, LEN(Employee_Id)) as int))+1,'1') FROM salesforce_vacant ";
                    sl_num = db.Exec_Scalar(strQry);

                    empl_id = "E" + sl_num.ToString();

                    strQry = " SELECT Sf_Code, Sf_Name, Designation_Code , Reporting_To_SF, Division_Code, " +
                                 " (SELECT Sf_Name FROM mas_salesforce WHERE Sf_Code = a.Reporting_To_SF) Reporting_To_SF_Name, Created_Date, LastUpdt_Date," +
                                 " sf_Designation_Short_Name,sf_emp_id,Sf_TP_DCR_Active_Dt, " +
                                 " Last_DCR_Date,Sf_Joining_Date,MONTH(Last_DCR_Date) Trans_Month,YEAR(Last_DCR_Date) Trans_Year,Sf_HQ,sf_desgn,fieldforce_type,sf_dow as Sf_Date_Confirm  " +
                                 " FROM mas_salesforce a " +
                                 " WHERE Sf_Code = '" + sf_code + "' ";

                    dsVacant = db.Exec_DataSet(strQry);

                    if (dsVacant.Tables[0].Rows.Count > 0)
                    {
                        //Populate salesforce_vacant
                        //strQry = " INSERT INTO salesforce_vacant (Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                        //            " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Division_Code ) " +
                        //            " VALUES ('" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                        //            " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                        //            " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                        //            " getdate(), getdate(), '" + dsVacant.Tables[0].Rows[0][4].ToString() + "' ) ";

                        DCR_Start_Date = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][10].ToString());
                        Joining_Date = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][12].ToString());

                        strQry = " SELECT ISNULL(max(Sl_No),0) FROM salesforce_vacant where SF_Code='" + sf_code + "' ";
                        Slno = db.Exec_Scalar(strQry);

                        //Populate salesforce_vacant
                        strQry = " INSERT INTO salesforce_vacant (Sl_No,Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                                    " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Division_Code,sf_Designation_Short_Name, " +
                                    " Employee_Code,DCR_Start_Date,Joining_Date,Sf_HQ,Created_Date,category,fieldforce_type,Sf_Date_Confirm) " +
                                    " VALUES ('" + Slno + "','" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                                    " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                                    " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                                    " getdate(), getdate(), '" + dsVacant.Tables[0].Rows[0][4].ToString() + "' ,'" + dsVacant.Tables[0].Rows[0][8].ToString() + "', " +
                                    " '" + dsVacant.Tables[0].Rows[0][9].ToString() + "','" + DCR_Start_Date.ToString("MM/dd/yyyy") + "','" + Joining_Date.ToString("MM/dd/yyyy") + "'," +
                                    " '" + dsVacant.Tables[0].Rows[0][15].ToString() + "',getdate(),'" + dsVacant.Tables[0].Rows[0]["sf_desgn"].ToString() + "','" + dsVacant.Tables[0].Rows[0]["fieldforce_type"].ToString() + "','" + dsVacant.Tables[0].Rows[0]["Sf_Date_Confirm"].ToString() + "') ";

                        iReturn = db.ExecQry(strQry);


                        string div_code = string.Empty;

                        if (dsVacant.Tables[0].Rows[0][4].ToString().Contains(','))
                        {
                            div_code = dsVacant.Tables[0].Rows[0][4].ToString().Remove(dsVacant.Tables[0].Rows[0][4].ToString().Length - 1);
                        }

                        string join_date = Joining_Date.Year + "-" + Joining_Date.Month + "-" + Joining_Date.Day;
                        string end_date = Joining_Date.Year + "-" + "12" + "-" + "31";
                        TimeSpan timespan = Convert.ToDateTime(end_date).Subtract(Convert.ToDateTime(join_date));

                        float days = Convert.ToInt16(timespan.Days);
                        float tot = 8, annual_tot = 365;

                        double leave_days = (tot / annual_tot * days);



                        int dayss = Convert.ToInt16(Math.Round(leave_days));

                        // SalesForce sf = new SalesForce();
                        string sl_no = string.Empty;

                        sl_no = RecordHeadAdd_Leave_Entitle(sf_code, div_code, Joining_Date.Year.ToString(), dsVacant.Tables[0].Rows[0][9].ToString());

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "CL", dayss.ToString(), div_code);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "SL", dayss.ToString(), div_code);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "PL", "0", div_code);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "LOP", "0", div_code);
                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "TL", "0", div_code);
                    }


                    strQry = " select Mail_Active_Flag from Trans_Mail_Detail where Open_Mail_Id='" + sf_code + "' and Mail_Active_Flag=0 ";
                    dsVacant2 = db.Exec_DataSet(strQry);

                    if (dsVacant2.Tables[0].Rows.Count > 0)
                    {

                        strQry = "update Trans_Mail_Detail set Mail_Active_Flag=10 where Open_Mail_Id='" + sf_code + "' " +
                             " and Mail_Active_Flag=0  ";

                        iReturn = db.ExecQry(strQry);
                    }

                    strQry = "  select Delayed_Flag from DCR_Delay_Dtls WHERE Sf_Code = '" + sf_code + "' and Delayed_Flag =1 ";
                    dsVacant2 = db.Exec_DataSet(strQry);

                    if (dsVacant2.Tables[0].Rows.Count > 0)
                    {
                        strQry = "UPDATE DCR_Delay_Dtls " +
                                 " SET Delayed_Flag = 0 ," +
                                 " Delay_Release_Date = NULL, Released_by_Whom = '' " +
                                 " WHERE Sf_Code = '" + sf_code + "' and Delayed_Flag =1 ";

                        iReturn = db.ExecQry(strQry);
                    }

                    strQry = " select status from DCR_MissedDates  WHERE Sf_Code = '" + sf_code + "' and status =1 ";
                    dsVacant2 = db.Exec_DataSet(strQry);

                    if (dsVacant2.Tables[0].Rows.Count > 0)
                    {

                        strQry = " UPDATE DCR_MissedDates " +
                                " SET [status] = 0 , " +
                                " Missed_Release_Date = NULL , Released_by_Whom = '' " +
                                " WHERE Sf_Code = '" + sf_code + "' and status =1 ";

                        iReturn = db.ExecQry(strQry);
                    }

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }



        public DataSet GetUserName(string div_code, string state_code, string designation_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "declare @DivName varchar(5)" +
                    "declare @ShName varchar(5)" +
                    "declare @DnName varchar(5)" +
                    "set @DivName=(select upper(Division_SName) Division_SName from  Mas_Division WHERE Division_Code=" + div_code + ")" + " " +
                    "set @ShName=(select ShortName from Mas_State where State_Code=" + state_code + ")" + " " +
                    "set @DnName=(select isnull(Designation_Short_Name,'') from Mas_SF_Designation where Designation_Code=" + designation_code + ")" + " " +
                    "select @DivName as Division_SName" + " " +
                    "select @ShName as ShortName" + " " +
                    "select @DnName as Designation_Short_Name" + " " +
                    "select @DivName+@ShName+@DnName CompletedName" + " " +
                    "declare @AutoNum varchar(10)" +
                    "declare @Incr int " +
                    "declare @Count int " +
                    "select @Count=(select count(Sf_UserName) from mas_salesforce where Sf_UserName like '%' +@DivName+@ShName+@DnName+'%')" + " " +
                    "set @Incr=@Count" + " " +
                    "set @AutoNum=CAST(@Incr+RIGHT(CAST(ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS VARCHAR(3)),0) AS VARCHAR(30))+1" + " " +
                    "select @AutoNum Number";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Added by Sri - to check duplicte user name
        public bool CheckDupUserName(string User_Name, string sf_code)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(UsrDfd_UserName) FROM Mas_Salesforce WHERE UsrDfd_UserName='" + User_Name + "'  AND sf_code !='" + sf_code + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }

        //Added by Sri - to check duplicte user name
        public bool CheckDupUserName(string User_Name)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(UsrDfd_UserName) FROM Mas_Salesforce WHERE UsrDfd_UserName='" + User_Name + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        public string RecordAdd(string sf_name, string user_name, string password, DateTime joining_date, string reporting_to, string state_code, DateTime tp_dcr_start_date, string contact_address1, string contact_address2, string contact_citypin, string email, string mobile, string dob, string dow, string permanent_address1, string permanent_address2, string permanent_citypin, string permanent_contact_no, string sf_hq, string div_code, int sf_type, string emp_id, string short_name, string desgn, string sub_division, string des_sname, string UsrDfd_UserName, int Fieldforce_Type, string category, string txtBankName, string txtAcountNo, string txtIFSC)
        {
            int iReturn = -1;
            string strSfCode = string.Empty;
            string sf_code = string.Empty;
            string strjoinDate = joining_date.Month + "-" + joining_date.Day + "-" + joining_date.Year;
            string strtp_dcr_start_date = tp_dcr_start_date.Month + "-" + tp_dcr_start_date.Day + "-" + tp_dcr_start_date.Year;
            string sEmp_ID = string.Empty;

            if (!CheckDupUserName(UsrDfd_UserName))
            {

                if (!CheckDupEmp_id(emp_id, div_code))
                {

                    try
                    {

                        DB_EReporting db = new DB_EReporting();


                        int sf_sl_no = -1;
                        DateTime deactDt = DateTime.Now.AddDays(-1);

                        strQry = "SELECT ISNULL(Max(sf_Sl_No),0)+1 FROM mas_salesforce WHERE Sf_Code !='admin'";
                        sf_sl_no = db.Exec_Scalar(strQry);

                        string sftype = string.Empty;
                        if (sf_type == 1)
                        {
                            sftype = "MR";
                            strQry = "SELECT  Max(Cast(SubString(Sf_Code,3, LEN(Sf_Code)) as int))+1 FROM mas_salesforce where Sf_Code like '" + sftype + "%'  ";
                        }
                        else
                        {
                            sftype = "MGR";
                            strQry = "SELECT  Max(Cast(SubString(Sf_Code,4, LEN(Sf_Code)) as int))+1 FROM mas_salesforce where Sf_Code like '" + sftype + "%'  ";
                        }

                        //strQry = "SELECT COUNT(Sf_Code)+1 FROM mas_salesforce where  Sf_Code like '" + sftype + "%' ";
                        //   strQry = "SELECT  max(Cast(SubString(Sf_Code,4, LEN(Sf_Code)) as int))+1 FROM mas_salesforce where Sf_Code like '" + sftype + "%'  ";
                        int iCnt = db.Exec_Scalar(strQry);
                        if (iCnt.ToString().Length == 1)
                        {
                            sf_code = "000" + iCnt.ToString();
                        }
                        else if (iCnt.ToString().Length == 2)
                        {
                            sf_code = "00" + iCnt.ToString();
                        }
                        else if (iCnt.ToString().Length == 3)
                        {
                            sf_code = "0" + iCnt.ToString();
                        }
                        else
                        {
                            sf_code = iCnt.ToString();
                        }
                        sf_code = sftype + sf_code;

                        sEmp_ID = "E" + sf_sl_no.ToString();
                        // Changed on 6th june 15 to include last dcr date - sridevi
                        strQry = " INSERT INTO Mas_Salesforce(Sf_Code,Sf_Name,Sf_UserName,Sf_Password,Sf_Joining_Date, " +
                               "Reporting_To_SF,TP_Reporting_SF,State_Code,sf_Tp_Active_Dt,Sf_TP_DCR_Active_Dt,SF_ContactAdd_One, " +
                               " SF_ContactAdd_Two,SF_City_Pincode,SF_Email,SF_Mobile,SF_DOB,SF_DOW,SF_Per_ContactAdd_One,SF_Per_ContactAdd_Two, " +
                               " SF_Per_City_Pincode,SF_Per_Contact_No,SF_Cat_Code,SF_Status,Sf_HQ,Division_Code,Created_Date,sf_Tp_Active_flag, " +
                               " sf_Tp_Deactive_Dt,sf_Sl_No,sf_type,sf_emp_id,sf_short_name,Designation_Code,LastUpdt_Date,subdivision_code, Employee_Id,Last_DCR_Date,sf_Designation_Short_Name,UsrDfd_UserName,Last_TP_Date,Fieldforce_Type,Sf_Deactivate_Permanent,sf_desgn,Bank_Name,Bank_AcNo,IFS_Code) " +
                               " VALUES ( '" + sf_code + "' , '" + sf_name + "', '" + user_name + "', '" + password.Trim() + "', '" + strjoinDate + "', " +
                               "  '" + reporting_to + "' , '" + reporting_to + "' , '" + state_code + "', '" + strtp_dcr_start_date + "', '" + strtp_dcr_start_date + "' , " +
                               " '" + contact_address1 + "', '" + contact_address2 + "', '" + contact_citypin + "', '" + email + "', '" + mobile + "', " +
                               " '" + dob + "','" + dow + "' , '" + permanent_address1 + "', '" + permanent_address2 + "' , '" + permanent_citypin + "', " +
                               " '" + permanent_contact_no + "', '0' , '0', " +
                               " '" + sf_hq + "' , '" + div_code + "' , getdate(), '0', '" + deactDt.Month + "-" + deactDt.Day + "-" + deactDt.Year + "', '" + sf_sl_no + "', " + sf_type + ", '" + emp_id + "', '" + short_name + "', '" + desgn + "',getdate(),'" + sub_division + "' , '" + sEmp_ID + "' ,'" + strtp_dcr_start_date + "', '" + des_sname + "','" + UsrDfd_UserName.Trim() + "','" + strtp_dcr_start_date + "','" + Fieldforce_Type + "','0','" + category + "','" + txtBankName + "','" + txtAcountNo + "','" + txtIFSC + "') ";

                        iReturn = db.ExecQry(strQry);

                        if (div_code.Contains(','))
                        {
                            div_code = div_code.Remove(div_code.Length - 1);
                        }


                        DataSet DsSal = null;

                        string type_code = category + Fieldforce_Type;

                        strQry = "select HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance,FareKm_Allowance,Range_of_Fare1,Range_of_Fare2, " +
                               " Effective_Form,Fixed_Column1,Fixed_Column2,Fixed_Column3,Fixed_Column4,Fixed_Column5,Meeting_Expenses " +
                               " from Mas_Desig_Allowance where division_code='" + div_code + "' and Designation_Code='" + desgn + "' and Type_code='" + type_code + "' ";

                        DsSal = db.Exec_DataSet(strQry);

                        if (DsSal.Tables[0].Rows.Count > 0)
                        {
                            strQry = " INSERT INTO Mas_Allowance_Fixation(sf_code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance,FareKm_Allowance,Range_of_Fare1,Range_of_Fare2, " +
                                   " Effective_Form,Fixed_Column1,Fixed_Column2,Fixed_Column3,Fixed_Column4,Fixed_Column5,Meeting_Expenses,Designation_Code,sf_Designation_Short_Name,division_code) VALUES('" + sf_code + "','" + DsSal.Tables[0].Rows[0][0].ToString() + "', " +
                                   " '" + DsSal.Tables[0].Rows[0][1].ToString() + "','" + DsSal.Tables[0].Rows[0][2].ToString() + "','" + DsSal.Tables[0].Rows[0][3].ToString() + "','" + DsSal.Tables[0].Rows[0][4].ToString() + "', " +
                                   " '" + DsSal.Tables[0].Rows[0][5].ToString() + "','" + DsSal.Tables[0].Rows[0][6].ToString() + "','" + DsSal.Tables[0].Rows[0][7].ToString() + "','" + DsSal.Tables[0].Rows[0][8].ToString() + "', " +
                                   " '" + DsSal.Tables[0].Rows[0][9].ToString() + "','" + DsSal.Tables[0].Rows[0][10].ToString() + "','" + DsSal.Tables[0].Rows[0][11].ToString() + "','" + DsSal.Tables[0].Rows[0][12].ToString() + "' ," +
                                   " '" + DsSal.Tables[0].Rows[0][13].ToString() + "','" + desgn + "','" + des_sname + "','" + div_code + "')";

                            iReturn = db.ExecQry(strQry);
                        }

                        strQry = "SELECT isnull(max([S.No])+1,'1') [S.No] from Screen_Lock ";
                        int SNo = db.Exec_Scalar(strQry);


                        strQry = " INSERT INTO Screen_Lock([S.No],Mgr_Code, SF_Code,Div_Code,DCR_Lock,TP_Lock,SDP_Lock,Camp_Lock,DR_Lock,Update_dtm) " +
                             " VALUES ( '" + SNo + "','admin' , '" + sf_code + "' , '" + div_code + "', '0' ,'0','0','0','0', getdate()) ";

                        iReturn = db.ExecQry(strQry);

                        string join_date = joining_date.Year + "-" + joining_date.Month + "-" + joining_date.Day;
                        string end_date = joining_date.Year + "-" + "12" + "-" + "31";
                        TimeSpan timespan = Convert.ToDateTime(end_date).Subtract(Convert.ToDateTime(join_date));

                        float days = Convert.ToInt16(timespan.Days);
                        float tot = 8, annual_tot = 365;

                        double leave_days = (tot / annual_tot * days);



                        int dayss = Convert.ToInt16(Math.Round(leave_days));

                        // SalesForce sf = new SalesForce();
                        string sl_no = string.Empty;

                        sl_no = RecordHeadAdd_Leave_Entitle(sf_code, div_code, joining_date.Year.ToString(), emp_id);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "CL", dayss.ToString(), div_code);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "SL", dayss.ToString(), div_code);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "PL", "0", div_code);

                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "LOP", "30", div_code);
                        RecordDetailsAdd_Leave_Entitle(sl_no, sf_code, "TL", "0", div_code);

                        //strQry = "Insert Into mas_salesforce_dcrtpdate(Sf_Code,last_dcr_date,last_tp_date) VALUES ('" + sf_code + "','" + strtp_dcr_start_date + "','" + strtp_dcr_start_date + "')";
                        //iReturn = db.ExecQry(strQry);


                    }
                    catch (Exception ex)
                    {
                        throw ex;
                    }
                    //}
                    //else
                    //{
                    //    iReturn = -2;
                    //}
                    if (iReturn > 0)
                    {
                        strSfCode = sf_code; //Pass Sf Code for Salesforce_ApprovalManager table data creation
                        if (sf_type == 1)
                        {
                            AdminSetup adm = new AdminSetup();
                            if (div_code.Contains(','))
                            {
                                div_code = div_code.Remove(div_code.Length - 1);
                            }
                            iReturn = adm.Add_Admin_FieldForce_Setup(strSfCode, div_code, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1);
                        }
                    }
                    return strSfCode;
                }
                else
                {

                    return "Dup_Emp";
                }
            }
            else
            {
                return "Dup";
            }

        }
        public int RecordAddApprovalMgr(string sfcode, string sf_name, string sf_hq, string DCR_AM, string TP_AM, string Leave_AM, string LstDr_AM, string SS_AM, string Expense_AM, string Otr_AM, string reporting_to, string Div_Code)
        {
            int iReturn = -1;
            try
            {

                DB_EReporting db = new DB_EReporting();



                strQry = "INSERT INTO Mas_Salesforce_AM(Sf_Code,Sf_Name,Sf_HQ,DCR_AM,TP_AM,LstDr_AM,Leave_AM,SS_AM,Expense_AM,Otr_AM,Reporting_To,Division_Code) " +
                         " VALUES ( '" + sfcode + "' ,'" + sf_name + "','" + sf_hq + "', '" + DCR_AM + "', '" + TP_AM + "', '" + LstDr_AM + "', '" + Leave_AM + "', " +
                         " '" + SS_AM + "' ,'" + Expense_AM + "', '" + Otr_AM + "' , '" + reporting_to + "' ,'" + Div_Code + "') ";



                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            //}
            //else
            //{
            //    iReturn = -2;
            //}
            return iReturn;
        }
        //Modified by Sri - 29Aug15
        public int RecordUpdate(string sf_code, string sf_name, string user_name, string password, DateTime joining_date, string reporting_to, string state_code, DateTime tp_dcr_start_date, string contact_address1, string contact_address2, string contact_citypin, string email, string mobile, string dob, string dow, string permanent_address1, string permanent_address2, string permanent_citypin, string permanent_contact_no, string sf_hq, string div_code, int sf_type, string emp_id, string short_name, string desgn, string sub_division, string UsrDfd_UserName, string sf_Designation_Short_Name, int Fieldforce_Type, string category, string txtBankName, string txtAcountNo, string txtIFSC)
        {
            int iReturn = -1;
            string strSfCode = string.Empty;

            string strjoinDate = joining_date.Month + "-" + joining_date.Day + "-" + joining_date.Year;
            string strtp_dcr_start_date = tp_dcr_start_date.Month + "-" + tp_dcr_start_date.Day + "-" + tp_dcr_start_date.Year;

            if (!CheckDupUserName(UsrDfd_UserName, sf_code))
            {
                if (!CheckDuplicateEmp_id(emp_id, sf_code, div_code))
                {
                    try
                    {
                        DB_EReporting db = new DB_EReporting();

                        strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                        iReturn_Backup = db.ExecQry(strQry);

                        strQry = "Update Mas_Salesforce set Sf_Name = '" + sf_name + "', Sf_UserName = '" + user_name + "' , " +
                                 " Sf_Password = '" + password.Trim() + "', Sf_Joining_Date = '" + strjoinDate + "' , " +
                                 " Reporting_To_SF=  '" + reporting_to + "', TP_Reporting_SF= '" + reporting_to + "', " +
                                 " State_Code= '" + state_code + "', sf_Tp_Active_Dt= '" + strtp_dcr_start_date + "', Sf_TP_DCR_Active_Dt= '" + strtp_dcr_start_date + "' , " +
                                 " SF_ContactAdd_One = '" + contact_address1 + "', SF_ContactAdd_Two= '" + contact_address2 + "', " +
                                 " SF_City_Pincode= '" + contact_citypin + "',  SF_Email= '" + email + "', SF_Mobile= '" + mobile + "', " +
                                 " SF_DOB = '" + dob + "',SF_DOW = '" + dow + "', SF_Per_ContactAdd_One='" + permanent_address1 + "', " +
                                 " SF_Per_ContactAdd_Two = '" + permanent_address2 + "',SF_Per_City_Pincode= '" + permanent_citypin + "', " +
                                 " SF_Per_Contact_No= '" + permanent_contact_no + "', Sf_HQ='" + sf_hq + "'," +
                                 " sf_emp_id = '" + emp_id + "', sf_short_name = '" + short_name + "', Designation_Code = '" + desgn + "', " +
                                 " LastUpdt_Date = getdate(), subdivision_code = '" + sub_division + "' ," +
                                 " UsrDfd_UserName = '" + UsrDfd_UserName.Trim() + "', sf_Designation_Short_Name = '" + sf_Designation_Short_Name + "',Fieldforce_Type='" + Fieldforce_Type + "',sf_desgn='" + category + "' " +
                                 " ,Bank_Name= '" + txtBankName + "',Bank_AcNo= '" + txtAcountNo + "',IFS_Code= '" + txtIFSC + "' WHERE Sf_Code= '" + sf_code + "' ";

                        iReturn = db.ExecQry(strQry);

                        strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                        iReturn_Backup = db.ExecQry(strQry);

                        strQry = "Update Mas_Salesforce_AM set Sf_Name = '" + sf_name + "' , Sf_HQ ='" + sf_hq + "' ,Reporting_To ='" + reporting_to + "' " +
                               " where Sf_Code = '" + sf_code + "' ";

                        iReturn = db.ExecQry(strQry);

                    }
                    catch (Exception ex)
                    {
                        throw ex;
                    }
                    //}
                    //else
                    //{
                    //    iReturn = -2;
                    //}
                    return iReturn;
                }
                else
                {
                    return -90;
                }
            }
            else
            {
                return -99;
            }
        }
        public int RecordUpdate(string sf_code)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce set sf_Tp_Active_flag = 1 ," +
                         " LastUpdt_Date = getdate() " +
                         " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }

        public int RecordUpdate(string sf_code, string reporting, string hold)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                if ((hold == "") || (hold == null))
                {

                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);

                    strQry = "Update Mas_Salesforce " +
                             " set Reporting_To_SF = '" + reporting + "', TP_Reporting_SF = '" + reporting + "' ," +
                              " LastUpdt_Date = getdate() " +
                             " WHERE Sf_Code= '" + sf_code + "' ";

                    iReturn = db.ExecQry(strQry);

                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);

                    RecordUpdate_App(sf_code, reporting, reporting, reporting, reporting, reporting, reporting, reporting);
                }
                else
                {
                    RecordUpdate_App(sf_code, reporting, reporting, reporting, reporting, reporting, reporting, reporting);
                    iReturn = 1;
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }

        public int BulkUpdateDCR(string sf_code, DateTime dcr)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                // Modified on 6th june 15 to include last dcr date.
                strQry = "Update Mas_Salesforce " +
                         // " set Sf_TP_DCR_Active_Dt =  '" + dcr.Month.ToString() + "-" + dcr.Day + "-" + dcr.Year + "' , " +
                         " set  Last_Dcr_Date =  '" + dcr.Month.ToString() + "-" + dcr.Day + "-" + dcr.Year + "' , " +
                          " LastUpdt_Date = getdate() " +
                         " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Update mas_salesforce_DCRTPdate " +
                         // " set Sf_TP_DCR_Active_Dt =  '" + dcr.Month.ToString() + "-" + dcr.Day + "-" + dcr.Year + "' , " +
                         " set  Last_Dcr_Date =  '" + dcr.Month.ToString() + "-" + dcr.Day + "-" + dcr.Year + "'  " +

                         " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public int BulkUpdateTP(string sf_code, DateTime tp)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce " +
                         //" set Sf_TP_Active_Dt = '" + tp.Month.ToString() + "-" + tp.Day + "-" + tp.Year + "' , " +
                         " set Last_TP_Date =  '" + tp.Month.ToString() + "-" + tp.Day + "-" + tp.Year + "' , " +
                          " LastUpdt_Date = getdate() " +
                         " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Update mas_salesforce_DCRTPdate " +
                    //" set Sf_TP_Active_Dt = '" + tp.Month.ToString() + "-" + tp.Day + "-" + tp.Year + "' , " +
                    " set Last_TP_Date =  '" + tp.Month.ToString() + "-" + tp.Day + "-" + tp.Year + "'  " +

                    " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        // Approval Changes Update
        public int Update_App(string sf_code, string sMgr, string sMode)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Update Mas_Salesforce_AM ";
                if (sMode == "DCR")
                {
                    strQry = strQry + " set DCR_AM = '" + sMgr + "' ";
                }
                else if (sMode == "TP")
                {
                    strQry = strQry + " set TP_AM = '" + sMgr + "' ";
                }
                else if (sMode == "LstDr")
                {
                    strQry = strQry + " set LstDr_AM = '" + sMgr + "' ";
                }
                else if (sMode == "Leave")
                {
                    strQry = strQry + " set Leave_AM = '" + sMgr + "' ";
                }
                else if (sMode == "SS")
                {
                    strQry = strQry + " set SS_AM = '" + sMgr + "' ";
                }
                else if (sMode == "Expense")
                {
                    strQry = strQry + " set Expense_AM = '" + sMgr + "' ";
                }
                else if (sMode == "Otr")
                {
                    strQry = strQry + " set Otr_AM = '" + sMgr + "' ";
                }

                strQry = strQry + " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);


            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }

        public DataSet getUserList_Reporting_All(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " SELECT '0' as sf_code, '---ALL---' as Sf_Name " +
                     " UNION " +
                     " select Sf_Code,Sf_Name  from mas_salesforce " +
                     " where sf_TP_Active_Flag in (0,2)  and Sf_Code in " +
                     " (select TP_Reporting_SF from Mas_Salesforce where sf_code != 'admin' and (Division_Code like '" + div_code + ',' + "%' or " +
                     " Division_Code like '%" + ',' + div_code + ',' + "%')  ) " +
                     " order by 2";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //16Jul - Sridevi - To check the type of SF(MR or MGR)
        public DataSet CheckSFType(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select sf_type from Mas_Salesforce where sf_code = '" + sf_code + "'";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //16Jul - Sridevi - To get the list of MRs under the Manager
        public DataSet UserList_getMR(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getMR '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Sridevi- Procedures for Report
        public DataSet UserList_Hierarchy(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_Hierarchy_New(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy_New '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserList_Alpha(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Alpha '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_getMR(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //strQry = "EXEC sp_UserList_getMR '" + divcode + "', '" + sf_code + "' ";

            strQry = "    SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type, " +
                        " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password " +
                        " FROM mas_salesforce a " +
                        " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and (a.Division_Code like '" + divcode + ',' + "%'  or " +
                        " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                        " and a.sf_code !='admin' and a.sf_type=1 " +
                        " order by 2 ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_Alphasearch(string divcode, string sf_code, string alpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Alphasearch '" + divcode + "', '" + sf_code + "', '" + alpha + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_getMR_Alpha(string divcode, string Alpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //strQry = "EXEC sp_UserList_getMR '" + divcode + "', '" + sf_code + "' ";
            strQry = "SELECT a.sf_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name, a.Sf_UserName, a.sf_Type, " +
                        " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password " +
                        " FROM mas_salesforce a " +
                        " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and (a.Division_Code like '" + divcode + ',' + "%'  or " +
                        " a.Division_Code like '%" + ',' + divcode + ',' + "%') and a.sf_code !='admin' and a.sf_type=1 and LEFT(a.sf_Name,1) = '" + Alpha + "' " +
                        " order by 2 ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet UserListTP_Hierarchy(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_TP '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserListTP_Hierarchy_New(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_TP_New '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_MGR_SFC(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_MGR_SFC '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getFieldForceMGR_SFC(string div_code, string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "select '' sf_code, '---Select---'  sf_name, '' sf_username, '' sf_HQ, '' des_color Union " +
                     "select sf_code, sf_name+' - '+b.Designation_Short_Name+' - '+ sf_HQ+' - '+ sf_emp_id  sf_name, sf_username, sf_HQ, Desig_color des_color " +
                     " from Mas_Salesforce a,Mas_SF_Designation b " +
                     " where Sf_Code='" + sfcode + "' and (a.Division_Code like '" + div_code + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " and sf_status=0 and a.Designation_Code=b.Designation_Code " +
                     " order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getnotifymsg(string divcode, string year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSubDiv = null;

            strQry = " select Notification_Message from Mas_Notification where division_code='" + divcode + "' and year(Notification_To_Date)='" + year + "'";
            try
            {
                dsSubDiv = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSubDiv;
        }
        public DataSet UserListTP_Alpha(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Alpha_TP '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserListTP_Alphasearch(string divcode, string sf_code, string alpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Alphasearch_TP '" + divcode + "', '" + sf_code + "', '" + alpha + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_HQ(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_HQ '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Created the below function for MR Status Report by Devi on 07/14/14.
        // This will call the new proc to fetch the required data.
        public DataSet get_MR_Status_Report(string div_code, int state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_mr_status_report  '" + div_code + "', " + state_code;

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet get_Rep_Status_Report(string div_code, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_rep_status_report  '" + div_code + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }



        public DataSet getTerritory_Rep(string sf_code, int type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsTerr = null;

            strQry = " select Territory_Code, Territory_Name, Territory_SName " +
                       " from Mas_Territory_Creation " +
                       " where sf_code = '" + sf_code + "' and Territory_Active_Flag = " + type +
                       " order by Territory_Name ";

            try
            {
                dsTerr = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsTerr;
        }

        public DataSet getDoctor_Rep(string sf_code, int type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            //strQry = " select ListedDrCode, ListedDr_Sl_No, ListedDr_Name, a.Doc_QuaCode,ListedDr_Address1,ListedDr_Address2, " +
            //           " ListedDr_Address3, ListedDr_PinCode,a.Doc_Special_Code,a.Doc_Cat_Code,a.Doc_ClsCode,a.Territory_Code,ListedDr_DOB,ListedDr_DOW, " +
            //           " ListedDr_Mobile,ListedDr_Email, b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name,  " +
            //             " stuff((select ', '+territory_Name from Mas_Territory_Creation t where a.Territory_Code = cast(t.Territory_Code as varchar) and  charindex(cast(t.Territory_Code as varchar)+',',a.Territory_Code+',')>0 for XML path('')),1,2,'') Territory_Name " +
            //           " from Mas_ListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e" +
            //           " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
            //           " and a.Doc_ClsCode=b.Doc_ClsCode " +
            //           " and a.sf_code = '" + sf_code + "' and a.ListedDr_Active_Flag = " + type +
            //           " order by ListedDr_Name ";
            string strType = string.Empty;
            if (type == 0)
            {
                strType = "ListedDr_Created_Date";
            }
            else
            {
                strType = "ListedDr_Deactivate_Date";
            }

            strQry = " select row_number() over (order by ListedDr_Sl_No) ListedDr_Sl_No,ListedDrCode, ListedDr_Sl_No as  ListedDr_Sl , ltrim(ListedDr_Name) as ListedDr_Name,ListedDr_New_Sl_No,a.Doc_QuaCode,ListedDr_Address1,ListedDr_Address2,ListedDr_Hospital,Hospital_Address,Hospital_City,Hospital_State,Hospital_Country,  " +
                       " ListedDr_Address3, ListedDr_PinCode,a.Doc_Special_Code,a.Doc_Cat_Code,a.Doc_ClsCode,a.Territory_Code, " +
                       " case isnull(a.ListedDr_DOB,null) when '1900-01-01 00:00:00.000' then null else  ListedDr_DOB end ListedDr_DOB, " +
                       " case  isnull(a.ListedDr_DOW,null) when '1900-01-01 00:00:00.000'then null else ListedDr_DOW end ListedDr_DOW, " +
                       " ListedDr_Mobile,ListedDr_Phone,ListedDr_Email, a.Doc_Class_ShortName,a.Doc_Qua_Name, a.Doc_Cat_ShortName,a.Doc_Spec_ShortName, " +
                       " stuff((select ', '+territory_Name from Mas_Territory_Creation t where a.Territory_Code = cast(t.Territory_Code as varchar) and  charindex(cast(t.Territory_Code as varchar)+',',a.Territory_Code+',')>0 for XML path('')),1,2,'') Territory_Name, " +
                         " stuff((select '/ '+ Product_Name from Map_LstDrs_Product p where p.Listeddr_Code =a.ListedDrCode  and CHARINDEX(cast(p.Listeddr_Code as varchar),a.ListedDrCode) > 0  order by Product_Priority for XML path('')),1,2,'') ProductName, " +
                         " (select Alias_Name from  Mas_Territory_Creation h where h.sf_code = a.Sf_code and cast(h.Territory_Code as varchar) = a.Territory_Code) Territory, " +
                       " convert(char(10)," + strType + ",103) as ListedDr_Created_Date," +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       //" (select Sf_Name from Mas_Salesforce where " +
                       //" Sf_Code=(select TP_Reporting_SF from Mas_Salesforce " +
                       //" where Sf_Code=a.Sf_Code)) AS Reporting_Manager1, " +
                       //"(select sf_name from Mas_Salesforce where " +
                       //"Sf_Code=(select top(1)TP_Reporting_SF from Mas_Salesforce where " +
                       //" Sf_Code=(select Sf_Code from Mas_Salesforce where Sf_Code=(select TP_Reporting_SF from Mas_Salesforce where Sf_Code=a.Sf_Code)))) AS Reporting_Manager2," +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ " +
                       " from Mas_ListedDr a, Mas_Doctor_Category dc " +
                       " where a.sf_code = '" + sf_code + "' and a.ListedDr_Active_Flag = " + type +
                       //" order by ListedDr_Created_Date ";
                       " and a.Doc_Cat_Code=dc.Doc_Cat_Code order by ListedDr_Sl_No";// Doc_Cat_Sl_No,Doc_Spec_ShortName ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet getNonDoctor_Rep(string sf_code, int type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            //strQry = " select a.UnListedDrCode, a.UnListedDr_Name, a.UnListedDr_Mobile, a.UnListedDr_Email, " +
            //           " b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name, f.Territory_Name, a.UnListedDr_DOB,a.UnListedDr_DOW " +
            //           " from Mas_UnListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e, Mas_Territory_Creation f " +
            //           " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
            //           " and a.Territory_Code = f.Territory_Code and a.Doc_ClsCode=b.Doc_ClsCode " +
            //           " and a.sf_code = '" + sf_code + "' and a.UnListedDr_Active_Flag = " + type +
            //           " order by a.UnListedDr_Name ";
            string strType = string.Empty;
            if (type == 0)
            {
                strType = "UnListedDr_Created_Date";
            }
            else
            {
                strType = "UnListedDr_Deactivate_Date";
            }
            strQry = " select UnListedDrCode, ltrim(UnListedDr_Name) as UnListedDr_Name, UnListedDr_Mobile,UnListedDr_Phone,UnListedDr_Email, " +
                       " b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name, f.Territory_Name, " +
                       " case isnull(a.UnListedDr_DOB,null) when '1900-01-01 00:00:00.000' then null else  a.UnListedDr_DOB end UnListedDr_DOB, " +
                       " case  isnull(a.UnListedDr_DOW,null) when '1900-01-01 00:00:00.000'then null else a.UnListedDr_DOW end UnListedDr_DOW, " +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " convert(char(10)," + strType + ",103) as UnListedDr_Created_Date," +
                        " (select Sf_Name from Mas_Salesforce where " +
                       " Sf_Code=(select TP_Reporting_SF from Mas_Salesforce " +
                       " where Sf_Code=a.Sf_Code)) AS Reporting_Manager1, " +
                       "(select sf_name from Mas_Salesforce where " +
                       "Sf_Code=(select top(1)TP_Reporting_SF from Mas_Salesforce where " +
                       " Sf_Code=(select Sf_Code from Mas_Salesforce where Sf_Code=(select TP_Reporting_SF from Mas_Salesforce where Sf_Code=a.Sf_Code)))) AS Reporting_Manager2," +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ " +
                       " from Mas_UnListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e, Mas_Territory_Creation f " +
                       " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
                       " and a.Territory_Code = f.Territory_Code and a.Doc_ClsCode=b.Doc_ClsCode " +
                       " and a.sf_code = '" + sf_code + "' and a.UnListedDr_Active_Flag = " + type +
                       " order by UnListedDr_Created_Date ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet getChemists_Rep(string sf_code, int type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            strQry = " select chemists_code,Chemists_Name,Chemists_Contact, " +
                       " Chemists_Phone,b.Territory_Name,Chemists_Address1,Chemists_Fax,Chemists_Email,Chemists_Mobile,Chemists_Address3,Cluster,City,State,Country,Chemists_PinCode, " +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ " +
                       " from Mas_Chemists a, Mas_Territory_Creation b " +
                       " where a.Territory_Code=b.Territory_Code and  a.sf_code like '%" + sf_code + "%' and a.Chemists_Active_Flag  = " + type +
                       " order by Chemists_Name ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet getStockiest_Rep(string sf_code, int type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            //strQry = " select Stockist_Code,Stockist_Name,Stockist_ContactPerson,Stockist_Mobile, " +
            //           "(select sf_name from mas_salesforce b   where a.sf_code=b.sf_code ) sf_name " +
            //           " from Mas_Stockist a " +
            //           " where a.sf_code like '%" + sf_code + "%' and Stockist_Active_Flag  = " + type +
            //           " order by Stockist_Name ";
            strQry = " select Stockist_Code,Stockist_Name,Stockist_ContactPerson,Stockist_Mobile, " +
                     "(select sf_name from mas_salesforce b   where a.sf_code=b.sf_code ) sf_name " +
                     " from Mas_Stockist a " +
                     " where CHARINDEX(',' + CAST('" + sf_code + "' AS VARCHAR(20)) + ',', sf_code) > 0 " +
                     " or CHARINDEX(CAST('" + sf_code + "' AS VARCHAR(20)) + ',', sf_code) > 0 and Stockist_Active_Flag  = " + type +
                     " order by Stockist_Name ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet UserList_TP_Status(string divcode, int state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC [sp_UserList_TP_Status] '" + divcode + "', 'admin', " + state_code;

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_TP_Status_All(string divcode, int state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC [sp_UserList_TP_Status_All] '" + divcode + "', 'admin', " + state_code;

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //New Designation 
        public DataSet getDesignation()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,''Designation_Short_Name,''Designation_Name,'---Select---'Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name,Designation_Name,Designation_Short_Name + ' / ' + Designation_Name AS Name " +
                     " FROM Mas_SF_Designation  " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getsfDesignation(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "SELECT 0 as Designation_Code,'---Select---' as Designation_Short_Name,'' as Designation_Name " +
                           " UNION " +
                       " SELECT Designation_Code,Designation_Short_Name,Designation_Name " +
                       " FROM Mas_SF_Designation where Division_Code ='" + div_code + "' " +
                       " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSalesForce_des(string divcode, string Designation_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Short_Name as Designation_Name,a.Designation_Code as Designation_Code" +
            //         " FROM  mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //         " where lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
            //         " AND a.sf_Tp_Active_flag = 0  AND a.Designation_Code = '" + Designation_Code + "' AND (a.Division_Code like '" + divcode + ',' + "%' " +
            //         " or a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //         " ORDER BY 2";

            strQry = " SELECT SF_Code, Sf_Name, UsrDfd_UserName,Sf_UserName, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     " Sf_Password, Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Short_Name as Designation_Name,a.Designation_Code as Designation_Code,c.Designation_Short_Name" +
                     " FROM  mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                     " where lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
                     " AND a.sf_Tp_Active_flag = 0  AND a.Designation_Code = '" + Designation_Code + "' AND a.Division_Code = '" + divcode + ",' " +
                     " ORDER BY 2";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        //end
        public DataTable getSalesForcelist_Sort(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                      "sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.Division_Code = '" + divcode + ",' " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " ORDER BY Sf_Name";


            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataTable getSalesForcelist_Sort(string divcode, string sAlpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code " +
                     " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                     " WHERE a.SF_Status=0 " +
                     " AND lower(a.sf_code) != 'admin' " +
                     " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " AND LEFT(SF_Code,1) = '" + sAlpha + "' " +
                     " ORDER BY 2";


            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSalesForce_st(string divcode, string state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,b.StateName,a.State_Code as state_code,c.Designation_Short_Name as Designation_Name" +
            //" FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
            //" join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code  WHERE SF_Status=0 " +
            //" AND lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
            //" AND a.sf_Tp_Active_flag = 0  AND a.State_Code = '" + state_code + "' AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
            //" a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //" ORDER BY 2";

            strQry = " SELECT SF_Code, Sf_Name,Sf_UserName, UsrDfd_UserName, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     " Sf_Password,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date, Sf_HQ,sf_type as Type , case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,b.StateName,a.State_Code as state_code,c.Designation_Short_Name as Designation_Name,c.Designation_Short_Name" +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code  WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
                     " AND a.sf_Tp_Active_flag = 0  AND a.State_Code = '" + state_code + "' AND a.Division_Code = '" + divcode + ",' " +
                     " ORDER BY 2";



            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSFStateType(string state_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select '' Sf_Code,'---Select---' sf_name" + " " +
                      "union" + " " +
                      "SELECT 'admin' as Sf_Code, 'admin' as sf_name " +
                      " UNION " +
                      "select Sf_Code,sf_name from mas_salesforce where sf_type=2 and State_Code='" + state_code + "' and (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                      "union all" + " " +
                      "select Sf_Code,sf_name from mas_salesforce where sf_type=2 and State_Code<>'" + state_code + "' and (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Changes done by Saravanan
        public DataTable getDTSalesForcelist(string divcode, string sAlpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     " Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.Division_Code = '" + divcode + ",' " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " AND LEFT(a.sf_name,1) = '" + sAlpha + "' " +
                     " ORDER BY Sf_Name";



            try
            {
                dsDivision = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataTable FindDTSalesForcelist(string sFindQry)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsDivision = null;
            strQry = " SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     "a.Sf_HQ,a.sf_type as Type, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type, " +
                      " b.StateName,c.Designation_Name, a.State_Code as state_code from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.State_Code=b.State_Code " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     sFindQry +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataTable getDTSalesForce_st(string divcode, string state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dtDivision = null;
            //strQry = " SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type, " +
            //         " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
            //         " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //         "  WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' AND a.SF_Status = 0 " +
            //         " AND a.sf_Tp_Active_flag = 0  AND a.State_Code = '" + state_code + "' AND (a.Division_Code like '" + divcode + ',' + "%' or " +
            //         " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //          " ORDER BY 2";

            strQry = " SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, a.Sf_HQ, " +
                    " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                    " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                    "a.sf_type as Type, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type, " +
                    " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                    " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                    "  WHERE SF_Status=0 " +
                    " AND lower(sf_code) != 'admin' AND a.SF_Status = 0 " +
                    " AND a.sf_Tp_Active_flag = 0  AND a.State_Code = '" + state_code + "' AND a.Division_Code = '" + divcode + ",' " +
                     " ORDER BY 2";


            try
            {
                dtDivision = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dtDivision;
        }
        public DataTable getDTSalesForcelist_Reporting(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dtDivision = null;
            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
            //         " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
            //         " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //         " WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " AND a.TP_Reporting_SF = '" + sf_code + "' " +
            //         " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
            //         " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
            //         " ORDER BY Sf_Name";

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, " +
                    " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                    " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                    " sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                    " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                    " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                    " WHERE SF_Status=0 " +
                    " AND lower(sf_code) != 'admin' " +
                    " AND a.TP_Reporting_SF = '" + sf_code + "' " +
                    " AND a.Division_Code = '" + divcode + ",' " +
                    " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                    " ORDER BY Sf_Name";


            try
            {
                dtDivision = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dtDivision;
        }

        //

        //change done by saravanan on 120914
        public int vbRecordUpdate(string sf_code, string strVacantBlock, string strDCRDate, string strTPDCRStartDate, string Effective_Date, string UsrDfd_UserName, string div_code, string Hold_reason, string sf_emp_id)
        {
            int iReturn = -1;
            int count = 0;
            DateTime dtDCRDate = Convert.ToDateTime(strDCRDate.ToString());
            DateTime dtTPDCRStartDate = Convert.ToDateTime(strTPDCRStartDate.ToString());
            DataSet dsVacant;
            DataSet dsVacant2;
            DataSet dsMonth;
            DataSet dsdcr;
            string empl_id = string.Empty;
            int sl_num = -1;
            int iretdcr = -1;
            DateTime sfdate;
            DateTime Effe_Date = Convert.ToDateTime(Effective_Date.ToString());
            DateTime DCR_Start_Date;
            DateTime DCR_End_Date;
            DateTime Joining_Date;
            int Slno = -1;

            strDCRDate = dtDCRDate.Month + "-" + dtDCRDate.Day + "-" + dtDCRDate.Year;
            strTPDCRStartDate = dtTPDCRStartDate.Month + "-" + dtTPDCRStartDate.Day + "-" + dtTPDCRStartDate.Year;
            Effective_Date = Effe_Date.Month + "-" + Effe_Date.Day + "-" + Effe_Date.Year;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce set sf_Tp_Active_flag = 1 ,SF_VacantBlock='" + strVacantBlock + "',Last_DCR_Date='" + strDCRDate + "'," +
                       "sf_Tp_Active_Dt='" + strTPDCRStartDate + "', LastUpdt_Date = getdate(),UsrDfd_UserName='" + UsrDfd_UserName + "V' " +
                       " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "  update mas_sf_audit_team set Audit_Team=REPLACE(Audit_Team,'" + sf_code + ",','') where Audit_Team like '%" + sf_code + "%' ";
                iReturn = db.ExecQry(strQry);

                strQry = "Update mas_salesforce_dcrtpdate " +
                 " set last_dcr_date='" + strDCRDate + "' " +
                  // "  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' " +
                  " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);


                strQry = "Update Trans_Leave_Entitle_Head set active_flag=1 where sf_code='" + sf_code + "' and sf_emp_id='" + sf_emp_id + "' ";
                iReturn = db.ExecQry(strQry);

                strQry = "Update mas_leave_form set leave_active_flag=0,LastUpdt_Date=GETDATE() where sf_code='" + sf_code + "' and leave_active_flag=2 ";
                iReturn = db.ExecQry(strQry);


                strQry = "Update access_table " +
              " set app_device_id='' ,Device_Id=0 " +
               " WHERE sf_code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                if (strVacantBlock == "H")
                {
                    DateTime date = DateTime.Now;
                    int day = date.Day;
                    int month = date.Month;
                    int year = date.Year;
                    string created_date = day + "/" + month + "/" + year;

                    strQry = "Update Mas_Salesforce set sf_blkreason = '" + Hold_reason + "(" + created_date + ")', " +
                       " LastUpdt_Date = getdate() " +
                       " WHERE Sf_Code= '" + sf_code + "' ";

                    iReturn = db.ExecQry(strQry);
                }


                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                if (iReturn > 0)
                {

                    strQry = "select distinct Tour_Month from trans_tp where convert(char(10),Tour_Date,105)='" + dtTPDCRStartDate.ToString().Substring(0, 10) + "'" +
                             "and SF_Code='" + sf_code + "'";

                    dsMonth = db.Exec_DataSet(strQry);
                    if (dsMonth.Tables[0].Rows.Count > 0)
                    {

                        strQry = "Insert into Trans_TP_one(SF_Code,Tour_Month,Tour_Year,Submission_date,Tour_Date,WorkType_Code_B,Worktype_Name_B, " +
                                 "Tour_Schedule1,Tour_Schedule2,Tour_Schedule3,Objective,Worked_With_SF_Code,Division_Code,Confirmed, " +
                                 "Confirmed_Date,Rejection_Reason,Change_Status,Territory_Code1,Territory_Code2,Territory_Code3,Worked_With_SF_Name) " +
                                 "Select SF_Code,Tour_Month,Tour_Year,Submission_date,Tour_Date,WorkType_Code_B,Worktype_Name_B, " +
                                 "Tour_Schedule1,Tour_Schedule2,Tour_Schedule3,Objective,Worked_With_SF_Code,Division_Code,'0' Confirmed, " +
                                 "Confirmed_Date,Rejection_Reason,'1' Change_Status,Territory_Code1,Territory_Code2,Territory_Code3,Worked_With_SF_Name from Trans_TP " +
                                 "where SF_Code='" + sf_code + "' and MONTH(tour_date)='" + dsMonth.Tables[0].Rows[0][0].ToString() + "' ";

                        iReturn = db.ExecQry(strQry);

                        strQry = "Delete from trans_tp where SF_Code='" + sf_code + "' and MONTH(tour_date)>='" + dsMonth.Tables[0].Rows[0][0].ToString() + "' ";

                        iReturn = db.ExecQry(strQry);
                    }


                    // Populate the new table "salesforce_vacant" before making the fieldforce as VACANT by Sridevi on 04/21/2015

                    //strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM salesforce_vacant ";
                    strQry = "SELECT isnull(max(Cast(SubString(Employee_Id,2, LEN(Employee_Id)) as int))+1,'1') FROM salesforce_vacant ";
                    sl_num = db.Exec_Scalar(strQry);

                    empl_id = "E" + sl_num.ToString();


                    strQry = " SELECT Sf_Code, Sf_Name, Designation_Code , Reporting_To_SF, Division_Code, " +
                                " (SELECT Sf_Name FROM Mas_Salesforce WHERE Sf_Code = a.Reporting_To_SF) Reporting_To_SF_Name, Created_Date, LastUpdt_Date,  " +
                                " sf_Designation_Short_Name,sf_emp_id,Sf_TP_DCR_Active_Dt, " +
                                " Last_DCR_Date,Sf_Joining_Date,MONTH(Last_DCR_Date) Trans_Month,YEAR(Last_DCR_Date) Trans_Year,Sf_HQ,sf_desgn,fieldforce_type,sf_dow as Sf_Date_Confirm " +
                                " FROM Mas_Salesforce a " +
                                " WHERE Sf_Code = '" + sf_code + "' ";


                    dsVacant = db.Exec_DataSet(strQry);

                    if (strVacantBlock == "R" || strVacantBlock == "H")
                    {

                        if (dsVacant.Tables[0].Rows.Count > 0)
                        {
                            //sfdate = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][6].ToString());
                            //strQry = " INSERT INTO salesforce_vacant (Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                            //            " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Vacant_Reason,Division_Code ,Effective_Date) " +
                            //            " VALUES ('" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                            //            " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                            //            " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                            //            " '" + sfdate.ToString("MM/dd/yyyy") + "', getdate(),'" + strVacantBlock + "', '" + dsVacant.Tables[0].Rows[0][4].ToString() + "','"+Effective_Date+"' ) ";

                            strQry = " SELECT ISNULL(Count(Sl_No),0)+1 FROM salesforce_vacant where SF_Code='" + sf_code + "' ";
                            Slno = db.Exec_Scalar(strQry);

                            sfdate = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][6].ToString());
                            DCR_Start_Date = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][10].ToString());
                            DCR_End_Date = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][11].ToString());
                            Joining_Date = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][12].ToString());

                            strQry = " INSERT INTO salesforce_vacant (Sl_No,Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                                        " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Vacant_Reason,Division_Code ,Effective_Date,sf_Designation_Short_Name , " +
                                      " Employee_Code,DCR_Start_Date,DCR_End_Date,Joining_Date,Vacant_Date,Trans_Month,Trans_Year,Sf_HQ,Created_Date,category,fieldforce_type,Sf_Date_Confirm) " +
                                        " VALUES ('" + Slno + "','" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                                        " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                                        " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                                        " '" + sfdate.ToString("MM/dd/yyyy") + "', getdate(),'" + strVacantBlock + "', '" + dsVacant.Tables[0].Rows[0][4].ToString() + "','" + Effective_Date + "', " +
                                       " '" + dsVacant.Tables[0].Rows[0][8].ToString() + "','" + dsVacant.Tables[0].Rows[0][9].ToString() + "','" + DCR_Start_Date.ToString("MM/dd/yyyy") + "', " +
                                       " '" + DCR_End_Date.ToString("MM/dd/yyyy") + "','" + Joining_Date.ToString("MM/dd/yyyy") + "',getdate(),'" + dsVacant.Tables[0].Rows[0][13].ToString() + "', " +
                                       " '" + dsVacant.Tables[0].Rows[0][14].ToString() + "','" + dsVacant.Tables[0].Rows[0][15].ToString() + "',getdate(),'" + dsVacant.Tables[0].Rows[0]["sf_desgn"].ToString() + "','" + dsVacant.Tables[0].Rows[0]["fieldforce_type"].ToString() + "','" + dsVacant.Tables[0].Rows[0]["Sf_Date_Confirm"].ToString() + "') ";


                            iReturn = db.ExecQry(strQry);
                        }
                    }


                    if (strVacantBlock == "R")
                    {
                        strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM salesforce_vacant_resign ";
                        sl_num = db.Exec_Scalar(strQry);

                        empl_id = "E" + sl_num.ToString();
                        //Populate salesforce_vacant_resign                    
                        sfdate = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][6].ToString());

                        strQry = " INSERT INTO salesforce_vacant_resign (Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                                    " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Division_Code,Effective_Date ) " +
                                    " VALUES ('" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                                    " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                                    " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                                    " '" + sfdate.ToString("MM/dd/yyyy") + "' , getdate(), '" + dsVacant.Tables[0].Rows[0][4].ToString() + "' ,'" + Effective_Date + "') ";

                        iReturn = db.ExecQry(strQry);
                    }
                    //else if (strVacantBlock == "T")
                    //{
                    //    strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM salesforce_vacant_transfer ";
                    //    sl_num = db.Exec_Scalar(strQry);

                    //    empl_id = "E" + sl_num.ToString();
                    //    //Populate salesforce_vacant_transfer
                    //    sfdate = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][6].ToString());

                    //    strQry = " INSERT INTO salesforce_vacant_transfer (Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                    //                " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Division_Code,Effective_Date ) " +
                    //                " VALUES ('" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                    //                " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                    //                " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                    //                " '" + sfdate.ToString("MM/dd/yyyy") + "', getdate(), '" + dsVacant.Tables[0].Rows[0][4].ToString() + "','"+Effective_Date+"' ) ";

                    //    iReturn = db.ExecQry(strQry);
                    //}
                    //else if (strVacantBlock == "P")
                    //{
                    //    strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM SalesForce_Vacant_Promote ";
                    //    sl_num = db.Exec_Scalar(strQry);

                    //    empl_id = "E" + sl_num.ToString();
                    //    //Populate salesforce_vacant_transfer
                    //    sfdate = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][6].ToString());

                    //    strQry = " INSERT INTO SalesForce_Vacant_Promote (Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                    //                " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Division_Code,Effective_Date ) " +
                    //                " VALUES ('" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                    //                " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                    //                " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                    //                " '" + sfdate.ToString("MM/dd/yyyy") + "', getdate(), '" + dsVacant.Tables[0].Rows[0][4].ToString() + "' ,'"+Effective_Date+"') ";

                    //    iReturn = db.ExecQry(strQry);
                    //}
                    //else if (strVacantBlock == "D")
                    //{
                    //    strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM SalesForce_Vacant_DePromote ";
                    //    sl_num = db.Exec_Scalar(strQry);

                    //    empl_id = "E" + sl_num.ToString();
                    //    //Populate salesforce_vacant_transfer
                    //    sfdate = Convert.ToDateTime(dsVacant.Tables[0].Rows[0][6].ToString());

                    //    strQry = " INSERT INTO SalesForce_Vacant_DePromote (Employee_Id, SF_Code, SF_Name, SF_Desgn,   " +
                    //                " Reporting_To_SF_Code, Reporting_To_SF_Name, Start_Date, End_Date, Division_Code,Effective_Date ) " +
                    //                " VALUES ('" + empl_id + "' , '" + dsVacant.Tables[0].Rows[0][0].ToString() + "', " +
                    //                " '" + dsVacant.Tables[0].Rows[0][1].ToString() + "', '" + dsVacant.Tables[0].Rows[0][2].ToString() + "', " +
                    //                " '" + dsVacant.Tables[0].Rows[0][3].ToString() + "', '" + dsVacant.Tables[0].Rows[0][5].ToString() + "', " +
                    //                " '" + sfdate.ToString("MM/dd/yyyy") + "', getdate(), '" + dsVacant.Tables[0].Rows[0][4].ToString() + "','"+Effective_Date+"' ) ";

                    //    iReturn = db.ExecQry(strQry);
                    //}
                }

                // DCR Pending Requests - Auto Approve - Sridevi - 5June15

                DCR dcr = new DCR();
                dsdcr = dcr.get_dcr_pending_approval_TransSl(sf_code);
                if (dsdcr.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drdcr in dsdcr.Tables[0].Rows)
                    {
                        iretdcr = dcr.Create_DCRHead_Trans(sf_code, drdcr["Trans_Slno"].ToString()); // Auto Approve all pending requests.
                    }
                }


                DataSet dsOther;

                strQry = "select Fieldforce_Resig from Setup_Others where division_code='" + div_code + "' ";
                dsOther = db.Exec_DataSet(strQry);

                if (dsOther.Tables[0].Rows.Count > 0)
                {
                    if ((dsOther.Tables[0].Rows[0]["Fieldforce_Resig"].ToString() != null) && (dsOther.Tables[0].Rows[0]["Fieldforce_Resig"].ToString() != "0") && (dsOther.Tables[0].Rows[0]["Fieldforce_Resig"].ToString() != ""))
                    {
                        strQry = "Update Mas_Salesforce set " +
                                 " sf_name=(select case when Fieldforce_Resig='1' then " +
                                 " (select Fieldforce_Resig_Caption+' - '+'( '+a.sf_name+' )') when " +
                                 " Fieldforce_Resig='2' then (select '( '+a.sf_name+' )' +' - ' +b.Fieldforce_Resig_Caption) " +
                                 " when  Fieldforce_Resig='0' then a.sf_name end " +
                                 " from mas_salesforce a,Setup_Others b where b.division_code='" + div_code + "' and a.division_code='" + div_code + ",' and a.sf_code='" + sf_code + "') " +
                                 " WHERE Sf_Code= '" + sf_code + "' ";

                        iReturn = db.ExecQry(strQry);
                    }
                }


                //strQry = " select Mail_Active_Flag from Trans_Mail_Detail where Open_Mail_Id='" + sf_code + "' and Mail_Active_Flag=0 ";
                //dsVacant2 = db.Exec_DataSet(strQry);

                //if (dsVacant2.Tables[0].Rows.Count > 0)
                //{

                //    strQry = "update Trans_Mail_Detail set Mail_Active_Flag=10 where Open_Mail_Id='" + sf_code + "' " +
                //         " and Mail_Active_Flag=0  ";

                //    iReturn = db.ExecQry(strQry);
                //}

                //strQry = "  select Delayed_Flag from DCR_Delay_Dtls WHERE Sf_Code = '" + sf_code + "' and Delayed_Flag =1 ";
                //dsVacant2 = db.Exec_DataSet(strQry);

                //if (dsVacant2.Tables[0].Rows.Count > 0)
                //{
                //    strQry = "UPDATE DCR_Delay_Dtls " +
                //             " SET Delayed_Flag = 0 ," +
                //             " Delay_Release_Date = NULL, Released_by_Whom = '' " +
                //             " WHERE Sf_Code = '" + sf_code + "' and Delayed_Flag =1 ";

                //    iReturn = db.ExecQry(strQry);
                //}

                //strQry = " select status from DCR_MissedDates  WHERE Sf_Code = '" + sf_code + "' and status =1 ";
                //dsVacant2 = db.Exec_DataSet(strQry);

                //if (dsVacant2.Tables[0].Rows.Count > 0)
                //{

                //    strQry = " UPDATE DCR_MissedDates " +
                //            " SET [status] = 0 , " +
                //            " Missed_Release_Date = NULL , Released_by_Whom = '' " +
                //            " WHERE Sf_Code = '" + sf_code + "' and status =1 ";

                //    iReturn = db.ExecQry(strQry);
                //}

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public DataTable getDTSalesForce_des(string divcode, string Designation_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dtDivision = null;

            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Short_Name as Designation_Name,a.Designation_Code as Designation_Code" +
            //    " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
            //    " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code  WHERE SF_Status=0" +
            //    " AND lower(sf_code) != 'admin' AND a.SF_Status = 0 " +
            //    " AND a.sf_Tp_Active_flag = 0  AND a.Designation_Code = '" + Designation_Code + "' AND (a.Division_Code like '" + divcode + ',' + "%' or " +
            //    " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //    " ORDER BY 2";

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password, " +
                " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                "Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Short_Name as Designation_Name,a.Designation_Code as Designation_Code" +
                " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code  WHERE SF_Status=0" +
                " AND lower(sf_code) != 'admin' AND a.SF_Status = 0 " +
                " AND a.sf_Tp_Active_flag = 0  AND a.Designation_Code = '" + Designation_Code + "' AND a.Division_Code = '" + divcode + ",' " +
                " ORDER BY 2";

            try
            {
                dtDivision = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dtDivision;
        }
        //

        //Changes done by Priya
        public DataSet getDesignation_BulkEdit(string SF_Code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT Designation_Code FROM  Mas_Salesforce " +
                     " WHERE SF_Code='" + SF_Code + "' AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //end

        public DataSet dsSF { get; set; }

        public DataSet getSF_Password(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select Sf_Password  from mas_salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int UpdatePassword(string sf_code, string pwd)
        {
            int iReturn = -1;
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "UPDATE Mas_Salesforce " +
                         " SET Sf_Password = '" + pwd + "' " +
                         " WHERE sf_code = '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }

        public DataSet getFieldForce_MailView(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "select sf_code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name , sf_username, sf_HQ " +
                        " from Mas_Salesforce " +
                        " where Sf_Code !='admin' and (Division_Code like '" + div_code + ',' + "%'  or " +
                        " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                        " and sf_type = 1 " +
                        " order by sf_name ";



            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getFieldForce_Birth(string Sf_Code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            //    strQry = " SELECT e.Sf_Code,e.Sf_Name,e.SF_DOB FROM Mas_Salesforce e WHERE MONTH(SF_DOB) = MONTH(GETDATE()) " +
            //" AND DAY(SF_DOB) >= DAY(DATEADD(WK, DATEDIFF(WK, 0, GETDATE()), -1)) " +
            //" AND DAY(SF_DOB) < DAY(DATEADD(WK, DATEDIFF(WK, 0, GETDATE()) + 1, -1)) and e.Sf_Code='" + Sf_Code + "' ";

            //strQry = " SELECT e.Sf_Code,e.Sf_Name,e.SF_DOB FROM Mas_Salesforce e WHERE MONTH(SF_DOB) = MONTH(GETDATE()) " +
            //" and e.Sf_Code='" + Sf_Code + "' ";

            strQry = " Select Sf_Code,Sf_Name, case convert(char(10),SF_DOB,103)" +
                       " when '01/01/1900' then '' " +
                       " else convert(char(10),SF_DOB,103) end SF_DOB from Mas_Salesforce " +
                     " where (month(SF_DOB)=month(getdate())) " +
                      " and (day(SF_DOB) between day(getdate())-3 and day(getdate())+3 ) and Sf_Code='" + Sf_Code + "' and (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%')  and isnull(SF_DOB,'')!=''";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSaleforce_Image(string divcode, string Sf_Code, string ImageId)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsDivision = null;
            strQry = " select a.Filename, a.FilePath, a.Subject, b.Sf_Code, b.Sf_Name, b.Sf_HQ, b.Sf_Code " +
                     " From mas_salesforce b, Mas_HomeImage_FieldForce a " +
                     " Where (a.Division_Code like '" + divcode + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " and b.Sf_Code='" + Sf_Code + "' and ImageId='" + ImageId + "'";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return dsDivision;

        }
        public DataSet Sales_Image(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForce_Image '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSales(string divcode, string Sf_Code, string Image_Id)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            if (Sf_Code != "")
            {
                strQry = "SELECT a.FileName,a.FilePath,a.Subject, b.Sf_Code,b.Sf_Name, b.Sf_HQ  " +
                          " FROM Mas_HomeImage_FieldForce a " +
                          " inner join mas_salesforce b On a.Sf_Code=b.Sf_Code " +
                          " WHERE (b.Division_Code like '" + divcode + ',' + "%'  or " +
                          " b.Division_Code like '%" + ',' + divcode + ',' + "%')" +
                          " and a.Sf_Code='" + Sf_Code + "' or Image_Id= '" + Image_Id + "' ";


            }
            else
            {
                strQry = "SELECT  ''FileName,''FilePath,''Subject, b.Sf_Code,b.Sf_Name, b.Sf_HQ  " +
                         " FROM  mas_salesforce b  " +
                         " WHERE (b.Division_Code like '" + divcode + ',' + "%'  or " +
                         " b.Division_Code like '%" + ',' + divcode + ',' + "%')" +
                         " and b.Sf_Code='" + Sf_Code + "'";


            }
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        //Changes Done by Sridevi - Starts
        public DataSet UserList_getVacantMR(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getVacantMR '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getReporting(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_getReportingTo '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet FillSF_ScreenAccess(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_screen_lock  '" + div_code + "', '" + sf_code + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        //public DataSet MissedCallReport(string sf_code, string div_code, DateTime dtcurrent)
        //{
        //    DB_EReporting db_ER = new DB_EReporting();

        //    DataSet dsAdmin = null;

        //    strQry = "EXEC sp_MissedCallReport  '" + div_code + "', '" + sf_code + "', '" + dtcurrent + "' ";

        //    try
        //    {
        //        dsAdmin = db_ER.Exec_DataSet(strQry);
        //    }
        //    catch (Exception ex)
        //    {
        //        throw ex;
        //    }
        //    return dsAdmin;
        //}

        public DataSet MissedCallReport(string div_code, string sf_code, int cmonth, int cyear, DateTime dtcurrent)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_Get_LstDr_Cnt  '" + div_code + "', '" + sf_code + "'," + cmonth + "," + cyear + ", '" + dtcurrent + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet DCR_MissedCallReport(string sf_code, string div_code, int iMonth, int iYear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_DCR_MissedCallReport  '" + div_code + "', '" + sf_code + "', " + iMonth + ", " + iYear + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet SDP_LST_Report(string sf_code, string div_code, DateTime dtcurrent)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_SDP_MSD_Report  '" + div_code + "', '" + sf_code + "', '" + dtcurrent + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet SDP_MSD_Report(string sf_code, string div_code, int iMonth, int iYear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_SDP_MSD_DCR_Report  '" + div_code + "', '" + sf_code + "', " + iMonth + ", " + iYear + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Catg_LST_Report(string sf_code, string div_code, DateTime dtcurrent, int strDay, int strMonth, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_CatgMissedCallReport  '" + div_code + "', '" + sf_code + "', '" + dtcurrent + "','" + strDay + "','" + strMonth + "', " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Catg_MSD_Report(string sf_code, string div_code, int iMonth, int iYear, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_DCR_CatgMissedCallReport  '" + div_code + "', '" + sf_code + "', " + iMonth + ", " + iYear + ", " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Spec_LST_Report(string sf_code, string div_code, DateTime dtcurrent, int iMonth, int iYear, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_SpecMissedCallReport  '" + div_code + "', '" + sf_code + "', '" + dtcurrent + "','" + iMonth + "','" + iYear + "', " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Spec_MSD_Report(string sf_code, string div_code, int iMonth, int iYear, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_DCR_SpecMissedCallReport  '" + div_code + "', '" + sf_code + "', " + iMonth + ", " + iYear + ", " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Class_LST_Report(string sf_code, string div_code, DateTime dtcurrent, int iMonth, int iYear, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_ClassMissedCallReport  '" + div_code + "', '" + sf_code + "', '" + dtcurrent + "','" + iMonth + "','" + iYear + "', " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Class_MSD_Report(string sf_code, string div_code, int iMonth, int iYear, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_DCR_ClassMissedCallReport  '" + div_code + "', '" + sf_code + "', " + iMonth + ", " + iYear + ", " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }


        public string getMonthName(string sMonth)
        {
            string sReturn = string.Empty;

            //if (sMonth == "1")
            //{
            //    sReturn = "January";
            //}
            //else if (sMonth == "2")
            //{
            //    sReturn = "February";
            //}
            //else if (sMonth == "2")
            //{
            //    sReturn = "February";
            //}
            //else if (sMonth == "3")
            //{
            //    sReturn = "March";
            //}
            //else if (sMonth == "4")
            //{
            //    sReturn = "April";
            //}
            //else if (sMonth == "5")
            //{
            //    sReturn = "May";
            //}
            //else if (sMonth == "6")
            //{
            //    sReturn = "June";
            //}
            //else if (sMonth == "7")
            //{
            //    sReturn = "July";
            //}
            //else if (sMonth == "8")
            //{
            //    sReturn = "August";
            //}
            //else if (sMonth == "9")
            //{
            //    sReturn = "September";
            //}
            //else if (sMonth == "10")
            //{
            //    sReturn = "October";
            //}
            //else if (sMonth == "11")
            //{
            //    sReturn = "November";
            //}
            //else if (sMonth == "12")
            //{
            //    sReturn = "December";
            //}
            if (sMonth == "1")
            {
                sReturn = "Jan";
            }
            else if (sMonth == "2")
            {
                sReturn = "Feb";
            }

            else if (sMonth == "3")
            {
                sReturn = "Mar";
            }
            else if (sMonth == "4")
            {
                sReturn = "Apr";
            }
            else if (sMonth == "5")
            {
                sReturn = "May";
            }
            else if (sMonth == "6")
            {
                sReturn = "June";
            }
            else if (sMonth == "7")
            {
                sReturn = "July";
            }
            else if (sMonth == "8")
            {
                sReturn = "Aug";
            }
            else if (sMonth == "9")
            {
                sReturn = "Sep";
            }
            else if (sMonth == "10")
            {
                sReturn = "Oct";
            }
            else if (sMonth == "11")
            {
                sReturn = "Nov";
            }
            else if (sMonth == "12")
            {
                sReturn = "Dec";
            }

            return sReturn;
        }

        //Changes Done by Sridevi - Ends

        //Changes Done by Saravana
        public DataSet getFieldForce_Distance(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "select sf_code, sf_name+' - '+b.Designation_Short_Name+' - '+ sf_HQ  sf_name, sf_username, sf_HQ " +
                     " from Mas_Salesforce a,Mas_SF_Designation b " +
                     " where Sf_Code !='admin' and (a.Division_Code like '" + div_code + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " and sf_type = 1 and sf_status=0 and a.Designation_Code=b.Designation_Code " +
                     " order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        //Changes done by Priya
        public DataSet getSalesForceVaclist_MR(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name, Sf_UserName, Sf_HQ,case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type, b.StateName,a.State_Code as state_code " +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " WHERE a.SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 and a.sf_Type=1 " +
                     " ORDER BY 2";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getFieldForce_Name(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "select sf_code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name , sf_username, sf_HQ " +
                        " from Mas_Salesforce " +
                        " where Sf_Code !='admin' and (Division_Code like '" + div_code + ',' + "%' or " +
                        " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                        " and sf_type = 1 and sf_status=0 " +
                        " order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForce_subdiv(string divcode, string subdivision_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Name,a.Designation_Code as Designation_Code,d.subdivision_name" +
                " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code join mas_subdivision d on a.subdivision_code=d.subdivision_code WHERE SF_Status=0" +
                " AND lower(sf_code) != 'admin' and a.SF_Status = 0 " +
                " AND a.sf_Tp_Active_flag = 0  AND a.subdivision_code = '" + subdivision_code + "' AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet get_HO_ID_Reporting()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = " select '0' ho_id,'Select' ho_name " +
                        " union all " +
                        " select CONVERT(varchar,ho_id) ho_id, name ho_name from mas_ho_id_creation " +
                         " WHERE HO_Active_flag = 0 ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        //public int HO_ID_RecordAdd(string username, string password, string name, string menu, string div_code, string reporting_to, string reporting_to_name)
        //{
        //    int iReturn = -1;
        //    if (!RecordExistAdd(username))
        //    {
        //        try
        //        {
        //            DB_EReporting db = new DB_EReporting();
        //            strQry = "INSERT INTO mas_ho_id_creation VALUES ( '" + username + "' ,'" + password + "','" + name + "', '" + menu + "', '" + div_code + "', '" + reporting_to + "', '" + reporting_to_name + "',getdate(),getdate(),'0') ";
        //            iReturn = db.ExecQry(strQry);
        //        }
        //        catch (Exception ex)
        //        {
        //            throw ex;
        //        }
        //    }

        //    else
        //    {
        //        iReturn = -2;
        //    }
        //    return iReturn;
        //}
        public DataSet getHO()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT HO_ID,Name,User_Name,Password,Reporting_To_Name" +
                     " FROM mas_ho_id_creation " +
                     " WHERE HO_Active_flag = 0  and Name <> 'admin' " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public int HO_DeActivate(int ho_id)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Update Mas_HO_ID_Creation set HO_Active_flag = 1," +
                        " LastUpdt_Date = getdate() " +
                        " WHERE HO_ID= '" + ho_id + "' ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        public DataSet FindSalesForcelist_Mgr(string sFindQry)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code,a.Division_Code  " +
                     " FROM mas_salesforce a, mas_state b" +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.State_Code=b.State_Code " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " AND a.sf_type = 2 " +
                     sFindQry +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet FillSalesForcelist_Mgr(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code,a.Division_Code  " +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                      " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " AND a.sf_type = 2  AND a.sf_code not in(select reporting_to_sf from mas_salesforce where isnull(reporting_to_sf,'')!='' and (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%' ))" +
                     " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public DataSet FillSalesForcelist_Mgr_New(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT a.SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code,a.Division_Code,  " +
                " case when isnull(Audit_Team,'')=''  then '-'  Else 'Tagged' end as Status " +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " Left join Mas_Sf_Audit_Team c on a.Sf_Code=c.Sf_Code " +
                     " WHERE SF_Status=0 " +
                     " AND lower(a.sf_code) != 'admin' " +
                     " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                      " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     " AND a.sf_type = 2  AND a.sf_code not in(select reporting_to_sf from mas_salesforce where isnull(reporting_to_sf,'')!='' and (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%' ))" +
                     " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_st_mgr(string divcode, string state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,b.StateName,a.State_Code as state_code,c.Designation_Name," +
                           " c.desig_color " +
                  " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                  " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code  WHERE SF_Status=0 " +
                  " AND lower(sf_code) != 'admin' AND a.SF_Status = 0 and a.Designation_code = c.Designation_code " +
                 " AND a.sf_Tp_Active_flag = 0   AND a.sf_type = 2 AND a.State_Code = '" + state_code + "' AND (a.Division_Code like '" + divcode + ',' + "%' or " +
                 " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                 " ORDER BY 2";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForce_des_mgr(string divcode, string Designation_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Name,a.Designation_Code as Designation_Code" +
                " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code WHERE SF_Status=0" +
                " AND lower(sf_code) != 'admin' AND a.SF_Status = 0 " +
                " AND a.sf_Tp_Active_flag = 0  a.sf_type = 2  AND a.Designation_Code = '" + Designation_Code + "' AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
                " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSfDivision(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT Division_code FROM mas_salesforce WHERE Sf_Code = '" + sf_code + "'";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public DataSet getSfDivision_Main(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT Division_code FROM mas_salesforce_AM WHERE Sf_Code = '" + sf_code + "'";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int UpdateDivisionCode(string sf_code, string division_code, int ismultidivision)
        {
            int iReturn = -1;
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "UPDATE Mas_Salesforce " +
                         " SET division_code = '" + division_code + "',IsMultiDivision = " + ismultidivision + " " +
                         " WHERE sf_code = '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }
        //Changes done by Saravana
        public DataSet TPviewGetAlphapet(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_TPViewAlphapetGet '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Added by devi 
        public int UpdateRepMgr(string sf_code, string Mgr_Code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce set " +
                        "  Reporting_To_SF = '" + Mgr_Code + "'," +
                        "  TP_Reporting_SF = '" + Mgr_Code + "'," +
                           "LastUpdt_Date = getdate() " +
                        " WHERE Sf_Code= '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                iReturn_Backup = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        public int CreateAuditMgr(string sf_code, string audit_team, string mgrAuditTeam, string division_code) // Modified by Sri - 28Aug15
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();
                strQry = "SELECT isnull(max([S No])+1,'1') [S No] from mas_sf_audit_team ";
                int SNo = db.Exec_Scalar(strQry);
                if (!RecordExistAudit(division_code, sf_code))
                {

                    strQry = "INSERT INTO mas_sf_audit_team VALUES ('" + SNo + "' ,'" + sf_code + "' ,'" + audit_team + "','" + division_code + "', getdate(),getdate(),'" + mgrAuditTeam + "') ";
                    iReturn = db.ExecQry(strQry);
                }
                else
                {
                    strQry = "Update mas_sf_audit_team set " +
                        "  Audit_team = '" + audit_team + "'," +
                           "LastUpdt_Date = getdate() " +
                        " WHERE Sf_Code= '" + sf_code + "' and Division_code like '" + division_code + "'";

                    iReturn = db.ExecQry(strQry);
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }
        public bool RecordExistAudit(string division_code, string sf_code)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(Division_code) FROM mas_sf_audit_team WHERE sf_code='" + sf_code + "' and division_code='" + division_code + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }

        public DataSet UserList_Self(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserListTP_AlphasearchMgr(string divcode, string sf_code, string alpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Alphasearch_TPMgr '" + divcode + "', '" + sf_code + "', '" + alpha + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet SalesForceListMgrGet(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet SalesForce_Reporting(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select Sf_Code, Sf_Name ,Sf_HQ,sf_Designation_Short_Name,sf_TP_Active_Dt,sf_joining_date, UsrDfd_UserName, sf_emp_id, " +
  "(select b.Desig_Color from Mas_SF_Designation b where a.Designation_Code=b.Designation_Code) as desig_color " +
  "from mas_Salesforce a where tp_reporting_sf='" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //end
        public int Vac_Team_RecordAdd(string sf_Code, string sf_team, string division_code)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT isnull(max(S_No)+1,'1') S_No from Mas_Salesforce_Vac_RepTeam ";
                int S_No = db.Exec_Scalar(strQry);
                strQry = "INSERT INTO Mas_Salesforce_Vac_RepTeam VALUES ( '" + S_No + "','" + sf_Code + "' ,'" + sf_team + "','" + division_code + "') ";
                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        public int del_vac_team(string sf_Code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "delete from Mas_Salesforce_Vac_RepTeam where sf_Code = '" + sf_Code + "'";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        //saravana changes
        public DataSet TPviewGetAlphapetMgr(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_TPViewAlphapetMgrGet '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserListMailAddress(string divcode, string sf_code, string level)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_MailAddress '" + divcode + "', '" + sf_code + "', '" + level + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Changes done by Sridevi
        public DataSet UserList_AlphaAll(string divcode, string sf_code, string alpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Alphasearch_TP  '" + divcode + "', '" + sf_code + "', '" + alpha + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Changes done by Priya

        public DataSet getVacantlist_MR(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "EXEC sp_get_VacantMr '" + sf_code + "' ";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        //Changes done by Priya
        public DataSet SalesForce_State_Get(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForce_State '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserList_Self_Vacant(string divcode, string sf_code, string strVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self_vacant '" + divcode + "', '" + sf_code + "','" + strVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDesignation_MR(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,''Designation_Short_Name,''Designation_Name,'---Select---'Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name,Designation_Name,Designation_Short_Name + ' / ' + Designation_Name AS Name " +
                     " FROM Mas_SF_Designation where type=1 and Division_Code = '" + div_code + "'  and Designation_Active_Flag=0 " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getDesignation_Manager(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,''Designation_Short_Name,''Designation_Name,'---Select---'Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name,Designation_Name,Designation_Short_Name + ' / ' + Designation_Name AS Name " +
                     " FROM Mas_SF_Designation where type=2 and Division_Code = '" + div_code + "'  and Designation_Active_Flag=0 " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Change the Saravanan 230315

        //public int ExpSalesforce_RecordAdd(string lblsfcode, string txtHq, string txtEXHQ, string txtOS, string txtHill, string txtFareKm, string txtRangeofFare1, string txtRangeofFare2, string txtEffective, string strParametrValue, string strColumn)
        //{
        //    int iReturn = -1;
        //    try
        //    {
        //        DB_EReporting db = new DB_EReporting();

        //        int iCount = -1;
        //        DateTime dtEffective = Convert.ToDateTime(txtEffective);
        //        //strQry = "select count(SF_Code) from Mas_Allowance_Fixation where Sf_Code = '" + lblsfcode + "' ";
        //        //iCount = db.Exec_Scalar(strQry);

        //        strQry = "delete from Mas_Allowance_Fixation where SF_Code='" + lblsfcode + "' ";
        //        iCount = db.Exec_Scalar(strQry);

        //        //if (iCount == 0)
        //        //{
        //        //    strQry =" Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
        //        //            " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form)values('" + lblsfcode + "','" + txtEXHQ + "','" + txtEXHQ + "','" + txtOS + "', " +
        //        //            " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','"+dtEffective.Month+"-"+dtEffective.Day+"-"+dtEffective.Year +"') ";

        //        //}
        //        //else
        //        //{
        //        //    strQry = "update Mas_Allowance_Fixation set HQ_Allowance='" + txtHq + "',EX_HQ_Allowance='" + txtEXHQ + "',OS_Allowance='" + txtOS + "'," +
        //        //             "Hill_Allowance='" + txtHill + "',FareKm_Allowance='" + txtFareKm + "',Range_of_Fare1='" + txtRangeofFare1 + "',Range_of_Fare2='" + txtRangeofFare2 + "' , " +
        //        //             "Effective_Form='" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'" +
        //        //             "where Sf_Code='" + lblsfcode + "'";
        //        //}

        //        //strQry = " Insert Into Mas_Allowance_Fixation values('" + lblsfcode + "','" + txtEXHQ + "','" + txtEXHQ + "','" + txtOS + "', " +
        //        //           " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "',"+ strParametrValue+") ";


        //        if (strColumn == "")
        //        {
        //            strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
        //                    " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
        //                    " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "') ";
        //        }
        //        else
        //        {
        //            strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
        //                        " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form," + strColumn + ")values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
        //                        " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'," + strParametrValue + ") ";
        //        }

        //        iReturn = db.ExecQry(strQry);
        //    }
        //    catch (Exception ex)
        //    {
        //        throw ex;
        //    }
        //    return iReturn;
        //}

        public int ExpSalesforce_RecordAdd(string lblsfcode, string txtHq, string txtEXHQ, string txtOS, string txtHill, string txtFareKm, string txtRangeofFare1, string txtRangeofFare2, string txtEffective, string strParametrValue, string strColumn, string lblDesignation, string lblsname, string divcode, string strWrktypeParametrValue, string strWrktypeColumn, string txtRangeofFare3, string txtMetro, string txtNonMetro, string txtoslmt, string txtlocal)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                int iCount = -1;
                int iCount1 = -1;
                DateTime dtEffective = Convert.ToDateTime(txtEffective);
                //strQry = "select count(SF_Code) from Mas_Allowance_Fixation where Sf_Code = '" + lblsfcode + "' ";
                //iCount = db.Exec_Scalar(strQry);
                strQry = "select count(SF_Code) from mas_Salesforce where Sf_Code = '" + lblsfcode + "' and (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') ";
                iCount1 = db.Exec_Scalar(strQry);
                if (iCount1 == 1)
                {

                    strQry = "delete from Mas_Allowance_Fixation where SF_Code='" + lblsfcode + "' and division_code='" + divcode + "' ";
                    iCount = db.Exec_Scalar(strQry);

                    //if (iCount == 0)
                    //{
                    //    strQry =" Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                    //            " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form)values('" + lblsfcode + "','" + txtEXHQ + "','" + txtEXHQ + "','" + txtOS + "', " +
                    //            " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','"+dtEffective.Month+"-"+dtEffective.Day+"-"+dtEffective.Year +"') ";

                    //}
                    //else
                    //{
                    //    strQry = "update Mas_Allowance_Fixation set HQ_Allowance='" + txtHq + "',EX_HQ_Allowance='" + txtEXHQ + "',OS_Allowance='" + txtOS + "'," +
                    //             "Hill_Allowance='" + txtHill + "',FareKm_Allowance='" + txtFareKm + "',Range_of_Fare1='" + txtRangeofFare1 + "',Range_of_Fare2='" + txtRangeofFare2 + "' , " +
                    //             "Effective_Form='" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'" +
                    //             "where Sf_Code='" + lblsfcode + "'";
                    //}

                    //strQry = " Insert Into Mas_Allowance_Fixation values('" + lblsfcode + "','" + txtEXHQ + "','" + txtEXHQ + "','" + txtOS + "', " +
                    //           " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "',"+ strParametrValue+") ";


                    /*if (strColumn == "")
                    {
                        strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                                " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form,Designation_Code,sf_Designation_Short_Name,division_code)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
                                " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "','" + lblDesignation + "','" + lblsname + "','" + divcode + "') ";
                    }
                    else
                    {
                        strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                                    " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form," + strColumn + ",Designation_Code,sf_Designation_Short_Name,division_code)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
                                    " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'," + strParametrValue + ",'" + lblDesignation + "','" + lblsname + "','" + divcode + "') ";
                    }*/
                    if (strColumn == "" && strWrktypeColumn == "")
                    {
                        strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                                " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form,Designation_Code,sf_Designation_Short_Name,division_code,Range_of_Fare3,OS_SM,OS_NM,created_date,os_with_lmt,loal_convey)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
                                " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "','" + lblDesignation + "','" + lblsname + "','" + divcode + "','" + txtRangeofFare3 + "','" + txtMetro + "','" + txtNonMetro + "',getdate(),'" + txtoslmt + "','" + txtlocal + "') ";
                    }
                    else if (strColumn != "" && strWrktypeColumn == "")
                    {
                        strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                                    " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form," + strColumn + ",Designation_Code,sf_Designation_Short_Name,division_code,Range_of_Fare3,OS_SM,OS_NM,created_date,os_with_lmt,loal_convey)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
                                    " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'," + strParametrValue + ",'" + lblDesignation + "','" + lblsname + "','" + divcode + "','" + txtRangeofFare3 + "','" + txtMetro + "','" + txtNonMetro + "',getdate(),'" + txtoslmt + "','" + txtlocal + "') ";
                    }
                    else if (strColumn == "" && strWrktypeColumn != "")
                    {
                        strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                                    " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form," + strWrktypeColumn + ",Designation_Code,sf_Designation_Short_Name,division_code,Range_of_Fare3,OS_SM,OS_NM,created_date,os_with_lmt,loal_convey)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
                                    " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'," + strWrktypeParametrValue + ",'" + lblDesignation + "','" + lblsname + "','" + divcode + "','" + txtRangeofFare3 + "','" + txtMetro + "','" + txtNonMetro + "',getdate(),'" + txtoslmt + "','" + txtlocal + "') ";
                    }
                    else
                    {

                        strQry = " Insert Into Mas_Allowance_Fixation (SF_Code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance, " +
                                    " FareKm_Allowance,Range_of_Fare1,Range_of_Fare2,Effective_Form," + strColumn + "," + strWrktypeColumn + ",Designation_Code,sf_Designation_Short_Name,division_code,Range_of_Fare3,OS_SM,OS_NM,created_date,os_with_lmt,loal_convey)values('" + lblsfcode + "','" + txtHq + "','" + txtEXHQ + "','" + txtOS + "', " +
                                    " '" + txtHill + "','" + txtFareKm + "','" + txtRangeofFare1 + "','" + txtRangeofFare2 + "','" + dtEffective.Month + "-" + dtEffective.Day + "-" + dtEffective.Year + "'," + strParametrValue + "," + strWrktypeParametrValue + ",'" + lblDesignation + "','" + lblsname + "','" + divcode + "','" + txtRangeofFare3 + "','" + txtMetro + "','" + txtNonMetro + "',getdate(),'" + txtoslmt + "','" + txtlocal + "') ";
                    }
                    iReturn = db.ExecQry(strQry);
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }
        public DataTable GetRange(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            strQry = "select * from range_per_kms where division_code='" + divcode + "'";
            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public int SetRange(string rgtxtval1, string rgbtnval1, string rgtxtval2, string rgbtnval2, string div_code, string rgtxtval3, string rgbtnval3)
        {
            int iReturn = -1;
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "delete FROM Range_Per_KMS where division_code='" + div_code + "' ";
                iReturn = db.ExecQry(strQry);

                strQry = " INSERT INTO Range_Per_KMS (Range1, Range1_KMS, Range1_status, Range2,   " +
                                   " Range2_KMS, Range2_status, Division_Code, Range3, Range3_KMS, Range3_status ) " +
                                   " VALUES ('Range1' , '" + rgtxtval1 + "', " +
                                   " '" + rgbtnval1 + "', 'Range2', " +
                                   "' " + rgtxtval2 + "', '" + rgbtnval2 + "', " +
                                   "  '" + div_code + "','Range3' , '" + rgtxtval3 + "', " +
                                   " '" + rgbtnval3 + "' ) ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }



        public DataSet GetExp_AllwanceFixation(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet_Allowance '" + divcode + "', '" + sf_code + "' ";

            //strQry = "select * from Mas_Allowance_Fixation";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Changes done by Priya

        public DataSet Hq_Camp(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_Camp_HQ '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Changes done by Saravanan
        public DataSet UserList_get_SelfMail(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self_Mail '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_UserList_Self_Mail_Vacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self_Mail_Vacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSfName_HQ(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;

            strQry = " SELECT a.sf_code, a.Sf_Name, a.Sf_HQ,a.sf_type,b.Designation_Short_Name,UsrDfd_UserName,sf_joining_date,sf_emp_id" +
                     " FROM mas_salesforce a, Mas_SF_Designation b" +
                     " WHERE a.Sf_Code= '" + sfcode + "' " +
                     "and a.Designation_Code=b.Designation_Code " +
                     " ORDER BY 2";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Type_LST_Report(string sf_code, string div_code, DateTime dtcurrent, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_TypeMissedCallReport  '" + div_code + "', '" + sf_code + "', '" + dtcurrent + "', " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet Type_MSD_Report(string sf_code, string div_code, int iMonth, int iYear, int catg_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_DCR_TypeMissedCallReport  '" + div_code + "', '" + sf_code + "', " + iMonth + ", " + iYear + ", " + catg_code + " ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public int PromoteSf(string sf_code, string sf_Name, string From_Des, string To_Des, string Reporting_To, string div_code, string Effective_Date, int Fieldforce_Type, string category)
        {
            int iReturn = -1;
            string empl_id = string.Empty;
            int sl_num;
            DateTime Effe_Date = Convert.ToDateTime(Effective_Date.ToString());

            Effective_Date = Effe_Date.Month + "-" + Effe_Date.Day + "-" + Effe_Date.Year;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM Salesforce_Promotion_Dtls ";
                sl_num = db.Exec_Scalar(strQry);

                empl_id = "E" + sl_num.ToString();

                strQry = " INSERT INTO Salesforce_Promotion_Dtls (Employee_Id, SF_Code, SF_Name, Promoted_From_Desg,   " +
                                    " Promoted_To_Desg, Reporting_To_Sf_Code, Effective_Date,Division_Code ) " +
                                    " VALUES ('" + empl_id + "' , '" + sf_code + "', " +
                                    " '" + sf_Name + "', " + From_Des + ", " +
                                    " " + To_Des + ", '" + Reporting_To + "', " +
                                    "  '" + Effective_Date + "','" + div_code + "' ) ";

                iReturn = db.ExecQry(strQry);

                DataSet DsSal = null;

                if (div_code.Contains(','))
                {
                    div_code = div_code.Remove(div_code.Length - 1);
                }

                string type_code = category + Fieldforce_Type;

                strQry = "select HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance,FareKm_Allowance,Range_of_Fare1,Range_of_Fare2, " +
                        " Effective_Form,Fixed_Column1,Fixed_Column2,Fixed_Column3,Fixed_Column4,Fixed_Column5,Meeting_Expenses " +
                        " from Mas_Desig_Allowance where division_code='" + div_code + "' and Designation_Code='" + To_Des + "' and Type_Code='" + type_code + "' ";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {


                    strQry = " update Mas_Allowance_Fixation set HQ_Allowance='" + DsSal.Tables[0].Rows[0][0].ToString() + "', " +
                           " EX_HQ_Allowance='" + DsSal.Tables[0].Rows[0][1].ToString() + "',OS_Allowance='" + DsSal.Tables[0].Rows[0][2].ToString() + "',Hill_Allowance='" + DsSal.Tables[0].Rows[0][3].ToString() + "',FareKm_Allowance='" + DsSal.Tables[0].Rows[0][4].ToString() + "',Range_of_Fare1='" + DsSal.Tables[0].Rows[0][5].ToString() + "',Range_of_Fare2='" + DsSal.Tables[0].Rows[0][6].ToString() + "', " +
                            " Effective_Form='" + DsSal.Tables[0].Rows[0][7].ToString() + "',Fixed_Column1='" + DsSal.Tables[0].Rows[0][8].ToString() + "',Fixed_Column2='" + DsSal.Tables[0].Rows[0][9].ToString() + "',Fixed_Column3='" + DsSal.Tables[0].Rows[0][10].ToString() + "',Fixed_Column4='" + DsSal.Tables[0].Rows[0][11].ToString() + "',Fixed_Column5='" + DsSal.Tables[0].Rows[0][12].ToString() + "', " +
                            " Meeting_Expenses='" + DsSal.Tables[0].Rows[0][13].ToString() + "',Designation_Code='" + To_Des + "',sf_Designation_Short_Name=(select sf_Designation_Short_Name from mas_salesforce where sf_code='" + sf_code + "' and Designation_Code='" + To_Des + "' ) where sf_code='" + sf_code + "' ";
                    //and  Designation_Code='"+From_Des+"' ";



                    iReturn = db.ExecQry(strQry);
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }


        public int DePromoteSf(string sf_code, string sf_Name, string From_Des, string To_Des, string Reporting_To, string div_code, string Effective_Date, int Fieldforce_Type, string category)
        {
            int iReturn = -1;
            string empl_id = string.Empty;
            int sl_num;
            DateTime Effe_Date = Convert.ToDateTime(Effective_Date.ToString());

            Effective_Date = Effe_Date.Month + "-" + Effe_Date.Day + "-" + Effe_Date.Year;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT ISNULL(COUNT(Employee_Id),0)+1 FROM Salesforce_DePromotion_Dtls ";
                sl_num = db.Exec_Scalar(strQry);

                empl_id = "E" + sl_num.ToString();

                strQry = " INSERT INTO Salesforce_DePromotion_Dtls (Employee_Id, SF_Code, SF_Name, Promoted_From_Desg,   " +
                                    " Promoted_To_Desg, Reporting_To_Sf_Code, Effective_Date,Division_Code ) " +
                                    " VALUES ('" + empl_id + "' , '" + sf_code + "', " +
                                    " '" + sf_Name + "', " + From_Des + ", " +
                                    " " + To_Des + ", '" + Reporting_To + "', " +
                                    "  '" + Effective_Date + "','" + div_code + "' ) ";

                iReturn = db.ExecQry(strQry);
                DataSet DsSal = null;

                if (div_code.Contains(','))
                {
                    div_code = div_code.Remove(div_code.Length - 1);
                }

                string type_code = category + Fieldforce_Type;

                strQry = "select HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance,FareKm_Allowance,Range_of_Fare1,Range_of_Fare2, " +
                        " Effective_Form,Fixed_Column1,Fixed_Column2,Fixed_Column3,Fixed_Column4,Fixed_Column5,Meeting_Expenses " +
                        " from Mas_Desig_Allowance where division_code='" + div_code + "' and Designation_Code='" + To_Des + "' and Type_Code='" + type_code + "' ";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {


                    strQry = " update Mas_Allowance_Fixation set HQ_Allowance='" + DsSal.Tables[0].Rows[0][0].ToString() + "', " +
                           " EX_HQ_Allowance='" + DsSal.Tables[0].Rows[0][1].ToString() + "',OS_Allowance='" + DsSal.Tables[0].Rows[0][2].ToString() + "',Hill_Allowance='" + DsSal.Tables[0].Rows[0][3].ToString() + "',FareKm_Allowance='" + DsSal.Tables[0].Rows[0][4].ToString() + "',Range_of_Fare1='" + DsSal.Tables[0].Rows[0][5].ToString() + "',Range_of_Fare2='" + DsSal.Tables[0].Rows[0][6].ToString() + "', " +
                            " Effective_Form='" + DsSal.Tables[0].Rows[0][7].ToString() + "',Fixed_Column1='" + DsSal.Tables[0].Rows[0][8].ToString() + "',Fixed_Column2='" + DsSal.Tables[0].Rows[0][9].ToString() + "',Fixed_Column3='" + DsSal.Tables[0].Rows[0][10].ToString() + "',Fixed_Column4='" + DsSal.Tables[0].Rows[0][11].ToString() + "',Fixed_Column5='" + DsSal.Tables[0].Rows[0][12].ToString() + "', " +
                            " Meeting_Expenses='" + DsSal.Tables[0].Rows[0][13].ToString() + "',Designation_Code='" + To_Des + "',sf_Designation_Short_Name=(select sf_Designation_Short_Name from mas_salesforce where sf_code='" + sf_code + "' and Designation_Code='" + To_Des + "' ) where sf_code='" + sf_code + "' ";
                    //and  Designation_Code='" + From_Des + "' ";



                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }
        //Changes done by Priya

        public DataSet getFieldForce_Transfer(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = " SELECT '' as sf_code, '---Select the FieldForce---' as sf_name, '' as sf_username,'' as sf_HQ  " +
                   " UNION " +
                     "select sf_code, sf_name+' - '+b.Designation_Short_Name+' - '+ sf_HQ  sf_name, sf_username, sf_HQ " +
                     " from Mas_Salesforce a,Mas_SF_Designation b " +
                     " where Sf_Code !='admin' and (a.Division_Code like '" + div_code + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " and sf_type = 1 and a.Designation_Code=b.Designation_Code and sf_status<>2 " +
                     " order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        //Changes done by Saravanan
        public DataSet sp_UserList_NameHierarchy(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_UserList_NameHierarchy '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        //Changes done by Priya
        public DataSet getMR_Alphabet(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_type = 1 " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSfCode(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code FROM  Mas_Salesforce " +
                     " WHERE UsrDfd_UserName= '" + sfcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfCodeNew(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code FROM  Mas_Salesforce " +
                     " WHERE UsrDfd_UserName= '" + sfcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet GetSFCode_Upload(string sf_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            try
            {


                string sftype = string.Empty;
                string Sf_Code = string.Empty;
                if (sf_type == "1")
                {
                    sftype = "MR";
                    strQry = "SELECT  Count(Cast(SubString(Sf_Code,3, LEN(Sf_Code)) as int))+1 FROM mas_salesforce where Sf_Code like '" + sftype + "%'  ";
                }
                else
                {
                    sftype = "MGR";
                    strQry = "SELECT  Count(Cast(SubString(Sf_Code,4, LEN(Sf_Code)) as int))+1 FROM mas_salesforce where Sf_Code like '" + sftype + "%'  ";
                }

                //  strQry = "SELECT MAX(sf_code) FROM mas_salesforce where  Sf_Code like '" + sftype + "%' ";
                //  strQry = "SELECT  max(Cast(SubString(Sf_Code,4, LEN(Sf_Code)) as int))+1 FROM mas_salesforce where Sf_Code like '" + sftype + "%'  ";
                int iCnt = db_ER.Exec_Scalar(strQry);
                if (iCnt.ToString().Length == 1)
                {
                    Sf_Code = "000" + iCnt.ToString();
                }
                else if (iCnt.ToString().Length == 2)
                {
                    Sf_Code = "00" + iCnt.ToString();
                }
                else if (iCnt.ToString().Length == 3)
                {
                    Sf_Code = "0" + iCnt.ToString();
                }
                else
                {
                    Sf_Code = iCnt.ToString();
                }
                Sf_Code = sftype + Sf_Code;

                // dsSF = Sf_Code.ToString();

                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return dsSF;

        }
        public DataSet getReporting_Name(string Sf_Name)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT sf_code FROM  Mas_Salesforce " +
                     " WHERE Sf_Name= '" + Sf_Name + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getReporting_Name(string Sf_Name, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            if (Sf_Name == "admin")
            {
                strQry = " SELECT sf_code FROM  Mas_Salesforce " +
                         " WHERE Sf_Name= '" + Sf_Name + "' ";
            }
            else
            {
                strQry = " SELECT sf_code FROM  Mas_Salesforce " +
                        " WHERE Sf_Name= '" + Sf_Name + "' and  Division_code = '" + div_code + ',' + "'  ";
            }

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getLastDCR(string sfcode)
        {

            //changed by sri - 15july
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            //strQry = " SELECT max (convert(varchar,Activity_Date,103)) as activity_date FROM " +
            //         " ( SELECT activity_date FROM DCRMain_Temp where sf_code='" + sfcode + "' UNION ALL " +
            //         " SELECT activity_date FROM DCRMain_Trans where sf_code='" + sfcode + "') activity ";

            //strQry = " SELECT convert(varchar,Last_Dcr_Date,103) as activity_date FROM Mas_Salesforce " +
            //          "where sf_code='" + sfcode + "'";

            strQry = " SELECT convert(varchar,Last_Dcr_Date,103) as activity_date FROM mas_salesforce_DCRTPdate " +
               "where sf_code='" + sfcode + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Changes done by Saravanan

        public DataSet SalesForceList_TP_StartingDt_Get(string divcode, string sf_code, string Month)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForce_TP_StartingDt_Get '" + divcode + "', '" + sf_code + "' ,'" + Month + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Changes done by saravanan
        public DataSet sp_UserMGRLogin(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC [sp_UserMGRLogin] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_UserMRLogin(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC [sp_UserMRLogin] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // added by sri - 21 July
        public DataSet getSalesForcelist_Alphabet_List(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=0  " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_Tp_Active_flag = 0 " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        // added by sri - 22 July
        public DataSet UserList_BulkEditStartDate(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_BulkEditStartDate '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // added by sri - 22 July
        public DataSet UserList_BulkEditTPStartDate(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_BulkEditTPStartDate '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Added by sri - to show des short name
        public DataSet getDesignation_SN(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,'---Select---'  Designation_Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name AS Designation_Name " +
                     " FROM Mas_SF_Designation where Division_Code = '" + div_code + "' " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Changes done by Saravana
        public DataSet getsf_tp(string div_code, string sReport, string ReportingMGR)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT sf_code, Sf_Name,convert(varchar,sf_TP_Active_Dt,103) sf_TP_Active_Dt,convert(varchar,Last_TP_Date,103) Last_TP_Date" +
                     " FROM mas_salesforce " +
                     " WHERE lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') " +
                      " AND SF_Status = 0 AND sf_Tp_Active_flag = 0 " +
                       " AND (TP_Reporting_SF = '" + sReport + "'" +
                     " OR sf_Code = '" + sReport + "' " +
                     " OR sf_Code = '" + ReportingMGR + "' )" +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        //// To fetch UserList by using DataSet & DataTable by Recursive call - Modified by Sri - 29Aug15
        public DataTable getUserListReportingTo(string div_code, string sf_code, int order_id)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("last_DCR_Date", typeof(string)));
                strQry = " SELECT a.sf_Code, a.sf_Name+' - '+sf_hq+' - '+sf_Designation_Short_Name as sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName,a.sf_emp_id,(select convert(char(10),DATEADD(day, -1, Last_DCR_Date),103) from [dbo].[Mas_Salesforce_DCRTPdate] where sf_code=a.sf_code) as last_DCR_Date  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status !=2 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (sf_code != "admin")
                    {
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();

                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dt.Rows.Add(dr);
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name+' - '+sf_hq+' - '+sf_Designation_Short_Name as sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName,a.sf_emp_id,(select convert(char(10),DATEADD(day, -1, Last_DCR_Date),103) from [dbo].[Mas_Salesforce_DCRTPdate] where sf_code=a.sf_code) as last_DCR_Date   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status !=2 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {

                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                        dr["sf_Type"] = drFF["sf_Type"].ToString();
                        dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                        dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                        dr["sf_hq"] = drFF["sf_hq"].ToString();
                        dr["sf_password"] = drFF["sf_password"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                        dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                        dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                        dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                        dr["last_DCR_Date"] = drFF["last_DCR_Date"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getUserListReportingTo(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }


        //Added by sri - to check for audit
        public DataSet CheckforAudit(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT Sf_Code from Mas_sf_Audit_Team Where" +
                     " (Audit_Team like '" + sf_code + ',' + "%'  or " +
                      " Audit_Team like '%" + ',' + sf_code + ',' + "%' or  " +
                     " Audit_Team like '%" + sf_code + "%' ) " +
                     " and  Division_code = '" + div_code + "'";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //Added by sri - to fetch Audit Mgr Dtls
        public DataSet getAuditMgr(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag ,a.UsrDfd_UserName , '' Lst_drCount, c.StateName,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt,  " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id ,a.sf_Type as type , (select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code,a.Approved_By,case when SF_DOW='1900-01-01' then '' else convert(varchar,sf_Dow,103) end as SF_DOW " +
                     " ,a.Bank_Name,a.Bank_AcNo,a.IFS_Code,isnull(a.Sf_DCRSample_Valid,0)as Sf_DCRSample_Valid,isnull(a.Sf_DCRInput_Valid,0)as Sf_DCRInput_Valid " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //// To fetch UserList by using DataSet & DataTable by Recursive call - Sridevi on 07/23/15
        public DataTable getUserList_Managers(string div_code, string sf_code, int order_id)
        {
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
            }

            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.sf_type = 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                        dr["sf_Type"] = drFF["sf_Type"].ToString();
                        dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                        dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                        dr["sf_hq"] = drFF["sf_hq"].ToString();
                        dr["sf_password"] = drFF["sf_password"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                        dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();

                        dt.Rows.Add(dr);

                        dt_recursive = getUserList_Managers(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        //// To fetch UserList by using DataSet & DataTable by Recursive call - Sridevi on 07/23/15
        public DataTable getUserList_Managers_Audit(string div_code, string sf_code, int order_id, string Aud_Mgr)
        {
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
            }

            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code"; // Modified to include MR - 29Aug15
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        if (drFF["sf_Code"].ToString() != Aud_Mgr)
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();

                            dt.Rows.Add(dr);
                        }
                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserList_Managers_Audit(div_code, drFF["sf_code"].ToString(), order_id, Aud_Mgr);//Modified by Sri to include MR - 29Aug15
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        // Added by Sri - 29Aug15
        public DataTable getUserList_ForAM(string div_code, string sf_code, int order_id)
        {
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
            }

            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        int i = 0;
                        DataSet dsA = FillSalesForcelist_Mgr(div_code);
                        foreach (DataRow dra in dsA.Tables[0].Rows)
                        {
                            if (dra["SF_Code"].ToString() == drFF["sf_code"].ToString())
                            {
                                i = 1;
                            }
                        }
                        if (i == 0)
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();

                            dt.Rows.Add(dr);
                        }
                        dt_recursive = getUserList_ForAM(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        public DataSet getAuditTeam(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " Select Audit_team from Mas_Sf_Audit_Team where " +
                     " Division_Code =  + '" + div_code + "'" +
                     " and sf_code = '" + sf_code + "'";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet getAuditTeam(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " Select sf_code,Audit_team from Mas_Sf_Audit_Team where " +
                     " Division_Code =  + '" + div_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // Added Newly
        public DataTable getUserListReportingToAllNew(string div_code, string sf_code, int order_id, string sf_type) // 23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                   " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                   " b.Designation_Short_Name, b.Desig_Color,   " +
                    //" when '0' then 'Active'  " +
                    //" when '1' then 'Vacant'  " +
                    " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                    "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                   " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                   " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' ) THEN 'Blocked' end ) " +
                   "  sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id " +
                   " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                   " WHERE a.SF_Status !=2 and " +
                   " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                   " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.State_Code=c.State_Code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (sf_type == "3")
                    {
                        strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                  " FROM mas_ho_id_creation " +
                                   " WHERE HO_Active_flag = 0  and  " +
                                   "(Division_Code like '" + div_code + "%'  or " +
                                    "Division_Code like '%" + ',' + div_code + "%') and " +
                                  " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                        DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsmgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = "admin";
                            dr["sf_Name"] = "admin";
                            dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = "";
                            dr["Sf_Joining_Date"] = "";
                            dr["Reporting_To_SF"] = "";
                            dr["sf_hq"] = "";
                            dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Designation_Short_Name"] = "Admin";
                            dr["Desig_Color"] = "33ff96";

                            dr["sf_Tp_Active_flag"] = "";
                            dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Lst_drCount"] = "";
                            dr["StateName"] = "";
                            dr["sf_emp_id"] = "";
                            dt.Rows.Add(dr);
                        }
                    }
                    else
                    {

                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();


                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                        dt.Rows.Add(dr);
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color,   " +
                     //" when '0' then 'Active'  " +
                     //" when '1' then 'Vacant'  " +
                     " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                     "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                     " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                     " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' ) THEN 'Blocked' end ) " +
                     " sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status !=2 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        //Check for Audit
                        // DataSet ds = CheckforAuditteammgr(drFF["sf_code"].ToString(), div_code);
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }
                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                            dt.Rows.Add(dr);
                        }
                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToAllNew(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        //// To fetch UserList by using DataSet & DataTable by Recursive call - Sridevi on 07/23/15
        public DataTable getUserListReportingToAll(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                   " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                   " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                   " when '0' then 'Active'  " +
                   " when '1' then 'Vacant'  " +
                   " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName  " +
                   " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                   " WHERE a.SF_Status=0 and " +
                   " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                   " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);

                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                    dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                    dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                    dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                    dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                    dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                    dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                    dt.Rows.Add(dr);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status=0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        if (drFF["sf_code"].ToString() != Audit_mgr_All)
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dt.Rows.Add(dr);
                        }
                        //Check for Audit
                        DataSet ds = CheckforAuditteammgr(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            dsA = getAuditMgr(ds.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                            if (dsA.Tables[0].Rows.Count > 0)
                            {
                                order_id = order_id + 1;
                                dr = dt.NewRow();
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                Audit_mgr_All = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                dt.Rows.Add(dr);
                            }
                        }
                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToAll(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        //changes done by Reshmi

        public DataSet getSalesForce_React(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "  SELECT a.SF_Code, a.Sf_Name , a.Sf_UserName,sf_Tp_Active_flag, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
                      " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code, " +
                      "(select sf_name from mas_salesforce where sf_code=a.Reporting_to_sf) as Reporting_To_SF, " +
                      " (select count(distinct listeddrcode) from mas_listeddr where ListedDr_Active_Flag=0 and  sf_code=a.sf_code) Drcnt " +
                      " from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                      " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and " +
                      " SF_Status= 2 and Sf_Deactivate_Permanent=0  AND lower(sf_code) != 'admin' " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public int Reactivate_Sales(string Sf_Code)
        {
            int iReturn = -1;
            try
            {
                //DB_EReporting db = new DB_EReporting();

                //strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + Sf_Code + "'";
                //iReturn_Backup = db.ExecQry(strQry);

                //strQry = "Update Mas_Salesforce " +
                //         "SET SF_Status = 0 , " +
                //         "LastUpdt_Date = getdate() " +
                //         "WHERE Sf_Code ='" + Sf_Code + "'";

                //iReturn = db.ExecQry(strQry);

                //strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + Sf_Code + "'";
                //iReturn_Backup = db.ExecQry(strQry);

                DB_EReporting db = new DB_EReporting();

                strQry = "EXEC Sf_Reactivate '" + Sf_Code + "' ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        //Changes done by Reshmi


        public DataSet get_Ho_Id(string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSalesForce = null;

            strQry = "Select Name , User_Name ,Password,Menu_type,Division_Code ,Reporting_To,ho_id " +
                     "From Mas_HO_ID_Creation WHERE HO_Active_Flag =0 and HO_ID ='" + HO_ID + "' " +
                     "ORDER BY 2";

            try
            {
                dsSalesForce = db_ER.Exec_DataSet(strQry);
            }

            catch (Exception ex)
            {
                throw ex;
            }

            return dsSalesForce;
        }
        public DataSet Check_box()
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSalesForce = null;

            strQry = "Select Name , User_Name ,Password,Menu_type,Division_Code ,Reporting_To_Name,ho_id " +
                     "From Mas_HO_ID_Creation WHERE HO_Active_Flag =0  " +
                     "ORDER BY 2";

            try
            {
                dsSalesForce = db_ER.Exec_DataSet(strQry);
            }

            catch (Exception ex)
            {
                throw ex;
            }

            return dsSalesForce;
        }

        public int Update_HO_Id(int HO_Id, string Name, string User_Name, string Password, string Menu_type, string div_code, string Reporting_To_Name)
        {
            int iReturn = -1;
            if (!RecordExist(User_Name, HO_Id))
            {

                try
                {
                    DB_EReporting db = new DB_EReporting();

                    strQry = "Update Mas_HO_ID_Creation " +
                             "SET Name = '" + Name + "' ," +
                             "User_Name = '" + User_Name + "' ," +
                             "Password ='" + Password + "' ," +
                             "Menu_type = '" + Menu_type + "' ," +
                             "Division_Code ='" + div_code + "'," +
                             "Reporting_To_Name ='" + Reporting_To_Name + "', " +
                             "LastUpdt_Date = getdate() " +
                             "WHERE HO_ID ='" + HO_Id + "' and HO_Active_Flag =0";

                    iReturn = db.ExecQry(strQry);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            else
            {
                iReturn = -2;
            }
            return iReturn;
        }
        public bool RecordExistAdd(string username)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(User_Name) FROM Mas_HO_ID_Creation WHERE User_Name='" + username + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        public bool RecordExist(string User_Name, int HO_Id)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(User_Name) FROM Mas_HO_ID_Creation WHERE User_Name='" + User_Name + "'  AND HO_ID !='" + HO_Id + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }

        //Added by sri - to check for audit - 28-Aug-15 sridevi
        public DataSet CheckforAuditteammgr(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT Sf_Code from Mas_sf_Audit_Team Where " +
                       " Mgr_Audit_Team = '" + sf_code + "' " +
                     " and  Division_code = '" + div_code + "'";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Changes done by Saravanan

        public DataSet getDCRStatus_MR(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;

            strQry = " SELECT a.sf_code, a.Sf_Name, a.Sf_HQ,a.sf_type,b.Designation_Short_Name as sf_Designation_Short_Name" +
                     " FROM mas_salesforce a, Mas_SF_Designation b" +
                     " WHERE a.Sf_Code= '" + sfcode + "' " +
                     "and a.Designation_Code=b.Designation_Code " +
                     " ORDER BY 2";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //New Designation 
        public DataSet getDesignation_div(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,''Designation_Short_Name,''Designation_Name,'---Select---'Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name,Designation_Name,Designation_Short_Name + ' / ' + Designation_Name AS Name " +
                     " FROM Mas_SF_Designation where Division_Code = '" + div_code + "'  and Designation_Active_Flag=0 " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getHO_new(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT HO_ID,Name,User_Name,Password,Reporting_To_Name" +
                     " FROM mas_ho_id_creation " +
                     " WHERE HO_Active_flag = 0  and Name <> 'admin'  and  Division_Code = '" + div_code + "'" +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        // Added Newly
        public DataTable getUserListReportingToNew(string div_code, string sf_code, int order_id, string sf_type)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;

                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color,  " +
                     //" when '0' then 'Active'  " +
                     //" when '1' then 'Vacant'  " +
                     " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                     "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                     " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                     " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' )THEN 'Blocked' end ) " +
                     " sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status != 2 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (sf_code == "admin")
                    {
                        strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                  " FROM mas_ho_id_creation " +
                                   " WHERE HO_Active_flag = 0  and  " +
                                   "(Division_Code like '" + div_code + "%'  or " +
                                    "Division_Code like '%" + ',' + div_code + "%') and " +
                                   " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                        DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsmgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = "admin";
                            dr["sf_Name"] = "admin";
                            dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = "";
                            dr["Sf_Joining_Date"] = "";
                            dr["Reporting_To_SF"] = "";
                            dr["sf_hq"] = "";
                            dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Designation_Short_Name"] = "Admin";
                            dr["Desig_Color"] = "33ff96";
                            dr["sf_Tp_Active_flag"] = "";
                            dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Lst_drCount"] = "";
                            dr["StateName"] = "";
                            dr["sf_emp_id"] = "";
                            dt.Rows.Add(dr);
                        }
                    }
                    else
                    {
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                        dt.Rows.Add(dr);
                    }

                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color,   " +
                      //" when '0' then 'Active'  " +
                      //" when '1' then 'Vacant'  " +
                      " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                      "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                     " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                     " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' )THEN 'Blocked' end ) " +
                     "  sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status != 2 and (a.sf_Tp_Active_flag = 0 or a.sf_Tp_Active_flag = 1 and sf_type='1') and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }

                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                            dt.Rows.Add(dr);
                        }

                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToNew(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }


        // Changes done by Priya
        public DataSet SalesForceList_New(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC getHyrSFList '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSalesForcelist_New(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "  SELECT a.SF_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq +' - '+ sf_emp_id as sf_Name, a.Sf_UserName, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
                      " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code,c.Desig_Color from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                      " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and  " +
                      " SF_Status=0  AND lower(sf_code) != 'admin' AND a.sf_Tp_Active_flag = 0 " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet UserList_getMR_New(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //strQry = "EXEC sp_UserList_getMR '" + divcode + "', '" + sf_code + "' ";

            strQry = "SELECT a.sf_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name, a.Sf_UserName, a.sf_Type, " +
                        " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password " +
                        " FROM mas_salesforce a " +
                        " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and (a.Division_Code like '" + divcode + ',' + "%'  or " +
                        " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                        " and a.sf_code !='admin' and a.sf_type=1 " +
                        " order by 2 ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // Added by Sri - Address Book in Mail - 06-Oct-15
        public DataTable getAddressBookMgr(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));

                DataSet dsmgr = null;


                strQry = " SELECT  'admin' Sf_Code,case Sub_ho_id " +
                         " when '0' then 'admin-Level1' " +
                         " else name+'-Level1' " +
                         " end sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,'' sf_type,'-Level1' as sf_color, '' des_color ,'' Designation_Code from Mas_HO_ID_Creation" +
                         " Where (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "') " +
                         " UNION " +
                         " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code" +
                         " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {
                        foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                        {

                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_mail"] = drFF["sf_mail"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                            dr["sf_color"] = drFF["Sf_HQ"].ToString();
                            dr["des_color"] = drFF["des_color"].ToString();
                            dr["sf_type"] = drFF["sf_type"].ToString();
                            dt.Rows.Add(dr);
                            order_id = order_id + 1;
                        }
                    }
                    foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                    {
                        DataSet dsAudit = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (dsAudit.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow drFF1 in dsAudit.Tables[0].Rows)
                            {
                                strQry = " select a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name,a.Reporting_To_SF,a.Sf_HQ,a.sf_type,'-Level1' as sf_color, " +
                                        " b.Desig_Color as des_color ,b.Designation_Code from Mas_Salesforce a,Mas_SF_Designation b " + // SM Level
                                        " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and a.Designation_Code=b.Designation_Code and  " +
                                        " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                        " and a.sf_code = '" + drFF1["sf_code"].ToString() + "'";

                                DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);

                                if (dsMgr1.Tables[0].Rows.Count > 0)
                                {
                                    dr = dt.NewRow();
                                    order_id = order_id + 1;
                                    dr["order_id"] = order_id;
                                    dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                    dr["sf_mail"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                    dr["sf_name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                    dr["Designation_Short_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                    dr["Reporting_To_SF"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                    dr["Sf_HQ"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                    dr["sf_type"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                    dr["sf_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                    dr["des_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                    dr["Designation_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                    dt.Rows.Add(dr);
                                }
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;

            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "'and a.Designation_Code=b.Designation_Code  ORDER BY sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_mail"] = drFF["sf_mail"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["sf_color"] = drFF["Sf_HQ"].ToString();
                        dr["des_color"] = drFF["des_color"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getAddressBookMgr(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        // Added by Sri - Address Book in Mail - 06-Oct-15
        public DataTable getAddressBookDesign(string div_code, string sf_code, int order_id)
        {
            if (div_code.Contains(','))
            {
                div_code = div_code.Remove(div_code.Length - 1);
            }

            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));

                DataSet dsmgr = null;


                strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {
                        foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_mail"] = drFF["sf_mail"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                            dr["sf_color"] = drFF["Sf_HQ"].ToString();
                            dr["des_color"] = drFF["des_color"].ToString();
                            dr["sf_type"] = drFF["sf_type"].ToString();
                            dt.Rows.Add(dr);
                            order_id = order_id + 1;
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;

            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "'and a.Designation_Code=b.Designation_Code  ORDER BY sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_mail"] = drFF["sf_mail"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["sf_color"] = drFF["Sf_HQ"].ToString();
                        dr["des_color"] = drFF["des_color"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getAddressBookMgr(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            string[] TobeDistinct = { "Designation_Code", "Designation_Short_Name" };
            return GetDistinctRecords(dt, TobeDistinct);
        }

        //Following function will return Distinct records for Name, City and State column.
        public static DataTable GetDistinctRecords(DataTable dt, string[] Columns)
        {
            DataTable dtUniqRecords = new DataTable();
            dtUniqRecords = dt.DefaultView.ToTable(true, Columns);
            return dtUniqRecords;
        }
        public DataSet sp_UserList_Hierarchy_Mail(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy_Mail '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // Added by Sri - Address Book in Mail - 06-Oct-15
        public DataTable getAddressBookWithoutAdmin(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));

                DataSet dsmgr = null;


                strQry = " SELECT  'admin' Sf_Code,case Sub_ho_id " +
                         " when '0' then 'admin-Level1' " +
                         " else name+'-Level1' " +
                         " end sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,'' sf_type,'-Level1' as sf_color, '' des_color ,'' Designation_Code from Mas_HO_ID_Creation" +
                         " Where (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "') and user_name not like'admin%' " +
                         " UNION" +
                         " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code" +
                         " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                        " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {
                        foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_mail"] = drFF["sf_mail"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                            dr["sf_color"] = drFF["Sf_HQ"].ToString();
                            dr["des_color"] = drFF["des_color"].ToString();
                            dr["sf_type"] = drFF["sf_type"].ToString();
                            dt.Rows.Add(dr);
                            order_id = order_id + 1;
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;

            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "'and a.Designation_Code=b.Designation_Code  ORDER BY sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_mail"] = drFF["sf_mail"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["sf_color"] = drFF["Sf_HQ"].ToString();
                        dr["des_color"] = drFF["des_color"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getAddressBookMgr(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        //done by reshmi

        public DataSet getSubHO_new(string div_code, string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT HO_ID,Name,User_Name,Password,Emp_Id,Dcr_Joint_Work_Display " +
                     " FROM mas_ho_id_creation " +
                     " WHERE HO_Active_flag = 0  and Name <> 'admin'  and  " +
                      //" (Division_Code like '" + div_code +  "%'  or " +
                      //" Division_Code like '%" + ',' + div_code  + "%') and " +
                      "Sub_HO_ID='" + HO_ID + "'" +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int Sub_HO_ID_RecordAdd(string username, string password, string name, string menu, string div_code, string reporting_to, string reporting_to_name, string Ho_Id)
        {
            int iReturn = -1;
            if (!RecordExistAddSub(username, Ho_Id))
            {
                try
                {
                    DB_EReporting db = new DB_EReporting();
                    strQry = "SELECT isnull(max(HO_ID)+1,'1') HO_ID from mas_ho_id_creation ";
                    int HO_IDNew = db.Exec_Scalar(strQry);

                    strQry = "INSERT INTO mas_ho_id_creation VALUES ('" + HO_IDNew + "' ,'" + username + "' ,'" + password + "','" + name + "', '" + menu + "', '" + div_code + "', '" + reporting_to + "', '" + reporting_to_name + "',getdate(),getdate(),'0','" + Ho_Id + "',NULL) ";
                    iReturn = db.ExecQry(strQry);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            else
            {
                iReturn = -2;
            }
            return iReturn;
        }

        public int Update_Sub_HO_Id(int HO_Id, string Name, string User_Name, string Password, string div_code)
        {
            int iReturn = -1;
            if (!RecordExistSub(User_Name, HO_Id))
            {

                try
                {
                    DB_EReporting db = new DB_EReporting();

                    strQry = "Update Mas_HO_ID_Creation " +
                             "SET Name = '" + Name + "' ," +
                             "User_Name = '" + User_Name + "' ," +
                             "Password ='" + Password + "' ," +
                             "Division_Code ='" + div_code + "'," +
                             "LastUpdt_Date = getdate() " +
                             "WHERE HO_ID ='" + HO_Id + "' and HO_Active_Flag =0";

                    iReturn = db.ExecQry(strQry);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            else
            {
                iReturn = -2;
            }
            return iReturn;
        }

        public DataSet get_Sub_Ho_Id(string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSalesForce = null;

            strQry = "Select Name , User_Name ,Password,Division_Code ,ho_id,Emp_Id,Dcr_Joint_Work_Display " +
                     "From Mas_HO_ID_Creation WHERE HO_Active_Flag =0 and HO_ID ='" + HO_ID + "' " +
                     "ORDER BY 2";

            try
            {
                dsSalesForce = db_ER.Exec_DataSet(strQry);
            }

            catch (Exception ex)
            {
                throw ex;
            }

            return dsSalesForce;
        }

        public DataSet getHO_new(string div_code, string ho_id)//changes done by reshmi
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT HO_ID,Name,User_Name,Password,Reporting_To_Name" +
                     " FROM mas_ho_id_creation " +
                     " WHERE HO_Active_flag = 0  and Name <> 'admin'  and  Division_Code = '" + div_code + "' and HO_ID='" + ho_id + "'" +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public int HO_ID_RecordAdd(string username, string password, string name, string menu, string div_code, string reporting_to, string reporting_to_name, string sub_ho)
        {
            int iReturn = -1;
            if (!RecordExistAdd(username))
            {
                try
                {
                    DB_EReporting db = new DB_EReporting();
                    strQry = "SELECT isnull(max(HO_ID)+1,'1') HO_ID from mas_ho_id_creation ";
                    int HO_ID = db.Exec_Scalar(strQry);

                    strQry = "INSERT INTO mas_ho_id_creation VALUES ('" + HO_ID + "' ,'" + username + "' ,'" + password + "','" + name + "', '" + menu + "', '" + div_code + "', '" + reporting_to + "', '" + reporting_to_name + "',getdate(),getdate(),'0','" + sub_ho + "',NULL,'','') ";
                    iReturn = db.ExecQry(strQry);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            else
            {
                iReturn = -2;
            }
            return iReturn;
        }
        public bool RecordExistAddSub(string username, string Ho_Id)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(User_Name) FROM Mas_HO_ID_Creation WHERE User_Name='" + username + "' and (HO_id='" + Ho_Id + "' or Sub_HO_ID ='" + Ho_Id + "') and HO_Active_Flag=0";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        public bool RecordExistSub(string username, int Ho_Id)
        {
            bool bRecordExist = false;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(User_Name) FROM Mas_HO_ID_Creation WHERE User_Name ='" + username + "' AND HO_ID !='" + Ho_Id + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        public DataSet sp_UserList_getMR_Doc_List(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getMR_Doc_List '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDCRStatus_MRStatus(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;

            strQry = " SELECT a.sf_code, a.Sf_Name, a.Sf_HQ,a.sf_type,b.Designation_Short_Name,a.UsrDfd_UserName,sf_emp_id " +
                     " FROM mas_salesforce a, Mas_SF_Designation b" +
                     " WHERE a.Sf_Code= '" + sfcode + "' " +
                     "and a.Designation_Code=b.Designation_Code " +
                     " ORDER BY 2";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        // Added by Sri - Joined Work in DCR - 25 Nov 15
        public DataTable getJointWorkDCR(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));


                DataSet dsmgr = null;


                strQry = " Select Sf_Code,'SELF' Sf_Name, 'ZZZZ' Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' " +
                           " UNION" +
                           " Select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // AM Level
                           " where Sf_Code !='admin' and Sf_Code in " +
                           " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                           " UNION" +
                           " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF from Mas_Salesforce " + // RM Level
                           " where Sf_Code !='admin' and Sf_Code in " +
                           " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                           " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                           " UNION " +
                           " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // SM Level
                           " where Sf_Code !='admin' and Sf_Code in " +
                           " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                           " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                           " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                           " UNION " +
                           " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF from Mas_Salesforce " + // ZM Level
                           " where Sf_Code !='admin' and Sf_Code in " +
                           " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                           " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                           " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                           " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {
                        foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dt.Rows.Add(dr);
                            order_id = order_id + 1;
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;

            strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // SM Level
                     " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                     " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and Reporting_To_SF = '" + sf_code + "' ORDER BY sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();

                        dt.Rows.Add(dr);

                        dt_recursive = getJointWorkDCR(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        public DataSet getSalesForcelist_NewUser(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;


            strQry = "  SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
                     " b.StateName,a.sf_Designation_Short_Name as Designation_Name, a.State_Code as state_code,a.UsrDfd_UserName,a.Sf_Password, " +
                     " (select s.Sf_Name from mas_salesforce s where sf_code=a.TP_Reporting_SF) as Reporting_To, " +
                     " case when a.Reporting_To_SF='admin' then " +
                     " (select User_Name from Mas_HO_ID_Creation where   (Division_Code like '" + divcode + ',' + "%'  or Division_Code like '%" + ',' + divcode + ',' + "%') and  (Sub_HO_ID is null or Sub_HO_ID = '0')  ) " +
                     " else " +
                     " (select s.UsrDfd_UserName from mas_salesforce s where sf_code=a.TP_Reporting_SF) end as rep_username, " +
                     " case when a.Reporting_To_SF='admin' then " +
                     " (select Password from Mas_HO_ID_Creation where   (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') and (Sub_HO_ID is null or Sub_HO_ID = '0') ) " +
                     " else " +
                     " (select s.Sf_Password from mas_salesforce s where sf_code=a.TP_Reporting_SF) end as rep_password, " +
                     " CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'A'  " +
                     " when '1' then 'V' end sf_Tp_Active_flag  " +
                      "  from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      // " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                      " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and  " +
                      " lower(sf_code) != 'admin' " +
                      " AND a.sf_Tp_Active_flag = 0 AND SF_Status=0   " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet FindSalesForcelist_NewUser(string sFindQry, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.sf_Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                     " ,a.UsrDfd_UserName,a.Sf_Password, (select s.Sf_Name from mas_salesforce s where sf_code=a.TP_Reporting_SF) as Reporting_To,  " +

                     " case when a.Reporting_To_SF='admin' then " +
                     " (select User_Name from Mas_HO_ID_Creation where   (Division_Code like '" + divcode + ',' + "%'  or Division_Code like '%" + ',' + divcode + ',' + "%') and  (Sub_HO_ID is null or Sub_HO_ID = '0')  ) " +
                     " else " +
                     " (select s.UsrDfd_UserName from mas_salesforce s where sf_code=a.TP_Reporting_SF) end as rep_username, " +
                     " case when a.Reporting_To_SF='admin' then " +
                     " (select Password from Mas_HO_ID_Creation where   (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') and (Sub_HO_ID is null or Sub_HO_ID = '0') ) " +
                     " else " +
                     " (select s.Sf_Password from mas_salesforce s where sf_code=a.TP_Reporting_SF) end as rep_password, " +
                     " CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'A'  " +
                     " when '1' then 'V' end sf_Tp_Active_flag  " +
                     " FROM mas_salesforce a, mas_state b " +
                     " WHERE  " +
                     " lower(sf_code) != 'admin' " +
                     " AND a.State_Code=b.State_Code " +
                     //   " AND a.Designation_Code = c.Designation_Code" +
                     //  " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
                     sFindQry +
                     " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet FindSalesForcelistApp(string sFindQry)//done by resh
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
            //         " FROM mas_salesforce a, mas_state b,Mas_SF_Designation c " +
            //         " WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " AND a.State_Code=b.State_Code " +
            //         " AND a.Designation_Code = c.Designation_Code" +
            //         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 " +
            //         sFindQry +
            //         " ORDER BY Sf_Name";

            strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ,c.sf_Designation_Short_Name as Designation_Name," +
                    "(select Sf_Name  from mas_salesforce where sf_code=a.Reporting_To)+'-'+ " +
                    "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=a.Reporting_To)+'-'+ " +
                    "(select Sf_HQ from Mas_Salesforce where sf_code=a.Reporting_To) Reporting_To, " +
                    "(select Sf_Code from Mas_Salesforce where sf_code=a.Reporting_To) Reporting, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                    " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                    " WHERE c.sf_TP_Active_Flag=0 and c.SF_Status=0" +
                    sFindQry +
                    " ORDER BY Sf_Name";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_desAp(string divcode, string Designation_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName,Sf_Password, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Short_Name as Designation_Name,a.Designation_Code as Designation_Code" +
            //         " FROM  mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //         " where lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
            //         " AND a.sf_Tp_Active_flag = 0  AND a.Designation_Code = '" + Designation_Code + "' AND (a.Division_Code like '" + divcode + ',' + "%' " +
            //         " or a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //         " ORDER BY 2";

            strQry = "SELECT a.SF_Code, a.Sf_Name,a.Sf_HQ ,c.sf_Designation_Short_Name as Designation_Name," +
                    "(select Sf_Name  from mas_salesforce where sf_code=a.Reporting_To)+'-'+ " +
                    "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=a.Reporting_To)+'-'+ " +
                    "(select Sf_HQ from Mas_Salesforce where sf_code=a.Reporting_To) Reporting_To, " +
                    "(select Sf_Code from Mas_Salesforce where sf_code=a.Reporting_To) Reporting, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                    " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                    " WHERE  c.sf_TP_Active_Flag=0 and c.SF_Status=0 " +
                    " AND c.Designation_Code = '" + Designation_Code + "' AND a.Division_Code = '" + divcode + "' " +
                     " ORDER BY 2";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        //done by resh
        public DataSet getDesignation_SNM(string div_code, int sf_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,'---Select---'  Designation_Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name AS Designation_Name " +
                     " FROM Mas_SF_Designation where Division_Code = '" + div_code + "' and Designation_Active_Flag=0 and Type = '" + sf_type + "' " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSalesForcelist_Rep(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ" +
                     " FROM mas_salesforce   " +
                     " WHERE SF_Status=0 " +
                     //" AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND (sf_type=2 or ISNULL(sf_type,'')='') and   sf_Tp_Active_flag = 0 " +
                     " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int RecordUpdate_App(string sf_code, string DCR, string TP, string Lst_Dr, string leave, string SS_AM, string Expense, string Otr_AM)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = " UPDATE Mas_Salesforce_AM " +
                         " SET DCR_AM = '" + DCR + "', " +
                         " TP_AM = '" + TP + "', " +
                         " LstDr_AM = '" + Lst_Dr + "', " +
                         " Leave_AM = '" + leave + "'," +
                         " SS_AM = '" + SS_AM + "'," +
                         " Expense_AM = '" + Expense + "'," +
                         " Otr_AM = '" + Otr_AM + "'" +
                         " WHERE sf_code = '" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        // Added by Sridevi - Audit Manager login 
        // Audit Manager Team
        public DataTable getAuditManagerTeam(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Des_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("last_DCR_Date", typeof(string)));

                dt_recursive_Aud.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Des_Color", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("last_DCR_Date", typeof(string)));

                strQry = " SELECT a.sf_Code, sf_Name + ' - '+ sf_Designation_Short_Name + ' - ' + Sf_HQ as Sf_Name , a.sf_Type, " +
                    " b.Designation_Short_Name, b.Desig_Color,a.Sf_HQ,convert(char(10),a.Sf_Joining_Date,103) as Sf_Joining_Date, b.Desig_Color as Des_Color,a.Sf_UserName," +
                    " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF,convert(char(10),a.last_DCR_Date,103) as last_DCR_Date,sf_emp_id " +
                    " FROM mas_salesforce a, Mas_SF_Designation b " +
                    " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                    " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                    " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";

                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {

                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                    dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                    dr["Des_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                    dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                    dr["last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                    dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();

                    dt.Rows.Add(dr);
                }

            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {

                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, sf_Name + ' - '+ sf_Designation_Short_Name + ' - ' + Sf_HQ as Sf_Name , a.sf_Type, " +
                                     " b.Designation_Short_Name, b.Desig_Color,a.Sf_HQ,convert(char(10),a.Sf_Joining_Date,103) as Sf_Joining_Date,b.Desig_Color as Des_Color,a.Sf_UserName, " +
                                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, " +
                                     " convert(char(10),a.last_DCR_Date,103) as last_DCR_Date,sf_emp_id " +
                                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                     " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {

                                    dr = dt.NewRow();
                                    order_id = order_id + 1;

                                    dr["order_id"] = order_id;
                                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                    dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                    dr["Des_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                    dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                    dr["last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                    dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();

                                    dt.Rows.Add(dr);
                                    dt_recursive_Aud.Rows.Clear();
                                    dt_recursive = getAuditTeamMGRRep(div_code, dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                                    if (dt_recursive != null)
                                    {
                                        if (dt_recursive.Rows.Count > 0)
                                        {
                                            foreach (DataRow dataRow in dt_recursive.Rows)
                                            {
                                                dr = dt.NewRow();
                                                order_id = order_id + 1;
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                dr["Desig_Color"] = dataRow["Desig_Color"].ToString();
                                                dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                                dr["Sf_Joining_Date"] = dataRow["Sf_Joining_Date"].ToString();
                                                dr["Des_Color"] = dataRow["Des_Color"].ToString();
                                                dr["Sf_UserName"] = dataRow["Sf_UserName"].ToString();
                                                dr["Reporting_To_SF"] = dataRow["Reporting_To_SF"].ToString();
                                                dr["last_DCR_Date"] = dataRow["last_DCR_Date"].ToString();
                                                dr["sf_emp_id"] = dataRow["sf_emp_id"].ToString();

                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                        }
                    }
                }
            }
            return dt;

        }

        // Added by Sridevi - Audit Manager login 

        // Get Audit Team - Mgr - Reporting 
        public DataTable getAuditTeamMGRRep(string div_code, string sf_code, int order_id)
        {

            DataTable dt_recursive1 = new DataTable();

            DataSet dsDivision = null;
            DB_EReporting db_ER = new DB_EReporting();
            strQry = " SELECT a.sf_Code, Sf_Name + ' - '+ sf_Designation_Short_Name + ' - ' + Sf_HQ as Sf_Name , a.sf_Type, " +
          " b.Designation_Short_Name, b.Desig_Color,a.Sf_HQ,convert(char(10),a.Sf_Joining_Date,103) as Sf_Joining_Date" +
          ",b.desig_Color as Des_Color,convert(char(10),a.last_DCR_Date,103) as last_DCR_Date" +
          " FROM mas_salesforce a, Mas_SF_Designation b " +
          " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
          " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
           " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt_recursive_Aud.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["sf_Type"] = drFF["sf_Type"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                        dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                        dr["Des_Color"] = drFF["Des_Color"].ToString();
                        dr["last_DCR_Date"] = drFF["last_DCR_Date"].ToString();
                        dt_recursive_Aud.Rows.Add(dr);

                        dt_recursive1 = getAuditTeamMGRRep(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt_recursive_Aud;
        }

        // Audit Manager Team - MR only
        public DataTable getAuditManagerTeam_GetMR(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_username", typeof(string)));
                dt.Columns.Add(new DataColumn("Name", typeof(string)));
            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {
                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.Sf_Name + '-'+ a.sf_Designation_Short_Name + '-' + a.Sf_HQ as sf_Name, a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color , a.sf_Designation_Short_Name, a.Sf_HQ, a.sf_username,a.Sf_Name + '-'+ a.sf_Designation_Short_Name + '-' + a.Sf_HQ Name" +
                                " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {
                                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString() == "1")
                                    {
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["sf_Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_username"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Name"] = dsmgr.Tables[0].Rows[0]["Name"].ToString();
                                        dt.Rows.Add(dr);
                                    }
                                    else
                                    {
                                        string mgrcode = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                                        strQry = "EXEC [sp_get_Rep_audit]  '" + mgrcode + "' , '" + div_code + "'";

                                        dsSF = db_ER.Exec_DataSet(strQry);

                                        if (dsSF != null)
                                        {
                                            if (dsSF.Tables[0].Rows.Count > 0)
                                            {
                                                foreach (DataRow dataRow in dsSF.Tables[0].Rows)
                                                {
                                                    dr = dt.NewRow();
                                                    order_id = order_id + 1;

                                                    dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                    dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                    dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                    dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                    dr["Desig_Color"] = "";
                                                    dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                                    dr["Name"] = dataRow["Name"].ToString();
                                                    dt.Rows.Add(dr);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                            order_id = order_id + 1;
                        }
                    }
                }
            }
            return dt;

        }

        // Audit Manager Team - MR only for DCR Manager 
        public DataTable getAuditManagerTeam_GetMR_DCR(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            DataSet ds = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));

                dr = dt.NewRow();
                dr["order_id"] = order_id;
                dr["sf_Code"] = "0";
                dr["sf_Name"] = "---Select---";
                dr["sf_Type"] = "0";
                dr["Designation_Short_Name"] = "";
                dr["Desig_Color"] = "";

                dt.Rows.Add(dr);
            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {

                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.sf_HQ + '(' + a.Sf_Name + ')' As sf_Name, a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color" +
                                " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {

                                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString() == "1")
                                    {
                                        dr = dt.NewRow();
                                        order_id = order_id + 1;

                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();

                                        dt.Rows.Add(dr);
                                    }
                                    else
                                    {
                                        string mgrcode = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                                        strQry = "EXEC sp_get_Rep  '" + mgrcode + "'";

                                        dsSF = db_ER.Exec_DataSet(strQry);

                                        if (dsSF != null)
                                        {
                                            if (dsSF.Tables[0].Rows.Count > 0)
                                            {
                                                foreach (DataRow dataRow in dsSF.Tables[0].Rows)
                                                {
                                                    dr = dt.NewRow();
                                                    order_id = order_id + 1;
                                                    dr["order_id"] = order_id;
                                                    dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                    dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                    dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                    dr["Designation_Short_Name"] = "";
                                                    dr["Desig_Color"] = "";

                                                    dt.Rows.Add(dr);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                        }
                    }
                }
            }
            return dt;

        }
        // Audit Manager Team - MGR only
        public DataTable getAuditManagerTeam_GetMGR(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));

                strQry = " SELECT a.sf_Code, sf_Name + ' - '+ sf_Designation_Short_Name + ' - ' + Sf_HQ as Sf_Name , a.sf_Type, " +
                 " b.Designation_Short_Name, b.Desig_Color,Sf_HQ " +
                 " FROM mas_salesforce a, Mas_SF_Designation b " +
                 " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                 " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                 " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";

                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {

                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                    dr["des_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                    dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                    dt.Rows.Add(dr);
                }

            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {

                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.Sf_Name + '-'+ a.sf_Designation_Short_Name + '-' + a.Sf_HQ as sf_Name, a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color,Sf_HQ" +
                                " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {
                                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString() == "2")
                                    {
                                        dr = dt.NewRow();
                                        order_id = order_id + 1;
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["des_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();

                                        dt.Rows.Add(dr);

                                        string mgrcode = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                                        strQry = "EXEC [sp_UserList_Hierarchy_Aud]  '" + div_code + "','" + mgrcode + "' ";

                                        dsSF = db_ER.Exec_DataSet(strQry);

                                        if (dsSF != null)
                                        {
                                            if (dsSF.Tables[0].Rows.Count > 0)
                                            {
                                                foreach (DataRow dataRow in dsSF.Tables[0].Rows)
                                                {
                                                    dr = dt.NewRow();
                                                    order_id = order_id + 1;

                                                    dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                    dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                    dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                    dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                    dr["Desig_Color"] = dataRow["des_color"].ToString();
                                                    dr["des_color"] = dataRow["des_color"].ToString();
                                                    dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                                    dt.Rows.Add(dr);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }

                        }
                    }
                }
            }
            return dt;

        }


        public DataSet getSalesForcelist_TP_Alphabet(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_Tp_Active_flag = 0 " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getDoctorMgr_View(string mgr_code, string type, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDocCat = null;
            string swhere = string.Empty;

            if ((type == "0") && (mgr_code != "admin"))
            {
                swhere = swhere + "and a.Sf_Code in " +
                                "(select sf_code from Mas_Salesforce " +
                                " where sf_code in (" + mgr_code + ") ) and a.ListedDr_Active_Flag = 0";
            }
            else if ((type == "0") && (mgr_code == "admin"))
            {
                swhere = swhere + "and a.ListedDr_Active_Flag = 0 ";
            }
            else
            {
                swhere = swhere + "and a.Sf_Code in " +
                                "(select sf_code from Mas_Salesforce " +
                                " where Sf_Code !='admin' and State_Code = '" + mgr_code + "'  and sf_type = 1)";
            }


            strQry = " select ListedDrCode, ListedDr_Sl_No, ListedDr_Name, a.Doc_QuaCode,ListedDr_Address1,ListedDr_Address2, " +
                       " ListedDr_Address3, ListedDr_PinCode, a.Doc_Special_Code,a.Doc_Cat_Code,a.Doc_ClsCode,a.Territory_Code,case isnull(ListedDr_DOB,null)" +
                       " when '1900-01-01 00:00:00.000' then null  else  ListedDr_DOB  end ListedDr_DOB," +
                       " case  isnull(ListedDr_DOW,null) when '1900-01-01 00:00:00.000'then null else ListedDr_DOW end ListedDr_DOW,ListedDr_Mobile,ListedDr_Email, " +
                       " b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name,  " +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ, " +
                       " stuff((select ', '+territory_Name from Mas_Territory_Creation t where a.Territory_Code = cast(t.Territory_Code as varchar) and  charindex(cast(t.Territory_Code as varchar)+',',a.Territory_Code+',')>0 for XML path('')),1,2,'') Territory_Name " +
                       " from Mas_ListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e " +
                       " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
                       " and  a.Doc_ClsCode=b.Doc_ClsCode and a.Division_Code='" + div_code + "'  " +
                       swhere +
                       " order by ListedDr_Name ";

            try
            {
                dsDocCat = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDocCat;
        }

        public DataSet getDoctorCategory(string sf_code, string cat_code, string type, string strsf_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDocCat = null;
            string swhere = string.Empty;

            if ((type == "0") && (cat_code != "-1"))
            {
                swhere = " and a.Doc_Cat_Code = '" + cat_code + "' and a.Sf_Code in (" + strsf_Code + ") ";
            }
            else if ((type == "1") && (cat_code != "-1"))
            {
                swhere = " and a.Doc_Special_Code = '" + cat_code + "' and a.Sf_Code in (" + strsf_Code + ") ";
            }
            else if ((type == "2") && (cat_code != "-1"))
            {
                swhere = " and a.Doc_ClsCode = '" + cat_code + "' and a.Sf_Code in (" + strsf_Code + ") ";
            }
            else if ((type == "3") && (cat_code != "-1"))
            {
                swhere = " and a.Doc_QuaCode = '" + cat_code + "' and a.Sf_Code in (" + strsf_Code + ") ";
            }

            if (sf_code != "-1")
            {
                swhere = swhere + "and a.Sf_Code = '" + sf_code + "' ";
            }

            //strQry = " select ListedDrCode, ListedDr_Sl_No, ListedDr_Name, a.Doc_QuaCode,ListedDr_Address1,ListedDr_Address2, " +
            //           " ListedDr_Address3, ListedDr_PinCode, a.Doc_Special_Code,a.Doc_Cat_Code,a.Doc_ClsCode,a.Territory_Code,ListedDr_DOB,ListedDr_DOW, " +
            //           " ListedDr_Mobile,ListedDr_Email, b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name,  " +
            //           " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
            //           " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
            //           " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ, " +
            //           " stuff((select ', '+territory_Name from Mas_Territory_Creation t where a.Territory_Code = cast(t.Territory_Code as varchar) and  charindex(cast(t.Territory_Code as varchar)+',',a.Territory_Code+',')>0 for XML path('')),1,2,'') Territory_Name " +
            //           " from Mas_ListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e " +
            //           " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
            //           " and a.Doc_ClsCode=b.Doc_ClsCode " +
            //           swhere +
            //           " order by ListedDr_Name ";

            strQry = " select ListedDrCode, ListedDr_Sl_No, ListedDr_Name, a.Doc_QuaCode,ListedDr_Address1,ListedDr_Address2, " +
                       " ListedDr_Address3, ListedDr_PinCode, a.Doc_Special_Code,a.Doc_Cat_Code,a.Doc_ClsCode,a.Territory_Code," +
                       " case isnull(ListedDr_DOB,null) when '1900-01-01 00:00:00.000' then null else  ListedDr_DOB end ListedDr_DOB, " +
                       " case  isnull(ListedDr_DOW,null) when '1900-01-01 00:00:00.000'then null else ListedDr_DOW end ListedDr_DOW, " +
                       " ListedDr_Mobile,ListedDr_Email, b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name, " +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ, " +
                       " stuff((select ', '+territory_Name from Mas_Territory_Creation t where a.Territory_Code = cast(t.Territory_Code as varchar) and  charindex(cast(t.Territory_Code as varchar)+',',a.Territory_Code+',')>0 for XML path('')),1,2,'') Territory_Name " +
                       " from Mas_ListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e " +
                       " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
                       " and a.Doc_ClsCode=b.Doc_ClsCode " +
                       swhere +
                       " order by ListedDr_Name ";
            try
            {
                dsDocCat = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDocCat;
        }
        public int getDoctorcount_Total(string sf_code, string cat_code, string strSf_Code)
        {

            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                if (sf_code != "-1")
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code = '" + sf_code + "' " +
                              " and Doc_Cat_Code = '" + cat_code + "' and ListedDr_Active_Flag= 0 ";
                }
                else
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code in (" + strSf_Code + ") " +
                              " and Doc_Cat_Code = '" + cat_code + "' and ListedDr_Active_Flag= 0 ";
                }

                iReturn = db.Exec_Scalar(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public int getSpecialcount_Total(string sf_code, string spec_code, string strSf_Code)
        {

            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                if (sf_code != "-1")
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code = '" + sf_code + "' " +
                              " and Doc_Special_Code = '" + spec_code + "' and ListedDr_Active_Flag=0 ";
                }
                else
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code in(" + strSf_Code + ") " +
                              " and Doc_Special_Code = '" + spec_code + "' and ListedDr_Active_Flag=0 ";
                }

                iReturn = db.Exec_Scalar(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public int getClasscount_Total(string sf_code, string Doc_ClsCode, string strSf_Code)
        {

            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();
                if (sf_code != "-1")
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code = '" + sf_code + "' " +
                              " and Doc_ClsCode = '" + Doc_ClsCode + "' and ListedDr_Active_Flag = 0 ";
                }
                else
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                             " where Sf_Code in(" + strSf_Code + ") " +
                             " and Doc_ClsCode = '" + Doc_ClsCode + "' and ListedDr_Active_Flag = 0 ";
                }

                iReturn = db.Exec_Scalar(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public int getQualcount_Total(string sf_code, string qual_code, string strSf_Code)
        {

            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                if (sf_code != "-1")
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code = '" + sf_code + "' " +
                              " and Doc_QuaCode = '" + qual_code + "' and ListedDr_Active_Flag = 0 ";
                }
                else
                {
                    strQry = "select COUNT(listeddrcode) from Mas_ListedDr " +
                              " where Sf_Code in(" + strSf_Code + ") " +
                              " and Doc_QuaCode = '" + qual_code + "' and ListedDr_Active_Flag = 0 ";
                }

                iReturn = db.Exec_Scalar(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public DataSet getTerritory_Rep_Total(string Division_Code, int type, string strSF_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsTerr = null;

            if (Division_Code.Contains(','))
            {
                Division_Code = Division_Code.Remove(Division_Code.Length - 1);
            }

            strQry = " select Territory_Code, Territory_Name, Territory_SName " +
                       " from Mas_Territory_Creation " +
                       " where Division_Code = '" + Division_Code + "' and sf_code in(" + strSF_code + ") and Territory_Active_Flag = " + type +
                       " order by Territory_Name ";

            try
            {
                dsTerr = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsTerr;
        }

        public DataSet getDoctor_Rep_Total(string Div_Code, int type, string strSF_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            if (Div_Code.Contains(','))
            {
                Div_Code = Div_Code.Remove(Div_Code.Length - 1);
            }

            string strType = string.Empty;
            if (type == 0)
            {
                strType = "ListedDr_Created_Date";
            }
            else
            {
                strType = "ListedDr_Deactivate_Date";
            }

            strQry = " select row_number() over (order by ListedDr_Sl_No) ListedDr_Sl_No,ListedDrCode, ListedDr_Sl_No as ListedDr_Sl, ListedDr_Name,ListedDr_New_Sl_No,a.Doc_QuaCode,ListedDr_Address1,ListedDr_Address2,ListedDr_Hospital,Hospital_Address,Hospital_City,Hospital_State,Hospital_Country,  " +
                       " ListedDr_Address3, ListedDr_PinCode,a.Doc_Special_Code,a.Doc_Cat_Code,a.Doc_ClsCode,a.Territory_Code, " +
                       " case isnull(a.ListedDr_DOB,null) when '1900-01-01 00:00:00.000' then null else  ListedDr_DOB end ListedDr_DOB, " +
                       " case  isnull(a.ListedDr_DOW,null) when '1900-01-01 00:00:00.000'then null else ListedDr_DOW end ListedDr_DOW, " +
                       " ListedDr_Mobile,ListedDr_Phone,ListedDr_Email, a.Doc_Class_ShortName,a.Doc_Qua_Name,a.Doc_Cat_ShortName,a.Doc_Spec_ShortName, " +
                       " stuff((select ', '+territory_Name from Mas_Territory_Creation t where a.Territory_Code = cast(t.Territory_Code as varchar) and  charindex(cast(t.Territory_Code as varchar)+',',a.Territory_Code+',')>0 for XML path('')),1,2,'') Territory_Name, " +
                       " stuff((select '/ '+ Product_Name from Map_LstDrs_Product p where p.Listeddr_Code =a.ListedDrCode  and CHARINDEX(cast(p.Listeddr_Code as varchar),a.ListedDrCode) > 0 for XML path('')),1,2,'') ProductName, " +
                       " (select Alias_Name from  Mas_Territory_Creation h where h.sf_code = a.Sf_code and cast(h.Territory_Code as varchar) = a.Territory_Code) Territory, " +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " convert(char(10)," + strType + ",103) as ListedDr_Created_Date," +
                       //" (select Sf_Name from Mas_Salesforce where " +
                       //" Sf_Code=(select TP_Reporting_SF from Mas_Salesforce " +
                       //" where Sf_Code=a.Sf_Code)) AS Reporting_Manager1, " +
                       //"(select sf_name from Mas_Salesforce where " +
                       //"Sf_Code=(select top(1)TP_Reporting_SF from Mas_Salesforce where " +
                       //" Sf_Code=(select Sf_Code from Mas_Salesforce where Sf_Code=(select TP_Reporting_SF from Mas_Salesforce where Sf_Code=a.Sf_Code)))) AS Reporting_Manager2," +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ " +
                       " from Mas_ListedDr a, Mas_Doctor_Category dc" +
                       " where  a.Division_Code = '" + Div_Code + "' and a.sf_code in(" + strSF_code + ") and a.ListedDr_Active_Flag = " + type +
                       //" order by ListedDr_Created_Date ";
                       " and a.Doc_Cat_Code=dc.Doc_Cat_Code order by ListedDr_Sl_No";// Doc_Cat_Sl_No,Doc_Spec_ShortName ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet getNonDoctor_Rep_Total(string Div_Code, int type, string strSF_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            if (Div_Code.Contains(','))
            {
                Div_Code = Div_Code.Remove(Div_Code.Length - 1);
            }

            string strType = string.Empty;
            if (type == 0)
            {
                strType = "UnListedDr_Created_Date";
            }
            else
            {
                strType = "UnListedDr_Deactivate_Date";
            }

            strQry = " select UnListedDrCode, ltrim(UnListedDr_Name) as UnListedDr_Name, UnListedDr_Mobile,UnListedDr_Phone,UnListedDr_Email, " +
                       " b.Doc_ClsName,c.Doc_QuaName, d.Doc_Cat_Name,e.Doc_Special_Name, f.Territory_Name, " +
                       " case isnull(a.UnListedDr_DOB,null) when '1900-01-01 00:00:00.000' then null else  a.UnListedDr_DOB end UnListedDr_DOB, " +
                       " case  isnull(a.UnListedDr_DOW,null) when '1900-01-01 00:00:00.000'then null else a.UnListedDr_DOW end UnListedDr_DOW, " +
                        " convert(char(10)," + strType + ",103) as UnListedDr_Created_Date," +
                        " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                         " (select Sf_Name from Mas_Salesforce where " +
                       " Sf_Code=(select TP_Reporting_SF from Mas_Salesforce " +
                       " where Sf_Code=a.Sf_Code)) AS Reporting_Manager1, " +
                       "(select sf_name from Mas_Salesforce where " +
                       "Sf_Code=(select top(1)TP_Reporting_SF from Mas_Salesforce where " +
                       " Sf_Code=(select Sf_Code from Mas_Salesforce where Sf_Code=(select TP_Reporting_SF from Mas_Salesforce where Sf_Code=a.Sf_Code)))) AS Reporting_Manager2," +
                       " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                       " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                       " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ " +
                       " from Mas_UnListedDr a, Mas_Doc_Class b, Mas_Doc_Qualification c, Mas_Doctor_Category d, Mas_Doctor_Speciality e, Mas_Territory_Creation f " +
                       " where a.Doc_QuaCode = c.Doc_QuaCode and a.Doc_Special_Code = e.Doc_Special_Code and a.Doc_Cat_Code = d.Doc_Cat_Code " +
                       " and a.Territory_Code = f.Territory_Code and a.Doc_ClsCode=b.Doc_ClsCode " +
                       " and a.Division_Code = '" + Div_Code + "' and a.sf_code in(" + strSF_code + ") and a.UnListedDr_Active_Flag = " + type +
                       " order by UnListedDr_Created_Date ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet getChemists_Rep_Total(string Div_Code, int type, string strSF_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = null;

            if (Div_Code.Contains(','))
            {
                Div_Code = Div_Code.Remove(Div_Code.Length - 1);
            }


            strQry = " select chemists_code,Chemists_Name,Chemists_Contact, " +
                         " Chemists_Phone,b.Territory_Name,Chemists_Address1,Chemists_Fax,Chemists_Email,Chemists_Mobile,Chemists_Address3,Cluster,City,State,Country,Chemists_PinCode, " +
                         " (select Sf_Name from mas_salesforce where sf_code = a.Sf_code) sf_name, " +
                         " (select sf_Designation_Short_Name from mas_salesforce where sf_code = a.Sf_code) sf_Designation_Short_Name, " +
                         " (select Sf_HQ from mas_salesforce where sf_code = a.Sf_code) Sf_HQ " +
                         " from Mas_Chemists a, Mas_Territory_Creation b " +
                         " where a.Territory_Code=b.Territory_Code and  a.Division_Code = '" + Div_Code + "' and a.sf_code in(" + strSF_code + ")  and a.Chemists_Active_Flag  = " + type +
                         " order by Chemists_Name ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet getStockiest_Rep_Total(string Div_Code, int type, string strSF_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDoc = new DataSet();

            if (Div_Code.Contains(','))
            {
                Div_Code = Div_Code.Remove(Div_Code.Length - 1);
            }

            //strQry = " select a.Stockist_Code,a.Stockist_Name,a.Stockist_ContactPerson,a.Stockist_Mobile, " +
            //           "(select sf_name from mas_salesforce b   where a.sf_code=b.sf_code ) sf_name " +
            //           " from Mas_Stockist a" +
            //           " where Division_Code='" + Div_Code + "'  and sf_code in(" + strSF_code + ") and  Stockist_Active_Flag  = " + type +
            //           " order by Stockist_Name ";

            strQry = "EXEC Stockist_Detail_Total_View '" + Div_Code + "', '" + strSF_code + "','" + type + "' ";

            try
            {
                dsDoc = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDoc;
        }

        public DataSet sp_UserListMr_Doc_List(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_audit '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // Audit Manager Team - MR only --- only Sfname
        public DataTable getAuditManagerTeam_GetMR_Sfname(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_username", typeof(string)));
            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {
                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.sf_Name, a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color , a.sf_Designation_Short_Name, a.Sf_HQ, a.sf_username" +
                                " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {
                                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString() == "1")
                                    {
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["sf_Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_username"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                    else
                                    {
                                        string mgrcode = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                                        strQry = "EXEC [sp_get_Rep_audit_sfName]  '" + mgrcode + "' , '" + div_code + "'";

                                        dsSF = db_ER.Exec_DataSet(strQry);

                                        if (dsSF != null)
                                        {
                                            if (dsSF.Tables[0].Rows.Count > 0)
                                            {
                                                foreach (DataRow dataRow in dsSF.Tables[0].Rows)
                                                {
                                                    dr = dt.NewRow();
                                                    order_id = order_id + 1;

                                                    dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                    dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                    dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                    dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                    dr["Desig_Color"] = "";
                                                    dr["sf_Designation_Short_Name"] = dataRow["sf_Designation_Short_Name"].ToString();
                                                    dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                                    dr["sf_username"] = dataRow["sf_username"].ToString();
                                                    dt.Rows.Add(dr);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                            order_id = order_id + 1;
                        }
                    }
                }
            }
            return dt;

        }


        // Added by Sri - Joined Work in DCR - MR - 20 Dec 15
        public DataTable getMRJointWork(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable DJW = new DataTable();

            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));

                strQry = " Select Sf_Code,'SELF' Sf_Name, 'ZZZZ' Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

                DataSet ds = db_ER.Exec_DataSet(strQry);
                if (ds.Tables[0].Rows.Count > 0)
                {
                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = ds.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = ds.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dt.Rows.Add(dr);
                }
            }
            DataSet dsmgr = null;

            strQry = " Select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() != "admin")
                    {
                        // Check if the Sf-Code has any Audit Manager.
                        DataSet dsAudit = CheckforAudit(dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                        if (dsAudit.Tables[0].Rows.Count > 0)
                        {
                            strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // SM Level
                             " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                             " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                             " and sf_code = '" + dsAudit.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";

                            DataSet dsMgr2 = db_ER.Exec_DataSet(strQry);
                            if (dsMgr2.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                order_id = order_id + 1;
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                dr["sf_Name"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                dt.Rows.Add(dr);
                            }
                        }

                        strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // SM Level
                                 " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                                 " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                 " and sf_code = '" + dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";

                        DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsMgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            order_id = order_id + 1;
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dt.Rows.Add(dr);

                            DJW = getMRJointWork(div_code, dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        // Added by Sri - Joined Work in DCR - MGR 
        public DataTable getManagerJointWork(string div_code, string sf_code, int order_id, string DCRDate, string MGR_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable DJW = new DataTable();

            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));

                strQry = " Select Sf_Code,'SELF' Sf_Name, 'ZZZZ' Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

                DataSet ds = db_ER.Exec_DataSet(strQry);
                if (ds.Tables[0].Rows.Count > 0)
                {
                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = ds.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = ds.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dt.Rows.Add(dr);
                }

                DataSet ds1 = null;

                strQry = "select distinct a.sf_code,b.Sf_Name + '-'+ b.sf_Designation_Short_Name + '-' + b.Sf_HQ as Sf_Name from DCR_MGR_WorkAreaDtls a,mas_salesforce b Where " +
                    " a.MGR_Code ='" + MGR_Code + "' and  a.DCR_Date ='" + DCRDate + "' and a.sf_code = b.sf_code ";

                ds1 = db_ER.Exec_DataSet(strQry);

                if (ds1.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in ds1.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["Sf_Name"].ToString();
                        dt.Rows.Add(dr);

                        strQry = "EXEC [sp_get_Reporting_To_MGR_Upp]  '" + drFF["sf_code"].ToString() + "'";

                        dsSF = db_ER.Exec_DataSet(strQry);

                        if (dsSF != null)
                        {
                            if (dsSF.Tables[0].Rows.Count > 0)
                            {
                                foreach (DataRow dataRow in dsSF.Tables[0].Rows)
                                {
                                    if (MGR_Code != dataRow["Sf_Code"].ToString())
                                    {
                                        dr = dt.NewRow();
                                        order_id = order_id + 1;

                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dataRow["Sf_Code"].ToString();
                                        dr["sf_Name"] = dataRow["Sf_Name"].ToString();
                                        dt.Rows.Add(dr);
                                    }
                                    else
                                    {
                                        break;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            DataSet dsmgr = null;

            strQry = " Select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {

                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() != "admin")
                    {
                        // Check if the Sf-Code has any Audit Manager.
                        DataSet dsAudit = CheckforAudit(dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                        if (dsAudit.Tables[0].Rows.Count > 0)
                        {
                            strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // SM Level
                             " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                             " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                             " and sf_code = '" + dsAudit.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";

                            DataSet dsMgr2 = db_ER.Exec_DataSet(strQry);
                            if (dsMgr2.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                order_id = order_id + 1;
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                dr["sf_Name"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                dt.Rows.Add(dr);
                            }
                        }

                        strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF  from Mas_Salesforce " + // SM Level
                                 " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                                 " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                 " and sf_code = '" + dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";

                        DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsMgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            order_id = order_id + 1;
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dt.Rows.Add(dr);

                            DJW = getManagerJointWork(div_code, dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id, DCRDate, MGR_Code);
                        }
                    }
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        // Audit Manager Team
        public DataTable getAuditManagerTeam_User(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));

                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));

                dt_recursive_Aud.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Desig_Color", typeof(string)));

                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));


                strQry = " SELECT a.sf_Code, a.Sf_Name , a.sf_Type, " +

                    " b.Designation_Short_Name, b.Desig_Color, convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     "  CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                    //" FROM mas_salesforce a, Mas_SF_Designation b " +
                    " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                    " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                    " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";

                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {

                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();

                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                    dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                    dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                    dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                    dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                    dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                    dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                    dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();



                    dt.Rows.Add(dr);
                }

            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {

                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.sf_Name , a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color, convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                                " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                                "  CASE a.sf_Tp_Active_flag   " +
                                " when '0' then 'Active'  " +
                                " when '1' then 'Vacant'  " +
                                " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                                " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                                //  " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {

                                    dr = dt.NewRow();
                                    order_id = order_id + 1;

                                    dr["order_id"] = order_id;
                                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();

                                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                    dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                    dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                    dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                    dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                    dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                    dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                    dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();

                                    dt.Rows.Add(dr);
                                    dt_recursive_Aud.Rows.Clear();
                                    dt_recursive = getAuditTeamMGRRep_User(div_code, dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                                    if (dt_recursive != null)
                                    {
                                        if (dt_recursive.Rows.Count > 0)
                                        {
                                            foreach (DataRow dataRow in dt_recursive.Rows)
                                            {
                                                dr = dt.NewRow();
                                                order_id = order_id + 1;
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                dr["Desig_Color"] = dataRow["Desig_Color"].ToString();
                                                dr["Sf_Joining_Date"] = dataRow["Sf_Joining_Date"].ToString();
                                                dr["Reporting_To_SF"] = dataRow["Reporting_To_SF"].ToString();
                                                dr["sf_hq"] = dataRow["sf_hq"].ToString();
                                                dr["sf_password"] = dataRow["sf_password"].ToString();
                                                dr["sf_Tp_Active_flag"] = dataRow["sf_Tp_Active_flag"].ToString();
                                                dr["UsrDfd_UserName"] = dataRow["UsrDfd_UserName"].ToString();
                                                dr["Lst_drCount"] = dataRow["Lst_drCount"].ToString();
                                                dr["StateName"] = dataRow["StateName"].ToString();
                                                dr["sf_emp_id"] = dataRow["sf_emp_id"].ToString();

                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                        }
                    }
                }
            }
            return dt;

        }

        // Get Audit Team - Mgr - Reporting User
        public DataTable getAuditTeamMGRRep_User(string div_code, string sf_code, int order_id)
        {

            DataTable dt_recursive1 = new DataTable();

            DataSet dsDivision = null;
            DB_EReporting db_ER = new DB_EReporting();
            strQry = " SELECT a.sf_Code, a.Sf_Name , a.sf_Type, " +
          " b.Designation_Short_Name, b.Desig_Color, convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
          " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
          "  CASE a.sf_Tp_Active_flag   " +
          " when '0' then 'Active'  " +
          " when '1' then 'Vacant'  " +
          " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName  " +
          " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
          //" FROM mas_salesforce a, Mas_SF_Designation b " +
          " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
          " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
           " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt_recursive_Aud.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["sf_Type"] = drFF["sf_Type"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Desig_Color"] = drFF["Desig_Color"].ToString();

                        dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                        dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                        dr["sf_hq"] = drFF["sf_hq"].ToString();
                        dr["sf_password"] = drFF["sf_password"].ToString();
                        dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                        dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                        dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                        dr["StateName"] = drFF["StateName"].ToString();
                        dt_recursive_Aud.Rows.Add(dr);

                        dt_recursive1 = getAuditTeamMGRRep_User(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt_recursive_Aud;
        }


        // Audit Manager Team
        public DataTable getAuditManagerTeam_UserAll(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));


                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));

                dt_recursive_Aud.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Desig_Color", typeof(string)));

                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));


                strQry = " SELECT a.sf_Code, a.Sf_Name , a.sf_Type, " +

                    " b.Designation_Short_Name, b.Desig_Color, convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     "  CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                    //" FROM mas_salesforce a, Mas_SF_Designation b " +
                    " WHERE a.SF_Status=0 and  " +
                    " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                    " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";

                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {

                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();

                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                    dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                    dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                    dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                    dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                    dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                    dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                    dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();



                    dt.Rows.Add(dr);
                }

            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {

                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.sf_Name , a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color, convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                                " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                                "  CASE a.sf_Tp_Active_flag   " +
                                " when '0' then 'Active'  " +
                                " when '1' then 'Vacant'  " +
                                " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id  " +
                                " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                                //  " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status=0 and   " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {

                                    dr = dt.NewRow();
                                    order_id = order_id + 1;

                                    dr["order_id"] = order_id;
                                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                    dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                    dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();

                                    dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                    dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                    dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                    dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                    dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                    dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                    dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                    dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                    dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();

                                    dt.Rows.Add(dr);
                                    dt_recursive_Aud.Rows.Clear();
                                    dt_recursive = getAuditTeamMGRRep_User(div_code, dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                                    if (dt_recursive != null)
                                    {
                                        if (dt_recursive.Rows.Count > 0)
                                        {
                                            foreach (DataRow dataRow in dt_recursive.Rows)
                                            {
                                                dr = dt.NewRow();
                                                order_id = order_id + 1;
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                dr["Desig_Color"] = dataRow["Desig_Color"].ToString();
                                                dr["Sf_Joining_Date"] = dataRow["Sf_Joining_Date"].ToString();
                                                dr["Reporting_To_SF"] = dataRow["Reporting_To_SF"].ToString();
                                                dr["sf_hq"] = dataRow["sf_hq"].ToString();
                                                dr["sf_password"] = dataRow["sf_password"].ToString();
                                                dr["sf_Tp_Active_flag"] = dataRow["sf_Tp_Active_flag"].ToString();
                                                dr["UsrDfd_UserName"] = dataRow["UsrDfd_UserName"].ToString();
                                                dr["Lst_drCount"] = dataRow["Lst_drCount"].ToString();
                                                dr["StateName"] = dataRow["StateName"].ToString();
                                                dr["sf_emp_id"] = dataRow["sf_emp_id"].ToString();

                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                        }
                    }
                }
            }
            return dt;

        }

        // Added by Ram
        public DataSet getSecSales_MR(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC [sp_get_Rep_DivCode] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSecSales_MR_Vac_DCRDate(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC [sp_get_Rep_DivCode_Vacant_DCR] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getAuditTeamMGRRep_Mail(string div_code, string sf_code, int order_id)
        {

            DataTable dt_recursive1 = new DataTable();

            DataSet dsDivision = null;
            DB_EReporting db_ER = new DB_EReporting();

            strQry = " SELECT a.sf_Code,'admin-Level1' as sf_mail,sf_name, " +
                    " b.Designation_Short_Name,a.Reporting_To_SF,a.Sf_HQ, a.sf_Type,'-Level1' as sf_color,b.Desig_Color as des_color,a.Designation_Code" +
                    " FROM mas_salesforce a, Mas_SF_Designation b " +
                    " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                    " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt_recursive_Aud.NewRow();

                        dr["sf_Code"] = drFF["sf_Code"].ToString();
                        dr["sf_mail"] = drFF["sf_mail"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dr["sf_color"] = drFF["sf_color"].ToString();
                        dr["des_color"] = drFF["des_color"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                        dt_recursive_Aud.Rows.Add(dr);

                        dt_recursive1 = getAuditTeamMGRRep_Mail(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt_recursive_Aud;
        }

        public DataTable getAuditManagerTeam_mail(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));


                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_type", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));

                strQry = " SELECT  'admin' Sf_Code,'admin-Level1' as sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,'' sf_type,'-Level1' as sf_color, '' des_color ,'' Designation_Code,'' Sf_Joining_Date from Mas_HO_ID_Creation" +
                         " Where (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "') " +
                         " UNION " +
                         " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code,a.Sf_Joining_Date" +
                         " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.Sf_Joining_Date" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.Sf_Joining_Date" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.Sf_Joining_Date" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                dsmgr = db_ER.Exec_DataSet(strQry);

                dr = dt.NewRow();

                dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                dr["sf_mail"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                dr["sf_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                dr["des_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                dr["Designation_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                dt.Rows.Add(dr);

            }

            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                Audit = AuditMgr.Split(',');
                foreach (string Au_cd in Audit)
                {
                    if (Au_cd.Length > 0)
                    {
                        strQry = " SELECT a.sf_Code,'admin-Level1' as sf_mail,a.Sf_Name , " +
                            " b.Designation_Short_Name,a.Reporting_To_SF,a.Sf_HQ,a.sf_Type,'-Level1' as sf_color,b.Desig_Color as des_color," +
                            " a.Designation_Code,a.Sf_Joining_Date FROM mas_salesforce a, Mas_SF_Designation b " +
                            " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                            " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                            " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                        try
                        {
                            dsmgr = db_ER.Exec_DataSet(strQry);

                            dr = dt.NewRow();
                            order_id = order_id + 1;

                            //dr["order_id"] = order_id;
                            dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_mail"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["sf_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["des_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["Designation_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();


                            dt.Rows.Add(dr);

                            dt_recursive = getAuditTeamMGRRep_Mail(div_code, dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), 0);
                            if (dt_recursive != null)
                            {
                                if (dt_recursive.Rows.Count > 0)
                                {
                                    foreach (DataRow dataRow in dt_recursive.Rows)
                                    {
                                        dr = dt.NewRow();
                                        //order_id = order_id + 1;
                                        //dr["order_id"] = order_id;
                                        dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                        dr["sf_mail"] = dataRow["sf_mail"].ToString();
                                        dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                        dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                        dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                        dr["Reporting_To_SF"] = dataRow["Reporting_To_SF"].ToString();
                                        dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                        dr["sf_color"] = dataRow["sf_color"].ToString();
                                        dr["des_color"] = dataRow["des_color"].ToString();
                                        dr["Designation_Code"] = dataRow["Designation_Code"].ToString();
                                        dr["Sf_Joining_Date"] = dataRow["Sf_Joining_Date"].ToString();

                                        dt.Rows.Add(dr);
                                    }
                                }
                            }


                        }
                        catch (Exception ex)
                        {
                            throw ex;
                        }
                    }
                }
            }
            return dt;
        }

        public DataTable getMail_MRJointWork(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable DJW = new DataTable();

            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("Sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));

            }
            DataSet dsmgr = null;

            if (order_id == 0)
            {
                strQry = " SELECT  'admin' Sf_Code,case Sub_ho_id " +
                         " when '0' then 'admin-Level1' " +
                         " else name+'-Level1' " +
                         " end sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,'' sf_type,'-Level1' as sf_color, '' des_color ,'' Designation_Code from Mas_HO_ID_Creation" +
                         " Where (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "') ";

                dsmgr = db_ER.Exec_DataSet(strQry);

                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    for (int i = 0; i < dsmgr.Tables[0].Rows.Count; i++)
                    {
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(0).ToString();
                        dr["sf_mail"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(1).ToString();
                        dr["sf_Name"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(2).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(3).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(4).ToString();
                        dr["Sf_HQ"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(5).ToString();
                        dr["sf_type"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(6).ToString();
                        dr["sf_color"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(7).ToString();
                        dr["des_color"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(8).ToString();
                        dr["Designation_Code"] = dsmgr.Tables[0].Rows[i].ItemArray.GetValue(9).ToString();
                        dt.Rows.Add(dr);
                    }
                }

            }

            strQry = " Select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() != "admin")
                    {
                        // Check if the Sf-Code has any Audit Manager.
                        DataSet dsAudit = CheckforAudit(dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                        if (dsAudit.Tables[0].Rows.Count > 0)
                        {
                            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                                        " from Mas_Salesforce  a, Mas_SF_Designation b    Where a.Designation_Code=b.Designation_Code and" +
                                        " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                         " and a.sf_code = '" + dsAudit.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";


                            DataSet dsMgr2 = db_ER.Exec_DataSet(strQry);

                            if (dsMgr2.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                order_id = order_id + 1;
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                dr["sf_mail"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                dr["sf_Name"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Designation_Short_Name"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Reporting_To_SF"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                dr["Sf_HQ"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                dr["sf_type"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                dr["sf_color"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                dr["des_color"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                dr["Designation_Code"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                dt.Rows.Add(dr);
                            }
                        }

                        strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                                        " from Mas_Salesforce  a, Mas_SF_Designation b    Where a.Designation_Code=b.Designation_Code and" +
                                        " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                         " and a.sf_code = '" + dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";



                        DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsMgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            order_id = order_id + 1;
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_mail"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["sf_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Designation_Short_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Reporting_To_SF"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Sf_HQ"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["sf_type"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dr["sf_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["des_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["Designation_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            dt.Rows.Add(dr);

                            DJW = getMail_MRJointWork(div_code, dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        //Siva
        public DataSet UserList_Hierarchy_Managers(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy_Managers_NoSpace '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserList_getMR_Multiple(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getMR_Multiple '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // Added by Sridevi - BulkEdit TP DCR Date
        public bool IsDcrStarted(string sf_code)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = " SELECT COUNT(trans_slno) FROM DCRMain_trans WHERE sf_code='" + sf_code + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
                else
                {
                    strQry = " SELECT COUNT(trans_slno) FROM DCRMain_temp WHERE sf_code='" + sf_code + "'";
                    int iRecordExist1 = db.Exec_Scalar(strQry);
                    if (iRecordExist1 > 0)
                        bRecordExist = true;

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        // Added by Sridevi - BulkEdit TP Start Date
        public bool IsTpStarted(string sf_code)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = " SELECT COUNT(Tour_Date) FROM Trans_Tp WHERE sf_code='" + sf_code + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
                else
                {
                    strQry = " SELECT COUNT(Tour_Date) FROM Trans_Tp_One WHERE sf_code='" + sf_code + "'";
                    int iRecordExist1 = db.Exec_Scalar(strQry);
                    if (iRecordExist1 > 0)
                        bRecordExist = true;

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        // done by reshmi for notification
        public int AddNotification(string div_code, string SF_Code, string SF_Name, string Notification_Message, DateTime effective_from, DateTime effective_to)
        {
            int iReturn = -1;
            int Trans_Sl_No = -1;

            string effective_from2 = effective_from.Month + "-" + effective_from.Day + "-" + effective_from.Year;
            string effective_to2 = effective_to.Month + "-" + effective_to.Day + "-" + effective_to.Year;

            try
            {
                if (div_code.Contains(','))
                {
                    div_code = div_code.Remove(div_code.Length - 1);
                }

                DB_EReporting db = new DB_EReporting();
                strQry = "SELECT ISNULL(max(Trans_Sl_No),0)+1 FROM Mas_Notification ";
                Trans_Sl_No = db.Exec_Scalar(strQry);

                strQry = "INSERT INTO Mas_Notification (Trans_Sl_No,Division_Code,SF_Code,SF_Name,Notification_Message,Notification_Sent_Date,Notification_From_Date,Notification_To_Date)" +
                         "values('" + Trans_Sl_No + "','" + div_code + "' , '" + SF_Code + "', '" + SF_Name + "' ,'" + Notification_Message + "' , getdate() ,'" + effective_from2 + "' ,'" + effective_to2 + "')";


                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }


        // Added by sridevi - To Update Reporting Date
        public int Rep_StDateRecordUpdate(string sf_code, DateTime repdate, string sf_name)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();



                if (sf_name != "" && sf_name != null)
                {
                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);

                    strQry = "Update Mas_Salesforce " +
                             " set Sf_TP_DCR_Active_Dt =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                             "  Last_Dcr_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                             "  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                              " LastUpdt_Date = getdate() " +
                             " WHERE Sf_Code= '" + sf_code + "' ";

                    iReturn = db.ExecQry(strQry);

                    strQry = "Update mas_salesforce_dcrtpdate " +
                    " set last_dcr_date='" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                    "  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' " +
                     " WHERE Sf_Code= '" + sf_code + "' ";

                    iReturn = db.ExecQry(strQry);

                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);
                }
                else
                {
                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);

                    strQry = "Update Mas_Salesforce " +
                           " set Sf_TP_DCR_Active_Dt =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                           "  Last_Dcr_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                              //"  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                              "  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' , " +
                            " LastUpdt_Date = getdate() " +
                           " WHERE Sf_Code= '" + sf_code + "' ";

                    iReturn = db.ExecQry(strQry);

                    strQry = "Update mas_salesforce_dcrtpdate " +
                    " set last_dcr_date='" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "',  " +
                      "  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' " +
                     // "  Last_Tp_Date =  '" + repdate.Month.ToString() + "-" + repdate.Day + "-" + repdate.Year + "' " +
                     " WHERE Sf_Code= '" + sf_code + "' ";

                    iReturn = db.ExecQry(strQry);

                    strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce Where SF_Code='" + sf_code + "'";
                    iReturn_Backup = db.ExecQry(strQry);
                }


            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public DataSet CheckSFNameVacant(string sf_code, int cmon, int cyr)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC sp_get_sf_name_between_dates_Temp '" + sf_code + "', " + cmon + ", " + cyr + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;

        }
        public DataSet getmode(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " SELECT 'Calendar Days' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " SELECT 'Sundays & Holidays' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " SELECT 'Working Days (Excl/Holidays & Sundays )' as Doc_Cat_SName,'' as Doc_Cat_Code " +
                      " union all " +
                      " select 'Fieldwork Days' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " select 'No Fieldwork Days' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " select  'Leave' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " select 'TP Deviation Days' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " select 'No of Listed Drs Met' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " select 'No of Listed Drs Seen' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " select 'Call Average' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                        " SELECT 'Morning Calls' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " SELECT 'Evening Calls' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                      " SELECT 'Both Calls' as Doc_Cat_SName,'' as Doc_Cat_Code union all" +
                      " select  Doc_Cat_SName +' Drs Met', Doc_Cat_Code as Doc_Cat_Code " +

                      " from Mas_Doctor_Category where Division_Code = '" + div_code + "' and Doc_Cat_Active_Flag = 0";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getProduct_Exp_count(string sf_code, string div_code, int cmonth, int cyear, int Prod, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = "EXEC sp_Get_LstDr_Prd_Count '" + div_code + "', '" + sf_code + "','" + cmonth + "' ,'" + cyear + "' , '" + cdate + "' ,'" + Prod + "'";




            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getProduct_Exp(string Division_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsState = null;
            strQry = "SELECT Product_Code_SlNo,Product_Detail_Name  " +
                     " FROM Mas_Product_Detail " +
                     " where Division_Code = '" + Division_Code + "' and Product_Active_Flag=0 ";

            try
            {
                dsState = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsState;
        }
        public DataSet UserList_Self_Call(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self_Call '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // ---- Changes done by saravanan --------
        public DataSet UserListVacant_getMR(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserListVacant_getMR '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getProduct_Exp_Speciality(string sf_code, string div_code, int cmonth, int cyear, int Prod, string cdate, int Speciality)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_Get_LstDr_Prd_SpeCat '" + div_code + "', '" + sf_code + "','" + cmonth + "' ,'" + cyear + "' , '" + cdate + "' ,'" + Prod + "','" + Speciality + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getProduct_Exp_Category(string sf_code, string div_code, int cmonth, int cyear, int Prod, string cdate, int Category)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_Get_LstDr_Prd_Category '" + div_code + "', '" + sf_code + "','" + cmonth + "' ,'" + cyear + "' , '" + cdate + "' ,'" + Prod + "','" + Category + "'";




            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet SalesForceListMgrGet_MgrOnly(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_GetMgrTeam_MgrOnly '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfName_Mr(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT distinct Sf_Name + ' - '+ sf_Designation_Short_Name + ' - ' + Sf_HQ as Sf_Name,sf_code, convert(char(10),Sf_Joining_Date,105)Sf_Joining_Date FROM  Mas_Salesforce " +
                     " WHERE sf_code= '" + sfcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_UserListMr_Doc_List_Vacant(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_audit_with_Vacant '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getAuditManagerTeam_GetMR_Sfname_With_Vacant(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_username", typeof(string)));
            }
            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                if (AuditMgr.Length > 0)
                {
                    Audit = AuditMgr.Split(',');
                    foreach (string Au_cd in Audit)
                    {
                        if (Au_cd.Length > 0)
                        {
                            strQry = " SELECT a.sf_Code, a.sf_Name, a.sf_Type, " +
                                " b.Designation_Short_Name, b.Desig_Color , a.sf_Designation_Short_Name, a.Sf_HQ, a.sf_username" +
                                " FROM mas_salesforce a, Mas_SF_Designation b " +
                                " WHERE a.SF_Status!=2 and  " +
                                " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                            try
                            {
                                dsmgr = db_ER.Exec_DataSet(strQry);
                                if (dsmgr.Tables[0].Rows.Count > 0)
                                {
                                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString() == "1")
                                    {
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["sf_Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_username"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                    else
                                    {
                                        string mgrcode = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                                        strQry = "EXEC [sp_get_Rep_audit_sfName_With_Vacant]  '" + mgrcode + "' , '" + div_code + "'";

                                        dsSF = db_ER.Exec_DataSet(strQry);

                                        if (dsSF != null)
                                        {
                                            if (dsSF.Tables[0].Rows.Count > 0)
                                            {
                                                foreach (DataRow dataRow in dsSF.Tables[0].Rows)
                                                {
                                                    dr = dt.NewRow();
                                                    order_id = order_id + 1;

                                                    dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                                    dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                                    dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                                    dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                                    dr["Desig_Color"] = "";
                                                    dr["sf_Designation_Short_Name"] = dataRow["sf_Designation_Short_Name"].ToString();
                                                    dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                                    dr["sf_username"] = dataRow["sf_username"].ToString();
                                                    dt.Rows.Add(dr);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                throw ex;
                            }
                            order_id = order_id + 1;
                        }
                    }
                }
            }
            return dt;

        }

        public DataSet sp_UserMRLogin_With_Vacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC [sp_UserMRLogin_With_Vacant] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getMRJointWork_camp(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable DJW = new DataTable();

            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Designation_Short_Name", typeof(string)));

                strQry = " Select Sf_Code,'SELF' Sf_Name, 'ZZZZ' Reporting_To_SF, sf_Designation_Short_Name from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

                DataSet ds = db_ER.Exec_DataSet(strQry);
                if (ds.Tables[0].Rows.Count > 0)
                {
                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = ds.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = ds.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["Reporting_To_SF"] = ds.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["sf_Designation_Short_Name"] = ds.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dt.Rows.Add(dr);
                }
            }
            DataSet dsmgr = null;

            strQry = " Select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() != "admin")
                    {
                        strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF,sf_Designation_Short_Name  from Mas_Salesforce " + // SM Level
                                 " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                                 " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                 " and sf_code = '" + dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";

                        DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsMgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            order_id = order_id + 1;
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["Reporting_To_SF"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Designation_Short_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dt.Rows.Add(dr);

                            DJW = getMRJointWork_camp(div_code, dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        public DataSet getProduct_Sample_count(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_Get_Product_Count '" + div_code + "', '" + sf_code + "','" + cmonth + "' ,'" + cyear + "' , '" + cdate + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getSalesForceAlpha(string divcode, string sAlpha)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code," +
                     "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_BlkReason,sf_Designation_Short_Name " +
                     " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code" +
                     " WHERE SF_Status=1 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.Division_Code = '" + divcode + ",' " +
                     " AND a.SF_Status = 1 AND a.sf_Tp_Active_flag = 0 " +
                     " AND LEFT(a.sf_name,1) = '" + sAlpha + "' " +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForcelist_Alphabet_ForBlock(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=1  " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_Tp_Active_flag = 0 " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForce_desBlock(string divcode, string Designation_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code," +
                     "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_BlkReason,sf_Designation_Short_Name " +
                     " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code" +
                     " WHERE SF_Status=1 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.Division_Code = '" + divcode + ",' " +
                     " AND a.SF_Status = 1 AND a.sf_Tp_Active_flag = 0  and a.Designation_Code = '" + Designation_Code + "'" +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet FindSalesForceBlock(string sFindQry)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,a.State_Code as state_code," +
                     "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_BlkReason,sf_Designation_Short_Name " +
                     " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code" +
                     " WHERE SF_Status=1 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.SF_Status = 1 AND a.sf_Tp_Active_flag = 0 " +
                     sFindQry +
                     " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_desVacant(string divcode, string Designation_Code, string sf_vacantblock)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, b.StateName,a.State_Code as state_code,sf_Designation_Short_Name ," +
                   "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, " +
                   " (select count(ListedDrCode) from mas_listeddr where ListedDr_Active_Flag=0 and sf_code=a.sf_code) Dr_Count  " +
                   " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                   " WHERE a.SF_Status=0 " +
                   " AND lower(a.sf_code) != 'admin' " +
                   " AND a.Division_Code = '" + divcode + ",' " +
                   " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 and a.sf_vacantblock='" + sf_vacantblock + "' and a.Designation_Code = '" + Designation_Code + "' " +
                   " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet FindSalesForceVacant(string sFindQry, string sf_vacantblock)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, b.StateName,a.State_Code as state_code,sf_Designation_Short_Name ," +
                   "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, " +
                   " (select count(ListedDrCode) from mas_listeddr where ListedDr_Active_Flag=0 and sf_code=a.sf_code) Dr_Count  " +
                   " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                   " WHERE a.SF_Status=0 " +
                   " AND lower(a.sf_code) != 'admin' " +
                   " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 and a.sf_vacantblock='" + sf_vacantblock + "' " +
                    sFindQry +
                   " ORDER BY 2";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForceAlpha_vacant(string divcode, string sAlpha, string sf_vacantblock)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, b.StateName,a.State_Code as state_code,sf_Designation_Short_Name ," +
                    "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, " +
                    " (select count(ListedDrCode) from mas_listeddr where ListedDr_Active_Flag=0 and sf_code=a.sf_code) Dr_Count  " +
                    " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                    " WHERE a.SF_Status=0 " +
                    " AND lower(a.sf_code) != 'admin' " +
                    " AND a.Division_Code = '" + divcode + ",' " +
                    " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 " +
                    " AND LEFT(a.sf_name,1) = '" + sAlpha + "' and sf_vacantblock='" + sf_vacantblock + "' " +
                    " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForcelist_Alphabet_ForVacant(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=0  " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_Tp_Active_flag = 1 " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getDr_Mapp_prd_count(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = " select COUNT (distinct a.Listeddr_Code) from  " +
                       " Map_LstDrs_Product a,Mas_ListedDr b " +
                       " where a.Division_Code='" + div_code + "' and a.Sf_Code='" + sf_code + "'  and b.ListedDr_Active_Flag=0  " +
                        " and b.ListedDrCode =a.Listeddr_Code ";


            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getDr_Dcr_prd_count(string sf_code, string div_code, int Year, int Month, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = " select COUNT ( distinct Trans_Detail_Info_Code) from DCRMain_Trans b, " +
                     " DCRDetail_Lst_Trans c ,Mas_ListedDr e,Mas_Product_Detail P,Map_LstDrs_Product m where " +
                     " c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo  and  " +
                     " charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code) > 0 " +
                     " and c.Trans_Detail_Info_Type=1  and c.Trans_Detail_Info_Code =m.Listeddr_Code " +
                     " and month(b.Activity_Date)='" + Month + "' and  YEAR(b.Activity_Date)= '" + Year + "' and  c.sf_code in " +
                     " ('" + sf_code + "') and b.sf_code in ('" + sf_code + "') ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getchmMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select count(distinct Chemists_Code)cnt from Mas_Chemists where division_code='" + div_code + "' and Chemists_Active_Flag=0 and sf_code='" + sf_code + "'";


            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getstkMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select count(distinct Stockist_Code)cnt from Mas_Stockist where division_code='" + div_code + "' and Stockist_Active_Flag=0 and sf_code like '%" + sf_code + "%'";


            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getDrprdMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            if (ddlmode == "1")
            {

                strQry = " select COUNT (distinct Listeddr_Code),(select COUNT(c.ListedDrCode) from Mas_ListedDr c " +
                        " where Division_Code='" + div_code + "' and Sf_Code ='" + sf_code + "' and c.ListedDr_Active_Flag=0) from " +
                        " Mas_ListedDr b,Map_LstDrs_Product a where a.Division_Code='" + div_code + "' " +
                        " and b.Sf_Code='" + sf_code + "' and a.Sf_Code=b.Sf_Code and a.Listeddr_Code =b.ListedDrCode and b.ListedDr_Active_Flag =0 ";
            }
            else if (ddlmode == "2")
            {

                //strQry = " select COUNT (distinct ListedDrCode) ,(select COUNT(c.ListedDrCode) from Mas_ListedDr c " +
                //        " where Division_Code='" + div_code + "' and Sf_Code ='" + sf_code + "' and c.ListedDr_Active_Flag=0) " +
                //       " from Mas_ListedDr a,Mas_Doc_SubCategory b where Sf_Code='" + sf_code + "' and a.Division_Code='" + div_code + "' and " +
                //       "  charindex(cast(b.Doc_SubCatCode as varchar),a.Doc_SubCatCode ) >0 and a.ListedDr_Active_Flag=0 ";

                strQry = " select COUNT (distinct ListedDrCode) ,(select COUNT(c.ListedDrCode) from Mas_ListedDr c " +
                       " where Division_Code='" + div_code + "' and Sf_Code ='" + sf_code + "' and c.ListedDr_Active_Flag=0) " +
                      " from Mas_ListedDr a,Mas_Doc_SubCategory b where Sf_Code='" + sf_code + "' and a.Division_Code='" + div_code + "' and " +
                      "  charindex(cast(b.Doc_SubCatCode as varchar),a.Doc_SubCatCode ) >0 and a.ListedDr_Active_Flag=0  and b.Doc_SubCat_ActiveFlag=0";
            }
            else if (ddlmode == "3")
            {

                strQry = " select count(dr_code),sf_name from Core_Doctor_Map M inner join mas_salesforce S on M.mgr_code=S.sf_code where mgr_code='" + sf_code + "' and M.Division_Code='" + div_code + "' group by sf_name";
            }
            else if (ddlmode == "4")
            {

                //strQry = "exec sfc_status '" + div_code + "','" + sf_code + "'";

                strQry = " select count(distinct DR_Code) from Core_Doctor_Map a,Mas_Core_DR_Lock b  where a.mgr_code=b.sf_code and b.CoreDr_Lock_flag =1 " +
                       " and a.mgr_code='" + sf_code + "' and a.division_code='" + div_code + "' " + " select count(distinct DR_Code) from Core_Doctor_Map  where mgr_code='" + sf_code + "' and division_code='" + div_code + "' ";
            }

            else if (ddlmode == "5")
            {
                strQry = " select count(distinct listeddrcode)cnt from Mas_ListedDr where division_code='" + div_code + "' and ListedDr_Active_Flag=0 and sf_code='" + sf_code + "'";

            }
            else if (ddlmode == "6")
            {

                strQry = " select COUNT (distinct Listeddr_Code),(select COUNT(c.ListedDrCode) from Mas_ListedDr c " +
                        " where Division_Code='" + div_code + "' and Sf_Code ='" + sf_code + "' and c.ListedDr_Active_Flag=0) from " +
                        " Mas_ListedDr b,Map_LstDrs_Chemists a where a.Division_Code='" + div_code + "' " +
                        " and b.Sf_Code='" + sf_code + "' and a.Sf_Code=b.Sf_Code and a.Listeddr_Code =b.ListedDrCode and b.ListedDr_Active_Flag =0 ";
            }
            else if (ddlmode == "7")
            {
                strQry = "select COUNT (distinct a.ListedDrCode), " +
                        " (select COUNT(c.ListedDrCode) from Mas_ListedDr c " +
                        " where Division_Code='2' and Sf_Code ='" + sf_code + "' and " +
                        " c.ListedDr_Active_Flag=0) from  Mas_ListedDr b,Map_Hos_ListedDr a " +
                        " where a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "' and " +
                        " a.Sf_Code=b.Sf_Code and a.ListedDrCode =b.ListedDrCode and b.ListedDr_Active_Flag =0";
            }
            else if (ddlmode == "8")
            {
                strQry = " SELECT h.Sf_Code, h.Division_Code,h.Trans_Month,h.Trans_Year,d.ListedDr_Code, d.ListedDr_Name, d.Business_Value FROM " +
                     " Trans_Dr_Business_Valuewise_Head h " +
                     " LEFT JOIN Trans_Dr_Business_Valuewise_Detail d on  h.Trans_Sl_No = d.Trans_Sl_No where " +
                     " h.Sf_Code ='" + sf_code + "' AND  h.Division_Code ='" + div_code + "'";
            }
            else if (ddlmode == "9")
            {
                strQry = " SELECT SF_code FROM TbRCPADetails  where SF_code='" + sf_code + "' AND  Division_Code = " + div_code + "";
            }
            else if (ddlmode == "12")
            {
                strQry = " select COUNT (distinct d.Chemists_Code) ,(select COUNT(c.Chemists_Code) from Mas_Chemists c  where Division_Code='" + div_code + "' " +
                " and Sf_Code ='" + sf_code + "' and  c.Chemists_Active_Flag=0) from Mas_Chemists a,Mas_chemist_campaign b,Map_chemist_campaign d where " +
                " a.Sf_Code='" + sf_code + "' and a.Division_Code='" + div_code + "' and charindex(cast(b.Chm_campaign_code as varchar), d.Chm_campaign_code ) >0 and " +
                " a.Chemists_Active_Flag=0 and d.sf_code='" + sf_code + "'";
            }
            else if (ddlmode == "11")
            {
                //strQry = " select COUNT ( visiting_card) ,(select COUNT(c.ListedDrCode) from Mas_ListedDr c  " +
                //        " where Division_Code='" + div_code + "' and Sf_Code ='" + sf_code + "' and c.ListedDr_Active_Flag=0) " +
                //       " from Mas_ListedDr a  where a.Sf_Code='" + sf_code + "' and a.Division_Code='" + div_code + "' and a.ListedDr_Active_Flag=0 and visiting_card<>''";
                strQry = "select COUNT(visiting_card) VC, " +
                       " (select COUNT(c.ListedDrCode)  from Mas_ListedDr c where Division_Code = '" + div_code + "' and Sf_Code = '" + sf_code + "' and c.ListedDr_Active_Flag = 0) Total, " +
                       " (select COUNT(c.ListedDr_RegNo)  from Mas_ListedDr c where Division_Code = '" + div_code + "' and Sf_Code = '" + sf_code + "' and c.ListedDr_Active_Flag = 0 and ListedDr_RegNo<> '') RN " +
                        " from Mas_ListedDr a where a.Sf_Code = '" + sf_code + "' and a.Division_Code = '" + div_code + "' and a.ListedDr_Active_Flag = 0 and visiting_card<> ''";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getDrgeoMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            if (ddlmode == "5")
            {


                strQry = " select count(distinct D.cust_code)cnt from Mas_ListedDr M inner join map_GEO_Customers D on D.cust_code=M.listeddrcode and M.division_code=D.division_code where D.division_code='" + div_code + "' and ListedDr_Active_Flag=0 and statflag=0 and sf_code='" + sf_code + "'";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getUnDrgeoMap_Status(string sf_code, string div_code, string ddlmode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            if (ddlmode == "5")
            {


                strQry = " select count(distinct listeddrcode)cnt from mas_listeddr where division_code='" + div_code + "' and sf_code='" + sf_code + "' and ListedDr_Active_Flag=0 and listeddrcode not in(select Cust_Code from map_GEO_Customers where division_code='" + div_code + "' and statflag=0)";
            }
            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getSalesForce_count(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            div_code = div_code + ',';
            strQry = "select COUNT(Sf_Code) cnt from Mas_Salesforce where Division_Code='" + div_code + "' and SF_Status != 2 ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSubDiv_Selected(string divcode, string SF_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSubDiv = null;

            strQry = " SELECT subdivision_code FROM  Mas_Salesforce " +
                   " WHERE SF_Code='" + SF_Code + "' AND (Division_Code like '" + divcode + ',' + "%'  or " +
                    " Division_Code like '%" + ',' + divcode + ',' + "%' )";
            try
            {
                dsSubDiv = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSubDiv;
        }
        public DataSet getSubDiv_Name(string divcode, string sub_div)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSubDiv = null;

            strQry = "SELECT LEFT(subdivision_name,Len(subdivision_name)-1) As subdivision_name FROM " +
                       " (SELECT DISTINCT(SELECT st1.subdivision_name + ', ' AS [text()] " +
                       " FROM mas_subdivision st1 WHERE st1.Div_Code = st2.Div_Code " +
                       " AND Div_Code = '" + divcode + "' AND subdivision_code IN (" + sub_div + ") ORDER BY st1.Div_Code " +
                       " FOR XML PATH ('')) [subdivision_name] FROM mas_subdivision st2 " +
                       " where Div_Code = '" + divcode + "' AND subdivision_code IN (" + sub_div + ")) mas_subdivision";
            try
            {
                dsSubDiv = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSubDiv;
        }
        public DataTable getUserListReportingToNew_for_all(string div_code, string sf_code, int order_id, string sf_type)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;

                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("Last_TP_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_TP_DCR_Active_Dt", typeof(string)));
                dt.Columns.Add(new DataColumn("Last_DCR_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("type", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Mobile", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_short_name", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Cat_Code", typeof(string)));

                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName ,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt,  " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id,a.sf_Type as type, (select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0  and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {

                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                        dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                        dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                        dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                        dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                        dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                        dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                        dr["sf_short_name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                        dr["SF_Cat_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                        dt.Rows.Add(dr);

                        if (sf_type == "3")
                        {
                            strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                      " FROM mas_ho_id_creation " +
                                       " WHERE HO_Active_flag = 0  and  " +
                                       "(Division_Code like '" + div_code + "%'  or " +
                                        "Division_Code like '%" + ',' + div_code + "%') and " +
                                       " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                            DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                            if (dsmgr1.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = "admin";
                                dr["sf_Name"] = "admin";
                                dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["sf_Type"] = "";
                                dr["Sf_Joining_Date"] = "";
                                dr["Reporting_To_SF"] = "";
                                dr["sf_hq"] = "";
                                dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Designation_Short_Name"] = "Admin";
                                dr["Desig_Color"] = "33ff96";
                                dr["sf_Tp_Active_flag"] = "";
                                dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Lst_drCount"] = "";
                                dr["StateName"] = "";
                                dr["Last_TP_Date"] = "";
                                dr["Sf_TP_DCR_Active_Dt"] = "";
                                dr["Last_DCR_Date"] = "";
                                dr["sf_emp_id"] = "";
                                dr["type"] = "";
                                dr["Reporting_To"] = "";
                                dr["Designation_Name"] = "";
                                dr["SF_Mobile"] = "";
                                dr["sf_short_name"] = "";
                                dr["SF_Cat_Code"] = "";
                                dt.Rows.Add(dr);
                            }
                        }
                        else
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                            dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                            dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                            dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                            dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                            dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                            dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                            dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                            dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                            dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                            dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                            dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                            dr["sf_short_name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                            dr["SF_Cat_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                            dt.Rows.Add(dr);
                        }

                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt, " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id ,a.sf_Type as type ,(select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status=0 and (a.sf_Tp_Active_flag = 0 or a.sf_Tp_Active_flag != 1) and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                        dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                        dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                        dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                        dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                                        dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }

                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                                dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                        dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                        dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                        dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                        dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                        dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["Last_TP_Date"] = drFF["Last_TP_Date"].ToString();
                            dr["Sf_TP_DCR_Active_Dt"] = drFF["Sf_TP_DCR_Active_Dt"].ToString();
                            dr["Last_DCR_Date"] = drFF["Last_DCR_Date"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                            dr["type"] = drFF["type"].ToString();
                            dr["Reporting_To"] = drFF["Reporting_To"].ToString();
                            dr["Designation_Name"] = drFF["Designation_Name"].ToString();
                            dr["SF_Mobile"] = drFF["SF_Mobile"].ToString();
                            dr["sf_short_name"] = drFF["sf_short_name"].ToString();
                            dr["SF_Cat_Code"] = drFF["SF_Cat_Code"].ToString();
                            dt.Rows.Add(dr);
                        }

                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToNew_for_all(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataSet sp_UserListMr_Doc_List_View(string sf_code, string divcode, string rdoType, int ivacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            if (rdoType == "0")
            {
                strQry = "EXEC sp_DCR_View '" + sf_code + "', '" + divcode + "'," + ivacant + " ";
            }
            else if (rdoType == "1")
            {
                strQry = "EXEC sp_Doc_Spec '" + sf_code + "', '" + divcode + "'," + ivacant + " ";
            }
            else if (rdoType == "2")
            {
                strQry = "EXEC sp_Doc_Class '" + sf_code + "', '" + divcode + "'," + ivacant + " ";
            }
            else if (rdoType == "3")
            {
                strQry = "EXEC sp_DCR_Quali_Get '" + sf_code + "', '" + divcode + "'," + ivacant + " ";
            }

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getprd_Dr_count(string div_code, string sf_code, int Prod_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_Get_MappProduct_Doctor_Count '" + div_code + "', '" + sf_code + "','" + Prod_code + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getVacantManagers(string div_code, string type, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;


            strQry = "SELECT '' as Sf_Code, '---Select---' as sf_name " +
                   " UNION " +
                   "select Sf_Code,sf_name + ' - ' + sf_Designation_Short_Name + ' - ' + Sf_HQ from Mas_Salesforce where  (Division_Code like '" + div_code + ',' + "%'  or " +
                   " Division_Code like '%" + ',' + div_code + ',' + "%')  AND sf_type = '" + type + "' and sf_TP_Active_Flag =1 and SF_Status = 0 and Sf_Code !='" + sf_code + "'";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getVac_info(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT case when SF_DOB='1900-01-01' then '' else convert(varchar,sf_Dob,103) end as SF_DOB,case when SF_DOW='1900-01-01' then '' else convert(varchar,sf_Dow,103) end as SF_DOW, " +
                    " SF_Mobile ,SF_Email ,SF_ContactAdd_One,SF_ContactAdd_Two,SF_City_Pincode,SF_Per_ContactAdd_One,SF_Per_ContactAdd_Two,SF_Per_City_Pincode,SF_Per_Contact_No,Sf_Password,Division_Code,Designation_Code,State_Code,Sf_HQ,Reporting_To_SF,subdivision_code,sf_emp_id,Bank_Name,Bank_AcNo,IFS_Code " +
                     " FROM mas_salesforce " +
                    " WHERE Sf_Code= '" + sf_code + "' ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int RecordUdpate_forUsdefd(string sf_code, string div_code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                DataSet DsSal = null;

                strQry = "Select UsrDfd_UserName,sf_emp_id,Sf_Name from Mas_Salesforce where Division_Code='" + div_code + ",' and sf_code='" + sf_code + "'";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {
                    strQry = "UPDATE Mas_Salesforce " +
                             " SET UsrDfd_UserName = '" + DsSal.Tables[0].Rows[0][0].ToString() + "T' , " +
                             " sf_emp_id ='" + DsSal.Tables[0].Rows[0][1].ToString() + "T', " +
                             " Sf_Name ='" + DsSal.Tables[0].Rows[0][2].ToString() + " - Transferred', " +
                             " LastUpdt_Date = getdate() " +
                             " WHERE sf_code = '" + sf_code + "' and Division_Code='" + div_code + ",' ";

                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int Transfer_RecordInsert(string sfname, string Vac_sfcode, string sfcode, int from_designation, int To_designation, string from_division, string to_division, string vac_sf_emp_id, string act_emp_id)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();
                strQry = "SELECT isnull(max(S_No)+1,'1') S_No from Salesforce_Transfer_Promote ";
                int S_No = db.Exec_Scalar(strQry);

                if (from_division.Contains(','))
                {
                    from_division = from_division.Remove(from_division.Length - 1);
                }

                strQry = "EXEC Promo_Depro_Leave_entile '" + from_division + "','" + Vac_sfcode + "','" + sfcode + "','" + vac_sf_emp_id + "','" + act_emp_id + "'";

                iReturn = db.ExecQry(strQry);

                strQry = "INSERT INTO Salesforce_Transfer_Promote(S_No,Sf_Name,From_sf_code,To_sf_code,From_Desigantion,To_Designation,From_Division_Code,To_Division_Code,Transfered_Date,Mode) " +
                         " VALUES ( '" + S_No + "','" + sfname + "' ,'" + Vac_sfcode + "','" + sfcode + "', '" + from_designation + "', '" + To_designation + "', '" + from_division + "', '" + to_division + "', " +
                         " getdate(),'Promoted')";




                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public DataSet getSalesForce_st_vacant(string divcode, string state_code, string sf_vacantblock)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;


            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, b.StateName,a.State_Code as state_code,sf_Designation_Short_Name ," +
                 "(select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, " +
                 " (select count(ListedDrCode) from mas_listeddr where ListedDr_Active_Flag=0 and sf_code=a.sf_code) Dr_Count  " +
                 " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code " +
                 " WHERE a.SF_Status=0 " +
                 " AND lower(a.sf_code) != 'admin' " +
                 " AND a.Division_Code = '" + divcode + ",' " +
                 " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 1 and a.sf_vacantblock='" + sf_vacantblock + "' and a.State_Code = '" + state_code + "' " +
                 " ORDER BY 2";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet UserList_getAll_Multiple(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getALL_Multiple '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDCR_Delayed_Dates(string sf_code, string div_code, int cmonth, int cyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select top(1) STUFF((Select ','+ cast(day(a.Delayed_Date) as varchar)  from DCR_Delay_Dtls a " +
                    " where a.Sf_Code = '" + sf_code + "' and MONTH(a.Delayed_Date) = '" + cmonth + "' and YEAR(a.Delayed_Date) = '" + cyear + "' and a.Division_Code='" + div_code + "' " +
                    " FOR XML PATH('')),1,1,'') Delayed_Date from DCR_Delay_Dtls T2 where t2.Sf_Code = '" + sf_code + "' and " +
                    " MONTH(T2.Delayed_Date) = '" + cmonth + "' and YEAR(t2.Delayed_Date) = '" + cyear + "' and t2.Division_Code='" + div_code + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getDCR_Leave_Count(string sf_code, string div_code, int cmonth, int cyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select COUNT(distinct Activity_Date) from DCRMain_Trans where Sf_Code='" + sf_code + "' and " +
                      " FieldWork_Indicator='L' and MONTH(activity_date)='" + cmonth + "' " +
                      " and YEAR(activity_date)='" + cyear + "' and Division_Code='" + div_code + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getDCR_Leave_Count_ToolTip(string sf_code, string div_code, int cmonth, int cyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select top(1) STUFF((Select ','+ cast(day(a.Activity_Date) as varchar)  from DCRMain_Trans a " +
                     " where a.Sf_Code = '" + sf_code + "' and MONTH(a.Activity_Date) = '" + cmonth + "' " +
                     " and YEAR(a.Activity_Date) = '" + cyear + "' and a.Division_Code='" + div_code + "' and a.FieldWork_Indicator ='L' " +
                     " FOR XML PATH('')),1,1,'') Delayed_Date from DCRMain_Trans T2 where t2.Sf_Code = '" + sf_code + "' and " +
                     " MONTH(T2.Activity_Date) = '" + cmonth + "' and YEAR(t2.Activity_Date) = '" + cyear + "' and t2.Division_Code='" + div_code + "' " +
                     " and T2.FieldWork_Indicator ='L' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet SalesForceList_camp(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceGet_MR '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;

        }
        public DataSet UserList_getMR_Multiple_camp(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getMR_Multiple '" + divcode + "', " + sf_code + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet get_sf_code(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsListedDR = null;


            strQry = "select sf_code from mas_salesforce where sf_code in (" + sf_code + ") ";
            try
            {
                dsListedDR = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsListedDR;
        }

        public DataSet sp_UserListMr_FieldForce(string sf_code, string divcode, string iMonth, string iYear, string StrVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            // strQry = "EXEC sp_get_Rep_audit_with_Vacant '" + sf_code + "', '" + divcode + "' ";

            strQry = "EXEC sp_Get_DCRCount_View '" + sf_code + "', '" + divcode + "','" + iMonth + "','" + iYear + "','" + StrVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_Get_DCRCount_Current_Pending_date_Count(string sf_code, string divcode, string iMonth, string iYear, string StrVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC sp_Get_DCRCount_Current_Pending_date_Count '" + sf_code + "', '" + divcode + "','" + iMonth + "','" + iYear + "','" + StrVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_FieldForce(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_FieldForce_Status '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_UserList_Hierarchy_Vacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy_Vacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDCR_Leave_Count_Type(string sf_code, string div_code, int cmonth, int cyear, int Leave_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select count(distinct a.Activity_Date) Leave_Date From DCRMain_Trans a,mas_Leave_Form b " +
                    " where a.FieldWork_Indicator='L' and a.sf_code='" + sf_code + "' " +
                    " and a.Activity_Date between b.From_Date and b.To_Date and a.Sf_Code=b.sf_code " +
                    " and a.Division_Code=b.Division_Code  " +
                    " and MONTH(a.Activity_Date)='" + cmonth + "' and YEAR(a.activity_date)='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Leave_Type='" + Leave_type + "' and b.Leave_Active_Flag=0 ";


            //strQry = "select (select count(distinct a.Activity_Date) Leave_Date From DCRMain_Trans a,mas_Leave_Form b " +
            //        " where a.FieldWork_Indicator='L' and a.sf_code='" + sf_code + "' " +
            //        " and a.Activity_Date between b.From_Date and b.To_Date and a.Sf_Code=b.sf_code " +
            //        " and a.Division_Code=b.Division_Code  " +
            //        " and MONTH(a.Activity_Date)='" + cmonth + "' and YEAR(a.activity_date)='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Leave_Type='" + Leave_type + "') , " +
            //        " (select count(a.Activity_Date) From DCRMain_Trans a " +
            //        " where a.FieldWork_Indicator='L' and a.sf_code='"+sf_code+"' " +
            //        " and month(a.Activity_Date)='"+cmonth+"' and Entry_Mode='Apps') ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }

        public DataSet getDCR_Leave_Count_ToolTip_Type(string sf_code, string div_code, int cmonth, int cyear, int Leave_Type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = " select top (1) STUFF((Select distinct ','+ cast(day(a.Activity_Date) as varchar)  from DCRMain_Trans a,mas_Leave_Form b " +
                     " where a.Sf_Code = '" + sf_code + "' and MONTH(a.Activity_Date) = '" + cmonth + "' " +
                     " and  a.Activity_Date between b.From_Date and b.To_Date and a.Sf_Code=b.sf_code and a.Division_Code=b.Division_Code " +
                     " and YEAR(a.Activity_Date) = '" + cyear + "' and a.Division_Code='" + div_code + "' and b.Leave_Type='" + Leave_Type + "' and b.Leave_Active_Flag=0 and a.FieldWork_Indicator ='L' " +
                     " FOR XML PATH('')),1,1,'') Leave_Date from DCRMain_Trans T2,mas_Leave_Form T3 where t2.Sf_Code = '" + sf_code + "' and " +
                     " T2.Activity_Date between T3.From_Date and T3.To_Date and T2.Sf_Code=T3.sf_code and T2.Division_Code=T3.Division_Code and " +
                     " MONTH(T2.Activity_Date) = '" + cmonth + "' and YEAR(t2.Activity_Date) = '" + cyear + "' and t2.Division_Code='" + div_code + "' and T3.Leave_Type='" + Leave_Type + "' and T3.Leave_Active_Flag=0 " +
                     " and T2.FieldWork_Indicator ='L' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getSalesForcelist_Alphabet_List_Promo(string divcode, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select '1' val,'All' sf_name " +
                     " union " +
                     " select distinct LEFT(sf_name,1) val, LEFT(sf_name,1) sf_name" +
                     " FROM mas_salesforce " +
                     " WHERE SF_Status=0  " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND (Division_Code like '" + divcode + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + divcode + ',' + "%') " +
                     " AND sf_Tp_Active_flag = 0 and sf_type = '" + type + "' " +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getSalesForcelist_Pro(string divcode, string sAlpha, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;


            //strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, " +
            //          " (select UsrDfd_UserName from Mas_Salesforce where sf_code=a.sf_code) +'- '+ " +
            //         "  (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
            //         "  Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
            //         " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //         " WHERE SF_Status=0 " +
            //         " AND lower(sf_code) != 'admin' " +
            //         " AND (a.Division_Code like '" + divcode + ',' + "%'  or " +
            //         " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
            //         " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 and and sf_type = '" + type + "' " +
            //         " AND LEFT(a.sf_name,1) = '" + sAlpha + "' " +
            //         " ORDER BY Sf_Name";

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, " +
                    " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                   "  (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                   "  Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                   " FROM mas_salesforce a join mas_state b on a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                   " WHERE SF_Status=0 " +
                   " AND lower(sf_code) != 'admin' " +
                   " AND a.Division_Code = '" + divcode + ",' " +
                   " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 and sf_type = '" + type + "' " +
                   " AND LEFT(a.sf_name,1) = '" + sAlpha + "' " +
                   " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_st_promo(string divcode, string state_code, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;


            strQry = " SELECT SF_Code, Sf_Name,Sf_UserName, UsrDfd_UserName, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     " Sf_Password,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date, Sf_HQ,sf_type as Type , case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,b.StateName,a.State_Code as state_code,c.Designation_Short_Name as Designation_Name,c.Designation_Short_Name" +
                     " FROM mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                     " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code  WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
                     " AND a.sf_Tp_Active_flag = 0 and a.sf_type = '" + type + "' AND a.State_Code = '" + state_code + "' AND a.Division_Code = '" + divcode + ",' " +
                     " ORDER BY 2";



            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getSalesForce_des_promo(string divcode, string Designation_Code, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;


            strQry = " SELECT SF_Code, Sf_Name, UsrDfd_UserName,Sf_UserName, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     " Sf_Password, Sf_HQ,sf_type as Type, case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,sf_emp_id,convert(varchar,Sf_Joining_Date,103)Sf_Joining_Date,b.StateName,c.Designation_Short_Name as Designation_Name,a.Designation_Code as Designation_Code,c.Designation_Short_Name" +
                     " FROM  mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                     " where lower(sf_code) != 'admin'  AND a.SF_Status = 0 " +
                     " AND a.sf_Tp_Active_flag = 0 and a.sf_type= '" + type + "'  AND a.Designation_Code = '" + Designation_Code + "' AND a.Division_Code = '" + divcode + ",' " +
                     " ORDER BY 2";


            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet FindSalesForcelist_Promo(string sFindQry, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "SELECT SF_Code, Sf_Name, Sf_UserName, Sf_HQ, " +
                     " (select UsrDfd_UserName from mas_salesforce where sf_code=a.sf_code) +'- '+ " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     "sf_type as Type , case when sf_Type = 1 THEN 'Medical Rep' ELSE 'Manager' END as sf_Type,b.StateName,c.Designation_Short_Name as Designation_Name,a.State_Code as state_code " +
                     " FROM mas_salesforce a, mas_state b,Mas_SF_Designation c " +
                     " WHERE SF_Status=0 " +
                     " AND lower(sf_code) != 'admin' " +
                     " AND a.State_Code=b.State_Code " +
                     " AND a.Designation_Code = c.Designation_Code" +
                     " AND a.SF_Status = 0 AND a.sf_Tp_Active_flag = 0 and a.sf_type = '" + type + "' " +
                     sFindQry +
                     " ORDER BY Sf_Name";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getDesignation_SN_prom(string div_code, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select ''Designation_Code,'---Select---'  Designation_Name" +
                     " union" +
                     " SELECT Designation_Code,Designation_Short_Name AS Designation_Name " +
                     " FROM Mas_SF_Designation where Division_Code = '" + div_code + "' and type = '" + type + "' " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getOnlyBaselevel(string divcode, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "  SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, " +
                     "  (select UsrDfd_UserName from Mas_Salesforce where sf_code=a.sf_code) +'- '+ " +
                     "  (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
                     "  a.sf_type as Type, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
                      " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                      " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and  " +
                      " SF_Status=0  AND lower(sf_code) != 'admin' AND a.sf_Tp_Active_flag = 0 and a.sf_type='" + type + "' " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int RecordUdpate_forBase_Manag(string sf_code, string div_code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                DataSet DsSal = null;

                strQry = "Select UsrDfd_UserName,sf_emp_id,Sf_Name from mas_salesforce where Division_Code='" + div_code + ",' and sf_code='" + sf_code + "'";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {
                    strQry = "UPDATE Mas_Salesforce " +
                             " SET UsrDfd_UserName = '" + DsSal.Tables[0].Rows[0][0].ToString() + "P' , " +
                             " sf_emp_id ='" + DsSal.Tables[0].Rows[0][1].ToString() + "P', " +
                             " Sf_Name ='" + DsSal.Tables[0].Rows[0][2].ToString() + " - Promoted', " +
                             " LastUpdt_Date = getdate() " +
                             " WHERE sf_code = '" + sf_code + "' and Division_Code='" + div_code + ",' ";

                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public DataSet getVacantManagersonly(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;


            strQry = "SELECT '' as Sf_Code, '---Select---' as sf_name " +
                   " UNION " +
                   "select Sf_Code,sf_name + ' - ' + sf_Designation_Short_Name + ' - ' + Sf_HQ from mas_salesforce where  Division_Code = '" + div_code + ",' " +
                   "  AND sf_type = 2 and sf_TP_Active_Flag =1 and SF_Status = 0 ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getUserListReportingToNew_for_all_Approval_Changes(string div_code, string sf_code, int order_id, string sf_type)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;

                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("Sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting", typeof(string)));
                dt.Columns.Add(new DataColumn("DCR_AM", typeof(string)));
                dt.Columns.Add(new DataColumn("TP_AM", typeof(string)));
                dt.Columns.Add(new DataColumn("LstDr_AM", typeof(string)));
                dt.Columns.Add(new DataColumn("Leave_AM", typeof(string)));
                dt.Columns.Add(new DataColumn("SS_AM", typeof(string)));
                dt.Columns.Add(new DataColumn("Expense_AM", typeof(string)));
                dt.Columns.Add(new DataColumn("Otr_AM", typeof(string)));

                strQry = "SELECT a.Sf_Code, a.Sf_Name,a.Sf_HQ,c.sf_Designation_Short_Name as Designation_Name," +
                    "(select Sf_Name  from mas_salesforce where sf_code=c.Reporting_To_SF)+'-'+ " +
                    "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=c.Reporting_To_SF)+'-'+ " +
                    "(select Sf_HQ from Mas_Salesforce where sf_code=c.Reporting_To_SF) Reporting_To, " +
                    "(select Sf_Code from Mas_Salesforce where sf_code=c.Reporting_To_SF) Reporting, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                    " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                    " WHERE  c.sf_TP_Active_Flag=0 and c.SF_Status=0 " +
                    " AND a.Reporting_To = '" + sf_code + "' " +
                    " and a.Division_Code = '" + div_code + "' " +
                    " ORDER BY 2";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {

                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["Sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                        dr["Sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                        dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["DCR_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["TP_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["LstDr_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Leave_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["SS_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["Expense_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Otr_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        //dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        //dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                        //dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                        //dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                        //dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                        //dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                        //dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                        //dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                        dt.Rows.Add(dr);

                        if (sf_type == "3")
                        {
                            strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                      " FROM mas_ho_id_creation " +
                                       " WHERE HO_Active_flag = 0  and  " +
                                       "(Division_Code like '" + div_code + "%'  or " +
                                        "Division_Code like '%" + ',' + div_code + "%') and " +
                                       " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                            DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                            if (dsmgr1.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                dr["order_id"] = order_id;
                                dr["Sf_Code"] = "admin";
                                dr["Sf_Name"] = "admin";
                                dr["Sf_HQ"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Designation_Name"] = "";
                                dr["Reporting_To"] = "";
                                dr["Reporting"] = "";
                                dr["DCR_AM"] = "";
                                dr["TP_AM"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["LstDr_AM"] = "";
                                dr["Leave_AM"] = "";
                                dr["SS_AM"] = "";
                                dr["Expense_AM"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Otr_AM"] = "";
                                //dr["StateName"] = "";
                                //dr["Last_TP_Date"] = "";
                                //dr["Sf_TP_DCR_Active_Dt"] = "";
                                //dr["Last_DCR_Date"] = "";
                                //dr["sf_emp_id"] = "";
                                //dr["type"] = "";
                                //dr["Reporting_To"] = "";
                                //dr["Designation_Name"] = "";
                                dt.Rows.Add(dr);
                            }
                        }
                        else
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["Sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["Sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Reporting"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["DCR_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dr["TP_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["LstDr_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["Leave_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            dr["SS_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                            dr["Expense_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                            dr["Otr_AM"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                            //dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                            //dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                            //dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                            //dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                            //dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                            //dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                            //dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                            //dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                            dt.Rows.Add(dr);
                        }

                    }
                    else
                    {

                    }
                }

                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = "SELECT a.Sf_Code, a.Sf_Name,a.Sf_HQ,c.sf_Designation_Short_Name as Designation_Name," +
                    "(select Sf_Name  from mas_salesforce where sf_code=c.Reporting_To_SF)+'-'+ " +
                    "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=c.Reporting_To_SF)+'-'+ " +
                    "(select Sf_HQ from Mas_Salesforce where sf_code=c.Reporting_To_SF) Reporting_To, " +
                    "(select Sf_Code from Mas_Salesforce where sf_code=c.Reporting_To_SF) Reporting, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                    "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                    " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                    " WHERE  (c.sf_Tp_Active_flag = 0 or c.sf_Tp_Active_flag != 1) and c.SF_Status=0 " +
                    " AND a.Reporting_To = '" + sf_code + "' " +
                    " and a.Division_Code = '" + div_code + "' " +
                    " ORDER BY 2";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr_Approval_Changes(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["Sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["Sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_HQ"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["DCR_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["TP_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["LstDr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Leave_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["SS_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["Expense_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Otr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        //dr["Expense_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        //dr["Otr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                        //dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                        //dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                        //dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                        //dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                        //dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                        //dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }

                                            dsA = getAuditMgr_Approval_Changes(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["Sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["Sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_HQ"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["DCR_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["TP_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["LstDr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Leave_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["SS_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["Expense_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Otr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                //dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                //dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                //dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                //dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                //dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                //dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                //dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                //dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr_Approval_Changes(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["Sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["Sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_HQ"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["DCR_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["TP_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["LstDr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Leave_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["SS_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["Expense_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Otr_AM"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        //dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        //dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                        //dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                        //dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                        //dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                        //dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                        //dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                        //dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["Sf_Code"] = drFF["Sf_Code"].ToString();
                            dr["Sf_Name"] = drFF["Sf_Name"].ToString();
                            dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                            dr["Designation_Name"] = drFF["Designation_Name"].ToString();
                            dr["Reporting_To"] = drFF["Reporting_To"].ToString();
                            dr["Reporting"] = drFF["Reporting"].ToString();
                            dr["DCR_AM"] = drFF["DCR_AM"].ToString();
                            dr["TP_AM"] = drFF["TP_AM"].ToString();
                            dr["LstDr_AM"] = drFF["LstDr_AM"].ToString();
                            dr["Leave_AM"] = drFF["Leave_AM"].ToString();
                            dr["SS_AM"] = drFF["SS_AM"].ToString();
                            dr["Expense_AM"] = drFF["Expense_AM"].ToString();
                            dr["Otr_AM"] = drFF["Otr_AM"].ToString();
                            //dr["StateName"] = drFF["StateName"].ToString();
                            //dr["Last_TP_Date"] = drFF["Last_TP_Date"].ToString();
                            //dr["Sf_TP_DCR_Active_Dt"] = drFF["Sf_TP_DCR_Active_Dt"].ToString();
                            //dr["Last_DCR_Date"] = drFF["Last_DCR_Date"].ToString();
                            //dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                            //dr["type"] = drFF["type"].ToString();
                            //dr["Reporting_To"] = drFF["Reporting_To"].ToString();
                            //dr["Designation_Name"] = drFF["Designation_Name"].ToString();
                            dt.Rows.Add(dr);
                        }

                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToNew_for_all_Approval_Changes(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataSet getAuditMgr_Approval_Changes(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "SELECT a.Sf_Code, a.Sf_Name,a.Sf_HQ,c.sf_Designation_Short_Name as Designation_Name," +
                     "(select Sf_Name  from mas_salesforce where sf_code=c.Reporting_To_SF)+'-'+ " +
                     "(select sf_Designation_Short_Name from Mas_Salesforce where sf_code=c.Reporting_To_SF)+'-'+ " +
                     "(select Sf_HQ from Mas_Salesforce where sf_code=c.Reporting_To_SF) Reporting_To, " +
                     "(select Sf_Code from Mas_Salesforce where sf_code=c.Reporting_To_SF) Reporting, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.DCR_AM) as DCR_AM, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.TP_AM) as TP_AM, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.LstDr_AM) as LstDr_AM, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.Leave_AM) as Leave_AM, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.SS_AM) as SS_AM, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.Expense_AM) as Expense_AM, " +
                     "(select Sf_Name from mas_salesforce where sf_code=a.Otr_AM) as Otr_AM " +
                     " FROM mas_salesforce_AM a join Mas_Salesforce c on a.Sf_Code = c.Sf_Code " +
                     " WHERE  c.sf_TP_Active_Flag=0 and c.SF_Status=0 " +
                     " AND a.Reporting_To = '" + sf_code + "' " +
                     " and a.Division_Code = '" + div_code + "' " +
                     " ORDER BY 2";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet UserList_getMR_Vacant(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //strQry = "EXEC sp_UserList_getMR '" + divcode + "', '" + sf_code + "' ";

            strQry = "SELECT a.sf_Code,Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name, a.Sf_UserName, a.sf_Type, " +
                        " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password " +
                        " FROM mas_salesforce a " +
                        " WHERE  a.sf_Tp_Active_flag = 1 and (a.Division_Code like '" + divcode + ',' + "%'  or " +
                        " a.Division_Code like '%" + ',' + divcode + ',' + "%') " +
                        " and a.sf_code !='admin' and a.sf_type=1 " +
                        " order by 2 ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getVacantBaselevelonly(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;


            strQry = "SELECT '' as Sf_Code, '---Select---' as sf_name " +
                   " UNION " +
                   "select Sf_Code,sf_name + ' - ' + sf_Designation_Short_Name + ' - ' + Sf_HQ from mas_salesforce where  Division_Code = '" + div_code + ",' " +
                   " AND sf_type = 1 and sf_TP_Active_Flag =1 and SF_Status = 0 ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int RecordUdpate_for_MangrtoBase(string sf_code, string div_code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                DataSet DsSal = null;

                strQry = "Select UsrDfd_UserName,sf_emp_id,Sf_Name from mas_salesforce where Division_Code='" + div_code + ",' and sf_code='" + sf_code + "'";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {
                    strQry = "UPDATE Mas_Salesforce " +
                             " SET UsrDfd_UserName = '" + DsSal.Tables[0].Rows[0][0].ToString() + "D' , " +
                             " sf_emp_id ='" + DsSal.Tables[0].Rows[0][1].ToString() + "D', " +
                             " Sf_Name ='" + DsSal.Tables[0].Rows[0][2].ToString() + " - DePromoted', " +
                             " LastUpdt_Date = getdate() " +
                             " WHERE sf_code = '" + sf_code + "' and Division_Code='" + div_code + ",' ";

                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int Transfer_RecordInsert_Depromo(string sfname, string Vac_sfcode, string sfcode, int from_designation, int To_designation, string from_division, string to_division, string vac_sf_emp_id, string act_emp_id)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();
                strQry = "SELECT isnull(max(S_No)+1,'1') S_No from Salesforce_Transfer_Promote ";
                int S_No = db.Exec_Scalar(strQry);

                if (from_division.Contains(','))
                {
                    from_division = from_division.Remove(from_division.Length - 1);
                }

                strQry = "EXEC Promo_Depro_Leave_entile '" + from_division + "','" + Vac_sfcode + "','" + sfcode + "','" + vac_sf_emp_id + "','" + act_emp_id + "'";

                iReturn = db.ExecQry(strQry);

                strQry = "INSERT INTO Salesforce_Transfer_Promote(S_No,Sf_Name,From_sf_code,To_sf_code,From_Desigantion,To_Designation,From_Division_Code,To_Division_Code,Transfered_Date,Mode) " +
                         " VALUES ('" + S_No + "', '" + sfname + "' ,'" + Vac_sfcode + "','" + sfcode + "', '" + from_designation + "', '" + To_designation + "', '" + from_division + "', '" + to_division + "', " +
                         " getdate(),'DePromoted')";



                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        public DataSet input_quantity_Mr(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "  select sum(cast(Despatch_Actual_qty as float)),sum(Despatch_qty) from Trans_Input_Despatch_Details a inner join Trans_Input_Despatch_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where b.Trans_Month='" + cmonth + "' and b.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;


        }
        public DataSet input_quantity_MrDatewise(string sf_code, string div_code, string FromDate, string ToDate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "  select sum(cast(Despatch_Actual_qty as float)),sum(Despatch_qty) from Trans_Input_Despatch_Details a inner join Trans_Input_Despatch_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where a.Create_dt between '" + FromDate + "' and '" + ToDate + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;


        }

        public DataSet inputissue_quantity_Mr(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "   select sum(sample) as   TOTAL_AMOUNT from(  ( select sum(c.Gift_Qty) as sample from DCRMain_Temp b,DCRDetail_Lst_Temp c  where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "' and c.Trans_Detail_Info_Type=1" +
                      " and  c.sf_code  in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "') )union( select sum(cast(substring(c.Additional_Gift_Code,charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code)+len('#'+cast(e.Gift_Code as varchar)+'~')-1,charindex('$','#'+ c.Additional_Gift_Code,charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code))-(charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code)+len('#'+cast(e.Gift_Code as varchar)+'~'))) as numeric)) sample " +
    " from DCRMain_Temp b,DCRDetail_Lst_Temp c ,Mas_Gift e    where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo  and" +
          " charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code) > 0  and c.Trans_Detail_Info_Type=1 " +
                      "and  charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code) > 0  and " +
                      " (charindex('~$','#'+ convert (varchar,e.Gift_Code)) <= 0 and charindex('~0$','#'+ Additional_Gift_Code) <= 0)   and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "' " +
                      " and  c.sf_code  in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "')  ) )s ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }

        public DataSet input_quantity_status(string sf_code, string div_code, int cmonth, int cyear, string cdate, string productid)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "  select SUM(Despatch_Qty) from Trans_Input_Despatch_Details a inner join Trans_Input_Despatch_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where b.Trans_Month='" + cmonth + "' and b.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "'and a.productc='" + productid + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;


        }

        public DataSet inputissue_quantity_product(string sf_code, string div_code, int cmonth, int cyear, string cdate, string productid)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "                       SELECT sum(sample) AS TOTAL_AMOUNT FROM ((  select distinct e.[Gift_Code],e.[Gift_Name] ,sum(c.Gift_Qty) as sample from DCRMain_Temp b,DCRDetail_Lst_Temp c ,Mas_Gift e  where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "' and c.Trans_Detail_Info_Type=1" +
                     " and  c.sf_code  in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "') and convert (varchar,e.Gift_Code)='" + productid + "'  and c.Gift_Code='" + productid + "'" +
                     " group by b.Sf_Code ,e.[Gift_Code],e.Gift_Name )  union  (select distinct e.Gift_Code,e.Gift_Name, sum(cast(substring(c.Additional_Gift_Code,charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code)+len('#'+cast(e.Gift_Code as varchar)+'~')-1,charindex('$','#'+ c.Additional_Gift_Code,charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code))-(charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code)+len('#'+cast(e.Gift_Code as varchar)+'~'))) as numeric)) sample " +
     "from DCRMain_Temp b,DCRDetail_Lst_Temp c ,Mas_Gift e    where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo  and charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code) > 0  and c.Trans_Detail_Info_Type=1 " +
                     " and  charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+ c.Additional_Gift_Code) > 0  and" +
                      " (charindex('~$','#'+ convert (varchar,e.Gift_Code)) <= 0 and charindex('~0$','#'+ Additional_Gift_Code) <= 0)   and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "'" +
                      " and  c.sf_code  in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "') and convert (varchar,e.Gift_Code)='" + productid + "'  group by b.Sf_Code ,e.Gift_Code,e.Gift_Name)) s";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }

        public DataSet despatch_quantity_Mr(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "  select SUM(Despatch_Actual_qty),sum(Despatch_qty) from Trans_Sample_Despatch_Details a inner join Trans_Sample_Despatch_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where b.Trans_Month='" + cmonth + "' and b.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }
        public DataSet despatch_quantity_MrDateWise(string sf_code, string div_code, string FromDate, string ToDate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "  select SUM(Despatch_Actual_qty),sum(Despatch_qty) from Trans_Sample_Despatch_Details a inner join Trans_Sample_Despatch_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "' and create_dt between '" + FromDate + "' and '" + ToDate + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }

        public DataSet issue_quantity_Mr(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = " select sum(cast(substring(c.product_Code,charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code)+len('#'+cast(Product_Code_SlNo as varchar)+'~')-1,charindex('$','#'+ c.Product_Code,charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code))-(charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code)+len('#'+cast(Product_Code_SlNo as varchar)+'~'))) as numeric)) sample" +
                     " from DCRMain_Trans b,DCRDetail_Lst_Trans c ,Mas_Product_Detail e  " +
                      "where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo and " +
                     " charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code) > 0  and c.Trans_Detail_Info_Type=1 " +
                     " and  charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ Product_Code) > 0  and " +
                       "(charindex('~$','#'+ Product_Code) <= 0 and charindex('~0$','#'+ Product_Code) <= 0)   and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "' " +
                      " and  c.sf_code  in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "')  ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }
        public DataSet despatch_quantity_status(string sf_code, string div_code, int cmonth, int cyear, string cdate, string productid)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "  select SUM(Despatch_Qty) from Trans_Sample_Despatch_Details a inner join Trans_Sample_Despatch_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where b.Trans_Month='" + cmonth + "' and b.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "' and a.productc='" + productid + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }

        public DataSet issue_quantity_status(string sf_code, string div_code, int cmonth, int cyear, string cdate, string productid)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = " select sum(cast(substring(c.product_Code,charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code)+len('#'+cast(Product_Code_SlNo as varchar)+'~')-1,charindex('$','#'+ c.Product_Code,charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code))-(charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code)+len('#'+cast(Product_Code_SlNo as varchar)+'~'))) as numeric)) sample" +
                     " from DCRMain_Trans b,DCRDetail_Lst_Trans c ,Mas_Product_Detail e  " +
                      "where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo and " +
                     " charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ c.Product_Code) > 0  and c.Trans_Detail_Info_Type=1 " +
                     " and  charindex('#'+cast(Product_Code_SlNo as varchar)+'~','#'+ Product_Code) > 0  and " +
                       "(charindex('~$','#'+ Product_Code) <= 0 and charindex('~0$','#'+ Product_Code) <= 0)   and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "' " +
                      " and  c.sf_code  in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "') and Product_Code_SlNo='" + productid + "'   ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }
        public DataSet SalesForceList_MR_ALL(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_access_ALL  '" + sf_code + "' , '" + divcode + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getTP_Deviation(string divcode, string sf_code, int Month, int Year, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            // strQry = "EXEC sp_TP_Deviation '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "' ,'" + type + "'";
            strQry = "EXEC TP_DeviationNew '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataSet SalesForceList_New_GetMr(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_access_with_HQ '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sp_get_Rep_access_with_HQ_wtoutvacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_access_with_HQ_wtoutvacant '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getTP_Deviation_Transl_terr(string Trans_SlNo)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            strQry = " select distinct SDP,SDP_Name from DCRDetail_Lst_Trans where Trans_SlNo ='" + Trans_SlNo + "' ";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataSet getTP_Deviation_Transl(string Trans_SlNo)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            strQry = " select distinct Worked_with_Name from DCRDetail_Lst_Trans where Trans_SlNo ='" + Trans_SlNo + "' ";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }
        public DataSet Doctor_count(string div_code, string sf_code, int cmonth, int cyear, DateTime dtcurrent)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "EXEC sp_Get_LstDr_CntOnly  '" + div_code + "', '" + sf_code + "'," + cmonth + "," + cyear + ", '" + dtcurrent + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet UserList_Self_Call_Vacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self_Call_Vacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSfName_sal(string sfcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Name,sf_code, sf_Designation_Short_Name, Sf_HQ, Division_Code, " +
                     " (select Sf_Name from mas_salesforce where sf_code=a.TP_Reporting_SF) Reporting_To FROM  Mas_Salesforce a" +
                     " WHERE sf_code= '" + sfcode + "' and Division_code='" + div_code + ',' + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserListTP_Hierarchy_Sale(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_TP_tempar '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet getInput_Sample_count(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;


            strQry = "select count(distinct e.Gift_Code)  from DCRMain_Trans b,DCRDetail_Lst_Trans c , " +
                     " Mas_Gift e,Mas_ListedDr a  where c.Division_Code ='" + div_code + "' and b.Trans_SlNo = c.Trans_SlNo and " +
                     " charindex('#'+cast(e.Gift_Code as varchar)+'~','#'+c.Gift_Code+'~'+cast(Gift_Qty as varchar) " +
                     " +'#'+c.Additional_Gift_Code) > 0 and (charindex('~$','#'+c.Gift_Code+'~'+cast(Gift_Qty as varchar)+'#'+c.Additional_Gift_Code) <= 0 " +
                     " and charindex('~0$','#'+c.Gift_Code+'~'+cast(Gift_Qty as varchar)+'#'+c.Additional_Gift_Code) <= 0 " +
                     " and c.Trans_Detail_Info_Type=1 and month(b.Activity_Date)='" + cmonth + "' and YEAR(b.Activity_Date)= '" + cyear + "' and  c.sf_code " +
                     " in ('" + sf_code + "') and b.sf_code in ('" + sf_code + "')) and b.Trans_SlNo = c.Trans_SlNo and ((CONVERT(Date, ListedDr_Created_Date) < '" + cdate + "') " +
                     " And (CONVERT(Date, ListedDr_Deactivate_Date) >= '" + cdate + "' or ListedDr_Deactivate_Date is null)) ";



            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public DataSet getLeavesf_code(string divcode, DateTime from_date, DateTime to_date)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsFrom = null;
            DataSet dsTo = null;

            string Fr_date = from_date.Month + "-" + from_date.Day + "-" + from_date.Year;
            string To_dat = to_date.Month + "-" + to_date.Day + "-" + to_date.Year;


            strQry = " SELECT DATEADD(month, DATEDIFF(month, 0, '" + Fr_date + "'), 0) AS StartOfMonth ";
            dsFrom = db_ER.Exec_DataSet(strQry);

            strQry = " SELECT DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,'" + To_dat + "')+1,0)) ";
            dsTo = db_ER.Exec_DataSet(strQry);


            DateTime Fr_date2 = Convert.ToDateTime(dsFrom.Tables[0].Rows[0][0].ToString());
            DateTime To_dat2 = Convert.ToDateTime(dsTo.Tables[0].Rows[0][0].ToString());

            string Fr_date3 = Fr_date2.Month + "-" + Fr_date2.Day + "-" + Fr_date2.Year;
            string To_dat3 = To_dat2.Month + "-" + To_dat2.Day + "-" + To_dat2.Year;



            dsSF = null;
            strQry = " select distinct sf_code , COUNT(distinct Activity_Date) Activity_Date from DCRMain_Trans where  " +
                     " FieldWork_Indicator='L' and  Activity_Date between '" + Fr_date3 + "' AND '" + To_dat3 + "' " +
                     " and Division_Code='" + divcode + "' group by  sf_code,Activity_Date ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet UserList_getMRalpha(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC  sp_UserList_getMRalpha '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDoctorDetailsBysfName(string div_code, string sfCode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "Select ListedDr_Name,Doc_Spec_ShortName,Doc_Cat_ShortName,ListedDrCode,DC.Doc_Cat_Name,DS.Doc_Special_Name,MT.Territory_Name FROM Mas_ListedDr ML LEFT OUTER JOIN Mas_Doctor_Category DC ON DC.Doc_Cat_Code = ML.Doc_Cat_Code " +
                     "LEFT OUTER JOIN Mas_Doctor_Speciality DS ON DS.Doc_Special_Code = ML.Doc_Special_Code LEFT OUTER JOIN (SELECT Territory_Code,Territory_Name FROM Mas_Territory_Creation WHERE Division_Code ='" + div_code + "' and SF_Code = '" + sfCode + "') MT ON convert(int,MT.Territory_Code) = ML.Territory_Code WHERE ML.Division_Code = '" + div_code + "' AND ML.Sf_Code ='" + sfCode + "' order by ListedDr_Name asc";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet CheckStatecode(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select State_Code from Mas_Salesforce where sf_code = '" + sf_code + "'";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getmode_monitor(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " SELECT 'No.of Listed Drs in List' as Doc_Cat_SName,'' as Doc_Cat_Code, '' as Doc_Cat union all " +
                     //" SELECT 'CallAverage for the Month' as Doc_Cat_SName,'' as Doc_Cat_Code " +
                     //" union all " +
                     // " select 'Fieldwork Days' as Doc_Cat_SName,'' as Doc_Cat_Code union all " +
                     " select 'Total No.of Calls Met' as Doc_Cat_SName,'' as Doc_Cat_Code, '' as Doc_Cat union all " +
                     " select  'Total No.of Calls Seen' as Doc_Cat_SName,'' as Doc_Cat_Code, '' as Doc_Cat union all " +
                     " select 'Total No.of Listed Drs Missed' as Doc_Cat_SName,'' as Doc_Cat_Code, '' as Doc_Cat union all " +

                     " select 'Total '+ Doc_Cat_SName +' Calls', Doc_Cat_Code as Doc_Cat_Code, Doc_Cat_SName as Doc_Cat " +
                     " from Mas_Doctor_Category where Division_Code = '" + div_code + "' and Doc_Cat_Active_Flag = 0 union all " +
                     " select   Doc_Cat_SName +' Calls Met', Doc_Cat_Code as Doc_Cat_Code, Doc_Cat_SName as Doc_Cat " +
                     " from Mas_Doctor_Category where Division_Code = '" + div_code + "'  and Doc_Cat_Active_Flag = 0  union all " +
                     " select   Doc_Cat_SName +' Calls Missed', Doc_Cat_Code as Doc_Cat_Code, '' as Doc_Cat " +
                     " from Mas_Doctor_Category where Division_Code = '" + div_code + "' and Doc_Cat_Active_Flag = 0 ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet checkMr_subdiv(string divcode, string sf_code, string sub_divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select Sf_Code,Sf_Name from Mas_Salesforce where Division_Code='" + divcode + ",' and Sf_Code ='" + sf_code + "' and " +
                     " CHARINDEX(cast('" + sub_divcode + "' as varchar),subdivision_code)>0 ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getsubdiv_userlist(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select '0' as subdivision_code,'---Select---' as subdivision_name " +
                     " union " +
                     " select subdivision_code,subdivision_name from mas_subdivision where Div_Code='" + div_code + "' and SubDivision_Active_Flag=0 ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSf_Doc(string div_code, string sf_code, int cmonth, int cyear, DateTime dtcurrent)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " select count(distinct a.ListedDrCode) as dr_count from Mas_ListedDr a " +
                     " where " +
                     " a.sf_code ='" + sf_code + "' and Division_code = '" + div_code + "' and " +
                     " ((CONVERT(Date, ListedDr_Created_Date) < CONVERT(VARCHAR(50), '" + dtcurrent + "' , 126)) And (CONVERT(Date, ListedDr_Deactivate_Date) >= " +
                     " CONVERT(VARCHAR(50), '" + dtcurrent + "' , 126) or ListedDr_Deactivate_Date is null))";



            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet CheckSFNameVacant_Temp(string sf_code, int cmon, int cyr)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC sp_get_sf_name_between_dates_Temp '" + sf_code + "', " + cmon + ", " + cyr + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;

        }

        public DataSet DCR_get_Not_Submit_Date(string divcode, string sf_code, string cmonth, string cyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Not_Submit_Date '" + sf_code + "', '" + divcode + ',' + "'," + cmonth + "," + cyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet CheckSFNameVacant_Temp_Delay(string sf_code, int cmon, int cyr)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC sp_get_sf_name_between_dates_forDelay '" + sf_code + "', " + cmon + ", " + cyr + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;

        }

        public DataSet DCR_Delayed_Dates(string divcode, string sf_code, string cmonth, string cyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Delayed_Dates '" + sf_code + "', '" + divcode + ',' + "'," + cmonth + "," + cyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getFieldforcetype_BulkEdit(string SF_Code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT Fieldforce_Type,Bank_Name FROM  Mas_Salesforce " +
                     " WHERE SF_Code='" + SF_Code + "' AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet CheckReporting(string sf_code, string Reporting_To_Sfcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsListedDR = null;

            strQry = "select Sf_Code from Mas_Salesforce where Sf_Code='" + Reporting_To_Sfcode + "' and Reporting_To_SF='" + sf_code + "' and Division_Code='" + div_code + ",' ";

            try
            {
                dsListedDR = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsListedDR;

        }

        public int RecordDele_ForRejoin(string sfcode, string sf_name, string div_code, string sf_emp_id, DateTime joining_date)
        {
            int iReturn = -1;
            try
            {

                DataSet dsSale = null;
                DB_EReporting db = new DB_EReporting();
                DB_EReporting db_ER = new DB_EReporting();

                //if (sf_hold_realse == "" || sf_hold_realse == null)
                //{

                strQry = "select DCR_Start_Date,Trans_Month,Trans_Year from SalesForce_Vacant where sf_Code='" + sfcode + "' and Division_Code ='" + div_code + ",' and Joining_Date='" + joining_date.ToString("MM/dd/yyyy") + "' and  DCR_End_Date is not null ";

                dsSale = db_ER.Exec_DataSet(strQry);

                if (dsSale.Tables[0].Rows.Count > 0)
                {
                    DateTime Sf_TP_DCR_Active_Dt = Convert.ToDateTime(dsSale.Tables[0].Rows[0]["DCR_Start_Date"].ToString());
                    strQry = "EXEC delete_rejoin '" + sfcode + "','" + dsSale.Tables[0].Rows[0]["Trans_Month"].ToString() + "','" + dsSale.Tables[0].Rows[0]["Trans_Year"].ToString() + "'";
                    iReturn = db.ExecQry(strQry);


                    strQry = "Update Trans_Leave_Entitle_Head set active_flag=0 where sf_code='" + sfcode + "' and sf_emp_id='" + sf_emp_id + "' and active_flag=1  ";
                    iReturn = db.ExecQry(strQry);

                    strQry = "Update mas_Salesforce set Sf_TP_DCR_Active_Dt='" + Sf_TP_DCR_Active_Dt.ToString("MM/dd/yyyy") + "',sf_TP_Active_Dt='" + Sf_TP_DCR_Active_Dt.ToString("MM/dd/yyyy") + "' where sf_code='" + sfcode + "' and sf_tp_active_flag=1  ";
                    iReturn = db.ExecQry(strQry);

                    strQry = " delete from SalesForce_Vacant where SF_Code='" + sfcode + "'  and Division_Code ='" + div_code + ",'  and Joining_Date='" + joining_date.ToString("MM/dd/yyyy") + "' and  DCR_End_Date is not null ";
                    iReturn = db.ExecQry(strQry);

                }

                // DB_EReporting db = new DB_EReporting();
                //if (sf_hold_realse == "" || sf_hold_realse == null)
                //{

                //strQry = " delete from SalesForce_Vacant where SF_Code='" + sfcode + "' and SF_Name ='" + sf_name + "' and Division_Code ='" + div_code + ",' ";
                //iReturn = db.ExecQry(strQry);

                //strQry = "Update Trans_Leave_Entitle_Head set active_flag=0 where sf_code='" + sfcode + "' and sf_emp_id='" + sf_emp_id + "' and active_flag=1  ";
                //iReturn = db.ExecQry(strQry);
                //}
                //else
                //{

                //    strQry = "Update Mas_Salesforce set sf_blkreason =null, " +
                //   " LastUpdt_Date = getdate() " +
                //   " WHERE Sf_Code= '" + sfcode + "' ";

                //    iReturn = db.ExecQry(strQry);
                //}

            }
            catch (Exception ex)
            {
                throw ex;
            }
            //}
            //else
            //{
            //    iReturn = -2;
            //}
            return iReturn;
        }

        public DataSet GetSalesAutoFill(string prefixText, string Div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsListedDR = null;

            strQry = strQry = "select Sf_HQ from Mas_Salesforce where Sf_HQ like '" + prefixText + "%' and Division_Code='" + Div_code + ",' ";

            try
            {
                dsListedDR = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsListedDR;

        }
        public DataSet getResigned_User(string divcode, DateTime from_date, DateTime to_date)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsFrom = null;
            DataSet dsTo = null;

            string Fr_date = from_date.Month + "-" + from_date.Day + "-" + from_date.Year;
            string To_dat = to_date.Month + "-" + to_date.Day + "-" + to_date.Year;


            strQry = " SELECT DATEADD(month, DATEDIFF(month, 0, '" + Fr_date + "'), 0) AS StartOfMonth ";
            dsFrom = db_ER.Exec_DataSet(strQry);

            strQry = " SELECT DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,'" + To_dat + "')+1,0)) ";
            dsTo = db_ER.Exec_DataSet(strQry);


            DateTime Fr_date2 = Convert.ToDateTime(dsFrom.Tables[0].Rows[0][0].ToString());
            DateTime To_dat2 = Convert.ToDateTime(dsTo.Tables[0].Rows[0][0].ToString());

            string Fr_date3 = Fr_date2.Month + "-" + Fr_date2.Day + "-" + Fr_date2.Year;
            string To_dat3 = To_dat2.Month + "-" + To_dat2.Day + "-" + To_dat2.Year;



            dsSF = null;
            strQry = " select SF_Code,Employee_Code,SF_Name,sf_Designation_Short_Name,Sf_HQ,convert(varchar,DCR_Start_Date,103) DCR_Start_Date,convert(varchar,DCR_End_Date,103) DCR_End_Date,Division_Code,'TP_DCR' TP_DCR" +
                     " from SalesForce_Vacant where Division_Code='" + divcode + ",' and " +
                     "  DCR_End_Date between '" + Fr_date3 + "' AND '" + To_dat3 + "' order by MONTH(DCR_End_Date)  ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getcheckTp_forVacant(string div_code, string sf_code, int Month, int Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsListedDR = null;

            strQry = " select SF_Code,Employee_Code,SF_Name,sf_Designation_Short_Name,Sf_HQ, " +
                    " CONVERT(varchar, DCR_Start_Date,103),CONVERT(varchar,DCR_End_Date,103) " +
                    " from SalesForce_Vacant where Division_Code='" + div_code + ",' " +
                    " and MONTH(DCR_End_Date)='" + Month + "' and Year(DCR_End_Date)='" + Year + "'  and SF_Code = '" + sf_code + "' ";

            try
            {
                dsListedDR = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsListedDR;

        }

        public DataSet getResigned_User_Leave(string divcode, string sf_code, string sf_name)
        {
            DB_EReporting db_ER = new DB_EReporting();

            dsSF = null;
            strQry = "select SF_Code,Employee_Code,SF_Name,sf_Designation_Short_Name,Sf_HQ " +
                     " from SalesForce_Vacant where Division_Code='" + divcode + ",' and SF_Code='" + sf_code + "' and SF_Name='" + sf_name + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getResigned_User_soring(string divcode, DateTime from_date, DateTime to_date)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            DataSet dsFrom = null;
            DataSet dsTo = null;

            string Fr_date = from_date.Month + "-" + from_date.Day + "-" + from_date.Year;
            string To_dat = to_date.Month + "-" + to_date.Day + "-" + to_date.Year;


            strQry = " SELECT DATEADD(month, DATEDIFF(month, 0, '" + Fr_date + "'), 0) AS StartOfMonth ";
            dsFrom = db_ER.Exec_DataSet(strQry);

            strQry = " SELECT DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0,'" + To_dat + "')+1,0)) ";
            dsTo = db_ER.Exec_DataSet(strQry);


            DateTime Fr_date2 = Convert.ToDateTime(dsFrom.Tables[0].Rows[0][0].ToString());
            DateTime To_dat2 = Convert.ToDateTime(dsTo.Tables[0].Rows[0][0].ToString());

            string Fr_date3 = Fr_date2.Month + "-" + Fr_date2.Day + "-" + Fr_date2.Year;
            string To_dat3 = To_dat2.Month + "-" + To_dat2.Day + "-" + To_dat2.Year;



            dsSF = null;
            strQry = " select SF_Code,Employee_Code,SF_Name,sf_Designation_Short_Name,Sf_HQ,convert(varchar,DCR_Start_Date,103) DCR_Start_Date,convert(varchar,DCR_End_Date,103) DCR_End_Date,Division_Code,'TP_DCR' TP_DCR" +
                     " from SalesForce_Vacant where Division_Code='" + divcode + ",' and " +
                     "  DCR_End_Date between '" + Fr_date3 + "' AND '" + To_dat3 + "' order by MONTH(DCR_End_Date)  ";

            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet LoginFieldforce(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Login_to_Fieldforce '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet get_HO(string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "SELECT HO_ID,Name,User_Name,Password,Division_Code " +
                     " FROM mas_ho_id_creation " +
                     " WHERE HO_Active_flag = 0  and Name <> 'admin'  and  " +
                      //" (Division_Code like '" + div_code +  "%'  or " +
                      //" Division_Code like '%" + ',' + div_code  + "%') and " +
                      "Sub_HO_ID='" + HO_ID + "'" +
                     " ORDER BY 1";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet GetJoiningdate(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select convert(varchar,Sf_Joining_Date,103) from Mas_Salesforce where sf_code = '" + sf_code + "'";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // Leave Entitlement

        public DataSet sp_UserList_leave_Entitlement(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Self_Mail '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet get_cl_days(string sf_code, string division_code, int Trans_year)
        {

            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select No_Of_Days,Leave_Balance_Days from Trans_Leave_Entitle_Details a inner join Trans_Leave_Entitle_Head b on a.Division_Code=b.Division_Code and a.Sl_No=b.Sl_No where sf_code='" + sf_code + "' and a.Division_Code='" + division_code + "'  and Leave_Type_Code='CL' and b.active_flag=0 and b.Trans_year='" + Trans_year + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;




        }
        public DataSet get_pl_days(string sf_code, string division_code, int Trans_year)
        {

            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select No_Of_Days,Leave_Balance_Days from Trans_Leave_Entitle_Details a inner join Trans_Leave_Entitle_Head b on a.Division_Code=b.Division_Code and a.Sl_No=b.Sl_No where sf_code='" + sf_code + "' and a.Division_Code='" + division_code + "'  and Leave_Type_Code='PL' and b.active_flag=0 and b.Trans_year='" + Trans_year + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;




        }
        public DataSet get_sl_days(string sf_code, string division_code, int Trans_year)
        {

            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select No_Of_Days,Leave_Balance_Days from Trans_Leave_Entitle_Details a inner join Trans_Leave_Entitle_Head b on a.Division_Code=b.Division_Code and a.Sl_No=b.Sl_No where sf_code='" + sf_code + "' and a.Division_Code='" + division_code + "'  and Leave_Type_Code='SL' and b.active_flag=0 and b.Trans_year='" + Trans_year + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;




        }
        public DataSet get_lop_days(string sf_code, string division_code, int Trans_year)
        {

            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select No_Of_Days,Leave_Balance_Days from Trans_Leave_Entitle_Details a inner join Trans_Leave_Entitle_Head b on a.Division_Code=b.Division_Code and a.Sl_No=b.Sl_No where sf_code='" + sf_code + "' and a.Division_Code='" + division_code + "'  and Leave_Type_Code='LOP' and b.active_flag=0 and b.Trans_year='" + Trans_year + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;




        }
        public string RecordHeadAdd_Leave_Entitle(string sf_code, string division_code, string transYear, string sf_emp_id)
        {
            int iReturn = -1;
            string strSfCode = string.Empty;
            DB_EReporting db = new DB_EReporting();

            try
            {
                //int Division_Code = -1;

                //strQry = "select division_code from Mas_Salesforce_AM where Sf_Code = '" + sf_code + "' ";
                //Division_Code = db.Exec_Scalar(strQry);
                //strQry = "SELECT ISNULL(MAX(sf_Sl_No),0)+1 FROM mas_salesforce WHERE Sf_Code !='admin'";
                //sf_sl_no = db.Exec_Scalar(strQry);

                //int transSlNo = this.RecordExist_Leave_Entitle(sf_code, Convert.ToString(Division_Code), transYear);
                //if (transSlNo > 0)
                //{
                //    this.RecordDelete_Leave_Entitle_Details(Convert.ToString(transSlNo));
                //    this.RecordDelete_Leave_Entitle_Head(Convert.ToString(transSlNo));
                //}

                //else
                //{

                strQry = " INSERT INTO [Trans_Leave_Entitle_Head]([sf_code] ,[Division_Code]  ,[Trans_Year] ,[Created_Date],sf_emp_id,active_flag) " +
                       " VALUES ( '" + sf_code + "' , '" + division_code + "', '" + transYear + "', getdate(),'" + sf_emp_id + "',0) ";

                iReturn = db.ExecQry(strQry);
                // }
            }
            catch (Exception ex)
            {
                throw ex;
            }

            if (iReturn > 0)
            {
                strQry = "SELECT MAX(Sl_No) FROM Trans_Leave_Entitle_Head";
                iReturn = db.Exec_Scalar(strQry);
            }
            return iReturn.ToString();
            //}
            //else
            //{
            //    return "Dup";
            //}

        }
        public string RecordDetailsAdd_Leave_Entitle(string TransSlNo, string sf_code, string leavetype, string noofdays, string divition_code)
        {
            int iReturn = -1;
            string strSfCode = string.Empty;
            DB_EReporting db = new DB_EReporting();

            try
            {
                //int Division_Code = -1;

                //strQry = "select division_code from Mas_Salesforce_AM where Sf_Code = '" + sf_code + "' ";
                //Division_Code = db.Exec_Scalar(strQry);

                strQry = " INSERT INTO [Trans_Leave_Entitle_Details]([Sl_No],[Leave_Type_Code],[No_Of_Days],[Division_Code],[Leave_Balance_Days]) " +
                          " VALUES ( '" + TransSlNo + "' , '" + leavetype + "', '" + noofdays + "', '" + divition_code + "','" + noofdays + "') ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            if (iReturn > 0)
            {
                return iReturn.ToString();
            }
            else
            {
                return "0";
            }
        }






        public DataSet get_leave_days(string sf_code, string division_code, string Leave_type, int cyear)
        {

            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select No_Of_Days from Trans_Leave_Entitle_Details a inner join Trans_Leave_Entitle_Head b on a.Division_Code=b.Division_Code and a.Sl_No=b.Sl_No where sf_code='" + sf_code + "' and a.Division_Code='" + division_code + "'  and a.Leave_Type_Code='" + Leave_type + "' and b.Trans_Year='" + cyear + "' ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;




        }
        public int RecordExist_Leave_Entitle(string sfCode, string divCode, string stryear)
        {

            int iTransSlNo = 0;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Select Sl_No from Trans_Leave_Entitle_Head WHERE sf_code = '" + sfCode + "' AND Division_Code='" + divCode + "' AND Trans_Year ='" + stryear + "' ";
                iTransSlNo = db.Exec_Scalar(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iTransSlNo;
        }
        public DataSet getDCR_Leave_utilitycount(string sf_code, string div_code, string cmonth, int cyear, int Leave_type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;
            if (cmonth.Contains(','))
            {
                cmonth = cmonth.Remove(cmonth.Length - 1);
            }

            strQry = " select count(distinct a.Activity_Date) Leave_Date From DCRMain_Trans a,mas_Leave_Form b " +
                    " where a.FieldWork_Indicator='L' and a.sf_code='" + sf_code + "' " +
                    " and a.Activity_Date between b.From_Date and b.To_Date and a.Sf_Code=b.sf_code " +
                    " and a.Division_Code=b.Division_Code  " +
                    " and MONTH(a.Activity_Date) in (" + cmonth + ")and YEAR(a.activity_date)='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Leave_Type='" + Leave_type + "' and b.Leave_Active_Flag=0 ";


            //strQry = "select (select count(distinct a.Activity_Date) Leave_Date From DCRMain_Trans a,mas_Leave_Form b " +
            //        " where a.FieldWork_Indicator='L' and a.sf_code='" + sf_code + "' " +
            //        " and a.Activity_Date between b.From_Date and b.To_Date and a.Sf_Code=b.sf_code " +
            //        " and a.Division_Code=b.Division_Code  " +
            //        " and MONTH(a.Activity_Date)='" + cmonth + "' and YEAR(a.activity_date)='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Leave_Type='" + Leave_type + "') , " +
            //        " (select count(a.Activity_Date) From DCRMain_Trans a " +
            //        " where a.FieldWork_Indicator='L' and a.sf_code='"+sf_code+"' " +
            //        " and month(a.Activity_Date)='"+cmonth+"' and Entry_Mode='Apps') ";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;
        }
        public int RecordDelete_Leave_Entitle_Details(string TransSlNo)
        {
            int iReturn = -1;
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "DELETE FROM Trans_Leave_Entitle_Details WHERE Sl_No = '" + TransSlNo + "' ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }
        public int RecordDelete_Leave_Entitle_Head(string TransSlNo)
        {
            int iReturn = -1;
            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "DELETE FROM Trans_Leave_Entitle_Head WHERE Sl_No = '" + TransSlNo + "' ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }

        public DataSet getDrcnt_VcantMr(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC VacantMr_ManagerVisit '" + sf_code + "','" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDrcnt_VcantMr_Desig(int month, int year, string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Vacunt_Mr_Drs_To_Mgr " + month + "," + year + "," + divcode + ",'" + sf_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Get_Remarks(string sf_code, string iday, int imonth, int iyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;



            //strQry = "select COUNT(UnListedDrCode) from Mas_UnListedDr  " +
            //         " where UnListedDr_Active_Flag=0 and Territory_Code = '" + Territory_Code + "' " +
            //         " and Doc_Cat_Code = '" + cat_code + "' ";

            strQry = " select Remarks from dcrmain_trans where  Sf_Code='" + sf_code + "' and MONTH(Activity_Date)=" + imonth + " " +
                    " and YEAR(Activity_Date)=" + iyear + " and day(Activity_Date) = '" + iday + "'";



            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return dsSF;
        }

        public DataSet sp_get_Consolidate_Not_Submit_Days(string sf_code, string divcode, string iMonth, string iYear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Consolidate_Not_Submit_Days '" + sf_code + "', '" + divcode + ',' + "','" + iMonth + "','" + iYear + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet CheckSFNameVacant_DCR_View(string sf_code, int cmon, int cyr, string Date)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC sp_get_sf_name_between_dates_Dcr_View '" + sf_code + "', " + cmon + "," + cyr + "," + Date + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;

        }

        public DataSet getDesignation_forLeave(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDesignation = null;
            strQry = " select Designation_Code,Designation_Short_Name from Mas_SF_Designation where " +
                    " Division_Code='" + div_code + "' and Designation_Active_Flag=0 ";
            try
            {
                dsDesignation = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDesignation;
        }

        public DataSet ViewDetails_Feedback_new(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            dsSF = null;
            strQry = "EXEC ViewDetails_Feedback_new '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_TP_Delete(string divcode, string Tour_Month, string Tour_Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_TP_Delete_New '" + Tour_Month + "', '" + Tour_Year + "','" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
       
        public DataSet sp_SalesForceMrGet(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMrGet '" + divcode + "', '" + sf_code + "'  ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getTP_Deviation_MGR(string divcode, string sf_code, int Month, int Year, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            //strQry = "EXEC sp_TP_Deviation '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "' ,'" + type + "'";

            strQry = "EXEC TP_DeviationNew_MGR '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataSet getTP_Deviation_At_glance(string divcode, string sf_code, int Month, int Year, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            strQry = "EXEC sp_TP_Deviation '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "' ,'" + type + "'";

            // strQry = "EXEC TP_DeviationNew '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataTable getUserListReportingTo_WithVacant(string div_code, string sf_code, int order_id)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName,a.sf_emp_id   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status !=2  and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (sf_code != "admin")
                    {
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();

                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dt.Rows.Add(dr);
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName,a.sf_emp_id   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE a.SF_Status!=2 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {

                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                        dr["sf_Type"] = drFF["sf_Type"].ToString();
                        dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                        dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                        dr["sf_hq"] = drFF["sf_hq"].ToString();
                        dr["sf_password"] = drFF["sf_password"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                        dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                        dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                        dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getUserListReportingTo_WithVacant(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        public DataSet get_Mr_List(string div_code, string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT a.sf_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF " +
                     " , a.sf_Type,convert(char(10),Sf_Joining_Date,105)Sf_Joining_Date " +
                     " FROM mas_salesforce a WHERE a.SF_Status != 2 and (Division_Code like '" + div_code + ',' + "%'  or  Division_Code like '%" + ',' + div_code + ',' + "%' ) and a.sf_code !='admin' and a.sf_type=1 and Reporting_To_SF='" + sfcode + "' " +
                     " order by 2 ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sf_Name_Mgr(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Reporting_To_MGR_Upp '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getEmp_code(string empcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code FROM Mas_Salesforce " +
                     " WHERE sf_emp_id= '" + empcode + "' and (Division_Code like '" + div_code + ',' + "%'  or  Division_Code like '%" + ',' + div_code + ',' + "%' ) ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_get_Join_Left_Details(string Frm_Month, string To_Month, string Frm_Year, string To_Year, string Div_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC SP_Join_Left_Details '" + Frm_Month + "', '" + To_Month + "','" + Frm_Year + "','" + To_Year + "','" + Div_Code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_get_Left_Details(string Frm_Month, string To_Month, string Frm_Year, string To_Year, string Div_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC SP_Left_Details '" + Frm_Month + "', '" + To_Month + "','" + Frm_Year + "','" + To_Year + "','" + Div_Code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        #region Get mail MR Joint Work New
        public DataTable getMail_MRJointWork_New(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable DJW = new DataTable();

            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("Sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(int)));
                //dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("State_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("subdivision_code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(int)));


            }
            DataSet dsmgr = null;

            if (order_id == 0)
            {
                strQry = " SELECT  cast(HO_ID as varchar) as Sf_Code, cast(HO_ID as varchar)+'-Level1' as sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,0  sf_type,'-Level1' as sf_color, '' des_color ,0 Designation_Code,0 State_Code,'' subdivision_code from Mas_HO_ID_Creation" +
                         " Where (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "') ";

                dsmgr = db_ER.Exec_DataSet(strQry);

                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_mail"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dr["Designation_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                    //dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                    dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                    dr["sf_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                    dr["des_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                    dr["State_Code"] = dsmgr.Tables[0].Rows[0]["State_Code"].ToString();
                    dr["subdivision_code"] = dsmgr.Tables[0].Rows[0]["subdivision_code"].ToString();
                    dr["sf_type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();

                    dt.Rows.Add(dr);
                }

            }

            strQry = " Select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() != "admin")
                    {
                        // Check if the Sf-Code has any Audit Manager.
                        DataSet dsAudit = CheckforAudit(dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                        if (dsAudit.Tables[0].Rows.Count > 0)
                        {
                            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.State_Code,,replace(a.subdivision_code,',','') subdivision_code" +
                                        " from Mas_Salesforce  a, Mas_SF_Designation b    Where a.Designation_Code=b.Designation_Code and" +
                                        " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                         " and a.sf_code = '" + dsAudit.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";


                            DataSet dsMgr2 = db_ER.Exec_DataSet(strQry);

                            if (dsMgr2.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                order_id = order_id + 1;
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                dr["sf_mail"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                dr["sf_Name"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Designation_Short_Name"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Designation_Code"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                //dr["Reporting_To_SF"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                dr["Sf_HQ"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                dr["sf_color"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                dr["des_color"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                dr["State_Code"] = dsMgr2.Tables[0].Rows[0]["State_Code"].ToString();
                                dr["subdivision_code"] = dsMgr2.Tables[0].Rows[0]["subdivision_code"].ToString();
                                dr["sf_type"] = dsMgr2.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();

                                dt.Rows.Add(dr);
                            }
                        }

                        strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code" +
                                        " from Mas_Salesforce  a, Mas_SF_Designation b    Where a.Designation_Code=b.Designation_Code and" +
                                        " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                         " and a.sf_code = '" + dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";



                        DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsMgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            order_id = order_id + 1;
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_mail"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["sf_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Designation_Short_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Designation_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            //dr["Reporting_To_SF"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Sf_HQ"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["sf_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["des_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["State_Code"] = dsMgr1.Tables[0].Rows[0]["State_Code"].ToString();
                            dr["subdivision_code"] = dsMgr1.Tables[0].Rows[0]["subdivision_code"].ToString();
                            dr["sf_type"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dt.Rows.Add(dr);

                            DJW = getMail_MRJointWork_New(div_code, dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        #endregion


        #region Get Address Book with HO_ID
        public DataTable getAddressBookMgr_New(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("State_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("subdivision_code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(int)));

                DataSet dsmgr = null;


                strQry = " SELECT  cast(HO_ID as varchar) AS Sf_Code, cast(HO_ID as varchar)+'-Level1' as sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,'' sf_type,'-Level1' as sf_color, '' des_color ,'' Designation_Code,0 State_Code,''subdivision_code from Mas_HO_ID_Creation" +
                         " Where HO_Active_Flag=0 and (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "')  " +
                         " UNION " +
                         " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code" +
                         " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {
                        foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                        {

                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_mail"] = drFF["sf_mail"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                            dr["sf_color"] = drFF["Sf_HQ"].ToString();
                            dr["des_color"] = drFF["des_color"].ToString();
                            dr["State_Code"] = drFF["State_Code"].ToString();
                            dr["subdivision_code"] = drFF["subdivision_code"].ToString();
                            dr["sf_type"] = drFF["sf_type"].ToString();
                            dt.Rows.Add(dr);
                            order_id = order_id + 1;
                        }
                    }
                    foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                    {
                        DataSet dsAudit = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (dsAudit.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow drFF1 in dsAudit.Tables[0].Rows)
                            {
                                strQry = " select a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name,a.Reporting_To_SF,a.Sf_HQ,a.sf_type,'-Level1' as sf_color, " +
                                        " b.Desig_Color as des_color ,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code from Mas_Salesforce a,Mas_SF_Designation b " + // SM Level
                                        " WHERE a.SF_Status!=2  and a.Designation_Code=b.Designation_Code and  " +
                                        " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                        " and a.sf_code = '" + drFF1["sf_code"].ToString() + "'";

                                DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);

                                if (dsMgr1.Tables[0].Rows.Count > 0)
                                {
                                    dr = dt.NewRow();
                                    order_id = order_id + 1;
                                    dr["order_id"] = order_id;
                                    dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                    dr["sf_mail"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                    dr["sf_name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                    dr["Designation_Short_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                    dr["Reporting_To_SF"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                    dr["Sf_HQ"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                    dr["sf_type"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                    dr["sf_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                    dr["des_color"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                    dr["State_Code"] = dsMgr1.Tables[0].Rows[0]["State_Code"].ToString();
                                    dr["subdivision_code"] = dsMgr1.Tables[0].Rows[0]["subdivision_code"].ToString();
                                    dr["Designation_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                    dt.Rows.Add(dr);
                                }
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;

            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.State_Code,replace(a.subdivision_code,',','') subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                     " WHERE a.SF_Status!=2 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "'and a.Designation_Code=b.Designation_Code  ORDER BY sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_mail"] = drFF["sf_mail"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["sf_color"] = drFF["Sf_HQ"].ToString();
                        dr["des_color"] = drFF["des_color"].ToString();
                        dr["State_Code"] = drFF["State_Code"].ToString();
                        dr["subdivision_code"] = drFF["subdivision_code"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getAddressBookMgr_New(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        #endregion

        #region Get Audit Manager Team Mail New
        public DataTable getAuditManagerTeam_mail_New(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsmgr = null;
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("State_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("subdivision_code", typeof(string)));

                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_HQ", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_type", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("State_Code", typeof(string)));
                dt_recursive_Aud.Columns.Add(new DataColumn("subdivision_code", typeof(string)));

                strQry = " SELECT cast(HO_ID as varchar) as Sf_Code, cast(HO_ID as varchar)+'-Level1' as sf_mail,Name as sf_name,'admin' Designation_Short_Name, 'ZZZ' Reporting_To_SF, '' Sf_HQ,'' sf_type,'-Level1' as sf_color, '' des_color ,'' Designation_Code,'' Sf_Joining_Date,'' State_Code,'' subdivision_code from Mas_HO_ID_Creation" +
                         " Where HO_Active_Flag=0 and (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%' or Division_Code like '" + div_code + "') " +
                         " UNION " +
                         " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code,a.Sf_Joining_Date,a.State_Code,a.subdivision_code" +
                         " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.Sf_Joining_Date,a.State_Code,a.subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.Sf_Joining_Date,a.State_Code,a.subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code,a.Sf_Joining_Date,a.State_Code,a.subdivision_code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                dsmgr = db_ER.Exec_DataSet(strQry);
                foreach (DataRow dataRow in dsmgr.Tables[0].Rows)
                {
                    dr = dt.NewRow();

                    dr["sf_Code"] = dataRow["sf_Code"].ToString();
                    dr["sf_mail"] = dataRow["sf_mail"].ToString();
                    dr["sf_Name"] = dataRow["sf_Name"].ToString();
                    dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                    dr["Reporting_To_SF"] = dataRow["Reporting_To_SF"].ToString();
                    dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                    dr["sf_Type"] = dataRow["sf_Type"].ToString();
                    dr["sf_color"] = dataRow["sf_color"].ToString();
                    dr["des_color"] = dataRow["des_color"].ToString();
                    dr["Designation_Code"] = dataRow["Designation_Code"].ToString();
                    dr["Sf_Joining_Date"] = dataRow["Sf_Joining_Date"].ToString();
                    dr["State_Code"] = dataRow["State_Code"].ToString();
                    dr["subdivision_code"] = dataRow["subdivision_code"].ToString();
                    dt.Rows.Add(dr);
                }

            }

            DataSet dsAtm = getAuditTeam(sf_code, div_code);
            if (dsAtm.Tables[0].Rows.Count > 0)
            {
                string AuditMgr = dsAtm.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                string[] Audit;
                Audit = AuditMgr.Split(',');
                foreach (string Au_cd in Audit)
                {
                    if (Au_cd.Length > 0)
                    {
                        strQry = " SELECT a.sf_Code,a.sf_Code+'-Level1' as sf_mail,a.Sf_Name , " +
                            " b.Designation_Short_Name,a.Reporting_To_SF,a.Sf_HQ,a.sf_Type,'-Level1' as sf_color,b.Desig_Color as des_color," +
                            " a.Designation_Code,a.Sf_Joining_Date,a.State_Code,a.subdivision_code FROM mas_salesforce a, Mas_SF_Designation b " +
                            " WHERE a.SF_Status!=2 and  " +
                            " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                            " and a.sf_code = '" + Au_cd + "' and a.Designation_Code=b.Designation_Code ORDER BY a.sf_type";
                        try
                        {
                            dsmgr = db_ER.Exec_DataSet(strQry);

                            if (dsmgr.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                order_id = order_id + 1;

                                //dr["order_id"] = order_id;
                                dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                dr["sf_mail"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                dr["Sf_HQ"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                dr["sf_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                dr["des_color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                dr["Designation_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                dr["State_Code"] = dsmgr.Tables[0].Rows[0]["State_Code"].ToString();
                                dr["subdivision_code"] = dsmgr.Tables[0].Rows[0]["subdivision_code"].ToString();

                                dt.Rows.Add(dr);

                                dt_recursive = getAuditTeamMGRRep_Mail(div_code, dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), 0);
                                if (dt_recursive != null)
                                {
                                    if (dt_recursive.Rows.Count > 0)
                                    {
                                        foreach (DataRow dataRow in dt_recursive.Rows)
                                        {
                                            dr = dt.NewRow();
                                            //order_id = order_id + 1;
                                            //dr["order_id"] = order_id;
                                            dr["sf_Code"] = dataRow["sf_Code"].ToString();
                                            dr["sf_mail"] = dataRow["sf_mail"].ToString();
                                            dr["sf_Name"] = dataRow["sf_Name"].ToString();
                                            dr["sf_Type"] = dataRow["sf_Type"].ToString();
                                            dr["Designation_Short_Name"] = dataRow["Designation_Short_Name"].ToString();
                                            dr["Reporting_To_SF"] = dataRow["Reporting_To_SF"].ToString();
                                            dr["Sf_HQ"] = dataRow["Sf_HQ"].ToString();
                                            dr["sf_color"] = dataRow["sf_color"].ToString();
                                            dr["des_color"] = dataRow["des_color"].ToString();
                                            dr["Designation_Code"] = dataRow["Designation_Code"].ToString();
                                            dr["Sf_Joining_Date"] = dataRow["Sf_Joining_Date"].ToString();
                                            dr["State_Code"] = dataRow["State_Code"].ToString();
                                            dr["subdivision_code"] = dataRow["subdivision_code"].ToString();
                                            dt.Rows.Add(dr);
                                        }
                                    }
                                }
                            }

                        }
                        catch (Exception ex)
                        {
                            throw ex;
                        }
                    }
                }
            }
            return dt;
        }
        //
        #endregion

        public DataSet sp_get_Rep_access_All_User(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_access_All_User '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet doctorbusentry_value(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select SUM(value) from Trans_DCR_BusinessEntry_Details a inner join Trans_DCR_BusinessEntry_Head b on b.Trans_sl_No=a.Trans_sl_No and a.Division_Code=b.Division_Code where b.Trans_Month='" + cmonth + "' and b.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }

        public DataSet getTerr_TypeDrCnt(string divcode, string sf_code, int Month, int Year, string type, string mode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            strQry = "EXEC getTerr_TypeDrCnt '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "','" + mode + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }
        public DataSet getTerr_TypeDrCnt_new(string divcode, string sf_code, int Month, int Year, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;



            strQry = "EXEC getTerr_TypeDrCnt_New '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataSet GetfullSalesforce_New(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;


            //strQry = "  SELECT a.SF_Code, a.Sf_Name, a.Sf_UserName, " +
            //         "  (select UsrDfd_UserName from Mas_Salesforce where sf_code=a.sf_code) +'- '+ " +
            //         "  (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To ," +
            //         "  a.sf_type as Type, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
            //          " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
            //          " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
            //          " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and  " +
            //          " SF_Status=0  AND lower(sf_code) != 'admin' AND a.sf_Tp_Active_flag = 0 " +
            //          " ORDER BY Sf_Name";

            strQry = " EXEC GetSalesforce1 '" + divcode + "' ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int DeActivate_UsrName(string sf_code, string div_code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                DataSet DsSal = null;

                strQry = "Select UsrDfd_UserName from Mas_Salesforce where Division_Code='" + div_code + ",' and sf_code='" + sf_code + "'";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {
                    strQry = "UPDATE Mas_Salesforce " +
                             " SET UsrDfd_UserName = '" + DsSal.Tables[0].Rows[0][0].ToString() + "DD' , " +
                             " LastUpdt_Date = getdate() " +
                             " WHERE sf_code = '" + sf_code + "' and Division_Code='" + div_code + ",' ";

                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public DataSet GetSalesforce_vaclist(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "EXEC GetSalesforce_vaclist '" + divcode + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet GetSalesforce_Blocklist(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "EXEC GetSalesforce_Blocklist '" + divcode + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getOnlyBaselevel_NewPro(string divcode, string type)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "EXEC GetSalesforce_baseToMgr '" + divcode + "','" + type + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public int PermanentDeact_Sales(string Sf_Code)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce where SF_Code='" + Sf_Code + "' ";
                iReturn_Backup = db.ExecQry(strQry);

                strQry = "Update Mas_Salesforce " +
                         "SET Sf_Deactivate_Permanent = 1 , " +
                         "LastUpdt_Date = getdate() " +
                         "WHERE Sf_Code ='" + Sf_Code + "'";

                iReturn = db.ExecQry(strQry);

                strQry = "Insert into Mas_Salesforce_Backup select * from Mas_Salesforce where SF_Code='" + Sf_Code + "' ";
                iReturn_Backup = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        public DataSet getSfCode_Upload(string sfcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code FROM  Mas_Salesforce " +
                     " WHERE UsrDfd_UserName= '" + sfcode + "' and  (Division_Code like '" + div_code + ',' + "%'  or  Division_Code like '%" + ',' + div_code + ',' + "%' ) ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet SalesForceList_MR_ALL_Sfc(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_Sfc  '" + sf_code + "' , '" + divcode + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet SalesForceList_Allow(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceGet_MR_Allw '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        #region Get Address Book Without Admin New
        public DataTable getAddressBookWithoutAdmin_New(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_mail", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_color", typeof(string)));
                dt.Columns.Add(new DataColumn("des_color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_type", typeof(string)));

                DataSet dsmgr = null;


                strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color ,b.Designation_Code" +
                         " from Mas_Salesforce  a, Mas_SF_Designation b    " + // AM Level
                             " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') " +
                             " UNION" +
                            " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " ( select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                            " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce  where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "'))) " +
                             " UNION " +
                              " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Reporting_To_SF, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                              " where a.Designation_Code=b.Designation_Code and a.Sf_Code !='admin' and a.Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF  from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code in " +
                             " (select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "') ) ) ) order by Reporting_To_SF Desc ";

                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {
                        foreach (DataRow drFF in dsmgr.Tables[0].Rows)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_mail"] = drFF["sf_mail"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                            dr["sf_color"] = drFF["Sf_HQ"].ToString();
                            dr["des_color"] = drFF["des_color"].ToString();
                            dr["sf_type"] = drFF["sf_type"].ToString();
                            dt.Rows.Add(dr);
                            order_id = order_id + 1;
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;

            strQry = " SELECT  a.Sf_Code,a.Sf_Code+'-Level1' as sf_mail,a.sf_name,b.Designation_Short_Name, a.Sf_HQ,a.sf_type,'-Level1' as sf_color, b.Desig_Color as des_color,b.Designation_Code" +
                      " from Mas_Salesforce  a, Mas_SF_Designation b    " +
                     " WHERE a.SF_Status=0 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "'and a.Designation_Code=b.Designation_Code  ORDER BY sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        order_id = order_id + 1;
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = drFF["sf_code"].ToString();
                        dr["sf_mail"] = drFF["sf_mail"].ToString();
                        dr["sf_Name"] = drFF["sf_Name"].ToString();
                        dr["Designation_Code"] = drFF["Designation_Code"].ToString();
                        dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                        dr["Sf_HQ"] = drFF["Sf_HQ"].ToString();
                        dr["sf_color"] = drFF["Sf_HQ"].ToString();
                        dr["des_color"] = drFF["des_color"].ToString();
                        dr["sf_type"] = drFF["sf_type"].ToString();
                        dt.Rows.Add(dr);

                        dt_recursive = getAddressBookMgr_New(div_code, drFF["sf_code"].ToString(), order_id);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }
        #endregion


        public DataSet sp_UserList_MGR_SFC(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_MGR_SFC '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataTable sp_UserList_HOID(string Division_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            strQry = "EXEC sp_UserList_HOID '" + Division_Code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet SalesForceListMgrGet_Mail(string divcode, string sf_code, string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet_Mail '" + divcode + "', '" + sf_code + "','" + HO_ID + "'    ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Hierarchy_Team(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Hierarchy_Team '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSales_SampleNames()
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;

            strQry = "select 'Search the Fieldforce for' as search ,'EDIT' as search2 ,'VACANT' search3,'BLOCK' as search4,  'DEACTIVATE' as search5 ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int RecordUpdate_inline(string sf_code, string sf_name, int state, string hq, string sf_design, string desig_short_name)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = "EXEC salesforce_inline '" + sf_code + "','" + sf_name + "','" + state + "','" + hq + "','" + sf_design + "','" + desig_short_name + "' ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public DataSet Sample_Status_New(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Sample_Status_New '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Sample_Status_New_Product(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Sample_Status_New_Product '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Input_Status_New(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Input_Status_New '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Sample_Status_New_gift(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Input_Status_New_GIft '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet untagGeodrs(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select distinct cust_code,Listeddrcode,listeddr_name,sf_name+'-'+sf_Designation_Short_Name+'-'+sf_hq sf_name,Doc_Spec_ShortName,lat,long,MapId from map_GEO_Customers M inner join mas_listeddr DR on M.cust_code=DR.ListedDrCode inner join mas_salesforce SF on SF.sf_code=DR.sf_code where DR.ListedDr_Active_Flag=0  and M.division_code='" + divcode + "' and DR.sf_code='" + sf_code + "' order by listeddr_name,Listeddrcode";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserList_Hierarchy_StateCode(string divcode, string sf_code, string StateCode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Hierarchy_StateCode '" + divcode + "', '" + sf_code + "','" + StateCode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataTable getMonth_Day(string month)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            strQry = "EXEC Month_date '" + month + "'";

            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sp_Get_DCRCount_StateWise(string divcode, string iMonth, string iYear, string strVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            if (divcode.Contains(','))
            {
                divcode = divcode.Remove(divcode.Length - 1);
            }


            strQry = "EXEC sp_Get_DCRCount_StateWise  '" + iMonth + "','" + iYear + "','" + divcode + "','" + strVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sp_Get_DCRCount_StateWise_View(string divcode, string iMonth, string iYear, string StateCode, string strVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            // strQry = "EXEC sp_get_Rep_audit_with_Vacant '" + sf_code + "', '" + divcode + "' ";

            strQry = "EXEC sp_Get_DCRCount_StateWise_View  '" + iMonth + "','" + iYear + "','" + divcode + "','" + StateCode + "','" + strVacant + "'  ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getMR_Doc_List(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " SELECT  Sf_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name, sf_type, sf_Designation_Short_Name, Sf_HQ, Division_Code " +
                    " FROM mas_salesforce WHERE Sf_Code  = '" + sf_code + "' and (Division_Code like  '%" + divcode + ",%' or Division_Code like '%," + divcode + ",%') and SF_Status !=2 ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_Get_DCRCount_StateWise_View_Missing_Name(string divcode, string iMonth, string iYear, string StateCode, string strVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            // strQry = "EXEC sp_get_Rep_audit_with_Vacant '" + sf_code + "', '" + divcode + "' ";

            strQry = "EXEC sp_Get_DCRCount_StateWise_ViewMissingName  '" + iMonth + "','" + iYear + "','" + divcode + "','" + StateCode + "','" + strVacant + "'  ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet docbusvaluewiseentry_busvalue(string sf_code, string div_code, int cmonth, int cyear, string cdate)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            //strQry = "select SUM(Business_Value) from Trans_Dr_Business_Valuewise_Detail a inner join Trans_Dr_Business_Valuewise_Head b on b.Trans_Sl_No=a.Trans_Sl_No and a.Division_Code=b.Division_Code where b.Trans_Month='" + cmonth + "' and b.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and b.Sf_Code='" + sf_code + "'";

            strQry = "select SUM(a.Business_Value) from Trans_Dr_Business_Valuewise_Head a where a.Trans_Month='" + cmonth + "' and a.Trans_Year='" + cyear + "' and a.Division_Code='" + div_code + "' and a.Sf_Code='" + sf_code + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }

        public DataSet getSalesForce_DeleteId(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "  SELECT a.SF_Code, a.Sf_Name , a.Sf_UserName,sf_Tp_Active_flag, a.Sf_HQ, case when a.sf_Type = 1  THEN 'Medical Rep' ELSE 'Manager' END as sf_Type," +
                      " b.StateName,c.Designation_Short_Name as Designation_Name, a.State_Code as state_code,(select count(ListedDrCode) from mas_listeddr where ListedDr_Active_Flag=0 and sf_code=a.sf_code ) Dr_Count from mas_salesforce a join mas_state b  on  a.State_Code=b.State_Code " +
                      " join Mas_SF_Designation c on a.Designation_Code = c.Designation_Code " +
                      " WHERE (a.Division_Code like '" + divcode + ',' + "%' or  a.Division_Code like '%" + ',' + divcode + ',' + "%') and " +
                      " SF_Status= 2 and Sf_Deactivate_Permanent=1  AND lower(sf_code) != 'admin' " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet getvacant_id_only(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "select sf_Block_ID,sf_code,sf_name,sf_block_flag,sf_block_reason, " +
                    "convert(varchar,sf_block_start_date,103) as sf_block_start_date,convert(varchar,sf_block_end_date,103) as sf_block_end_date,sf_hq,sf_emp_id,sf_designation_short_name,Reporting_ManagerName " +
                    " from Mas_SF_Block where division_code='" + divcode + "' and status='H' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getblock_id_only(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " select sf_Block_ID,sf_code,sf_name,sf_block_flag,sf_block_reason, " +
                       " convert(varchar,sf_block_start_date,103) as sf_block_start_date,convert(varchar,sf_block_end_date,103) as sf_block_end_date,sf_hq,sf_emp_id,sf_designation_short_name,Reporting_ManagerName " +
                       " from Mas_SF_Block where division_code='" + divcode + "' and status='B' ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataTable SalesForce_State_Get_SS_Dt(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataTable dsSF = null;
            strQry = "EXEC SS_State_Filter '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataTable(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet SalesForce_State_Get_SS(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC SS_State_Filter '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet CallAvergeVacant(string divcode, string sf_code, string strVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_CallAverge_Vacant '" + divcode + "', '" + sf_code + "','" + strVacant + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet fill_baselevel_forDeviceId(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;

            strQry = "  SELECT SF_Code, Sf_Name, sf_Designation_Short_Name,sf_hq,sf_emp_id from mas_salesforce where " +
                     " (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%')  and sf_status=0 and sf_TP_Active_Flag=0 and sf_code='" + sf_code + "' " +
                      " ORDER BY Sf_Name";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public int Update_deviceid_delete(string sf_code)
        {
            int iReturn = -1;
            DataSet dsDelay;

            try
            {

                DB_EReporting db = new DB_EReporting();

                strQry = " update access_table set app_device_id='',Device_Id=0  where Sf_Code='" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public DataSet UserList_Hierarchy_With_Vacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_TP_Hierarchy_WithVacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet Hirarchy_UserList_All(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Hirarchy_User_Latest '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet GetMr_Det(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " select sf_name,sf_hq,sf_Designation_Short_Name,sf_emp_id,division_name,st.statename " +
                     " from mas_salesforce s, mas_division d, mas_state st where  " +
                     " sf_code='" + sf_code + "' and s.state_code=st.state_code and  d.division_code='" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfCode_Second_Level(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code,Sf_Name + ' - '+ sf_Designation_Short_Name + ' - ' + Sf_HQ as Sf_Name, sf_hq from mas_sf_designation d,mas_salesforce s " +
                     " where d.division_code='" + div_code + "' and  (report_level <= 2 and report_level != 0) and Designation_Active_Flag=0 and s.Designation_Code=d.Designation_Code ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public int check_vac_ex(string sf_code)
        {

            int iReturn = -1;
            int iRecordExist;

            var today = DateTime.Today;
            var month = new DateTime(today.Year, today.Month, 1);
            var first = month.AddMonths(-1);
            var last_month_date = month.AddDays(-1);

            int last_month = last_month_date.Month;
            int last_month_year = last_month_date.Year;

            DateTime dt = DateTime.Now;
            int curr_month = dt.Month;
            int curr_year = dt.Year;
            DataSet dsdcr;
            int iretdcr = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                DCR dcr = new DCR();
                dsdcr = dcr.get_dcr_pending_approval_TransSl(sf_code);
                if (dsdcr.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drdcr in dsdcr.Tables[0].Rows)
                    {
                        iretdcr = dcr.Create_DCRHead_Trans(sf_code, drdcr["Trans_Slno"].ToString()); // Auto Approve all pending requests.
                    }
                }

                //strQry = " SELECT COUNT(trans_slno) FROM DCRMain_trans WHERE sf_code='" + sf_code + "' and month(activity_date)='" + last_month + "' and year(activity_date)='" + last_month_year + "' ";

                strQry = "  SELECT COUNT(trans_slno) FROM DCRMain_trans a , mas_salesforce b WHERE a.sf_code='" + sf_code + "' " +
                        " and month(activity_date)='" + last_month + "' and year(activity_date)='" + last_month_year + "' " +
                        " and sf_tp_dcr_active_dt<=activity_date and a.sf_code=b.sf_code ";
                iReturn = db.Exec_Scalar(strQry);

                if (iReturn > 0)
                {
                    strQry = " select count(sf_code) from trans_expense_head where expense_month='" + last_month + "' and expense_year='" + last_month_year + "' and sf_code='" + sf_code + "' and sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                    iReturn = db.Exec_Scalar(strQry);

                    if (iReturn == 0)
                    {
                        iReturn = 5;
                    }

                    else if (iReturn > 0)
                    {
                        //strQry = " SELECT COUNT(trans_slno) FROM DCRMain_trans WHERE sf_code='" + sf_code + "' and month(activity_date)='" + curr_month + "' and year(activity_date)='" + curr_year + "' ";

                        strQry = "  SELECT COUNT(trans_slno) FROM DCRMain_trans a , mas_salesforce b WHERE a.sf_code='" + sf_code + "' " +
                     " and month(activity_date)='" + curr_month + "' and year(activity_date)='" + curr_year + "' " +
                     " and sf_tp_dcr_active_dt<=activity_date and a.sf_code=b.sf_code ";

                        iReturn = db.Exec_Scalar(strQry);

                        if (iReturn > 0)
                        {
                            strQry = " select count(sf_code) from trans_expense_head where expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and sf_code='" + sf_code + "' and sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                            iReturn = db.Exec_Scalar(strQry);

                            //if (iReturn > 0)
                            //{
                            //    strQry = "UPDATE trans_expense_head set Resigned_Flag=2,DCR_end_date=(select dateadd(day,-1,last_dcr_date) last_dcr_date from mas_salesforce_dcrtpdate where sf_code='" + sf_code + "')  Where SF_Code='" + sf_code + "' and expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and Resigned_Flag is null and sl_no=(select max(sl_no) from trans_expense_head where expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and sf_code='" + sf_code + "' and resigned_flag is null) ";
                            //    iReturn = db.ExecQry(strQry);
                            //}

                            if (iReturn == 0)
                            {
                                iReturn = 6;
                            }
                            else
                            {
                                strQry = "update Trans_Expense_Head set resigned_flag=1 WHERE SF_Code='" + sf_code + "' and Expense_Month=" + curr_month + " and Expense_Year=" + curr_year + " and sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                                iReturn = db.ExecQry(strQry);

                            }

                        }
                    }

                }
                else
                {
                    //strQry = " SELECT COUNT(trans_slno) FROM DCRMain_trans WHERE sf_code='" + sf_code + "' and month(activity_date)='" + curr_month + "' and year(activity_date)='" + curr_year + "' ";


                    strQry = "  SELECT COUNT(trans_slno) FROM DCRMain_trans a , mas_salesforce b WHERE a.sf_code='" + sf_code + "' " +
                  " and month(activity_date)='" + curr_month + "' and year(activity_date)='" + curr_year + "' " +
                  " and sf_tp_dcr_active_dt<=activity_date and a.sf_code=b.sf_code ";
                    iReturn = db.Exec_Scalar(strQry);

                    if (iReturn > 0)
                    {
                        strQry = " select count(sf_code) from trans_expense_head where expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and sf_code='" + sf_code + "' and sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                        iReturn = db.Exec_Scalar(strQry);

                        //if (iReturn > 0)
                        //{
                        //    strQry = "UPDATE trans_expense_head set Resigned_Flag=2,DCR_end_date=(select dateadd(day,-1,last_dcr_date) last_dcr_date from mas_salesforce_dcrtpdate where sf_code='" + sf_code + "')  Where SF_Code='" + sf_code + "' and expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and Resigned_Flag is null and sl_no=(select max(sl_no) from trans_expense_head where expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and sf_code='" + sf_code + "' and resigned_flag is null) ";
                        //    iReturn = db.ExecQry(strQry);
                        //}

                        if (iReturn == 0)
                        {
                            iReturn = 6;
                        }
                        else
                        {
                            strQry = "update Trans_Expense_Head set resigned_flag=1 WHERE SF_Code='" + sf_code + "' and Expense_Month=" + curr_month + " and Expense_Year=" + curr_year + " and sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                            iReturn = db.ExecQry(strQry);

                        }
                    }


                }

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }
        public int RecordDetails_Leave_Entitle_Update(int TransSlNo, string sf_code, string leavetype, string noofdays, string divition_code, string type, int bal_days)
        {
            int iReturn = -1;
            string strSfCode = string.Empty;
            DB_EReporting db = new DB_EReporting();

            int balance_days;

            balance_days = Convert.ToInt16(noofdays) - bal_days;

            try
            {
                //int Division_Code = -1;

                //strQry = "select division_code from Mas_Salesforce_AM where Sf_Code = '" + sf_code + "' ";
                //Division_Code = db.Exec_Scalar(strQry);

                if (type == "1")
                {


                    strQry = " Update Trans_Leave_Entitle_Details set No_Of_Days='" + noofdays + "' " +
                             " where Division_Code='" + divition_code + "' and Leave_Type_Code='" + leavetype + "' and Sl_No='" + TransSlNo + "' ";

                    iReturn = db.ExecQry(strQry);
                }

                else if (type == "2")
                {

                    strQry = "select count(Leave_Type_Code) from Trans_Leave_Entitle_Details where Leave_Type_Code='" + leavetype + "' and Sl_No='" + TransSlNo + "' ";
                    iReturn = db.Exec_Scalar(strQry);

                    if (iReturn > 0)
                    {

                        strQry = " Update Trans_Leave_Entitle_Details set No_Of_Days='" + noofdays + "',Leave_Balance_Days='" + balance_days + "' " +
                                 " where Division_Code='" + divition_code + "' and Leave_Type_Code='" + leavetype + "' and Sl_No='" + TransSlNo + "' ";

                        iReturn = db.ExecQry(strQry);

                    }

                    else
                    {
                        strQry = " INSERT INTO [Trans_Leave_Entitle_Details]([Sl_No],[Leave_Type_Code],[No_Of_Days],[Division_Code],[Leave_Balance_Days]) " +
                         " VALUES ( '" + TransSlNo + "' , '" + leavetype + "', '" + noofdays + "', '" + divition_code + "','" + noofdays + "')";

                        iReturn = db.ExecQry(strQry);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public DataSet sp_UserList_leave_Entitlement_New(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC FieldSummary_AllFieldforce_NoVacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Leave_Sf_Emp_id(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " select sf_code, sf_emp_id, (select sf_code from mas_salesforce where sf_code=a.Reporting_To_SF) mgr_code, " +
                     " (select sf_emp_id from mas_salesforce where sf_code=a.Reporting_To_SF) mgr_emp_id,Sf_Name " +
                     " from mas_salesforce  a where sf_code='" + sf_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataTable getUserListReportingToNew_for_all_withvacant(string div_code, string sf_code, int order_id, string sf_type)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;

                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("Last_TP_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_TP_DCR_Active_Dt", typeof(string)));
                dt.Columns.Add(new DataColumn("Last_DCR_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("type", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Mobile", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_short_name", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Cat_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("Approved_By", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_DOW", typeof(string)));

                dt.Columns.Add(new DataColumn("Bank_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Bank_AcNo", typeof(string)));
                dt.Columns.Add(new DataColumn("IFS_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_DCRSample_Valid", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_DCRInput_Valid", typeof(string)));

                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName ,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt,  " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id,a.sf_Type as type, (select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code,a.Approved_By,case when SF_DOW='1900-01-01' then '' else convert(varchar,sf_Dow,103) end as SF_DOW " +
                     " ,Bank_Name,Bank_AcNo,IFS_Code,isnull(a.Sf_DCRSample_Valid,0)as Sf_DCRSample_Valid,isnull(a.Sf_DCRInput_Valid,0)as Sf_DCRInput_Valid " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status !=2 and   " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {

                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                        dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                        dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                        dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                        dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                        dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                        dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                        dr["sf_short_name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                        dr["SF_Cat_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                        dr["Approved_By"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(24).ToString();
                        dr["SF_DOW"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(25).ToString();

                        dr["Bank_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(26).ToString();
                        dr["Bank_AcNo"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(27).ToString();
                        dr["IFS_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(28).ToString();
                        dr["Sf_DCRSample_Valid"] = dsmgr.Tables[0].Rows[0]["Sf_DCRSample_Valid"].ToString();
                        dr["Sf_DCRInput_Valid"] = dsmgr.Tables[0].Rows[0]["Sf_DCRInput_Valid"].ToString();
                        dt.Rows.Add(dr);

                        if (sf_type == "3")
                        {
                            strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                      " FROM mas_ho_id_creation " +
                                       " WHERE HO_Active_flag = 0  and  " +
                                       "(Division_Code like '" + div_code + "%'  or " +
                                        "Division_Code like '%" + ',' + div_code + "%') and " +
                                       " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                            DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                            if (dsmgr1.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = "admin";
                                dr["sf_Name"] = "admin";
                                dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["sf_Type"] = "";
                                dr["Sf_Joining_Date"] = "";
                                dr["Reporting_To_SF"] = "";
                                dr["sf_hq"] = "";
                                dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Designation_Short_Name"] = "Admin";
                                dr["Desig_Color"] = "33ff96";
                                dr["sf_Tp_Active_flag"] = "";
                                dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Lst_drCount"] = "";
                                dr["StateName"] = "";
                                dr["Last_TP_Date"] = "";
                                dr["Sf_TP_DCR_Active_Dt"] = "";
                                dr["Last_DCR_Date"] = "";
                                dr["sf_emp_id"] = "";
                                dr["type"] = "";
                                dr["Reporting_To"] = "";
                                dr["Designation_Name"] = "";
                                dr["SF_Mobile"] = "";
                                dr["sf_short_name"] = "";
                                dr["SF_Cat_Code"] = "";
                                dr["Approved_By"] = "";
                                dr["SF_DOW"] = "";
                                dr["Bank_Name"] = "";
                                dr["Bank_AcNo"] = "";
                                dr["IFS_Code"] = "";
                                dr["Sf_DCRSample_Valid"] = "";
                                dr["Sf_DCRInput_Valid"] = "";
                                dt.Rows.Add(dr);
                            }
                        }
                        else
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                            dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                            dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                            dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                            dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                            dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                            dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                            dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                            dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                            dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                            dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                            dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                            dr["sf_short_name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                            dr["SF_Cat_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                            dr["Approved_By"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(24).ToString();
                            dr["SF_DOW"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(25).ToString();
                            dr["Bank_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(26).ToString();
                            dr["Bank_AcNo"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(27).ToString();
                            dr["IFS_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(28).ToString();
                            dr["Sf_DCRSample_Valid"] = dsmgr.Tables[0].Rows[0]["Sf_DCRSample_Valid"].ToString();
                            dr["Sf_DCRInput_Valid"] = dsmgr.Tables[0].Rows[0]["Sf_DCRInput_Valid"].ToString();
                            dt.Rows.Add(dr);
                        }

                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt, " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id ,a.sf_Type as type ,(select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code,a.Approved_By,case when SF_DOW='1900-01-01' then '' else convert(varchar,sf_Dow,103) end as SF_DOW " +
                     " ,a.Bank_Name,a.Bank_AcNo,a.IFS_Code,isnull(a.Sf_DCRSample_Valid,0)as Sf_DCRSample_Valid,isnull(a.Sf_DCRInput_Valid,0)as Sf_DCRInput_Valid " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status !=2 and   " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                        dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                        dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                        dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                        dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                                        dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                                        dr["Approved_By"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(24).ToString();
                                                        dr["SF_DOW"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(25).ToString();
                                                        dr["Bank_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(26).ToString();
                                                        dr["Bank_AcNo"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(27).ToString();
                                                        dr["IFS_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(28).ToString();
                                                        dr["Sf_DCRSample_Valid"] = dsA.Tables[0].Rows[0]["Sf_DCRSample_Valid"].ToString();
                                                        dr["Sf_DCRInput_Valid"] = dsA.Tables[0].Rows[0]["Sf_DCRInput_Valid"].ToString();
                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }

                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                                dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                                dr["Approved_By"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(24).ToString();
                                                dr["SF_DOW"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(25).ToString();

                                                dr["Bank_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(26).ToString();
                                                dr["Bank_AcNo"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(27).ToString();
                                                dr["IFS_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(28).ToString();
                                                dr["Sf_DCRSample_Valid"] = dsA.Tables[0].Rows[0]["Sf_DCRSample_Valid"].ToString();
                                                dr["Sf_DCRInput_Valid"] = dsA.Tables[0].Rows[0]["Sf_DCRInput_Valid"].ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr_withvacant(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                        dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                        dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                        dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                        dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                        dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                        dr["Approved_By"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(24).ToString();
                                        dr["SF_DOW"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(25).ToString();

                                        dr["Bank_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(26).ToString();
                                        dr["Bank_AcNo"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(27).ToString();
                                        dr["IFS_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(28).ToString();
                                        dr["Sf_DCRSample_Valid"] = dsA.Tables[0].Rows[0]["Sf_DCRSample_Valid"].ToString();
                                        dr["Sf_DCRInput_Valid"] = dsA.Tables[0].Rows[0]["Sf_DCRInput_Valid"].ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["Last_TP_Date"] = drFF["Last_TP_Date"].ToString();
                            dr["Sf_TP_DCR_Active_Dt"] = drFF["Sf_TP_DCR_Active_Dt"].ToString();
                            dr["Last_DCR_Date"] = drFF["Last_DCR_Date"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                            dr["type"] = drFF["type"].ToString();
                            dr["Reporting_To"] = drFF["Reporting_To"].ToString();
                            dr["Designation_Name"] = drFF["Designation_Name"].ToString();
                            dr["SF_Mobile"] = drFF["SF_Mobile"].ToString();
                            dr["sf_short_name"] = drFF["sf_short_name"].ToString();
                            dr["SF_Cat_Code"] = drFF["SF_Cat_Code"].ToString();
                            dr["Approved_By"] = drFF["Approved_By"].ToString();
                            dr["SF_DOW"] = drFF["SF_DOW"].ToString();
                            dr["Bank_Name"] = drFF["Bank_Name"].ToString();
                            dr["Bank_AcNo"] = drFF["Bank_AcNo"].ToString();
                            dr["IFS_Code"] = drFF["IFS_Code"].ToString();
                            dr["Sf_DCRSample_Valid"] = drFF["Sf_DCRSample_Valid"].ToString();
                            dr["Sf_DCRInput_Valid"] = drFF["Sf_DCRInput_Valid"].ToString();
                            dt.Rows.Add(dr);
                        }

                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToNew_for_all_withvacant(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataSet getAuditMgr_withvacant(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag ,a.UsrDfd_UserName , '' Lst_drCount, c.StateName,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt,  " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id ,a.sf_Type as type , (select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code,a.Approved_By,case when SF_DOW='1900-01-01' then '' else convert(varchar,sf_Dow,103) end as SF_DOW " +
                      " ,a.Bank_Name,a.Bank_AcNo,a.IFS_Code,isnull(a.Sf_DCRSample_Valid,0)as Sf_DCRSample_Valid,isnull(a.Sf_DCRInput_Valid,0)as Sf_DCRInput_Valid " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status !=2 and   " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet GetHq_Code_Target(string divcode, string Hq_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select sf_cat_code from mas_salesforce where  (Division_Code like '" + divcode + ',' + "%'  or " +
                     " Division_Code like '%" + ',' + divcode + ',' + "%') and sf_cat_code='" + Hq_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet MgrGet_MgrOnly(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Mgr_only '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet UserList_Mr_only(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC UserList_Mr '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getCategorytype_BulkEdit(string SF_Code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " SELECT sf_desgn FROM  Mas_Salesforce " +
                     " WHERE SF_Code='" + SF_Code + "' AND (Division_Code like '" + div_code + ',' + "%'  or " +
                      " Division_Code like '%" + ',' + div_code + ',' + "%') ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sp_UserMRLogin_With_Vacant_SFC(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC [sp_UserMRLogin_With_Vacant_SFC] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet AllFieldforce_withVacant_SFC(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC AllFieldforce_withVacant_SFC '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getFieldForce_Transfer_Emp(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = " SELECT '' as sf_code, '---Select the FieldForce---' as sf_name, '' as sf_username,'' as sf_HQ  " +
                   " UNION " +
                     "select sf_code, sf_name+' - '+b.Designation_Short_Name+' - '+ sf_HQ+' - '+sf_emp_id  sf_name, sf_username, sf_HQ " +
                     " from Mas_Salesforce a,Mas_SF_Designation b " +
                     " where Sf_Code !='admin' and (a.Division_Code like '" + div_code + ',' + "%'  or " +
                     " a.Division_Code like '%" + ',' + div_code + ',' + "%') " +
                     " and sf_type = 1 and a.Designation_Code=b.Designation_Code and sf_status<>2 " +
                     " order by sf_name ";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet get_tl_days(string sf_code, string division_code, int Trans_year)
        {

            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsAdmin = null;

            strQry = "select No_Of_Days,Leave_Balance_Days from Trans_Leave_Entitle_Details a inner join Trans_Leave_Entitle_Head b on a.Division_Code=b.Division_Code and a.Sl_No=b.Sl_No where sf_code='" + sf_code + "' and a.Division_Code='" + division_code + "'  and Leave_Type_Code='TL' and b.active_flag=0 and b.Trans_year='" + Trans_year + "'";

            try
            {
                dsAdmin = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsAdmin;

        }
        public DataSet getSfCode_HQ(string sfcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code,sf_emp_id,sf_hq FROM  Mas_Salesforce " +
                     " WHERE sf_code= '" + sfcode + "' and  (Division_Code like '" + div_code + ',' + "%'  or  Division_Code like '%" + ',' + div_code + ',' + "%' ) ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet AllMR_withNOVacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC [AllMR_withNOVacant] '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public int desig_chane_allowance(string sf_code, string sf_Name, string From_Des, string To_Des, string Reporting_To, string div_code, int Fieldforce_Type, string category)
        {
            int iReturn = -1;
            string empl_id = string.Empty;
            int sl_num;
            // DateTime Effe_Date = Convert.ToDateTime(Effective_Date.ToString());

            //  Effective_Date = Effe_Date.Month + "-" + Effe_Date.Day + "-" + Effe_Date.Year;

            try
            {

                DB_EReporting db = new DB_EReporting();


                DataSet DsSal = null;

                if (div_code.Contains(','))
                {
                    div_code = div_code.Remove(div_code.Length - 1);
                }

                string type_code = category + Fieldforce_Type;

                strQry = "select HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance,FareKm_Allowance,Range_of_Fare1,Range_of_Fare2, " +
                        " Effective_Form,Fixed_Column1,Fixed_Column2,Fixed_Column3,Fixed_Column4,Fixed_Column5,Meeting_Expenses " +
                        " from Mas_Desig_Allowance where division_code='" + div_code + "' and Designation_Code='" + To_Des + "' and Type_Code='" + type_code + "' ";

                DsSal = db.Exec_DataSet(strQry);

                if (DsSal.Tables[0].Rows.Count > 0)
                {
                    //strQry = " INSERT INTO Mas_Allowance_Fixation(sf_code,HQ_Allowance,EX_HQ_Allowance,OS_Allowance,Hill_Allowance,FareKm_Allowance,Range_of_Fare1,Range_of_Fare2, " +
                    //       " Effective_Form,Fixed_Column1,Fixed_Column2,Fixed_Column3,Fixed_Column4,Fixed_Column5,Meeting_Expenses,Designation_Code,sf_Designation_Short_Name,division_code) VALUES('" + sf_code + "','" + DsSal.Tables[0].Rows[0][0].ToString() + "', " +
                    //       " '" + DsSal.Tables[0].Rows[0][1].ToString() + "','" + DsSal.Tables[0].Rows[0][2].ToString() + "','" + DsSal.Tables[0].Rows[0][3].ToString() + "','" + DsSal.Tables[0].Rows[0][4].ToString() + "', " +
                    //       " '" + DsSal.Tables[0].Rows[0][5].ToString() + "','" + DsSal.Tables[0].Rows[0][6].ToString() + "','" + DsSal.Tables[0].Rows[0][7].ToString() + "','" + DsSal.Tables[0].Rows[0][8].ToString() + "', " +
                    //       " '" + DsSal.Tables[0].Rows[0][9].ToString() + "','" + DsSal.Tables[0].Rows[0][10].ToString() + "','" + DsSal.Tables[0].Rows[0][11].ToString() + "','" + DsSal.Tables[0].Rows[0][12].ToString() + "' ," +
                    //       " '" + DsSal.Tables[0].Rows[0][13].ToString() + "','" + desgn + "','" + des_sname + "','" + div_code + "')";



                    strQry = " update Mas_Allowance_Fixation set HQ_Allowance='" + DsSal.Tables[0].Rows[0][0].ToString() + "', " +
                           " EX_HQ_Allowance='" + DsSal.Tables[0].Rows[0][1].ToString() + "',OS_Allowance='" + DsSal.Tables[0].Rows[0][2].ToString() + "',Hill_Allowance='" + DsSal.Tables[0].Rows[0][3].ToString() + "',FareKm_Allowance='" + DsSal.Tables[0].Rows[0][4].ToString() + "',Range_of_Fare1='" + DsSal.Tables[0].Rows[0][5].ToString() + "',Range_of_Fare2='" + DsSal.Tables[0].Rows[0][6].ToString() + "', " +
                            " Effective_Form='" + DsSal.Tables[0].Rows[0][7].ToString() + "',Fixed_Column1='" + DsSal.Tables[0].Rows[0][8].ToString() + "',Fixed_Column2='" + DsSal.Tables[0].Rows[0][9].ToString() + "',Fixed_Column3='" + DsSal.Tables[0].Rows[0][10].ToString() + "',Fixed_Column4='" + DsSal.Tables[0].Rows[0][11].ToString() + "',Fixed_Column5='" + DsSal.Tables[0].Rows[0][12].ToString() + "', " +
                            " Meeting_Expenses='" + DsSal.Tables[0].Rows[0][13].ToString() + "',Designation_Code='" + To_Des + "',sf_Designation_Short_Name=(select sf_Designation_Short_Name from mas_salesforce where sf_code='" + sf_code + "' and Designation_Code='" + To_Des + "' ) where sf_code='" + sf_code + "' ";
                    //and  Designation_Code='" + From_Des + "' ";



                    iReturn = db.ExecQry(strQry);
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;

        }

        public DataSet getVacant_HoldManagersonly(string div_code, string designation_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;


            strQry = "SELECT '' as Sf_Code, '---Select---' as sf_name " +
                   " UNION " +
                   "select Sf_Code,sf_name + ' - ' + sf_Designation_Short_Name + ' - ' + Sf_HQ from Mas_salesforce where  Division_Code ='" + div_code + ",' " +
                   "   AND sf_type = 2 and sf_TP_Active_Flag =1 and SF_Status = 0 and SF_VacantBlock='H' and designation_code='" + designation_code + "' ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int RecordUpdate_AM_Hold(string Hold_sf_code, string Desgchange_sf_code)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();
                DB_EReporting db_ER = new DB_EReporting();

                DataSet dsSF = null;


                //strQry = "select sf_code from mas_salesforce where Reporting_To_SF='"+Desgchange_sf_code+"' ";
                //dsSF = db_ER.Exec_DataSet(strQry);

                strQry = " UPDATE Mas_Salesforce_AM " +
                         " SET DCR_AM = '" + Desgchange_sf_code + "', " +
                         " TP_AM = '" + Desgchange_sf_code + "', " +
                         // " LstDr_AM = '" + Lst_Dr + "', " +
                         " Leave_AM = '" + Desgchange_sf_code + "'," +
                         " SS_AM = '" + Desgchange_sf_code + "'," +
                         " Expense_AM = '" + Desgchange_sf_code + "'," +
                         " Otr_AM = '" + Desgchange_sf_code + "'" +
                         " WHERE sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' )";


                iReturn = db.ExecQry(strQry);

                strQry = "update mas_salesforce set Reporting_To_SF='" + Hold_sf_code + "' ,TP_Reporting_SF='" + Hold_sf_code + "' where sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' )";
                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int RecordUpdate_AM_Hold_Desg(string Hold_sf_code, string Desgchange_sf_code, string Designation_Code, string sf_Designation_Short_Name)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();
                DB_EReporting db_ER = new DB_EReporting();

                DataSet dsSF = null;


                strQry = "Update Mas_Salesforce set Designation_Code='" + Designation_Code + "',sf_Designation_Short_Name='" + sf_Designation_Short_Name + "' where sf_code='" + Hold_sf_code + "' ";
                iReturn = db.ExecQry(strQry);

                strQry = " UPDATE Mas_Salesforce_AM " +
                         " SET DCR_AM = '" + Desgchange_sf_code + "', " +
                         " TP_AM = '" + Desgchange_sf_code + "', " +
                         // " LstDr_AM = '" + Lst_Dr + "', " +
                         " Leave_AM = '" + Desgchange_sf_code + "'," +
                         " SS_AM = '" + Desgchange_sf_code + "'," +
                         " Expense_AM = '" + Desgchange_sf_code + "'," +
                         " Otr_AM = '" + Desgchange_sf_code + "'" +
                         " WHERE sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' )";


                iReturn = db.ExecQry(strQry);

                strQry = "update mas_salesforce set Reporting_To_SF='" + Hold_sf_code + "' ,TP_Reporting_SF='" + Hold_sf_code + "' where sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' )";
                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int RecordUpdate_AM_Hold_Depro(string Hold_sf_code, string Desgchange_sf_code, string DesgChange_Mgr)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();
                DB_EReporting db_ER = new DB_EReporting();

                DataSet dsSF = null;


                //strQry = "select sf_code from mas_salesforce where Reporting_To_SF='"+Desgchange_sf_code+"' ";
                //dsSF = db_ER.Exec_DataSet(strQry);

                strQry = " UPDATE Mas_Salesforce_AM " +
                         " SET DCR_AM = '" + DesgChange_Mgr + "', " +
                         " TP_AM = '" + DesgChange_Mgr + "', " +
                         // " LstDr_AM = '" + Lst_Dr + "', " +
                         " Leave_AM = '" + DesgChange_Mgr + "'," +
                         " SS_AM = '" + DesgChange_Mgr + "'," +
                         " Expense_AM = '" + DesgChange_Mgr + "'," +
                         " Otr_AM = '" + DesgChange_Mgr + "'" +
                         " WHERE sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' ) or sf_code ='" + Desgchange_sf_code + "' ";


                iReturn = db.ExecQry(strQry);

                strQry = "update mas_salesforce set Reporting_To_SF='" + Hold_sf_code + "' ,TP_Reporting_SF='" + Hold_sf_code + "' where sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' ) or sf_code ='" + Desgchange_sf_code + "'";
                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }

        public int RecordUpdate_AM_Hold_Desg_Depro(string Hold_sf_code, string Desgchange_sf_code, string Designation_Code, string sf_Designation_Short_Name, string DesgChange_Mgr)
        {
            int iReturn = -1;

            try
            {

                DB_EReporting db = new DB_EReporting();
                DB_EReporting db_ER = new DB_EReporting();

                DataSet dsSF = null;


                strQry = "Update Mas_Salesforce set Designation_Code='" + Designation_Code + "',sf_Designation_Short_Name='" + sf_Designation_Short_Name + "' where sf_code='" + Hold_sf_code + "' ";
                iReturn = db.ExecQry(strQry);

                strQry = " UPDATE Mas_Salesforce_AM " +
                         " SET DCR_AM = '" + DesgChange_Mgr + "', " +
                         " TP_AM = '" + DesgChange_Mgr + "', " +
                         // " LstDr_AM = '" + Lst_Dr + "', " +
                         " Leave_AM = '" + DesgChange_Mgr + "'," +
                         " SS_AM = '" + DesgChange_Mgr + "'," +
                         " Expense_AM = '" + DesgChange_Mgr + "'," +
                         " Otr_AM = '" + DesgChange_Mgr + "'" +
                         " WHERE sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' ) or sf_code ='" + Desgchange_sf_code + "' ";


                iReturn = db.ExecQry(strQry);

                strQry = "update mas_salesforce set Reporting_To_SF='" + Hold_sf_code + "' ,TP_Reporting_SF='" + Hold_sf_code + "' where sf_code in (select sf_code from mas_salesforce where Reporting_To_SF='" + Desgchange_sf_code + "' ) or sf_code ='" + Desgchange_sf_code + "' ";
                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;

        }
        public DataSet work_Type_Designation_Expense(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsDivision = null;
            strQry = "exec work_Type_Designation_Expense '" + divcode + "'";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }

        public DataSet sample_Des_New(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sample_Des_New '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Sample_Status_New_Product_New(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sample_Des_New_Zoom '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getReporting_sf(string div_code, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;


            strQry = "select Sf_Code,sf_name,sf_Designation_Short_Name,Sf_HQ " +
                     " from Mas_salesforce where   (Division_Code like '" + div_code + ',' + "%'  or Division_Code like '%" + ',' + div_code + ',' + "%')  and reporting_to_sf='" + sf_code + "' ";



            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Exp_Sts(string mnth, string yr)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "exec Exp_status_Month_wise '" + mnth + "','" + yr + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet AllMR_Novacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC AllMR_Novacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getUserList_Managers_Audit_new(string div_code, string sf_code, int order_id, string Aud_Mgr)
        {
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
            }

            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag   " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code"; // Modified to include MR - 29Aug15
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        if (drFF["sf_Code"].ToString() != Aud_Mgr)
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();

                            dt.Rows.Add(dr);
                        }
                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserList_Managers_Audit_new(div_code, drFF["sf_code"].ToString(), order_id, Aud_Mgr);//Modified by Sri to include MR - 29Aug15
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }


        public DataTable getUserList_Managers_Audit_new_Dev(string div_code, string sf_code, int order_id, string Aud_Mgr)
        {
            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
            }

            DB_EReporting db_ER = new DB_EReporting();
            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsSalesforce = null;


            if (order_id == 0)
            {
                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b " +
                     " WHERE " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.sf_status!=2 and a.Designation_Code=b.Designation_Code"; // Modified to include MR - 29Aug15
            }
            else
            {
                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                         " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                         " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                         " when '0' then 'Active'  " +
                         " when '1' then 'Vacant'  " +
                         " end sf_Tp_Active_flag " +
                         " FROM mas_salesforce a, Mas_SF_Designation b " +
                         " WHERE " +
                         " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                         " and a.Reporting_To_SF = '" + sf_code + "' and a.sf_status!=2 and a.Designation_Code=b.Designation_Code and  a.sf_Type=2"; // Modified to include MR - 29Aug15
            }

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        if (drFF["sf_Code"].ToString() != Aud_Mgr)
                        {


                            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                                                  " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                                                  " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                                                  " when '0' then 'Active'  " +
                                                  " when '1' then 'Vacant'  " +
                                                  " end sf_Tp_Active_flag " +
                                                  " FROM mas_salesforce a, Mas_SF_Designation b " +
                                                  " WHERE " +
                                                  " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                                  " and a.Reporting_To_SF = '" + drFF["sf_code"].ToString() + "' and a.sf_status!=2 and a.Designation_Code=b.Designation_Code";


                            dsSalesforce = db_ER.Exec_DataSet(strQry);
                            if (dsSalesforce.Tables[0].Rows.Count > 0)
                            {

                                order_id = order_id + 1;
                                dr = dt.NewRow();
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = drFF["sf_code"].ToString();
                                dr["sf_Name"] = drFF["sf_Name"].ToString();
                                dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                                dr["sf_Type"] = drFF["sf_Type"].ToString();
                                dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                                dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                                dr["sf_hq"] = drFF["sf_hq"].ToString();
                                dr["sf_password"] = drFF["sf_password"].ToString();
                                dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                                dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                                dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();

                                dt.Rows.Add(dr);
                            }
                        }
                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserList_Managers_Audit_new_Dev(div_code, drFF["sf_code"].ToString(), order_id, Aud_Mgr);//Modified by Sri to 
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataSet UserList_New(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_Audit '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataTable getUserListReportingToNew_bankdet(string div_code, string sf_code, int order_id, string sf_type)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;

                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_ContactAdd_One", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_ContactAdd_Two", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_City_Pincode", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Per_ContactAdd_Two", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Email", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Mobile", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Per_ContactAdd_One", typeof(string)));


                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color,  " +
                     //" when '0' then 'Active'  " +
                     //" when '1' then 'Vacant'  " +
                     " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                     "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                     " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                     " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' )THEN 'Blocked' end ) " +
                     " sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id,a.SF_ContactAdd_One,a.SF_ContactAdd_Two,a.SF_City_Pincode,a.SF_Per_ContactAdd_Two,a.SF_Email,a.SF_Mobile,a.SF_Per_ContactAdd_One " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status != 2 and a.sf_Tp_Active_flag = 0 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (sf_code == "admin")
                    {
                        strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                  " FROM mas_ho_id_creation " +
                                   " WHERE HO_Active_flag = 0  and  " +
                                   "(Division_Code like '" + div_code + "%'  or " +
                                    "Division_Code like '%" + ',' + div_code + "%') and " +
                                   " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                        DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsmgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = "admin";
                            dr["sf_Name"] = "admin";
                            dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = "";
                            dr["Sf_Joining_Date"] = "";
                            dr["Reporting_To_SF"] = "";
                            dr["sf_hq"] = "";
                            dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Designation_Short_Name"] = "Admin";
                            dr["Desig_Color"] = "33ff96";
                            dr["sf_Tp_Active_flag"] = "";
                            dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Lst_drCount"] = "";
                            dr["StateName"] = "";
                            dr["sf_emp_id"] = "";

                            dr["SF_ContactAdd_One"] = "";
                            dr["SF_ContactAdd_Two"] = "";
                            dr["SF_City_Pincode"] = "";
                            dr["SF_Per_ContactAdd_Two"] = "";

                            dr["SF_Email"] = "";
                            dr["SF_Mobile"] = "";
                            dr["SF_Per_ContactAdd_One"] = "";

                            dt.Rows.Add(dr);
                        }
                    }
                    else
                    {
                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                        dr["SF_ContactAdd_One"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                        dr["SF_ContactAdd_Two"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                        dr["SF_City_Pincode"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                        dr["SF_Per_ContactAdd_Two"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                        dr["SF_Email"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                        dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                        dr["SF_Per_ContactAdd_One"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();

                        dt.Rows.Add(dr);
                    }

                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color,   " +
                      //" when '0' then 'Active'  " +
                      //" when '1' then 'Vacant'  " +
                      " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                      "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                     " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                     " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' )THEN 'Blocked' end ) " +
                     "  sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id,a.SF_ContactAdd_One,a.SF_ContactAdd_Two,a.SF_City_Pincode,a.SF_Per_ContactAdd_Two,a.SF_Email,a.SF_Mobile,a.SF_Per_ContactAdd_One  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status != 2 and (a.sf_Tp_Active_flag = 0 or a.sf_Tp_Active_flag = 1 and sf_type='1') and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                                                        dr["SF_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                        dr["SF_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                        dr["SF_City_Pincode"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                        dr["SF_Per_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                                                        dr["SF_Email"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                        dr["SF_Per_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();

                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }

                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                                                dr["SF_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                dr["SF_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                dr["SF_City_Pincode"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                dr["SF_Per_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                                                dr["SF_Email"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                dr["SF_Per_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                                        dr["SF_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                        dr["SF_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                        dr["SF_City_Pincode"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                        dr["SF_Per_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                                        dr["SF_Email"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                        dr["SF_Per_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();

                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();

                            dr["SF_ContactAdd_One"] = drFF["SF_ContactAdd_One"].ToString();
                            dr["SF_ContactAdd_Two"] = drFF["SF_ContactAdd_Two"].ToString();
                            dr["SF_City_Pincode"] = drFF["SF_City_Pincode"].ToString();
                            dr["SF_Per_ContactAdd_Two"] = drFF["SF_Per_ContactAdd_Two"].ToString();

                            dr["SF_Email"] = drFF["SF_Email"].ToString();
                            dr["SF_Mobile"] = drFF["SF_Mobile"].ToString();
                            dr["SF_Per_ContactAdd_One"] = drFF["SF_Per_ContactAdd_One"].ToString();
                            dt.Rows.Add(dr);
                        }

                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToNew_bankdet(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataTable getUserListReportingToAllNew_bankdet(string div_code, string sf_code, int order_id, string sf_type) // 23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_ContactAdd_One", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_ContactAdd_Two", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_City_Pincode", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Per_ContactAdd_Two", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Email", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Mobile", typeof(string)));      //SF_Per_ContactAdd_One
                dt.Columns.Add(new DataColumn("SF_Per_ContactAdd_One", typeof(string)));


                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                   " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                   " b.Designation_Short_Name, b.Desig_Color,   " +
                    //" when '0' then 'Active'  " +
                    //" when '1' then 'Vacant'  " +
                    " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                    "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                   " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                   " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' ) THEN 'Blocked' end ) " +
                   "  sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id,a.SF_ContactAdd_One,a.SF_ContactAdd_Two,a.SF_City_Pincode,a.SF_Per_ContactAdd_Two,a.SF_Email,a.SF_Mobile,a.SF_Per_ContactAdd_One " +
                   " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                   " WHERE a.SF_Status !=2 and " +
                   " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                   " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.State_Code=c.State_Code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (sf_type == "3")
                    {
                        strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                  " FROM mas_ho_id_creation " +
                                   " WHERE HO_Active_flag = 0  and  " +
                                   "(Division_Code like '" + div_code + "%'  or " +
                                    "Division_Code like '%" + ',' + div_code + "%') and " +
                                   "Sub_HO_ID is null";

                        DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsmgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = "admin";
                            dr["sf_Name"] = "admin";
                            dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = "";
                            dr["Sf_Joining_Date"] = "";
                            dr["Reporting_To_SF"] = "";
                            dr["sf_hq"] = "";
                            dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Designation_Short_Name"] = "Admin";
                            dr["Desig_Color"] = "33ff96";

                            dr["sf_Tp_Active_flag"] = "";
                            dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["Lst_drCount"] = "";
                            dr["StateName"] = "";
                            dr["sf_emp_id"] = "";

                            dr["SF_ContactAdd_One"] = "";
                            dr["SF_ContactAdd_Two"] = "";
                            dr["SF_City_Pincode"] = "";
                            dr["SF_Per_ContactAdd_Two"] = "";

                            dr["SF_Email"] = "";
                            dr["SF_Mobile"] = "";
                            dr["SF_Per_ContactAdd_One"] = "";
                            dt.Rows.Add(dr);
                        }
                    }
                    else
                    {

                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();

                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();


                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                        dr["SF_ContactAdd_One"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                        dr["SF_ContactAdd_Two"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                        dr["SF_City_Pincode"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                        dr["SF_Per_ContactAdd_Two"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                        dr["SF_Email"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                        dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                        dr["SF_Per_ContactAdd_One"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();


                        dt.Rows.Add(dr);
                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color,   " +
                     //" when '0' then 'Active'  " +
                     //" when '1' then 'Vacant'  " +
                     " (CASE WHEN (sf_TP_Active_Flag = '0' and SF_Status = '0' ) THEN 'Active' " +
                     "  WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' and sf_vacantblock='H') THEN 'Hold' " +
                     " WHEN (sf_TP_Active_Flag = '1' and SF_Status = '0' ) THEN 'Vacant' " +
                     " WHEN (sf_TP_Active_Flag='0' and SF_Status = '1' ) THEN 'Blocked' end ) " +
                     " sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,a.sf_emp_id,a.SF_ContactAdd_One,a.SF_ContactAdd_Two,a.SF_City_Pincode,a.SF_Per_ContactAdd_Two,a.SF_Email,a.SF_Mobile,a.SF_Per_ContactAdd_One  " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE a.SF_Status !=2 and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        //Check for Audit
                        // DataSet ds = CheckforAuditteammgr(drFF["sf_code"].ToString(), div_code);
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                                                        dr["SF_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                        dr["SF_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                        dr["SF_City_Pincode"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                        dr["SF_Per_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                                                        dr["SF_Email"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                        dr["SF_Per_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();

                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }
                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                                                dr["SF_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                dr["SF_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                dr["SF_City_Pincode"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                dr["SF_Per_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                                                dr["SF_Email"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                dr["SF_Per_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();

                                        dr["SF_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                        dr["SF_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                        dr["SF_City_Pincode"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                        dr["SF_Per_ContactAdd_Two"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();

                                        dr["SF_Email"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                        dr["SF_Per_ContactAdd_One"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();

                            dr["SF_ContactAdd_One"] = drFF["SF_ContactAdd_One"].ToString();
                            dr["SF_ContactAdd_Two"] = drFF["SF_ContactAdd_Two"].ToString();
                            dr["SF_City_Pincode"] = drFF["SF_City_Pincode"].ToString();
                            dr["SF_Per_ContactAdd_Two"] = drFF["SF_Per_ContactAdd_Two"].ToString();

                            dr["SF_Email"] = drFF["SF_Email"].ToString();
                            dr["SF_Mobile"] = drFF["SF_Mobile"].ToString();
                            dr["SF_Per_ContactAdd_One"] = drFF["SF_Per_ContactAdd_One"].ToString();
                            dt.Rows.Add(dr);
                        }
                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToAllNew_bankdet(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataSet salesforce_vcant(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //           strQry = ";with cte as ( "+

            // "select distinct sf_code,sf_name,Emp_Id,min(activity_date) as mindate,max(activity_date) maxdate,(select sf_hq from mas_salesforce where sf_code=D.sf_code)sf_hq,(select sf_designation_short_name from mas_salesforce where sf_code=D.sf_code) designation "+
            //"from dcrmain_trans D where division_code='" + divcode + "' " +
            //"group by sf_code,sf_name,Emp_Id ) "+
            // "select   a.sf_code,a.sf_name+' - '+designation+' - '+a.sf_hq sf_name,a.Emp_Id,a.mindate,a.maxdate,(select top 1 sf_joining_date from "+
            // "salesforce_vacant where sf_code=a.sf_code and sf_emp_id=a.emp_id)as joinig_date "+
            //  "from cte a, "+
            //  "mas_salesforce b where (a.emp_id !=b.sf_emp_id or sf_TP_Active_Flag=1) and "+
            //   "a.sf_code=b.sf_code order by a.sf_code";

            strQry = "select distinct S.sf_code,S.sf_name+' - '+sf_designation_short_name+' - '+sf_hq+' - '+employee_code sf_name,convert(varchar,dcr_start_date,103)dcr_start_date,convert(varchar,DCR_End_Date,103)DCR_End_Date,S.sf_code+'$'+convert(varchar,dcr_start_date,101)+'$'+convert(varchar,DCR_End_Date,101)+'$'+convert(varchar,dcr_start_date,103)+'$'+convert(varchar,DCR_End_Date,103) sf from salesforce_vacant S inner join dcrmain_trans D on S.sf_code=D.sf_code and s.sf_name=D.sf_name where S.division_code='" + divcode + ',' + "' and dcr_end_date is not null order by s.sf_code";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet GetFillCheckDropDownValue(string Div_code, string Brand, string SubDiv)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;



            strQry = "EXEC sp_GetProduct_Img '" + Div_code + "','" + Brand + "','" + SubDiv + "'  ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Level_Reporting(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Mr_Level_Reporting_Des '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfCode_mr(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code, Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_name FROM  Mas_Salesforce " +
                     " WHERE Sf_Code= '" + sfcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getleave_type(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            DB_EReporting db = new DB_EReporting();


            strQry = "select Leave_SName,Leave_code,Leave_Name from mas_leave_type where Division_Code='" + divcode + "' and Active_Flag='0'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public bool CheckDuplicateEmp_id(string sf_emp_id, string sf_code, string div_code)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(sf_emp_id) FROM Mas_Salesforce WHERE sf_emp_id='" + sf_emp_id + "' and division_code ='" + div_code + ",'  AND sf_code !='" + sf_code + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }
        public DataSet getvacant(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "Select sf_emp_id,a.Sf_Name,a.Sf_HQ,a.sf_Designation_Short_Name,b.Vacant_Date,b.Reporting_To_SF_Name,Sf_TP_Active_Flag " +
                     " From Mas_Salesforce a,salesforce_vacant b Where Sf_TP_Active_Flag='1' and Sf_VacantBlock in ('H','R') " +
                     " and a.sf_code=b.sf_code and a.Division_Code='" + divcode + ",' order by sf_Designation_Short_Name desc   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet get_tp_status_new(string sf_code, string div_code, string month, string year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "exec tp_satus '" + sf_code + "','" + div_code + "','" + month + "','" + year + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet get_tp_status_newvacant(string sf_code, string div_code, string month, string year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "exec tp_satus_vacant '" + sf_code + "','" + div_code + "','" + month + "','" + year + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet get_tp_status_state(string div_code, string month, string year, string state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "exec tp_satus_test '" + div_code + "','" + month + "','" + year + "','" + state_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet get_tp_status_state_vacant(string div_code, string month, string year, string state_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "exec tp_satus_test234 '" + div_code + "','" + month + "','" + year + "','" + state_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getEmployee_code(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT sf_emp_id FROM Mas_Salesforce " +
                     " WHERE sf_code= '" + sf_code + "' and Division_Code = '" + div_code + ',' + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public bool CheckDupEmp_id(string sf_emp_id, string div_code)
        {

            bool bRecordExist = false;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "SELECT COUNT(sf_emp_id) FROM Mas_Salesforce WHERE sf_emp_id='" + sf_emp_id + "' and division_code ='" + div_code + "'";
                int iRecordExist = db.Exec_Scalar(strQry);

                if (iRecordExist > 0)
                    bRecordExist = true;
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return bRecordExist;
        }

        public DataSet Quiz_Survey_id(string divcode, string sf_code, string month, string year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " select Survey_Id from QuizTitleCreation where  Division_Code='" + divcode + "' and Month = '" + month + "' and Year = '" + year + "' and Active=0 ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Quiz_Status_Temp(string divcode, string sf_code, string month, string year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = " select Survey_Id from QuizTitleCreation where  Division_Code='" + divcode + "' and Month = '" + month + "' and Year = '" + year + "' and Active=0 ";
            dsSF = db_ER.Exec_DataSet(strQry);
            if (dsSF.Tables[0].Rows.Count > 0)
            {
                strQry = " EXEC Quiz_Status_temp '" + divcode + "', '" + sf_code + "', '" + month + "', '" + year + "', '" + dsSF.Tables[0].Rows[0][0].ToString() + "'  ";
            }
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfName_quiz(string sfcode)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Name +' - '+sf_Designation_Short_Name + ' - ' + sf_hq as sf_Name,Sf_HQ,sf_Designation_Short_Name FROM  Mas_Salesforce " +
                     " WHERE sf_code= '" + sfcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Quiz_Result(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //strQry = "  select  a.Question_Id,Question_Text,  b.Input_Id, b.Input_Text, r.Input_Id,r.Second_Input_Id , " +
            //         "  (select Input_Text from AddInputOptions where r.Input_Id=Input_Id and Division_code='" + divcode + "'  ) " +
            //         "  as InputName, (select Input_Text from AddInputOptions where r.Second_Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
            //         " as NameAttempt2 from AddQuestions a inner join QuestionType q " +
            //         "  on a.Question_type_id=q.Question_type_id inner join " +
            //         "  AddInputOptions b on b.Question_Id = a.Question_Id  " +
            //         "  inner join  Quiz_Result r on  b.Question_Id = r.Quiz_Id and Sf_Code='" + sf_code + "' and b.Division_Code='" + divcode + "'  and Correct_Ans=1 ";
            strQry = "  declare @surveyid int " +
                     " set @surveyid =( select Survey_Id from QuizTitleCreation where  Division_Code='" + divcode + "' and Status=0 and Active=0) " +

                     " select  a.Question_Id,Question_Text,  b.Input_Id, b.Input_Text, r.Input_Id,r.Second_Input_Id , " +
                     "  (select Input_Text from AddInputOptions where r.Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
                     "  as InputName, (select Input_Text from AddInputOptions where r.Second_Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
                     " as NameAttempt2 from AddQuestions a inner join QuestionType q " +
                     "  on a.Question_type_id=q.Question_type_id inner join " +
                     "  AddInputOptions b on b.Question_Id = a.Question_Id  " +
                     "  inner join  Quiz_Result r on  b.Question_Id = r.Quiz_Id and Sf_Code='" + sf_code + "' and b.Division_Code='" + divcode + "' and  SurveyID=@surveyid  and Correct_Ans=1 ";




            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Quiz_Result_View(string divcode, string sf_code, string imonth, string iyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "  declare @surveyid int " +
                     " set @surveyid =( select Survey_Id from QuizTitleCreation where  Division_Code='" + divcode + "' and Month='" + imonth + "' and Year ='" + iyear + "' and active=0) " +

                     " select  a.Question_Id,Question_Text,  b.Input_Id, b.Input_Text, r.Input_Id,r.Second_Input_Id , " +
                     "  (select Input_Text from AddInputOptions where r.Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
                     "  as InputName, (select Input_Text from AddInputOptions where r.Second_Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
                     " as NameAttempt2 from AddQuestions a inner join QuestionType q " +
                     "  on a.Question_type_id=q.Question_type_id inner join " +
                     "  AddInputOptions b on b.Question_Id = a.Question_Id  " +
                     "  inner join  Quiz_Result r on  b.Question_Id = r.Quiz_Id and Sf_Code='" + sf_code + "' and b.Division_Code='" + divcode + "' and  SurveyID=@surveyid  and Correct_Ans=1 ";




            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet sp_UserListMr_FieldForce_New(string sf_code, string divcode, string iMonth, string iYear, string StrVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            // strQry = "EXEC sp_get_Rep_audit_with_Vacant '" + sf_code + "', '" + divcode + "' ";

            strQry = "EXEC sp_Get_DCRCount_View_New '" + sf_code + "', '" + divcode + "','" + iMonth + "','" + iYear + "','" + StrVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //Notification msg new Indhu
        public DataSet getfield_notifydesig(string divcode, string desigcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "EXEC Hierarchy_Notification '" + divcode + "','" + desigcode + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getfield_notifystate(string divcode, string statecode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "EXEC Hierarchy_Notification_state '" + divcode + "','" + statecode + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getfield_notifysub(string divcode, string subdiv)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "EXEC Hierarchy_Notification_subdiv '" + divcode + "','" + subdiv + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }
        public DataSet getfield_notifyfieldall(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "EXEC Hierarchy_Notification_Fieldforce '" + divcode + "','" + sf_code + "' ";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }  //Notification msg new Indhu

        public DataSet SalesForceMgrGet_new(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet_new '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet sp_UserList_getALL_Multiple_Subdiv(string divcode, string sf_code, string sub_div)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_getALL_Multiple_Subdiv '" + divcode + "', '" + sf_code + "','" + sub_div + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        // PR
        public DataSet getMR_Performance()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select 'P' AS iD,'PERSONALITY' parameter UNION ALL select 'D' AS iD,'DRESS SENSE' parameter UNION ALL select 'S' AS iD,'SPOKEN ENGLISH' parameter " +
                     " UNION ALL select 'J' AS iD,'JOB KNOWLEDGE' parameter UNION ALL select 'C' AS iD,'CAREER GROWTH' parameter UNION ALL select 'U' AS iD,'URGE TO EARN' parameter " +
                     "  select '1' as sno union all select '2' as sno " +
                     " select '1' as ID, 'Sec.Sale' as Name  ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int Trans_Assesment_MR(string sf_code, string div_code, string sf_Hq, string sf_Desig, string sf_name, string txtName, string txtPost, string TxtQual, string txtExp, string txtage, string txtmarital, string ddltwowheel, string txtuan, string txtHq,
            string txtMbl, string txtEMail, string txtSale_Pre, string txtPerfo, string txtCur_Sale, string txtReason, string txtL_Salary, string txtmin_sal, string txtJ_Date, string txtIndu, string txtEffFrom, string txtToDate, string Personality,
            string Dress_Sense, string Spok_Eng, string Job_Knowl, string C_Growth, string U_Earn, string Stock_Pre_Comp1, string Stock_Address1, string Stock_Pre_Comp2, string Stock_Address2, string Sale_month1, string Sale_month2, string Sale_month3,
            string Sale_month4, string Sale_month5, string Sale_month6)
        {
            int iReturn = -1;
            int iTransSlNo = 0;
            string strSfCode = string.Empty;
            DB_EReporting db = new DB_EReporting();
            try
            {
                strQry = "select (isnull((max(CAST((Sl_No)as int))),0))+1 from Trans_Assesment_MR";
                iTransSlNo = db.Exec_Scalar(strQry);

                strQry = " INSERT INTO Trans_Assesment_MR(Sl_No, Frm_Sf_Code, Frm_Sf_Name, Frm_Sf_Hq, Frm_Sf_Desg,Division_Code,Created_Date," +
                    " Name,Qual,Age,Two_Wheeler,Hq,Post,Pharma_Exp,Marital_Status,UAN_no,Mob_No,Personality,Dress_Sense,Spok_Eng,Job_Knowl,C_Growth,U_Earn, " +
                    " Email_Pre_Comp,Stock_Pre_Comp1,Stock_Address1,Stock_Pre_Comp2,Stock_Address2,Sale_Pre_Comp,Perform_Percentage,Cur_Avg_Sale," +
                    " Sale_month1,Sale_month2,Sale_month3,Sale_month4,Sale_month5,Sale_month6,Change_Reason,L_Salary,Min_Salary_Exp,join_Date,Induction_By,Ind_Frm_Date,Ind_To_Date) " +
                           " VALUES ( '" + iTransSlNo + "','" + sf_code + "' , '" + sf_name + "', '" + sf_Hq + "', '" + sf_Desig + "','" + div_code + "',getdate()," +
                           "'" + txtName + "','" + TxtQual + "','" + txtage + "','" + ddltwowheel + "','" + txtHq + "','" + txtPost + "','" + txtExp + "','" + txtmarital + "','" + txtuan + "','" + txtMbl + "','" + Personality + "','" + Dress_Sense + "','" + Spok_Eng + "','" + Job_Knowl + "','" + C_Growth + "','" + U_Earn + "'," +
                           " '" + txtEMail + "','" + Stock_Pre_Comp1 + "','" + Stock_Address1 + "','" + Stock_Pre_Comp2 + "','" + Stock_Address2 + "','" + txtSale_Pre + "','" + txtPerfo + "','" + txtCur_Sale + "'," +
                           " '" + Sale_month1 + "','" + Sale_month2 + "','" + Sale_month3 + "','" + Sale_month4 + "','" + Sale_month5 + "','" + Sale_month6 + "','" + txtReason + "','" + txtL_Salary + "','" + txtmin_sal + "','" + txtJ_Date + "','" + txtIndu + "','" + txtEffFrom + "','" + txtToDate + "') ";
                iReturn = db.ExecQry(strQry);

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        public int Trans_Assesment_MGR(string sf_code, string div_code, string sf_Hq, string sf_Desig, string sf_name, string txtName, string txtPost, string TxtQual, string txtExp, string txtage, string txtmarital, string ddltwowheel, string txtuan, string txtHq,
           string txtMbl, string txtEMail, string txtSale_Pre, string txtPerfo, string txtCur_Sale, string txtReason, string txtL_Salary, string txtmin_sal, string txtJ_Date, string txtIndu, string txtEffFrom, string txtToDate, string Personality,
           string Dress_Sense, string Spok_Eng, string Job_Knowl, string C_Growth, string U_Earn, string Sale_month1, string Sale_month2, string Sale_month3,
           string Sale_month4, string Sale_month5, string Sale_month6, string Cover_Areas)
        {
            int iReturn = -1;
            int iTransSlNo = 0;
            string strSfCode = string.Empty;
            DB_EReporting db = new DB_EReporting();
            try
            {
                strQry = "select (isnull((max(CAST((Sl_No)as int))),0))+1 from Trans_Assesment_MGR";
                iTransSlNo = db.Exec_Scalar(strQry);

                strQry = " INSERT INTO Trans_Assesment_MGR(Sl_No, Frm_Sf_Code, Frm_Sf_Name, Frm_Sf_Hq, Frm_Sf_Desg,Division_Code,Created_Date," +
                    " Name,Qual,Age,Two_Wheeler,Hq,Post,Pharma_Exp,Marital_Status,UAN_no,Mob_No,Personality,Dress_Sense,Spok_Eng,Job_Knowl,C_Growth,U_Earn, " +
                    " Email_Pre_Comp,Sale_Pre_Comp,Perform_Percentage,Cur_Avg_Sale," +
                    " Sale_month1,Sale_month2,Sale_month3,Sale_month4,Sale_month5,Sale_month6,Change_Reason,L_Salary,Min_Salary_Exp,join_Date,Induction_By,Ind_Frm_Date,Ind_To_Date,Cover_Areas) " +
                           " VALUES ( '" + iTransSlNo + "','" + sf_code + "' , '" + sf_name + "', '" + sf_Hq + "', '" + sf_Desig + "','" + div_code + "',getdate()," +
                           "'" + txtName + "','" + TxtQual + "','" + txtage + "','" + ddltwowheel + "','" + txtHq + "','" + txtPost + "','" + txtExp + "','" + txtmarital + "','" + txtuan + "','" + txtMbl + "','" + Personality + "','" + Dress_Sense + "','" + Spok_Eng + "','" + Job_Knowl + "','" + C_Growth + "','" + U_Earn + "'," +
                           " '" + txtEMail + "','" + txtSale_Pre + "','" + txtPerfo + "','" + txtCur_Sale + "'," +
                           " '" + Sale_month1 + "','" + Sale_month2 + "','" + Sale_month3 + "','" + Sale_month4 + "','" + Sale_month5 + "','" + Sale_month6 + "','" + txtReason + "','" + txtL_Salary + "','" + txtmin_sal + "','" + txtJ_Date + "','" + txtIndu + "','" + txtEffFrom + "','" + txtToDate + "','" + Cover_Areas + "') ";
                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        public DataSet getAssesment_MR(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsrep = null;

            strQry = "select Sl_No,Frm_Sf_Code,Frm_Sf_Name,Frm_Sf_Hq,Frm_Sf_Desg,convert(varchar,Created_Date,105)dt,(select sf_emp_id from mas_salesforce b where a.Frm_Sf_Code=b.sf_code)Emp_id  " +
                     "from Trans_Assesment_MR a where Division_Code='" + div_code + "' order by Created_Date desc";
            try
            {
                dsrep = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsrep;
        }

        public DataSet getAssesment_MGR(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsrep = null;

            strQry = "select Sl_No,Frm_Sf_Code,Frm_Sf_Name,Frm_Sf_Hq,Frm_Sf_Desg,convert(varchar,Created_Date,105)dt,(select sf_emp_id from mas_salesforce b where a.Frm_Sf_Code=b.sf_code)Emp_id  " +
                     "from Trans_Assesment_MGR a where Division_Code='" + div_code + "' order by Created_Date desc";
            try
            {
                dsrep = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsrep;
        }

        public DataSet getAsses_MRview(string sl_no, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsrep = null;

            strQry = "select Sl_No,Frm_Sf_Code,Frm_Sf_Name,Frm_Sf_Hq,Frm_Sf_Desg,Division_Code,convert(varchar,Created_Date,103)Created_Date,Name,Qual,Age,Two_Wheeler,Hq,Post,Pharma_Exp,Marital_Status,UAN_no,Mob_No,Personality,Dress_Sense,Spok_Eng,Job_Knowl,C_Growth,U_Earn,Email_Pre_Comp,Stock_Pre_Comp1,Stock_Address1,Stock_Pre_Comp2,Stock_Address2,Sale_Pre_Comp,Perform_Percentage,Cur_Avg_Sale,Sale_month1,Sale_month2,Sale_month3,Sale_month4,Sale_month5,Sale_month6,Change_Reason,L_Salary,Min_Salary_Exp,join_Date,Induction_By,Ind_Frm_Date,Ind_To_Date from Trans_Assesment_MR   where Sl_No='" + sl_no + "' and Division_Code='" + div_code + "'";
            try
            {
                dsrep = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsrep;
        }
        public DataSet getAsses_MGRview(string sl_no, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsrep = null;

            strQry = "select Sl_No,Frm_Sf_Code,Frm_Sf_Name,Frm_Sf_Hq,Frm_Sf_Desg,Division_Code,convert(varchar,Created_Date,103)Created_Date,Name,Qual,Age,Two_Wheeler,Hq,Post,Pharma_Exp,Marital_Status,UAN_no,Mob_No,Personality,Dress_Sense,Spok_Eng,Job_Knowl,C_Growth,U_Earn,Email_Pre_Comp,Sale_Pre_Comp,Perform_Percentage,Cur_Avg_Sale,Sale_month1,Sale_month2,Sale_month3,Sale_month4,Sale_month5,Sale_month6,Change_Reason,L_Salary,Min_Salary_Exp,join_Date,Induction_By,Ind_Frm_Date,Ind_To_Date,Cover_Areas from Trans_Assesment_MGR  where Sl_No='" + sl_no + "' and Division_Code='" + div_code + "'";
            try
            {
                dsrep = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsrep;
        }
        public DataSet getMR_Cnt(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsrep = null;

            strQry = "select count(Sl_No)cnt  " +
                     "from Trans_Assesment_MR  where Division_Code='" + div_code + "'";
            try
            {
                dsrep = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsrep;
        }

        public DataSet getMGR_Cnt(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsrep = null;

            strQry = "select count(Sl_No)cnt  " +
                     "from Trans_Assesment_MGR  where Division_Code='" + div_code + "'";
            try
            {
                dsrep = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsrep;
        }
        // PR





        public DataSet Hierarchy_Mgr_Team(string divcode, string sf_code)   // Added by Preethi
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_Mgr_access '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet TP_DeviationMR_New(string divcode, string sf_code, int Month, int Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            // strQry = "EXEC sp_TP_Deviation '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "' ,'" + type + "'";
            strQry = "EXEC TP_DeviationMR_New '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataSet TP_DeviationMGR_New(string divcode, string sf_code, int Month, int Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            // strQry = "EXEC sp_TP_Deviation '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "' ,'" + type + "'";
            strQry = "EXEC TP_DeviationMGR_New '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }

        public DataSet TP_Deviationat_glance_new(string divcode, string sf_code, int Month, int Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProBrd = null;

            // strQry = "EXEC sp_TP_Deviation '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "' ,'" + type + "'";
            strQry = "EXEC TP_Deviationat_glance_new '" + divcode + "', '" + sf_code + "','" + Month + "' ,'" + Year + "'";

            try
            {
                dsProBrd = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProBrd;
        }
        public DataSet AllFieldforce_Novacant_MGROnly(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC AllFieldforce_Novacant_MGROnly '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet exp_setup_availcheck(string div_code)
        {

            //changed by sri - 15july
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;

            strQry = " select division_code from expense_setup where division_code='" + div_code + "' ";


            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public int check_vac_ex_flagup(string sf_code)
        {

            int iReturn = -1;
            int iRecordExist;

            var today = DateTime.Today;
            var month = new DateTime(today.Year, today.Month, 1);
            var first = month.AddMonths(-1);
            var last_month_date = month.AddDays(-1);

            int last_month = last_month_date.Month;
            int last_month_year = last_month_date.Year;

            DateTime dt = DateTime.Now;
            int curr_month = dt.Month;
            int curr_year = dt.Year;
            DataSet dsdcr;
            int iretdcr = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                DCR dcr = new DCR();

                strQry = " select count(sf_code) from trans_expense_head where expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and sf_code='" + sf_code + "' and sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                iReturn = db.Exec_Scalar(strQry);

                if (iReturn > 0)
                {
                    strQry = "UPDATE trans_expense_head set Resigned_Flag=1,draft_flag='DR' Where SF_Code='" + sf_code + "' " +
                                " and expense_month='" + curr_month + "' and expense_year='" + curr_year + "' and " +
                                " sf_joining_date=(select sf_joining_date from mas_salesforce where sf_code='" + sf_code + "') ";
                    iReturn = db.ExecQry(strQry);
                }

            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }



        public DataTable GetCRM_MR_Detail(string div_code, string sf_code, int order_id)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataTable DJW = new DataTable();

            if (order_id == 0)
            {
                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Designation_Short_Name", typeof(string)));

                strQry = "Select Sf_Code,Sf_Name, Reporting_To_SF, sf_Designation_Short_Name from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

                DataSet ds = db_ER.Exec_DataSet(strQry);
                if (ds.Tables[0].Rows.Count > 0)
                {
                    dr = dt.NewRow();
                    dr["order_id"] = order_id;
                    dr["sf_Code"] = ds.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                    dr["sf_Name"] = ds.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                    dr["Reporting_To_SF"] = ds.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                    dr["sf_Designation_Short_Name"] = ds.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                    dt.Rows.Add(dr);
                }
            }
            DataSet dsmgr = null;

            strQry = " Select Reporting_To_SF from Mas_Salesforce where Sf_Code = '" + sf_code + "' ";

            try
            {
                dsmgr = db_ER.Exec_DataSet(strQry);
                if (dsmgr.Tables[0].Rows.Count > 0)
                {
                    if (dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() != "admin")
                    {
                        strQry = " select Sf_Code,Sf_Name + '-'+ sf_Designation_Short_Name + '-' + Sf_HQ as Sf_Name,Reporting_To_SF,sf_Designation_Short_Name  from Mas_Salesforce " + // SM Level
                                 " WHERE SF_Status=0 and sf_Tp_Active_flag = 0 and  " +
                                 " (Division_Code like  + '" + div_code + ",'+'%' or Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                                 " and sf_code = '" + dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() + "'";

                        DataSet dsMgr1 = db_ER.Exec_DataSet(strQry);
                        if (dsMgr1.Tables[0].Rows.Count > 0)
                        {
                            dr = dt.NewRow();
                            order_id = order_id + 1;
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["Reporting_To_SF"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Designation_Short_Name"] = dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dt.Rows.Add(dr);

                            DJW = GetCRM_MR_Detail(div_code, dsMgr1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), order_id);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }




        public DataSet sample_Des_New_Modify(string divcode, string sf_code, string fmonth, string fyear, string tmonth, string tyear, string mode, string Prod_mode, string Prod_Code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            //strQry = "EXEC sample_Des_New_Modify '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ,'" + mode + "','" + Prod_mode + "','" + Prod_Code + "' ";
            strQry = "EXEC sample_Des_New_Modify_Job '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "," + tmonth + "," + tyear + " ,'" + mode + "','" + Prod_mode + "','" + Prod_Code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sample_Des_New_Modify_New(string divcode, string sf_code, string fmonth, string fyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Sample_Status_Get_From_Job_Table_DetailView '" + divcode + "', '" + sf_code + "', " + fmonth + "," + fyear + "";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getMonth_Day_Dt(string month, string Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC getDay_datewise '" + month + "', '" + Year + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Quiz_Result_ViewNew(string divcode, string sf_code, string imonth, string iyear, string day)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "  declare @surveyid int " +
                     " set @surveyid =( select top(1) SurveyId from Processing_UserList where  Div_Code='" + divcode + "' and Month='" + imonth + "' and Year ='" + iyear + "' and day(From_Date)='" + day + "') " +

                     " select  a.Question_Id,Question_Text,  b.Input_Id, b.Input_Text, r.Input_Id,r.Second_Input_Id , " +
                     "  (select Input_Text from AddInputOptions where r.Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
                     "  as InputName, (select Input_Text from AddInputOptions where r.Second_Input_Id=Input_Id and Division_code='" + divcode + "'   ) " +
                     " as NameAttempt2 from AddQuestions a inner join QuestionType q " +
                     "  on a.Question_type_id=q.Question_type_id inner join " +
                     "  AddInputOptions b on b.Question_Id = a.Question_Id  " +
                     "  inner join  Quiz_Result r on  b.Question_Id = r.Quiz_Id and Sf_Code='" + sf_code + "' and b.Division_Code='" + divcode + "' and  SurveyID=@surveyid  and Correct_Ans=1 ";




            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Quiz_Result_View_AvgNew(string divcode, string sf_code, string imonth, string iyear, string ans, string day)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_Get_QuizResult_Avg '" + divcode + "', '" + sf_code + "','" + imonth + "','" + iyear + "','" + ans + "','" + day + "'  ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfCode_Detail(string sfcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code,Sf_Name,sf_hq,sf_emp_id,sf_Designation_Short_Name,State_Code,subdivision_code, " +
                     " stuff((select ','+subdivision_name from  mas_subdivision sub where div_code='" + div_code + "' and  " +
                     " CHARINDEX(cast(sub.subdivision_code as varchar),a.subdivision_code) > 0  " +
                     " for XML path('')),1,1,'')   SubName  " +
                     " FROM  Mas_Salesforce a" +
                     " WHERE Sf_Code= '" + sfcode + "' and Division_code ='" + div_code + ',' + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSfCode_Verify(string sfcode, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code,Sf_Name,sf_hq,sf_emp_id,sf_Designation_Short_Name,State_Code,subdivision_code FROM  Mas_Salesforce " +
                     " WHERE Sf_Code= '" + sfcode + "' and Division_code ='" + div_code + ',' + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet Financial_Year_MQY(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Financial_Year_MQY '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet AllFieldforce_Novacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC AllFieldforce_Novacant '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet AllFieldforce_Novacant_All_Div(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC AllFieldforce_Novacant_All_Div '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet Get_HO_ID_Name_Team(string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " select Name as HO_Name,Division_Code,User_Name as UserName from mas_ho_id_creation where Sub_HO_ID='" + HO_ID + "' and HO_Active_Flag = 0 ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }


        public DataSet Get_HO_ID_Name(string HO_ID)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " select Name as HO_Name,Division_Code,User_Name as UserName from mas_ho_id_creation where HO_ID='" + HO_ID + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        //
        //notification msg delete screen by Ferooz
        //
        public DataSet getnotifymsgdel(string divcode, string year, string month)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSubDiv = null;

            //strQry = " select Trans_Sl_No,Notification_Message from Mas_Notification where division_code='" + divcode + "' and year(Notification_To_Date)='" + year + "' and Month(Notification_To_Date)='" + month + "'";

            strQry = " select Trans_Sl_No,Notification_Message,convert(varchar, Notification_From_Date,103) From_Date,convert(varchar,Notification_to_Date,103) To_Date from Mas_Notification where division_code='" + divcode + "' and year(Notification_To_Date)='" + year + "' and Month(Notification_To_Date)='" + month + "' order by Notification_to_Date desc ";
            try
            {
                dsSubDiv = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSubDiv;
        }
        public int NotificationMsgDelete(string Trans_Sl_No)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();
                strQry = " delete from Mas_Notification WHERE Trans_Sl_No='" + Trans_Sl_No + "' ";
                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }
        public DataSet getEmp_code(string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " SELECT Sf_Code,sf_emp_id,sf_cat_code,state_code FROM Mas_Salesforce " +
                     " WHERE  (Division_Code like '" + div_code + ',' + "%'  or  Division_Code like '%" + ',' + div_code + ',' + "%' ) ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataTable getUserListReportingToNew_for_all_New(string div_code, string sf_code, int order_id, string sf_type)//23-oct-15
        {
            DB_EReporting db_ER = new DB_EReporting();
            if (order_id == 0)
            {
                DataSet dsmgr = null;

                dt.Columns.Add(new DataColumn("order_id", typeof(int)));
                dt.Columns.Add(new DataColumn("sf_Code", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Type", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_Joining_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To_SF", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_hq", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_password", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Short_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("Desig_Color", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_Tp_Active_flag", typeof(string)));
                dt.Columns.Add(new DataColumn("UsrDfd_UserName", typeof(string)));
                dt.Columns.Add(new DataColumn("Lst_drCount", typeof(string)));
                dt.Columns.Add(new DataColumn("StateName", typeof(string)));
                dt.Columns.Add(new DataColumn("Last_TP_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("Sf_TP_DCR_Active_Dt", typeof(string)));
                dt.Columns.Add(new DataColumn("Last_DCR_Date", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_emp_id", typeof(string)));
                dt.Columns.Add(new DataColumn("type", typeof(string)));
                dt.Columns.Add(new DataColumn("Reporting_To", typeof(string)));
                dt.Columns.Add(new DataColumn("Designation_Name", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Mobile", typeof(string)));
                dt.Columns.Add(new DataColumn("sf_short_name", typeof(string)));
                dt.Columns.Add(new DataColumn("SF_Cat_Code", typeof(string)));

                strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName ,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt,  " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id,a.sf_Type as type, (select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE ((a.SF_Status=0 and  a.sf_Tp_Active_flag = 0 ) or(a.SF_Status=0 and  a.sf_Tp_Active_flag = 1 and a.SF_VacantBlock='H') ) and " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.sf_code = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
                try
                {
                    dsmgr = db_ER.Exec_DataSet(strQry);
                    if (dsmgr.Tables[0].Rows.Count > 0)
                    {

                        dr = dt.NewRow();
                        dr["order_id"] = order_id;
                        dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                        dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                        dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                        dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                        dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                        dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                        dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                        dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                        dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                        dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                        dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                        dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                        dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                        dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                        dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                        dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                        dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                        dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                        dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                        dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                        dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                        dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                        dr["sf_short_name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                        dr["SF_Cat_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                        dt.Rows.Add(dr);

                        if (sf_type == "3")
                        {
                            strQry = "SELECT HO_ID,Name,User_Name,Password " +
                                      " FROM mas_ho_id_creation " +
                                       " WHERE HO_Active_flag = 0  and  " +
                                       "(Division_Code like '" + div_code + "%'  or " +
                                        "Division_Code like '%" + ',' + div_code + "%') and " +
                                       " (Sub_HO_ID is null or Sub_HO_ID = '0')";

                            DataSet dsmgr1 = db_ER.Exec_DataSet(strQry);
                            if (dsmgr1.Tables[0].Rows.Count > 0)
                            {
                                dr = dt.NewRow();
                                dr["order_id"] = order_id;
                                dr["sf_Code"] = "admin";
                                dr["sf_Name"] = "admin";
                                dr["Sf_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["sf_Type"] = "";
                                dr["Sf_Joining_Date"] = "";
                                dr["Reporting_To_SF"] = "";
                                dr["sf_hq"] = "";
                                dr["sf_password"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                dr["Designation_Short_Name"] = "Admin";
                                dr["Desig_Color"] = "33ff96";
                                dr["sf_Tp_Active_flag"] = "";
                                dr["UsrDfd_UserName"] = dsmgr1.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                dr["Lst_drCount"] = "";
                                dr["StateName"] = "";
                                dr["Last_TP_Date"] = "";
                                dr["Sf_TP_DCR_Active_Dt"] = "";
                                dr["Last_DCR_Date"] = "";
                                dr["sf_emp_id"] = "";
                                dr["type"] = "";
                                dr["Reporting_To"] = "";
                                dr["Designation_Name"] = "";
                                dr["SF_Mobile"] = "";
                                dr["sf_short_name"] = "";
                                dr["SF_Cat_Code"] = "";
                                dt.Rows.Add(dr);
                            }
                        }
                        else
                        {
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                            dr["sf_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                            dr["Sf_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                            dr["sf_Type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                            dr["Sf_Joining_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                            dr["Reporting_To_SF"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                            dr["sf_hq"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                            dr["sf_password"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                            dr["Designation_Short_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                            dr["Desig_Color"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                            dr["sf_Tp_Active_flag"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                            dr["UsrDfd_UserName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                            dr["Lst_drCount"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                            dr["StateName"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                            dr["Last_TP_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                            dr["Sf_TP_DCR_Active_Dt"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                            dr["Last_DCR_Date"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                            dr["sf_emp_id"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                            dr["type"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                            dr["Reporting_To"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                            dr["Designation_Name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                            dr["SF_Mobile"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                            dr["sf_short_name"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                            dr["SF_Cat_Code"] = dsmgr.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                            dt.Rows.Add(dr);
                        }

                    }
                }
                catch (Exception ex)
                {
                    throw ex;
                }

            }


            DataTable dt_recursive = new DataTable();
            DataSet dsDivision = null;
            DataSet dsA = null;

            strQry = " SELECT a.sf_Code, a.sf_Name, a.Sf_UserName, a.sf_Type,convert(char(10),Sf_Joining_Date,105) Sf_Joining_Date, " +
                     " (select sf_name from mas_salesforce where sf_code=a.Reporting_To_SF) as Reporting_To_SF, a.sf_hq, a.sf_password, " +
                     " b.Designation_Short_Name, b.Desig_Color, CASE a.sf_Tp_Active_flag   " +
                     " when '0' then 'Active'  " +
                     " when '1' then 'Vacant'  " +
                     " end sf_Tp_Active_flag, a.UsrDfd_UserName, '' Lst_drCount, c.StateName,(select convert(varchar,Last_TP_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_TP_Date,convert(varchar,a.Sf_TP_DCR_Active_Dt,103) Sf_TP_DCR_Active_Dt, " +
                     " (select convert(varchar,Last_DCR_Date,103) from mas_salesforce_DCRTPdate where sf_code=a.sf_code) Last_DCR_Date,a.sf_emp_id ,a.sf_Type as type ,(select UsrDfd_UserName from Mas_Salesforce " +
                     " where sf_code=a.sf_code) +'- '+   (select Sf_Name from mas_salesforce where sf_code=a.Reporting_To_SF) Reporting_To,b.Designation_Short_Name as Designation_Name,a.SF_Mobile,a.sf_short_name,a.SF_Cat_Code " +
                     " FROM mas_salesforce a, Mas_SF_Designation b, mas_state c " +
                     " WHERE   ((a.SF_Status=0 and  a.sf_Tp_Active_flag = 0 ) or(a.SF_Status=0 and  a.sf_Tp_Active_flag = 1 and a.SF_VacantBlock='H') ) and  " +
                     " (a.Division_Code like  + '" + div_code + ",'+'%' or a.Division_Code like '%'+','+ '" + div_code + ",'+'%') " +
                     " and a.Reporting_To_SF = '" + sf_code + "' and a.Designation_Code=b.Designation_Code and a.state_code = c.state_code ORDER BY a.sf_type";
            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);

                if (dsDivision.Tables[0].Rows.Count > 0)
                {
                    foreach (DataRow drFF in dsDivision.Tables[0].Rows)
                    {
                        DataSet ds = CheckforAudit(drFF["sf_code"].ToString(), div_code);
                        if (ds.Tables[0].Rows.Count > 0)
                        {
                            foreach (DataRow dsloop in ds.Tables[0].Rows)
                            {
                                int am = 0;
                                foreach (DataRow draud in dt.Rows)
                                {
                                    if (draud["sf_Code"].ToString() == dsloop["Sf_Code"].ToString())
                                    {
                                        am = 1;
                                    }
                                }
                                if (am == 0)
                                {
                                    DataSet ds1 = CheckforAudit(dsloop["Sf_Code"].ToString(), div_code);
                                    if (ds1.Tables[0].Rows.Count > 0)
                                    {
                                        int am1 = 0;
                                        foreach (DataRow draud in dt.Rows)
                                        {
                                            if (draud["sf_Code"].ToString() == ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                            {
                                                am1 = 1;
                                            }
                                        }
                                        if (am1 == 0)
                                        {
                                            DataSet ds2 = CheckforAudit(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (ds2.Tables[0].Rows.Count > 0)
                                            {
                                                int am2 = 0;
                                                foreach (DataRow draud in dt.Rows)
                                                {
                                                    if (draud["sf_Code"].ToString() == ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString())
                                                    {
                                                        am2 = 1;
                                                    }
                                                }
                                                if (am2 == 0)
                                                {
                                                    dsA = getAuditMgr(ds2.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                                    if (dsA.Tables[0].Rows.Count > 0)
                                                    {
                                                        order_id = order_id + 1;
                                                        dr = dt.NewRow();
                                                        dr["order_id"] = order_id;
                                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                        dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                        dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                        dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                        dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                        dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                                        dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                                        dt.Rows.Add(dr);
                                                    }
                                                }
                                            }

                                            dsA = getAuditMgr(ds1.Tables[0].Rows[0].ItemArray.GetValue(0).ToString(), div_code);
                                            if (dsA.Tables[0].Rows.Count > 0)
                                            {
                                                order_id = order_id + 1;
                                                dr = dt.NewRow();
                                                dr["order_id"] = order_id;
                                                dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                                dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                                dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                                dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                                dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                                dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                                dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                                dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                                dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                                dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                                dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                                dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                                dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                                dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                                dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                                dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                                dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                                dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                                dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                                dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                                dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                                dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                                dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                                dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                                dt.Rows.Add(dr);
                                            }
                                        }
                                    }
                                    dsA = getAuditMgr(dsloop["Sf_Code"].ToString(), div_code);
                                    if (dsA.Tables[0].Rows.Count > 0)
                                    {
                                        order_id = order_id + 1;
                                        dr = dt.NewRow();
                                        dr["order_id"] = order_id;
                                        dr["sf_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        Audit_mgr = dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString();
                                        dr["sf_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(1).ToString();
                                        dr["Sf_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(2).ToString();
                                        dr["sf_Type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(3).ToString();
                                        dr["Sf_Joining_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(4).ToString();
                                        dr["Reporting_To_SF"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(5).ToString();
                                        dr["sf_hq"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(6).ToString();
                                        dr["sf_password"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(7).ToString();
                                        dr["Designation_Short_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(8).ToString();
                                        dr["Desig_Color"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(9).ToString();
                                        dr["sf_Tp_Active_flag"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(10).ToString();
                                        dr["UsrDfd_UserName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(11).ToString();
                                        dr["Lst_drCount"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(12).ToString();
                                        dr["StateName"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(13).ToString();
                                        dr["Last_TP_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(14).ToString();
                                        dr["Sf_TP_DCR_Active_Dt"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(15).ToString();
                                        dr["Last_DCR_Date"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(16).ToString();
                                        dr["sf_emp_id"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(17).ToString();
                                        dr["type"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(18).ToString();
                                        dr["Reporting_To"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(19).ToString();
                                        dr["Designation_Name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(20).ToString();
                                        dr["SF_Mobile"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(21).ToString();
                                        dr["sf_short_name"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(22).ToString();
                                        dr["SF_Cat_Code"] = dsA.Tables[0].Rows[0].ItemArray.GetValue(23).ToString();
                                        dt.Rows.Add(dr);
                                    }
                                }
                            }
                        }
                        dsA = getAuditTeam(drFF["sf_code"].ToString(), div_code);
                        if ((dsA.Tables[0].Rows.Count == 0) || (dsA.Tables[0].Rows[0].ItemArray.GetValue(0).ToString() == ""))
                        {
                            order_id = order_id + 1;
                            dr = dt.NewRow();
                            dr["order_id"] = order_id;
                            dr["sf_Code"] = drFF["sf_code"].ToString();
                            dr["sf_Name"] = drFF["sf_Name"].ToString();
                            dr["Sf_UserName"] = drFF["Sf_UserName"].ToString();
                            dr["sf_Type"] = drFF["sf_Type"].ToString();
                            dr["Sf_Joining_Date"] = drFF["Sf_Joining_Date"].ToString();
                            dr["Reporting_To_SF"] = drFF["Reporting_To_SF"].ToString();
                            dr["sf_hq"] = drFF["sf_hq"].ToString();
                            dr["sf_password"] = drFF["sf_password"].ToString();
                            dr["Designation_Short_Name"] = drFF["Designation_Short_Name"].ToString();
                            dr["Desig_Color"] = drFF["Desig_Color"].ToString();
                            dr["sf_Tp_Active_flag"] = drFF["sf_Tp_Active_flag"].ToString();
                            dr["UsrDfd_UserName"] = drFF["UsrDfd_UserName"].ToString();
                            dr["Lst_drCount"] = drFF["Lst_drCount"].ToString();
                            dr["StateName"] = drFF["StateName"].ToString();
                            dr["Last_TP_Date"] = drFF["Last_TP_Date"].ToString();
                            dr["Sf_TP_DCR_Active_Dt"] = drFF["Sf_TP_DCR_Active_Dt"].ToString();
                            dr["Last_DCR_Date"] = drFF["Last_DCR_Date"].ToString();
                            dr["sf_emp_id"] = drFF["sf_emp_id"].ToString();
                            dr["type"] = drFF["type"].ToString();
                            dr["Reporting_To"] = drFF["Reporting_To"].ToString();
                            dr["Designation_Name"] = drFF["Designation_Name"].ToString();
                            dr["SF_Mobile"] = drFF["SF_Mobile"].ToString();
                            dr["sf_short_name"] = drFF["sf_short_name"].ToString();
                            dr["SF_Cat_Code"] = drFF["SF_Cat_Code"].ToString();
                            dt.Rows.Add(dr);
                        }

                        if (order_id == 0)
                            order_id = order_id + 1;
                        dt_recursive = getUserListReportingToNew_for_all_New(div_code, drFF["sf_code"].ToString(), order_id, dr["sf_Name"].ToString());
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dt;
        }

        public DataSet getTP_Count(string divcode, string Month, string Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "select sf_Designation_Short_Name as Designation,Sum(App) as Approved,sum(Com) as Completed,Sum(App)+Sum(Com) as Total from" +
                     "(select a.Sf_Code, a.Division_Code, sf_Designation_Short_Name  from Mas_Salesforce a where sf_Designation_Short_Name <> 'Admin' " +
                     " group by a.sf_Designation_Short_Name, a.Division_Code, a.Sf_Code) C " +
                     " left join " +
                     " (select SF_Code, Count(distinct SF_Code) as App from Trans_TP B  where Tour_Month = '" + Month + "' and Tour_Year = '" + Year + "' group by SF_Code)D " +
                     " on C.Sf_Code = D.SF_Code " +
                     " left join " +
                     "(select SF_Code, Count(distinct SF_Code) as Com from Trans_TP_One B  where Tour_Month = '" + Month + "' and Tour_Year = '" + Year + "' group by SF_Code)E " +
                     " on C.Sf_Code = E.SF_Code where C.Division_Code like '%" + divcode + "%' " +
                     " group by sf_Designation_Short_Name " +
                     " union all " +
                     "select 'Total',Sum(App) as Approved,sum(Com) as Completed,Sum(App)+Sum(Com) as Total from" +
                     "(select a.Sf_Code, a.Division_Code, sf_Designation_Short_Name  from Mas_Salesforce a where sf_Designation_Short_Name <> 'Admin' " +
                     " group by a.sf_Designation_Short_Name, a.Division_Code, a.Sf_Code) C " +
                     " left join " +
                     " (select SF_Code, Count(distinct SF_Code) as App from Trans_TP B  where Tour_Month = '" + Month + "' and Tour_Year = '" + Year + "' group by SF_Code)D " +
                     " on C.Sf_Code = D.SF_Code " +
                     " left join " +
                     "(select SF_Code, Count(distinct SF_Code) as Com from Trans_TP_One B  where Tour_Month = '" + Month + "' and Tour_Year = '" + Year + "' group by SF_Code)E " +
                     " on C.Sf_Code = E.SF_Code where C.Division_Code like '%" + divcode + "%' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDCR_Count(string divcode, string Month, string Year)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "select sf_Designation_Short_Name as Designation,Sum(Total) as Total from " +
                      "(select a.Sf_Code, a.Division_Code, sf_Designation_Short_Name  from Mas_Salesforce a where sf_Designation_Short_Name <> 'Admin' " +
                      " group by a.sf_Designation_Short_Name, a.Division_Code, a.Sf_Code) C " +
                      " left join " +
                      " (select SF_Code, Count(distinct SF_Code) as Total from DCRMain_Trans B  where Month(Activity_Date) = '" + Month + "' and Year(Activity_Date) = '" + Year + "' group by SF_Code)D " +
                      " on C.Sf_Code = D.SF_Code " +
                      " where C.Division_Code like '%" + divcode + "%' " +
                      " group by sf_Designation_Short_Name " +
                      " union all " +
                      " select 'Total',Sum(Total) as Total from " +
                      " (select a.Sf_Code, a.Division_Code, sf_Designation_Short_Name  from Mas_Salesforce a where sf_Designation_Short_Name <> 'Admin' " +
                      "  group by a.sf_Designation_Short_Name, a.Division_Code, a.Sf_Code) C " +
                      " left join " +
                      " (select SF_Code, Count(distinct SF_Code) as Total from DCRMain_Trans B  where Month(Activity_Date) = '" + Month + "' and Year(Activity_Date) = '" + Year + "' group by SF_Code)D " +
                      " on C.Sf_Code = D.SF_Code " +
                      " where C.Division_Code like '%" + divcode + "%' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet Survey_Hirarchy_St_Subdiv(string divcode, string sf_code, string stcode, string subdiv)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC Survey_Hirarchy_all '" + divcode + "', '" + sf_code + "' , '" + stcode + "'  , '" + subdiv + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet BindQuestion_Survey(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = " select distinct Survey_ID,Survey_Title from Mas_Question_Survey_Creation_Head where Division_Code='" + divcode + "' and Active_Flag=0  ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getDCR_Time_Count(string divcode, string Month, string Year, string Date)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            //strQry = "select '12.00 AM to 6.00 AM 'Time,count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code = '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '00:00:00' and  CAST(Submission_Date as time) < '06:00:00') " +
            //         " union " +
            //         " select '6.00 AM to 8.00 AM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '06:00:00' and  CAST(Submission_Date as time) < '08:00:00') " +
            //         " union " +
            //         " select '8.00 AM to 10.00 AM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '08:00:00' and  CAST(Submission_Date as time) < '10:00:00') " +
            //         " union " +
            //         " select '10.00 AM to 12.00 PM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '10:00:00' and  CAST(Submission_Date as time) < '12:00:00') " +
            //         " union " +
            //         " select '12.00 PM to 2.00 PM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '12:00:00' and  CAST(Submission_Date as time) < '14:00:00') " +
            //         " union " +
            //         " select '2.00 PM to 4.00 PM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '14:00:00' and  CAST(Submission_Date as time) < '16:00:00') " +
            //         " union " +
            //         " select '4.00 PM to 6.00 PM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         "  and(CAST(Submission_Date as time) >= '16:00:00' and  CAST(Submission_Date as time) < '18:00:00') " +
            //         " union " +
            //         " select '6.00 PM to 8.00 PM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '18:00:00' and  CAST(Submission_Date as time) < '20:00:00') " +
            //         " union " +
            //         " select '8.00 PM to 10.00 PM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '20:00:00' and  CAST(Submission_Date as time) < '22:00:00') " +
            //         " union " +
            //         " select '10.00 PM to 12.00 AM 'Time, count(CAST(Submission_Date as time)) as Count from DCRMain_Trans where Month(Submission_Date) = '" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " +
            //         " and(CAST(Submission_Date as time) >= '22:00:00' and  CAST(Submission_Date as time) <= '23:59:59')" +
            //         " union "+
            //         " select 'Total'Time, count(*) as Count from DCRMain_Trans where Month(Submission_Date) ='" + Month + "' and Year(Submission_Date) = '" + Year + "' and Division_Code =  '" + divcode + "' " ;

            strQry = "EXEC Sp_Get_DCR_Time_Count '" + Month + "', '" + Year + "', '" + Date + "' ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //start
        public DataSet sp_Get_DCRCount_Current_Pending_date_Count_new(string sf_code, string divcode, string iMonth, string iYear, string StrVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC sp_Get_DCRCount_Current_Pending_date_Count_DCR '" + sf_code + "', '" + divcode + "','" + iMonth + "','" + iYear + "','" + StrVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet sp_UserListMr_FieldForce_New_new(string sf_code, string divcode, string iMonth, string iYear, string StrVacant)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            // strQry = "EXEC sp_get_Rep_audit_with_Vacant '" + sf_code + "', '" + divcode + "' ";

            //strQry = "EXEC sp_Get_DCRCount_View_New_DCR'" + sf_code + "', '" + divcode + "','" + iMonth + "','" + iYear + "','" + StrVacant + "' ";
            strQry = "EXEC sp_Get_DCRCount_View_New_DCR_DEV'" + sf_code + "', '" + divcode + "','" + iMonth + "','" + iYear + "','" + StrVacant + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //27/1/22
        //---hierarchy wise done by js

        public DataSet getBank_Details()
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "EXEC SP_Get_Bank_Details";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet getSFCodeInfo(string sf_code, string div_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProCat = null;

            strQry = " SELECT Distinct sf_code,sf_name,sf_emp_id,Convert(varchar(10),sf_joining_date,110)Sf_Joining_Date,sf_Designation_Short_Name,sf_hq FROM Mas_salesforce " +
                " Where sf_code='" + sf_code + "'  AND division_code='" + div_code + ",'";
            try
            {
                dsProCat = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProCat;
        }
        public DataSet getSFCodeWorkType(string ddlFieldForce, string div_code, string ddlMonth, string ddlYear, string ddlDay)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsProCat = null;

            //strQry = " select WorkType_Name from DCRMain_Trans WHERE YEAR(Activity_Date)= " + ddlYear + "  and MONTH(Activity_Date)= " + ddlMonth + " and day(Activity_Date)= " + ddlDay + " and Sf_Code = '" + ddlFieldForce + "' and  Division_Code=" + div_code + " ";

            strQry = " select WorkType_Name from DCRMain_Trans WHERE YEAR(Activity_Date)= " + ddlYear + "  and MONTH(Activity_Date)= " + ddlMonth + " and day(Activity_Date)= " + ddlDay + " and Sf_Code = '" + ddlFieldForce + "' and  Division_Code=" + div_code +
              "UNION ALL " +
              " select WorkType_Name from DCRMain_Temp WHERE YEAR(Activity_Date)= " + ddlYear + "  and MONTH(Activity_Date)= " + ddlMonth + " and day(Activity_Date)= " + ddlDay + " and Sf_Code = '" + ddlFieldForce + "' and  Division_Code=" + div_code;
            try
            {
                dsProCat = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsProCat;
        }

        //start
        //sujee 29 march 2022
        public DataSet salesforce_list_hie(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC salesforce_list_hie '" + divcode + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet salesforce_name_hq_header(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC salesforce_name_hq '" + divcode + "', '" + sf_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //end

        #region selva
        public DataSet DCR_Missed_Dates(string divcode, string sf_code, string cmonth, string cyear)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            // strQry = "EXEC Missed_Dates '" + sf_code + "', '" + divcode + "'," + cmonth + "," + cyear + " ";
            strQry = "EXEC Missed_Dates_Test2 '" + sf_code + "', '" + divcode + "'," + cmonth + "," + cyear + " ";
            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet getSfCode_mrVacant(string Month, string Year)
        {
            DB_EReporting db_ER = new DB_EReporting();
            DataSet dsSF = null;
            strQry = " select (a.Sf_Name + '-' + a.sf_Designation_Short_Name+'-' + a.Sf_HQ)Employee_Name,b.Employee_Id from Mas_Salesforce a,PaySlip_2 b where sf_TP_Active_Flag='1' and a.sf_emp_id=b.Employee_Id and b.Pay_Month='" + Month + "' and b.Pay_Year='" + Year + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        #endregion
        //sujee //30 may 2022
        //start
        public DataSet sp_Tp_fielforce(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_Tp_fielforce '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        //end
        public DataSet FillAudit_Team_List(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsDivision = null;
            strQry = "select A.[S No] as Audit_Id,A.Sf_Code,B.Sf_Name,Sf_UserName,sf_emp_id,Sf_HQ,C.Designation_Short_Name as Designation_Name from Mas_Sf_Audit_Team A join Mas_Salesforce B on A.Sf_Code = B.Sf_Code" +
                     " join Mas_SF_Designation C on C.Designation_Code = b.Designation_Code" +
                      " where A.Division_Code = '" + divcode + "'";

            try
            {
                dsDivision = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsDivision;
        }


        public int Delete_Audit_Id(string sf_code, string Audit_ID)
        {
            int iReturn = -1;
            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "Delete from Mas_Sf_Audit_Team where [S No]='" + Audit_ID + "' and Sf_Code='" + sf_code + "'";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return iReturn;
        }

        public DataSet sp_UserList_get_Doc_List(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_UserList_get_Doc_List '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // start - mary 19/10/2022
        public int Sub_HO_ID_RecordAdd_With_Emp(string username, string password, string name, string menu, string div_code, string reporting_to, string reporting_to_name, string Ho_Id, string Emp_id, string dcr)
        {
            int iReturn = -1;
            if (!RecordExistAddSub(username, Ho_Id))
            {
                try
                {
                    DB_EReporting db = new DB_EReporting();
                    strQry = "SELECT isnull(max(HO_ID)+1,'1') HO_ID from mas_ho_id_creation ";
                    int HO_IDNew = db.Exec_Scalar(strQry);

                    strQry = "INSERT INTO mas_ho_id_creation VALUES ('" + HO_IDNew + "' ,'" + username + "' ,'" + password + "','" + name + "', '" + menu + "', '" + div_code + "', '" + reporting_to + "', '" + reporting_to_name + "',getdate(),getdate(),'0','" + Ho_Id + "',NULL,'" + Emp_id + "','" + dcr + "') ";
                    iReturn = db.ExecQry(strQry);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            else
            {
                iReturn = -2;
            }
            return iReturn;
        }
        public int Update_Sub_HO_Id_With_Emp(int HO_Id, string Name, string User_Name, string Password, string div_code, string Emp_Id, string Dcr)
        {
            int iReturn = -1;
            if (!RecordExistSub(User_Name, HO_Id))
            {

                try
                {
                    DB_EReporting db = new DB_EReporting();

                    strQry = "Update Mas_HO_ID_Creation " +
                             "SET Name = '" + Name + "' ," +
                             "User_Name = '" + User_Name + "' ," +
                             "Password ='" + Password + "' ," +
                             "Division_Code ='" + div_code + "'," +
                             "Emp_Id ='" + Emp_Id + "'," +
                             "Dcr_Joint_Work_Display ='" + Dcr + "'," +
                             "LastUpdt_Date = getdate() " +
                             "WHERE HO_ID ='" + HO_Id + "' and HO_Active_Flag =0";

                    iReturn = db.ExecQry(strQry);
                }
                catch (Exception ex)
                {
                    throw ex;
                }
            }

            else
            {
                iReturn = -2;
            }
            return iReturn;
        }
        public DataSet samplemnthyr(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "select SI_EM_Month,SI_EM_Year from setup_others where Division_Code = '" + divcode + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet inputmnthyr(string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;

            strQry = "select IN_EM_Month,IN_EM_Year from setup_others where Division_Code = '" + divcode + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // start - mary - 03/12/2022
        public DataSet sp_get_Rep_access_All_User_DeviceLock(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_access_All_User_DeviceLock '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public DataSet SalesForceListMgrGet_MRonly(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet_MRonly '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int Device_Lock_Update(string sf_code, int AndoridApp, int IOSApp, int AndoridDetailing, int IOSDetailing)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "update Access_Table set Android_App='" + AndoridApp + "',ios_app='" + IOSApp + "',Android_Detailing='" + AndoridDetailing + "',ios_Detailing='" + IOSDetailing + "' where SF_Code='" + sf_code + "' ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public DataSet SalesForceListMgrGet_Active_Only(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet_Active_Only '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet SalesForceListMgrGet_Vacant_Only(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_SalesForceMgrGet_Only_Vacant '" + divcode + "', '" + sf_code + "'   ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        // end
        public int sampleinputEditinsert(string sf_code, string div_code, int Sample, int Input)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "insert into Option_Sample_Input_Edit (Sl_No,Division_Code,Created_date,Sf_Code,Sample_Edit_Flag,Input_Edit_Flag)" +
                    "VALUES((SELECT ISNULL(max(Sl_No),0)+1 FROM Option_Sample_Input_Edit),'" + div_code + "' ,getdate(),'" + sf_code + "','" + Sample + "','" + Input + "')";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public DataSet sampleinputchk(string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "select count(sf_code) cnt from Option_Sample_Input_Edit where SF_Code='" + sf_code + "'";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

        public int sampleinputEditUpdate(string sf_code, string div_code, int Sample, int Input)
        {
            int iReturn = -1;

            try
            {
                DB_EReporting db = new DB_EReporting();

                strQry = "update Option_Sample_Input_Edit set Sample_Edit_Flag='" + Sample + "',Input_Edit_Flag='" + Input + "',Updated_date=getdate() where Sf_Code='" + sf_code + "' and Division_Code='" + div_code + "' ";

                iReturn = db.ExecQry(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }

            return iReturn;
        }
        public DataSet sp_get_Rep_access_All_User_sampleinput(string sf_code, string divcode)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC sp_get_Rep_access_All_User_sampleinput '" + sf_code + "', '" + divcode + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }
        public DataSet AllFieldforce_MR_Novacant(string divcode, string sf_code)
        {
            DB_EReporting db_ER = new DB_EReporting();

            DataSet dsSF = null;
            strQry = "EXEC AllFieldforce_MR_Novacant '" + divcode + "', '" + sf_code + "' ";

            try
            {
                dsSF = db_ER.Exec_DataSet(strQry);
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return dsSF;
        }

    }


}